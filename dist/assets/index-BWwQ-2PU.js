const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/supabase-vendor-BeTA44qk.js","assets/map-vendor-ChI9isOj.js","assets/map-vendor--d70tv_y.css"])))=>i.map(i=>d[i]);
var at=Object.defineProperty;var rt=(a,s,t)=>s in a?at(a,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[s]=t;var Se=(a,s,t)=>rt(a,typeof s!="symbol"?s+"":s,t);import{c as He,R as D,r as o,j as e,L as js,z as xe,a as be,S as ye,X as G,U as nt,C as it,b as lt,A as ct,M as ot,d as Q,e as Re,B as W,f as Y,g as ss,h as Je,F as ys,i as ge,k as Oe,T as ee,l as dt,P as ne,D as le,m as ue,Z as oe,n as ce,o as Ye,p as Te,q as B,s as Ze,t as me,u as Z,v as $e,w as fe,G as mt,x as Ie,y as xt,E as vs,H as Ns,I as ws,J as je,K as _s,N as Ss,O as re,Q as ut,V as ht,W as Ae,Y as Fe,_ as Cs,$ as Xe,a0 as qe,a1 as gt,a2 as Le,a3 as pt,a4 as ft,a5 as bt,a6 as jt,a7 as ks,a8 as yt,a9 as vt,aa as Nt,ab as wt,ac as _t,ad as St,ae as De,af as Ct}from"./react-vendor-D_IsruGy.js";import{m as Ps}from"./map-vendor-ChI9isOj.js";import{c as kt,_ as Ke}from"./supabase-vendor-BeTA44qk.js";import{p as Pt}from"./state-vendor-BPg30LFv.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const x of i.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&r(x)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}})();const K=He((a,s)=>({openDrawer:null,setDrawer:t=>a({openDrawer:t}),closeDrawer:()=>a({openDrawer:null}),selectedParcel:null,setSelectedParcel:t=>a({selectedParcel:t}),filterModalOpen:!1,setFilterModal:t=>a({filterModalOpen:t}),filterMode:"all",colorMode:"zoning",zoningFilters:{activeZones:[]},selectionMode:"single",selectedParcelIds:[],setFilterMode:t=>a({filterMode:t}),setColorMode:t=>a({colorMode:t}),setZoningFilters:t=>a({zoningFilters:t}),setSelectionMode:t=>a({selectionMode:t}),addSelectedParcel:t=>a(r=>({selectedParcelIds:[...r.selectedParcelIds.filter(n=>n!==t),t]})),removeSelectedParcel:t=>a(r=>({selectedParcelIds:r.selectedParcelIds.filter(n=>n!==t)})),clearSelectedParcels:()=>a({selectedParcelIds:[]}),leftNavOpen:!1,setLeftNavOpen:t=>a({leftNavOpen:t}),isMobile:!1,setIsMobile:t=>a({isMobile:t}),commandPaletteOpen:!1,setCommandPalette:t=>a({commandPaletteOpen:t}),commentsOpen:!1,setCommentsOpen:t=>a({commentsOpen:t})})),Rs=()=>{const{openDrawer:a,setDrawer:s,closeDrawer:t,setFilterModal:r,setCommandPalette:n,commandPaletteOpen:i}=K();D.useEffect(()=>{const x=l=>{if(l.key==="Escape"){i?n(!1):K.getState().filterModalOpen?r(!1):t();return}if((l.metaKey||l.ctrlKey)&&l.key==="k"){l.preventDefault(),n(!0);return}if(l.key==="/"&&l.shiftKey&&l.code==="KeyC"){l.preventDefault(),K.getState().setCommentsOpen(!0);return}l.ctrlKey&&l.shiftKey&&(l.key==="["?(l.preventDefault(),s(a==="PROJECT"?"UNDERWRITING":"PROJECT")):l.key==="]"&&(l.preventDefault(),s(a==="UNDERWRITING"?"PROJECT":"UNDERWRITING")))};return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[a,s,t,r,n,i])},Rt=Object.freeze(Object.defineProperty({__proto__:null,useKeyboardShortcuts:Rs,useUIStore:K},Symbol.toStringTag,{value:"Module"}));console.log("VITE_SUPABASE_URL:","https://okxrvetbzpoazrybhcqj.supabase.co");console.log("VITE_SUPABASE_ANON_KEY present:",!0);const At="https://okxrvetbzpoazrybhcqj.supabase.co",Ft="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9reHJ2ZXRienBvYXpyeWJoY3FqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY1ODkxNDcsImV4cCI6MjA2MjE2NTE0N30.diq6x_Kr5_GxPSHJT1gm54Jh2UTiGVrBNgxDmV3yMxI",q=kt(At,Ft),ie=He((a,s)=>({id:null,name:null,selectedParcels:new Set,isLoading:!1,error:null,set:(t,r=null)=>{const n=s().id;a({id:t,name:r,selectedParcels:new Set,error:null}),t&&q&&t!==n&&s().loadProjectParcels(t)},addParcel:async(t,r)=>{const n=s();if(console.log("🔍 addParcel called:",{parcelId:t,parcelData:r,activeProjectId:n.id,currentParcels:n.selectedParcels.size}),!n.id){console.warn("No active project - cannot add parcel");return}const i=String(t);if(n.selectedParcels.has(i)){console.log("Parcel already exists in project"),a({error:"Parcel already in project"}),setTimeout(()=>a({error:null}),3e3);return}const x=n.selectedParcels.size===0,l=new Set([...n.selectedParcels,i]);console.log("🔍 Adding parcel to project:",{pid:i,newParcelsSize:l.size}),a({selectedParcels:l,isLoading:!0,error:null});try{if(q){const{error:m}=await q.from("project_parcels").upsert({project_id:n.id,parcel_id:i,added_at:new Date().toISOString(),parcel_data:r||null});if(m)throw console.error("Supabase error:",m),m}if(a({isLoading:!1}),console.log("✅ Parcel successfully added to project:",{pid:i,projectId:n.id}),a({error:"Parcel added to project ✓"}),setTimeout(()=>a({error:null}),2500),x&&typeof window<"u"){const{useUIStore:m}=await Ke(async()=>{const{useUIStore:h}=await Promise.resolve().then(()=>Rt);return{useUIStore:h}},void 0);m.getState().setDrawer("PROJECT")}}catch(m){console.error("Failed to add parcel:",m),a({selectedParcels:n.selectedParcels,isLoading:!1,error:`Failed to add parcel: ${m.message||"Unknown error"}`}),setTimeout(()=>a({error:null}),3e3)}},removeParcel:async t=>{const r=s();if(!r.id)return;const n=String(t),i=r.selectedParcels,x=new Set([...r.selectedParcels].filter(l=>l!==n));a({selectedParcels:x,isLoading:!0,error:null});try{if(q){const{error:l}=await q.from("project_parcels").delete().match({project_id:r.id,parcel_id:n});if(l)throw l}a({isLoading:!1}),a({error:"Parcel removed ✓"}),setTimeout(()=>a({error:null}),2e3)}catch(l){console.error("Failed to remove parcel:",l),a({selectedParcels:i,isLoading:!1,error:`Failed to remove parcel: ${l.message||"Unknown error"}`}),setTimeout(()=>a({error:null}),4e3)}},clear:()=>{a({id:null,name:null,selectedParcels:new Set,isLoading:!1,error:null})},loadProjectParcels:async t=>{if(q)try{a({isLoading:!0});const{data:r,error:n}=await q.from("project_parcels").select("parcel_id").eq("project_id",t);if(n)throw n;const i=r?.map(x=>x.parcel_id)||[];a({selectedParcels:new Set(i),isLoading:!1})}catch{a({isLoading:!1,error:"Failed to load project parcels"}),setTimeout(()=>a({error:null}),3e3)}}})),Mt=a=>Array.from(a);function Ve(){const{selectedParcels:a,id:s,name:t}=ie(),r=o.useMemo(()=>a?a instanceof Set?Mt(a):Array.isArray(a)?a.filter(i=>i!=null).map(String):typeof a=="object"?Object.values(a??{}).filter(i=>i!=null).map(String):[]:[],[a]),n=o.useMemo(()=>({count:r.length,hasSelection:r.length>0,isEmpty:r.length===0,isSingle:r.length===1,isMultiple:r.length>1,map:i=>r.map(i),filter:i=>r.filter(i),forEach:i=>r.forEach(i),find:i=>r.find(i),includes:i=>r.includes(i),first:r[0]||null,last:r[r.length-1]||null,reduce:(i,x)=>r.reduce(i,x)}),[r]);return{parcelIds:r,selectedParcels:new Set(r),activeProjectId:s,activeProjectName:t,...n,raw:a}}const As=()=>({role:"analyst",id:"user-1",name:"Demo User"}),ts={viewer:1,analyst:2,manager:3,admin:4},Ue=(a,s)=>{const t=ts[a];return s.some(r=>t>=ts[r])};function Pe({roles:a,children:s,fallback:t,disabled:r=!1,tooltip:n}){const i=As();return Ue(i.role,a)?r?e.jsx("div",{className:"opacity-50 pointer-events-none",children:s}):e.jsx(e.Fragment,{children:s}):t?e.jsx(e.Fragment,{children:t}):e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"opacity-50 pointer-events-none",children:s}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-75 rounded",children:e.jsxs("div",{className:"flex items-center space-x-1 text-gray-500",children:[e.jsx(js,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-xs font-medium",children:[a.join("/")?.toUpperCase(),"+"]})]})}),n&&e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50",children:n})]})}function Fs(){const a=As();return{user:a,hasRole:s=>Ue(a.role,s),isViewer:a.role==="viewer",isAnalyst:Ue(a.role,["analyst"]),isManager:Ue(a.role,["manager"]),isAdmin:a.role==="admin"}}function It({isOpen:a,onClose:s,projectId:t,projectName:r}){const{hasRole:n}=Fs(),[i,x]=o.useState("share"),[l,m]=o.useState(""),[h,d]=o.useState("viewer"),[c,u]=o.useState(""),[g,v]=o.useState(!1),[w,y]=o.useState(null),[j,b]=o.useState(null),[N,p]=o.useState(!1),_=`${window.location.origin}/project/${t}`,S=async()=>{try{await navigator.clipboard.writeText(_),p(!0),setTimeout(()=>p(!1),2e3)}catch{b("Failed to copy link")}},C=async()=>{if(!l.trim()){b("Email address is required");return}if(!n(["manager"])){b("Only managers and admins can send invites");return}v(!0),b(null);try{const{error:M}=await q.from("project_members").insert({project_id:t,email:l.trim(),role:h,invited_by:"current-user-id",invited_at:new Date().toISOString(),status:"pending",message:c.trim()||null});if(M)throw M;const{error:f}=await q.functions.invoke("send-invite",{body:{email:l.trim(),projectId:t,projectName:r,role:h,inviteUrl:`${_}?invite=true`,message:c.trim()}});f&&console.warn("Email send failed:",f),y(`Invitation sent to ${l}`),m(""),u(""),setTimeout(()=>y(null),3e3)}catch(M){console.error("Invite error:",M),b(`Failed to send invitation: ${M.message}`)}finally{v(!1)}},A=()=>{m(""),d("viewer"),u(""),b(null),y(null),p(!1)},k=()=>{A(),s()};return e.jsx(xe,{show:a,as:D.Fragment,children:e.jsxs(be,{as:"div",className:"relative z-50",onClose:k,children:[e.jsx(xe.Child,{as:D.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsx(xe.Child,{as:D.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(be.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all",children:[e.jsxs(be.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ye,{className:"w-5 h-5"}),e.jsx("span",{children:"Share Project"})]}),e.jsx("button",{onClick:k,className:"p-1 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"mt-4",children:e.jsx("p",{className:"text-sm text-gray-600",children:r})}),e.jsxs("div",{className:"flex mt-4 bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>x("share"),className:`flex-1 flex items-center justify-center space-x-2 px-3 py-2 text-sm font-medium rounded-md transition-colors ${i==="share"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{children:"Share Link"})]}),e.jsxs("button",{onClick:()=>x("invite"),className:`flex-1 flex items-center justify-center space-x-2 px-3 py-2 text-sm font-medium rounded-md transition-colors ${i==="invite"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,disabled:!n(["manager"]),children:[e.jsx(nt,{className:"w-4 h-4"}),e.jsx("span",{children:"Invite"})]})]}),i==="share"&&e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project Link"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:_,readOnly:!0,className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-sm"}),e.jsx("button",{onClick:S,className:`px-3 py-2 rounded-lg font-medium transition-colors ${N?"bg-green-600 text-white":"bg-blue-600 text-white hover:bg-blue-700"}`,children:N?e.jsx(it,{className:"w-4 h-4"}):e.jsx(lt,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Anyone with this link can view the project"})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-1",children:"Sharing Permissions"}),e.jsxs("ul",{className:"text-xs text-blue-700 space-y-1",children:[e.jsx("li",{children:"• Viewers can see parcels and analysis"}),e.jsx("li",{children:"• Link sharing requires no sign-up"}),e.jsx("li",{children:"• Data is read-only for shared viewers"})]})]})]}),i==="invite"&&e.jsxs("div",{className:"mt-4 space-y-4",children:[n(["manager"])?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:l,onChange:M=>m(M.target.value),placeholder:"colleague@company.com",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus-ring"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role"}),e.jsxs("select",{value:h,onChange:M=>d(M.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus-ring",children:[e.jsx("option",{value:"viewer",children:"Viewer - Can view only"}),e.jsx("option",{value:"analyst",children:"Analyst - Can analyze and export"}),e.jsx("option",{value:"manager",children:"Manager - Can edit and invite"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Message (Optional)"}),e.jsx("textarea",{value:c,onChange:M=>u(M.target.value),placeholder:"Add a personal message...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus-ring resize-none"})]})]}):e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 p-3 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ct,{className:"w-4 h-4 text-yellow-600"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"Only managers and admins can send invitations"})]})}),j&&e.jsx("div",{className:"bg-red-50 border border-red-200 p-3 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-700",children:j})}),w&&e.jsx("div",{className:"bg-green-50 border border-green-200 p-3 rounded-lg",children:e.jsx("p",{className:"text-sm text-green-700",children:w})})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{onClick:k,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Close"}),i==="invite"&&n(["manager"])&&e.jsxs("button",{onClick:C,disabled:g||!l.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:[g?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(ot,{className:"w-4 h-4"}),e.jsx("span",{children:g?"Sending...":"Send Invite"})]})]})]})})})})]})})}function zt({onOpenUnifiedWorkspace:a,onOpenProjectWorkflow:s,onOpenSimpleProjectManager:t,onOpenConnectedProjectWorkflow:r,onOpenUnifiedProjectWorkflow:n,onOpenRealUnderwritingWorkflow:i,onOpenWorkflowAudit:x,onOpenWorkflowConnectionTest:l,onOpenParcelAnalysisDemo:m}){const{setDrawer:h,setFilterModal:d,openDrawer:c,setCommandPalette:u}=K(),{activeProjectId:g,activeProjectName:v}=Ve(),{set:w,clear:y}=ie(),[j,b]=D.useState(!1),[N,p]=D.useState(0),[_,S]=D.useState(!1);D.useEffect(()=>{p(g?Math.floor(Math.random()*5):0)},[g]);const[C,A]=D.useState(!1),k=[{id:"demo-1",name:"Demo Project"},{id:"nashville-dev",name:"Nashville Development"},{id:"mixed-use-23",name:"Mixed Use 2023"}],M=f=>{g===f.id?y():w(f.id,f.name),A(!1)};return e.jsxs("header",{className:"bg-white border-b border-gray-200 px-4 md:px-6 py-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 min-w-0 flex-shrink-0",children:[e.jsx("div",{className:"bg-blue-600 p-2 rounded-lg",children:e.jsx(Q,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Parcel Intelligence"}),e.jsx("p",{className:"text-sm text-gray-600 hidden sm:block",children:"Real Estate Investment Platform"})]})]}),e.jsx("div",{className:"flex-1 max-w-md mx-4 md:mx-8 hidden lg:block","data-testid":"desktop-search",children:e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by address, parcel ID, or coordinates...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus-ring","aria-label":"Search parcels","data-testid":"search-input",onClick:()=>u(!0),readOnly:!0}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded",children:"⌘K"})})]})}),e.jsxs("div",{className:"flex items-center space-x-1 md:space-x-3 flex-shrink-0 kpi-bar","data-testid":"header-actions",children:[e.jsxs("div",{className:"hidden md:flex items-center space-x-2 text-sm text-gray-600 flex-wrap",children:[e.jsx("span",{"data-testid":"location-indicator",children:g?`Active: ${v}`:"Nashville Metro"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:"Real-time Data"})]}),e.jsx("div",{className:"hidden md:block w-px h-6 bg-gray-300 mx-2"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>A(!C),className:`flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors font-medium ${g?"bg-green-100 text-green-700 border border-green-200":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,"data-testid":"project-dropdown",children:[e.jsx(W,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm hidden md:inline","data-testid":"active-project-name",children:g?v:"Project"}),e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),C&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white border border-gray-200 rounded-lg shadow-lg z-50","data-testid":"project-menu",children:e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 px-3 py-2 uppercase tracking-wider",children:"Select Project"}),k.map(f=>e.jsx("button",{onClick:()=>M(f),className:`w-full text-left px-3 py-2 text-sm rounded-md transition-colors ${g===f.id?"bg-green-100 text-green-700 font-medium":"text-gray-700 hover:bg-gray-100"}`,"data-testid":`project-${f.id}`,children:f.name},f.id)),e.jsx("hr",{className:"my-2"}),e.jsx("button",{onClick:()=>{y(),A(!1)},className:"w-full text-left px-3 py-2 text-sm rounded-md text-gray-500 hover:bg-gray-100","data-testid":"no-active-project",children:"No Active Project"})]})})]}),e.jsxs("button",{onClick:n,className:"flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors font-medium bg-green-600 text-white hover:bg-green-700","data-testid":"unified-project-workflow-button",title:"Open unified project workflow","aria-label":"Open unified project workflow",children:[e.jsx(W,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm hidden md:inline",children:"New Project"})]}),e.jsxs("button",{onClick:i,className:"flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors font-medium bg-purple-600 text-white hover:bg-purple-700","data-testid":"real-underwriting-workflow-button",title:"Open real underwriting workflow","aria-label":"Open real underwriting workflow",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm hidden md:inline",children:"Underwriting"})]}),e.jsxs("button",{onClick:l,className:"flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors font-medium bg-gray-600 text-white hover:bg-gray-700","data-testid":"workflow-connection-test-button",title:"Test workflow connections","aria-label":"Test workflow connections",children:[e.jsx(ss,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm hidden md:inline",children:"Test"})]}),e.jsxs("button",{onClick:m,className:"flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors font-medium bg-blue-600 text-white hover:bg-blue-700","data-testid":"parcel-analysis-demo-button",title:"Parcel Analysis Demo","aria-label":"Open Parcel Analysis Demo",children:[e.jsx(W,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm hidden md:inline",children:"Analysis Demo"})]}),e.jsxs("button",{onClick:()=>h(c==="UNDERWRITING"?null:"UNDERWRITING"),className:`flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors font-medium ${c==="UNDERWRITING"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,"data-testid":"analysis-button",title:"Financial analysis and underwriting","aria-label":"Open financial analysis",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm hidden md:inline",children:"Analysis"})]}),g&&e.jsxs("button",{onClick:()=>h(c==="SCENARIO_COMPARE"?null:"SCENARIO_COMPARE"),className:`flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors font-medium ${c==="SCENARIO_COMPARE"?"bg-purple-100 text-purple-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,"data-testid":"scenario-compare-button",title:"Compare development scenarios",children:[e.jsx(Je,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm hidden md:inline",children:"Compare"})]}),g&&e.jsx(Pe,{roles:["manager"],children:e.jsxs("button",{onClick:()=>b(!0),className:"flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100","data-testid":"share-button",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm hidden md:inline",children:"Share"})]})}),e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors","data-testid":"filters-button",children:[e.jsx(ys,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium hidden md:inline",children:"Filters"})]}),e.jsx("button",{className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors focus-ring","aria-label":"Settings","data-testid":"header-settings",children:e.jsx(ge,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>u(!0),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors focus-ring","aria-label":"Command palette","data-testid":"command-palette-button",children:e.jsx(ss,{className:"w-4 h-4"})}),g&&e.jsxs("button",{className:"relative p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors focus-ring","aria-label":"Comments","data-testid":"comments-button",children:[e.jsx(Oe,{className:"w-4 h-4"}),N>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-medium",children:N>9?"9+":N})]}),e.jsx("button",{className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors lg:hidden focus-ring","aria-label":"Toggle search","data-testid":"mobile-search-toggle",children:e.jsx(Re,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"mt-4 lg:hidden hidden",id:"mobile-search","data-testid":"mobile-search",children:e.jsxs("div",{className:"relative",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by address, parcel ID, or coordinates...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent","data-testid":"mobile-search-input",onClick:()=>u(!0),readOnly:!0})]})}),g&&e.jsx(It,{isOpen:j,onClose:()=>b(!1),projectId:g,projectName:v||"Untitled Project"})]})}const Et="pk.eyJ1IjoiZW1ydXNzMyIsImEiOiJjamlkcHY1aTAwY3I3M3FyeHAxc3Nia2VqIn0.mxsGEk2I8Ygkf3Q_zJKMcw";Ps.accessToken=Et;const Be={longitude:-86.7816,latitude:36.1627,zoom:12},Ot="mapbox://styles/mapbox/light-v11";function as(){return["case",["<",["to-number",["get","sqft"]],1e3],"#f87171",["<",["to-number",["get","sqft"]],2e3],"#fb923c",["<",["to-number",["get","sqft"]],5e3],"#60a5fa",["<",["to-number",["get","sqft"]],2e4],"#3b82f6","#1e3a8a"]}function rs(){return["match",["slice",["to-string",["get","zoning"]],0,2],"RS","#22c55e","RM","#6366f1","MU","#ef4444","CS","#f59e0b","CN","#f59e0b","SP","#a855f7","AG","#10b981","#93a3b5"]}const Dt=D.memo(function({onParcelClick:s,selectedParcelIds:t,activeProjectId:r,activeProjectName:n}){const i=o.useRef(null),x=o.useRef(null),[l,m]=D.useState(null),[h,d]=D.useState(null),{filterMode:c,zoningFilters:u}=K(),g=o.useMemo(()=>c==="large"?[">=",["to-number",["get","sqft"]],5e3]:c==="huge"?[">=",["to-number",["get","sqft"]],2e4]:!0,[c]),v=o.useMemo(()=>{const b=u?.activeZones??[];return b.length?["in",["to-string",["get","zoning"]],...b]:!0},[u?.activeZones]),w=o.useMemo(()=>["all",g,v],[g,v]);o.useEffect(()=>{if(i.current||!x.current)return;const b=new Ps.Map({container:x.current,style:Ot,center:[Be.longitude,Be.latitude],zoom:Be.zoom,maxZoom:17,transformRequest:N=>{if(N.includes("/functions/v1/mvt-parcels"))return{url:N}}});return b.on("load",()=>{b.getSource("parcels")||(b.addSource("parcels",{type:"vector",tiles:["https://okxrvetbzpoazrybhcqj.supabase.co/functions/v1/mvt-parcels?z={z}&x={x}&y={y}"],minzoom:10,maxzoom:17,promoteId:"ogc_fid"}),b.addLayer({id:"parcels-fill",type:"fill",source:"parcels","source-layer":"parcels",paint:{"fill-color":"#1d4ed8","fill-opacity":.15}}),b.addLayer({id:"parcels-outline",type:"line",source:"parcels","source-layer":"parcels",paint:{"line-color":["case",["boolean",["feature-state","inProject"],!1],"#f59e0b","#1d4ed8"],"line-width":1}}),b.on("mouseenter","parcels-fill",()=>b.getCanvas().style.cursor="pointer"),b.on("mouseleave","parcels-fill",()=>b.getCanvas().style.cursor=""),b.on("click","parcels-fill",async N=>{const p=N.features?.[0]??b.queryRenderedFeatures(N.point,{layers:["parcels-fill"]})[0],{setDrawer:_,setSelectedParcel:S}=K.getState(),{activeProjectId:C,addParcel:A}=ie.getState();try{const{createClient:k}=await Ke(async()=>{const{createClient:I}=await import("./supabase-vendor-BeTA44qk.js").then(P=>P.i);return{createClient:I}},__vite__mapDeps([0,1,2])),M=k("https://okxrvetbzpoazrybhcqj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9reHJ2ZXRienBvYXpyeWJoY3FqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY1ODkxNDcsImV4cCI6MjA2MjE2NTE0N30.diq6x_Kr5_GxPSHJT1gm54Jh2UTiGVrBNgxDmV3yMxI");let f=null;const R=Number(p?.id??p?.properties?.ogc_fid);if(Number.isFinite(R)){const{data:I,error:P}=await M.rpc("get_parcel_by_id",{p_ogc_fid:R});if(P)throw P;f=Array.isArray(I)?I[0]:I}else{const{lng:I,lat:P}=N.lngLat,{data:F,error:z}=await M.rpc("get_parcel_at_point",{lon:I,lat:P});if(z)throw z;f=Array.isArray(F)?F[0]:F}if(!f?.geometry||!Array.isArray(f.geometry.coordinates)||!f.geometry.coordinates.length){console.warn("Click had no parcel geometry; ignoring.");return}const E=f.ogc_fid??f.id??null;if(E==null){console.warn("Click had no valid parcel ID; ignoring.");return}const O={ogc_fid:String(E),parcelnumb:f.parcelnumb??null,address:f.address??null,zoning:f.zoning??null,sqft:f.sqft??null,geometry:f.geometry};C?(await A(String(E),O),_("PROJECT")):s(O)}catch(k){console.error("parcel click failed",k)}}),b.on("click",N=>{const p=b.queryRenderedFeatures(N.point,{layers:["parcels-fill"]})[0];p&&(console.log("click →",{id:p.id,props:p.properties,source:p.source,sourceLayer:p.sourceLayer}),console.log("Available properties:",Object.keys(p.properties||{})))}))}),b.on("error",N=>{console.error("Map error:",N.error),N.error?.message?.includes("access token")?d("invalid-token"):d("general-error")}),i.current=b,()=>{i.current&&(i.current.remove(),i.current=null)}},[]);const y=o.useCallback(()=>{const b=i.current;if(!b||!b.getSource("parcels"))return;b.querySourceFeatures&&b.querySourceFeatures("parcels",{sourceLayer:"parcels"}).forEach(S=>{S.id&&b.setFeatureState({source:"parcels",sourceLayer:"parcels",id:S.id},{inProject:!1})});const N=ie.getState().selectedParcels;(Array.isArray(N)?N:Array.from(N||[])).forEach(_=>{const S=parseInt(_);Number.isFinite(S)&&b.setFeatureState({source:"parcels",sourceLayer:"parcels",id:S},{inProject:!0})})},[]);o.useEffect(()=>{const b=i.current;b&&b.isStyleLoaded()?y():b&&b.once("styledata",y);const N=ie.subscribe(p=>p.selectedParcels,y);return()=>N()},[y]),o.useEffect(()=>{const b=()=>i.current?.resize();return window.addEventListener("resize",b),()=>window.removeEventListener("resize",b)},[]),o.useEffect(()=>{const b=K.subscribe(N=>N.openDrawer,(N,p)=>{N!==p&&N!==null&&setTimeout(()=>{i.current&&i.current.resize()},150)});return()=>b()},[]),o.useEffect(()=>{const b=i.current;if(!b)return;const N=()=>{if(!b.getLayer("parcels-fill")){setTimeout(N,100);return}const _=K.getState().colorMode;b.setPaintProperty("parcels-fill","fill-color",_==="zoning"?rs():as())};b.isStyleLoaded()?N():b.once("style.load",N);const p=K.subscribe(_=>_.colorMode,_=>{b.getLayer("parcels-fill")&&b.setPaintProperty("parcels-fill","fill-color",_==="zoning"?rs():as())});return()=>p()},[]);const j=o.useCallback(()=>{const b=i.current;b&&["parcels-fill","parcels-outline"].forEach(N=>{b.getLayer(N)&&b.setFilter(N,w)})},[w]);return o.useEffect(()=>{j()},[j]),o.useEffect(()=>{const b=x.current;if(!b)return;const N=()=>{const S=b.clientHeight||0;S<1?m(`Map container has zero height. Container height: ${S}px`):m(null)},p=requestAnimationFrame(()=>requestAnimationFrame(N)),_=new ResizeObserver(N);return _.observe(b),()=>{cancelAnimationFrame(p),_.disconnect()}},[]),l?e.jsx("div",{className:"flex-1 flex items-center justify-center bg-red-50",children:e.jsxs("div",{className:"text-center p-8 max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Map Container Issue"}),e.jsx("p",{className:"text-red-700 mb-4",children:l})]})}):h==="invalid-token"?e.jsx("div",{className:"flex-1 flex items-center justify-center bg-red-50",children:e.jsxs("div",{className:"text-center p-8 max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Invalid Mapbox Token"}),e.jsx("p",{className:"text-red-700 mb-4",children:"Your Mapbox access token is invalid or expired."})]})}):e.jsx("div",{ref:x,className:"relative w-full h-full flex-1 min-h-0",style:{minHeight:200},"data-testid":"map-container","data-e2e":"map-canvas"})});function Ut(){const[a,s]=o.useState(!1),[t,r]=o.useState([]),[n,i]=o.useState(new Map),x=o.useCallback(async(d,c)=>{if(c)return c;if(!d||d.length===0||!q)return null;const u=d.map(v=>v.id),g=u.sort().join("|");if(n.has(g))return n.get(g);try{const{data:v,error:w}=await q.rpc("get_assemblage_geometry",{parcel_ids:u});if(w)throw w;const y={geometry:v[0]?.geometry,totalAcres:v[0]?.total_acres||0,totalSqft:v[0]?.total_sqft||0,zoningMix:v[0]?.zoning_mix||{},boundaryCoordinates:v[0]?.boundary_coordinates||""};return i(j=>new Map(j).set(g,y)),y}catch(v){return console.error("Error getting assemblage geometry:",v),null}},[n]),l=o.useCallback(async d=>{if(!d.length||!q)return null;try{const c=d.map(v=>v.id),{data:u,error:g}=await q.rpc("calculate_unified_constraints",{parcel_ids:c});if(g)throw g;return{maxFAR:u[0]?.max_far||3,maxHeight:u[0]?.max_height_ft||45,maxCoverage:u[0]?.max_coverage_pct||40,setbacks:u[0]?.setbacks||{front:25,rear:20,side:10},limitingFactor:u[0]?.limiting_factor||"Unknown",buildableAreaSqft:u[0]?.buildable_area_sqft||0}}catch(c){return console.error("Error calculating constraints:",c),null}},[]),m=o.useCallback(async(d,c=15)=>{if(!Array.isArray(d)||!d.length||!q)return[];s(!0);try{const u=d.map(y=>y.id),{data:g,error:v}=await q.rpc("optimize_yield_scenarios",{parcel_ids:u,target_irr:c});if(v)throw v;const w=g?.map(y=>({scenarioName:y.scenario_name,farUtilization:y.far_utilization,heightUtilization:y.height_utilization,coverageUtilization:y.coverage_utilization,estimatedUnits:y.estimated_units,estimatedIRR:y.estimated_irr,estimatedROI:y.estimated_roi,constraintAnalysis:y.constraint_analysis}))||[];return r(w),w}catch(u){return console.error("Error optimizing scenarios:",u),[]}finally{s(!1)}},[]),h=o.useCallback(async(d,c)=>{if(!d.length)return null;const[u,g]=await Promise.all([x(d),l(d)]);if(!u||!g)return null;const v=Math.min(c.targetFAR,g.maxFAR),w=Math.min(c.targetHeight,g.maxHeight),y=Math.min(c.targetCoverage,g.maxCoverage),j=Math.min(u.totalSqft*(y/100),g.buildableAreaSqft),b=u.totalSqft*v,N=Math.floor(w/12),p=j*N,_=Math.min(b,p),S=Math.ceil(_/j),C=S*12,A=_/u.totalSqft,k=Math.floor(u.totalAcres*(c.unitsPerAcre||25)),M=Math.ceil(k*(c.parkingRatio||1.2));return{footprint:j,totalGSF:_,height:C,stories:S,units:k,parkingSpaces:M,coverage:j/u.totalSqft*100,far:A,buildableArea:g.buildableAreaSqft,openSpaceArea:Math.max(u.totalSqft*.15,k*100),parkingArea:M*300,amenitySpace:Math.max(2e3,k*50),averageUnitSize:_/k,constructionCost:_*180*1.3,estimatedValue:k*35e4,roiProjection:Tt(_,k,u.totalAcres),constraintAnalysis:{farUtilization:A/g.maxFAR*100,heightUtilization:C/g.maxHeight*100,coverageUtilization:j/u.totalSqft*100/g.maxCoverage*100,limitingFactor:g.limitingFactor}}},[x,l]);return{getAssemblageGeometry:x,calculateUnifiedConstraints:l,optimizeYieldScenarios:m,calculateLiveMassing:h,isOptimizing:a,optimizationResults:t,clearCache:()=>i(new Map)}}function Tt(a,s,t){const r=a*180*1.3,n=s*35e4,i=t*5e5;return(n-r-i)/(r+i)*100}const qt=D.memo(function({parcelIds:s}){const{optimizeYieldScenarios:t,isOptimizing:r}=Ut(),{activeProjectId:n}=Ve();if(!n||s.length===0)return null;const i=async()=>{try{const x=s.map(l=>({id:l,parcelnumb:`PARCEL-${l}`,address:`Address ${l}`,deededacreage:1,sqft:43560,zoning:"RM15",geometry:{},landval:5e5,parval:6e5}));await t(x)}catch(x){console.error("Optimization error:",x)}};return e.jsx("div",{className:"absolute top-20 right-4 z-20",children:e.jsxs("button",{onClick:i,disabled:r,className:`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-colors shadow-lg ${r?"bg-gray-300 text-gray-600 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"}`,children:[r?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600"}):e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{children:r?"Optimizing...":`Optimize ${s.length===1?"Site":"Assemblage"}`})]})})}),Lt=D.memo(function({onParcelClick:s}){const{activeProjectId:t,activeProjectName:r,parcelIds:n}=Ve();return e.jsxs("div",{className:"w-full h-full min-h-0 relative",children:[e.jsx(Dt,{onParcelClick:s,selectedParcelIds:n,activeProjectId:t,activeProjectName:r}),e.jsx(qt,{parcelIds:n})]})});function $t({onParcelClick:a,activeProjectName:s}){return e.jsx("div",{className:"w-full h-full min-w-0 min-h-0 flex-1 flex flex-col",style:{height:"100%"},children:e.jsx(Lt,{onParcelClick:a,activeProjectName:s})})}const he=a=>Number.isFinite(a)?a:0;function Ee(a,s){let t=0,r=0;for(const n of s)t+=n/Math.pow(1+a,r++);return t}function Vt(a,s=200,t=1e-7){const r=a.some(h=>h<0),n=a.some(h=>h>0);if(!r||!n)return NaN;let i=-.9999,x=10,l=Ee(i,a),m=Ee(x,a);if(l*m>0&&(x=100,m=Ee(x,a),l*m>0))return NaN;for(let h=0;h<s;h++){const d=(i+x)/2,c=Ee(d,a);if(Math.abs(c)<t)return d;l*c<0?(x=d,m=c):(i=d,l=c)}return(i+x)/2}function Gt(a,s,t){const r=new Array(Math.max(t+1,2)).fill(0);return r[0]=-a,r[t]=s,r}function Bt(a){const{land_cost:s=0,hard_cost:t=0,soft_cost:r=0,contingency:n=0,loan_amount:i=0,revenue:x=0,development_months:l=18}=a,m=s+t+r+n,h=Math.max(m-i,0),d=x-m,c=Math.max(x-i,0),u=Gt(h,c,Math.max(1,l)),g=Vt(u),v=Number.isFinite(g)?Math.pow(1+g,12)-1:NaN,w=m>0?d/m:NaN,y=h>0?c/h:NaN,j=h>0?d/h:NaN;return{total_cost:he(m),equity_required:he(h),profit:he(d),irr_annual_pct:he(v*100),irr_monthly_pct:he(g*100),yield_on_cost_pct:he(w*100),equity_multiple:he(y),cash_on_cash_pct:he(j*100)}}const ns={RS5:{land_cost_per_acre:4e5,hard_cost_per_sf:160,sale_price_per_unit:28e4,rent_per_unit_per_month:1400},"RS7.5":{land_cost_per_acre:45e4,hard_cost_per_sf:165,sale_price_per_unit:32e4,rent_per_unit_per_month:1600},RS10:{land_cost_per_acre:5e5,hard_cost_per_sf:170,sale_price_per_unit:35e4,rent_per_unit_per_month:1800},RS15:{land_cost_per_acre:55e4,hard_cost_per_sf:175,sale_price_per_unit:38e4,rent_per_unit_per_month:2e3},RS20:{land_cost_per_acre:6e5,hard_cost_per_sf:180,sale_price_per_unit:42e4,rent_per_unit_per_month:2200},R6:{land_cost_per_acre:8e5,hard_cost_per_sf:150,sale_price_per_unit:25e4,rent_per_unit_per_month:1500},R8:{land_cost_per_acre:9e5,hard_cost_per_sf:160,sale_price_per_unit:28e4,rent_per_unit_per_month:1650},R10:{land_cost_per_acre:1e6,hard_cost_per_sf:170,sale_price_per_unit:32e4,rent_per_unit_per_month:1800},R15:{land_cost_per_acre:12e5,hard_cost_per_sf:180,sale_price_per_unit:35e4,rent_per_unit_per_month:2e3},R20:{land_cost_per_acre:14e5,hard_cost_per_sf:190,sale_price_per_unit:38e4,rent_per_unit_per_month:2200},RM2:{land_cost_per_acre:1e6,hard_cost_per_sf:180,sale_price_per_unit:32e4,rent_per_unit_per_month:1800},RM4:{land_cost_per_acre:12e5,hard_cost_per_sf:190,sale_price_per_unit:35e4,rent_per_unit_per_month:2e3},RM6:{land_cost_per_acre:14e5,hard_cost_per_sf:200,sale_price_per_unit:38e4,rent_per_unit_per_month:2200},RM9:{land_cost_per_acre:16e5,hard_cost_per_sf:210,sale_price_per_unit:42e4,rent_per_unit_per_month:2400},RM15:{land_cost_per_acre:18e5,hard_cost_per_sf:220,sale_price_per_unit:45e4,rent_per_unit_per_month:2600},RM20:{land_cost_per_acre:2e6,hard_cost_per_sf:230,sale_price_per_unit:5e5,rent_per_unit_per_month:2800},CN:{land_cost_per_acre:15e5,hard_cost_per_sf:200,sale_price_per_sf:300,rent_per_sf_per_month:2.5},CR:{land_cost_per_acre:18e5,hard_cost_per_sf:220,sale_price_per_sf:350,rent_per_sf_per_month:3},CS:{land_cost_per_acre:22e5,hard_cost_per_sf:240,sale_price_per_sf:400,rent_per_sf_per_month:3.5},CA:{land_cost_per_acre:28e5,hard_cost_per_sf:260,sale_price_per_sf:450,rent_per_sf_per_month:4},default:{land_cost_per_acre:5e5,hard_cost_per_sf:180,sale_price_per_unit:35e4,rent_per_unit_per_month:1800}};function Wt(a){return ns[a]||ns.default}const Me=[{id:"hard_construction",label:"Hard Construction Costs & Demo",basis:"per_sf",value:275,category:"HARD"},{id:"site_work",label:"Site Work",basis:"fixed",value:3e5,category:"SITE"},{id:"permit_tap",label:"Permit & Tap Fees",basis:"per_unit",value:3500,category:"FEES"},{id:"amenities",label:"Amenities",basis:"per_sf",value:15,category:"HARD"},{id:"legal",label:"Legal",basis:"fixed",value:65e3,category:"SOFT"},{id:"architecture",label:"Architecture",basis:"percent_of_hard",value:.035,category:"SOFT"},{id:"civil",label:"Civil Engineer",basis:"fixed",value:85e3,category:"SOFT"},{id:"survey_env",label:"Survey & Environmental",basis:"fixed",value:45e3,category:"SOFT"},{id:"title_escrow",label:"Title & Escrow",basis:"fixed",value:3e4,category:"SOFT"},{id:"taxes",label:"Real Estate Taxes (pre-CO)",basis:"fixed",value:4e4,category:"SOFT"},{id:"insurance",label:"Insurance",basis:"fixed",value:55e3,category:"SOFT"},{id:"dev_fee",label:"Development Fee",basis:"percent_of_hard",value:.04,category:"SOFT"},{id:"closing_misc",label:"Closing Cost & Fees",basis:"fixed",value:25e3,category:"SOFT"},{id:"consultants",label:"Consultants & Pro Fees",basis:"fixed",value:6e4,category:"SOFT"},{id:"op_loss",label:"Op Loss",basis:"fixed",value:5e4,category:"SOFT"},{id:"marketing_ffe",label:"Marketing & FF&E",basis:"per_unit",value:2500,category:"SOFT"},{id:"misc",label:"Misc",basis:"fixed",value:25e3,category:"SOFT"},{id:"contingency",label:"Contingency",basis:"percent_of_hard",value:.07,category:"CONT"}];function is(a,s){switch(a.basis){case"fixed":return a.value;case"per_sf":return a.value*(s.buildableSf||0);case"per_unit":return a.value*(s.units||0);case"percent_of_hard":return a.value*(s.hardSubtotalExCont||0);case"percent_of_tdc":return a.value*(s.tdcBeforeFee||0);default:return 0}}function Ms(a,s){const t=new Set(["hard_construction","site_work","permit_tap","amenities"]);let r=0;for(const c of a)t.has(c.id)&&(r+=is(c,{hardSubtotalExCont:0,tdcBeforeFee:0,buildableSf:s.buildableSf,units:s.units,keys:s.keys}));let n=r;const i=[];function x(c){const u=is(c,{hardSubtotalExCont:r,tdcBeforeFee:n,buildableSf:s.buildableSf,units:s.units,keys:s.keys});i.push({id:c.id,label:c.label,amount:u,category:c.category}),n+=u}const l=["hard_construction","site_work","amenities","permit_tap","legal","architecture","civil","survey_env","title_escrow","taxes","insurance","dev_fee","closing_misc","consultants","op_loss","marketing_ffe","misc","contingency"],m=new Map(a.map(c=>[c.id,c]));for(const c of l){const u=m.get(c);u&&x(u)}for(const c of a)l.includes(c.id)||x(c);const h={HARD:0,SITE:0,FEES:0,SOFT:0,CONT:0,FIN:0};for(const c of i)h[c.category]+=c.amount;const d=Object.values(h).reduce((c,u)=>c+u,0);return{items:i,subtotals:h,tdc:d}}function Ht({program:a,onChange:s,onTotalCostChange:t}){const[r,n]=o.useState(Me),[i,x]=o.useState(!1),l=o.useMemo(()=>{const y=Ms(r,a);return t?.(y.tdc),y},[r,a,t]),m=(y,j)=>{const b=r.slice();b[y]={...b[y],...j},n(b),s?.(b)},h=()=>{const y={id:`custom_${Date.now()}`,label:"Custom Item",basis:"fixed",value:0,category:"SOFT"},j=[...r,y];n(j),s?.(j)},d=y=>{const j=r.filter((b,N)=>N!==y);n(j),s?.(j)},c=()=>{n(Me),s?.(Me)},u=y=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(y),g=y=>y.basis==="percent_of_hard"||y.basis==="percent_of_tdc"?(y.value*100).toFixed(2)+"%":y.value.toLocaleString(),v=y=>{switch(y){case"HARD":return"bg-blue-50 border-blue-200";case"SITE":return"bg-green-50 border-green-200";case"FEES":return"bg-yellow-50 border-yellow-200";case"SOFT":return"bg-purple-50 border-purple-200";case"CONT":return"bg-red-50 border-red-200";case"FIN":return"bg-gray-50 border-gray-200";default:return"bg-gray-50 border-gray-200"}},w=y=>{switch(y){case"HARD":return e.jsx(ce,{className:"w-4 h-4"});case"SITE":return e.jsx(oe,{className:"w-4 h-4"});case"FEES":return e.jsx(le,{className:"w-4 h-4"});case"SOFT":return e.jsx(Y,{className:"w-4 h-4"});case"CONT":return e.jsx(ue,{className:"w-4 h-4"});case"FIN":return e.jsx(le,{className:"w-4 h-4"});default:return e.jsx(le,{className:"w-4 h-4"})}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center space-x-2",children:[e.jsx(Y,{className:"w-5 h-5"}),e.jsx("span",{children:"Development Cost Breakdown"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>x(!i),className:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:i?"Simple View":"Advanced"}),e.jsx("button",{onClick:c,className:"px-3 py-1 text-sm bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg transition-colors",children:"Reset"})]})]}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Buildable SF:"}),e.jsx("div",{className:"font-semibold",children:a.buildableSf.toLocaleString()})]}),a.units&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Units:"}),e.jsx("div",{className:"font-semibold",children:a.units})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Lot Size:"}),e.jsxs("div",{className:"font-semibold",children:[Math.round(a.lotSqft/43560*100)/100," ac"]})]})]})}),e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-12 gap-2 text-xs font-semibold text-gray-700 uppercase tracking-wider",children:[e.jsx("div",{className:"col-span-4",children:"Item"}),e.jsx("div",{className:"col-span-2",children:"Basis"}),e.jsx("div",{className:"col-span-2",children:"Value"}),e.jsx("div",{className:"col-span-3 text-right",children:"Amount"}),e.jsx("div",{className:"col-span-1"})]})}),e.jsx("div",{className:"divide-y divide-gray-200 max-h-96 overflow-y-auto",children:r.map((y,j)=>e.jsx("div",{className:`px-4 py-3 ${v(y.category)}`,children:e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsxs("div",{className:"col-span-4 flex items-center space-x-2",children:[w(y.category),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:y.label}),e.jsx("div",{className:"text-xs text-gray-500",children:y.category})]}),y.locked&&e.jsx(js,{className:"w-3 h-3 text-gray-400"})]}),e.jsx("div",{className:"col-span-2",children:e.jsxs("select",{value:y.basis,onChange:b=>m(j,{basis:b.target.value}),className:"w-full text-xs border border-gray-300 rounded px-2 py-1 focus-ring",disabled:y.locked,children:[e.jsx("option",{value:"fixed",children:"Fixed $"}),e.jsx("option",{value:"per_sf",children:"$ / SF"}),e.jsx("option",{value:"per_unit",children:"$ / Unit"}),e.jsx("option",{value:"percent_of_hard",children:"% of Hard"}),e.jsx("option",{value:"percent_of_tdc",children:"% of TDC"})]})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("input",{type:"number",step:y.basis.includes("percent")?"0.001":y.basis==="per_sf"?"1":"1000",value:y.value,onChange:b=>m(j,{value:Number(b.target.value)}),className:"w-full text-xs border border-gray-300 rounded px-2 py-1 focus-ring tabular-nums",disabled:y.locked}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:g(y)})]}),e.jsx("div",{className:"col-span-3 text-right",children:e.jsx("div",{className:"text-sm font-semibold text-gray-900 tabular-nums",children:u(l.items.find(b=>b.id===y.id)?.amount||0)})}),e.jsx("div",{className:"col-span-1 flex justify-end",children:i&&!y.locked&&e.jsx("button",{onClick:()=>d(j),className:"p-1 text-gray-400 hover:text-red-600 rounded",title:"Remove item",children:e.jsx(dt,{className:"w-4 h-4"})})})]})},y.id))}),i&&e.jsx("div",{className:"p-3 border-t border-gray-200 bg-gray-50",children:e.jsxs("button",{onClick:h,className:"flex items-center space-x-2 px-3 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"Add Custom Line Item"})]})})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Cost Summary"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Hard Construction + Demo:"}),e.jsx("span",{className:"font-medium tabular-nums",children:u(l.subtotals.HARD)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Site Work:"}),e.jsx("span",{className:"font-medium tabular-nums",children:u(l.subtotals.SITE)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Permit & Tap Fees:"}),e.jsx("span",{className:"font-medium tabular-nums",children:u(l.subtotals.FEES)})]}),e.jsxs("div",{className:"flex justify-between text-sm border-t pt-2",children:[e.jsx("span",{className:"text-gray-600",children:"Total Soft Costs:"}),e.jsx("span",{className:"font-medium tabular-nums",children:u(l.subtotals.SOFT)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Contingency:"}),e.jsx("span",{className:"font-medium tabular-nums",children:u(l.subtotals.CONT)})]}),l.subtotals.FIN>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Interest & Financing:"}),e.jsx("span",{className:"font-medium tabular-nums",children:u(l.subtotals.FIN)})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t-2 pt-3",children:[e.jsx("span",{children:"Total Development Cost (TDC):"}),e.jsx("span",{className:"tabular-nums",children:u(l.tdc)})]})]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{children:["Buildable: ",a.buildableSf.toLocaleString()," SF"]}),a.units&&e.jsxs("span",{children:["Units: ",a.units]}),a.keys&&e.jsxs("span",{children:["Keys: ",a.keys]})]})})]})}function Jt(a,s,t){const[r,n]=o.useState(Me),[i,x]=o.useState(!1),[l,m]=o.useState(!1);o.useEffect(()=>{},[a,s]);const h=o.useMemo(()=>Ms(r,t),[r,t]);return{lineItems:r,breakdown:h,loading:i,saving:l,updateLineItems:c=>{n(c),setTimeout(()=>{},500)},saveCostOverrides:()=>Promise.resolve(),resetToDefaults:()=>{n(Me)}}}function Yt(a){if(a.zoning_type)switch(a.zoning_type.toLowerCase()){case"residential":return a.zoning_subtype?.toLowerCase().includes("single")?"Single-Family":a.zoning_subtype?.toLowerCase().includes("multi")?"Multi-Family":a.zoning_subtype?.toLowerCase().includes("townhouse")?"Townhouse":"Multi-Family";case"commercial":return"Commercial";case"industrial":return"Industrial";case"mixed-use":return"Mixed-Use";case"agricultural":return"Agricultural";default:return"General"}const s=a.zoning||"";return s.startsWith("RS")?"Single-Family":s.startsWith("R")?"Multi-Family":s.startsWith("RM")?"Mixed-Use":s.startsWith("C")?"Commercial":s.startsWith("MU")?"Mixed-Use":"General"}const Zt=D.memo(function({parcel:s,onClose:t}){const[r,n]=o.useState(null),[i,x]=o.useState({}),[l,m]=o.useState(!1),[h,d]=o.useState("for-sale"),[c,u]=o.useState(!1),[g,v]=o.useState(!1),[w,y]=o.useState(null),j=o.useMemo(()=>{const f=s.deeded_acres||s.deededacreage||s.gisacre||0,R=s.sqft||f*43560,E=R*2,O=Math.floor(f*25);return{lotSqft:R,buildableSf:E,units:O}},[s]),{breakdown:b,updateLineItems:N}=Jt(null,String(s.ogc_fid),j);o.useEffect(()=>{s?.zoning&&_(s)},[s?.zoning]);const p=o.useMemo(()=>{if(!r||!s||l)return null;try{const f={...r,...i},R=s.deeded_acres||s.deededacreage||s.gisacre||0,E=s.sqft||R*43560,O=R*f.land_cost_per_acre,I=E*f.hard_cost_per_sf*2,P=I*(f.soft_cost_percentage/100),F=(I+P)*(f.contingency_percentage/100),T=(w||O+I+P+F)*(f.loan_to_cost/100);let se=0;h==="for-sale"?se=Math.floor(R*25)*f.sale_price_per_unit:se=E*f.rent_per_sf_per_month*12*2*(1-f.vacancy_rate/100)*(1-f.operating_expense_ratio/100)/(f.cap_rate/100);const L={land_cost:O,hard_cost:I,soft_cost:P,contingency:F,loan_amount:T,revenue:se,development_months:f.development_months};return Bt(L)}catch(f){return console.error("Error calculating metrics:",f),null}},[r,i,h,s,l,w]),_=async f=>{m(!0);try{const R=Wt(f.zoning),E={use_type:Yt(f),land_cost_per_acre:R.land_cost_per_acre||5e5,hard_cost_per_sf:R.hard_cost_per_sf||180,soft_cost_percentage:20,contingency_percentage:10,loan_to_cost:75,interest_rate:7.5,rent_per_sf_per_month:1.8,sale_price_per_sf:320,rent_per_unit_per_month:R.rent_per_unit_per_month||1800,sale_price_per_unit:R.sale_price_per_unit||35e4,vacancy_rate:5,operating_expense_ratio:35,cap_rate:5.5,development_months:18,lease_up_months:6};n(E),x({})}catch(R){console.error("Error loading default costs:",R),n({use_type:"General",land_cost_per_acre:5e5,hard_cost_per_sf:180,soft_cost_percentage:20,contingency_percentage:10,loan_to_cost:75,interest_rate:7.5,rent_per_sf_per_month:1.8,sale_price_per_sf:320,rent_per_unit_per_month:1800,sale_price_per_unit:35e4,vacancy_rate:5,operating_expense_ratio:35,cap_rate:5.5,development_months:18,lease_up_months:6})}finally{m(!1)}},S=(f,R)=>{x(E=>({...E,[f]:R}))},C=async()=>{if(s){u(!0);try{const{data:f,error:R}=await q.functions.invoke("pdf-export",{body:{projectData:{name:`Parcel ${s.parcelnumb}`,parcel:s,metrics:p,costs:{...r,...i}},reportType:"underwriting"}});if(R)throw R;const E=document.createElement("a");E.href=URL.createObjectURL(new Blob([f],{type:"application/pdf"})),E.download=`parcel-${s.parcelnumb}-underwriting.pdf`,E.click()}catch(f){console.error("PDF export error:",f)}finally{u(!1)}}},A=f=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(f),k=f=>`${f.toFixed(1)}%`,M=f=>f>=20?"text-green-600":f>=15?"text-blue-600":f>=10?"text-yellow-600":"text-red-600";return s?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-gray-50 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center space-x-2",children:[e.jsx(Y,{className:"w-5 h-5"}),e.jsx("span",{children:"Underwriting Analysis"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{className:"p-1 text-gray-400 hover:text-blue-600 rounded",title:"Recalculate",children:e.jsx(Ye,{className:"w-4 h-4"})})})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[s.address," • ",s.parcelnumb," • ",s.zoning,s.zoning_type&&e.jsxs("span",{className:"ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:[s.zoning_type,s.zoning_subtype&&` - ${s.zoning_subtype}`]})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(s.deeded_acres||s.deededacreage||s.gisacre||0).toFixed(2)," acres •",(s.sqft||0).toLocaleString()," sq ft"]})]})]}),e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>d("for-sale"),className:`flex-1 px-3 py-2 text-sm font-medium rounded-md transition-colors ${h==="for-sale"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,children:"For-Sale"}),e.jsx("button",{onClick:()=>d("rental"),className:`flex-1 px-3 py-2 text-sm font-medium rounded-md transition-colors ${h==="rental"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,children:"Rental"})]})}),(s.zoning_type||s.max_far||s.max_density_du_per_acre)&&e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(ee,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold text-gray-900",children:"Zoning Constraints"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.max_far&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Max FAR:"}),e.jsx("span",{className:"ml-2 font-medium text-gray-900",children:s.max_far})]}),s.max_density_du_per_acre&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Max Density:"}),e.jsxs("span",{className:"ml-2 font-medium text-gray-900",children:[s.max_density_du_per_acre," DU/acre"]})]}),s.max_building_height_ft&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Max Height:"}),e.jsxs("span",{className:"ml-2 font-medium text-gray-900",children:[s.max_building_height_ft," ft"]})]}),s.max_coverage_pct&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Max Coverage:"}),e.jsxs("span",{className:"ml-2 font-medium text-gray-900",children:[s.max_coverage_pct,"%"]})]}),s.min_lot_area_sq_ft&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Min Lot Area:"}),e.jsxs("span",{className:"ml-2 font-medium text-gray-900",children:[s.min_lot_area_sq_ft.toLocaleString()," sq ft"]})]}),s.min_front_setback_ft&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Front Setback:"}),e.jsxs("span",{className:"ml-2 font-medium text-gray-900",children:[s.min_front_setback_ft," ft"]})]})]}),s.permitted_land_uses&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-gray-600 text-sm font-medium mb-2",children:"Permitted Uses:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(s.permitted_land_uses).slice(0,3).map(([f,R])=>e.jsxs("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:[f,": ",Array.isArray(R)?R.slice(0,2).join(", "):R]},f))})]})]}),p&&e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Financial Results"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${M(p.irr_annual_pct)}`,"data-e2e":"irr-cell",children:k(p.irr_annual_pct)}),e.jsx("div",{className:"text-xs text-gray-600",children:"IRR"})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:k(p.yield_on_cost_pct)}),e.jsx("div",{className:"text-xs text-gray-600",children:"Yield on Cost"})]}),e.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[p.equity_multiple.toFixed(2),"x"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Equity Multiple"})]}),e.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:k(p.cash_on_cash_pct)}),e.jsx("div",{className:"text-xs text-gray-600",children:"Cash-on-Cash"})]})]})]}),r&&e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Cost Assumptions"}),e.jsxs("div",{className:"text-xs text-blue-600",children:["Default: ",r.use_type]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Hard Cost ($/SF)"}),e.jsx("input",{type:"number",value:i.hard_cost_per_sf??r.hard_cost_per_sf,onChange:f=>S("hard_cost_per_sf",parseFloat(f.target.value)),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus-ring",step:"10"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Interest Rate (%)"}),e.jsx("input",{type:"number",value:i.interest_rate??r.interest_rate,onChange:f=>S("interest_rate",parseFloat(f.target.value)),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus-ring",step:"0.1"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:h==="for-sale"?"Sale Price/Unit":"Rent/Unit/Month"}),e.jsx("input",{type:"number",value:h==="for-sale"?i.sale_price_per_unit??r.sale_price_per_unit:i.rent_per_unit_per_month??r.rent_per_unit_per_month,onChange:f=>S(h==="for-sale"?"sale_price_per_unit":"rent_per_unit_per_month",parseFloat(f.target.value)),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus-ring",step:h==="for-sale"?"10000":"50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Loan-to-Cost (%)"}),e.jsx("input",{type:"number",value:i.loan_to_cost??r.loan_to_cost,onChange:f=>S("loan_to_cost",parseFloat(f.target.value)),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus-ring",step:"5",min:"0",max:"95"})]})]}),h==="rental"&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Vacancy Rate (%)"}),e.jsx("input",{type:"number",value:i.vacancy_rate??r.vacancy_rate,onChange:f=>S("vacancy_rate",parseFloat(f.target.value)),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus-ring",step:"0.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Cap Rate (%)"}),e.jsx("input",{type:"number",value:i.cap_rate??r.cap_rate,onChange:f=>S("cap_rate",parseFloat(f.target.value)),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus-ring",step:"0.25"})]})]})]})]}),p&&e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Cost Breakdown"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total Development Cost:"}),e.jsx("span",{className:"font-medium",children:A(p.total_cost)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Equity Required:"}),e.jsx("span",{className:"font-medium",children:A(p.equity_required)})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"text-gray-600",children:"Estimated Profit:"}),e.jsx("span",{className:`font-semibold ${p.profit>0?"text-green-600":"text-red-600"}`,children:A(p.profit)})]})]})]}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsxs("button",{onClick:C,disabled:c||!p,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-300 transition-colors flex items-center justify-center space-x-2",children:[c?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{children:c?"Generating PDF...":"Export PDF Report"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("button",{onClick:()=>v(!g),className:"flex items-center space-x-2 text-sm font-medium text-blue-600 hover:text-blue-700",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsxs("span",{children:[g?"Hide":"Show"," Detailed Cost Breakdown"]})]}),b&&e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["TDC: ",A(b.tdc)]})]}),g&&e.jsx(Ht,{program:j,onChange:N,onTotalCostChange:y})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>window.location.reload(),className:"bg-green-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-green-700 transition-colors flex items-center justify-center space-x-1",children:[e.jsx(Y,{className:"w-3 h-3"}),e.jsx("span",{className:"text-sm",children:"Recalculate"})]}),e.jsx("button",{className:"border border-gray-300 text-gray-700 py-2 px-4 rounded-lg font-medium hover:bg-gray-50 transition-colors text-sm",children:"Save to Project"})]})]}),l&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading cost data..."})]})})]}):null});class Xt{constructor(s,t){Se(this,"marketData");Se(this,"costData");this.marketData=s,this.costData=t}safeParseNumber(s){if(s==null||s==="")return;const t=Number(s);if(!(isNaN(t)||!isFinite(t))&&!(t<0&&Math.abs(t)>1e3))return t}async analyzeHBU(s){console.log("Raw parcel data received:",s);const t={zoning_id:s.zoning_id,zoning:s.zoning,zoning_description:s.zoning_description,zoning_type:s.zoning_type,zoning_subtype:s.zoning_subtype,zoning_objective:s.zoning_objective,zoning_code_link:s.zoning_code_link,permitted_land_uses:s.permitted_land_uses,permitted_land_uses_as_of_right:s.permitted_land_uses_as_of_right,permitted_land_uses_conditional:s.permitted_land_uses_conditional,min_lot_area_sq_ft:this.safeParseNumber(s.min_lot_area_sq_ft),min_lot_width_ft:this.safeParseNumber(s.min_lot_width_ft),max_building_height_ft:this.safeParseNumber(s.max_building_height_ft),max_far:this.safeParseNumber(s.max_far),min_front_setback_ft:this.safeParseNumber(s.min_front_setback_ft),min_rear_setback_ft:this.safeParseNumber(s.min_rear_setback_ft),min_side_setback_ft:this.safeParseNumber(s.min_side_setback_ft),max_coverage_pct:this.safeParseNumber(s.max_coverage_pct),max_impervious_coverage_pct:this.safeParseNumber(s.max_impervious_coverage_pct),min_landscaped_space_pct:this.safeParseNumber(s.min_landscaped_space_pct),min_open_space_pct:this.safeParseNumber(s.min_open_space_pct),max_density_du_per_acre:this.safeParseNumber(s.max_density_du_per_acre),zoning_data_date:s.zoning_data_date,municipality_id:s.municipality_id,municipality_name:s.municipality_name,geoid:s.geoid};console.log("Processed zoning data:",t),!t.zoning&&!t.zoning_type&&(console.warn("No zoning data found, using fallback analysis"),t.zoning=s.zoning||"Unknown",t.zoning_type="Residential");const r=this.identifyFeasibleUses(t);console.log("Feasible uses identified:",r),r.length===0&&(console.warn("No feasible uses found, adding default residential use"),r.push("Single Family"));const n=await this.analyzeMarketFactors(s);console.log("Market factors analyzed:",n);const i=await this.calculateAlternatives(s,r);console.log("Alternatives calculated:",i);const x=this.identifyConstraints(t),l=this.determineRecommendedUse(i),m=this.calculateConfidence(i,n);return{recommendedUse:l,confidence:m,alternatives:i,constraints:x,marketFactors:n,financialProjections:this.generateFinancialProjections(l,i),analysisDate:new Date,analyst:"System"}}identifyFeasibleUses(s){const t=[];if(s.permitted_land_uses)try{typeof s.permitted_land_uses=="object"?Object.keys(s.permitted_land_uses).forEach(r=>{const n=s.permitted_land_uses[r];Array.isArray(n)?n.forEach(i=>{this.isFeasibleUse(i,s)&&t.push(i)}):typeof n=="string"&&this.isFeasibleUse(n,s)&&t.push(n)}):typeof s.permitted_land_uses=="string"&&s.permitted_land_uses.split(",").map(n=>n.trim()).forEach(n=>{this.isFeasibleUse(n,s)&&t.push(n)})}catch(r){console.warn("Error processing permitted_land_uses:",r)}if(s.zoning_type){const r=this.getUsesByZoningType(s.zoning_type);if(t.push(...r),s.zoning_subtype){const n=this.getUsesByZoningSubtype(s.zoning_subtype);t.push(...n)}}if(s.zoning_objective){const r=this.getUsesByZoningObjective(s.zoning_objective);t.push(...r)}return[...new Set(t)]}isFeasibleUse(s,t){const r=t.max_density_du_per_acre||0;if(this.getRequiredDensity(s)>r&&r>0)return!1;const i=t.max_far||0;if(this.getRequiredFAR(s)>i&&i>0)return!1;const l=t.max_building_height_ft||0;return!(this.getRequiredHeight(s)>l&&l>0)}getUsesByZoningType(s){return{Residential:["Single Family","Multi-Family","Townhouse","Apartment"],Commercial:["Retail","Office","Restaurant","Hotel"],Industrial:["Warehouse","Manufacturing","Distribution"],"Mixed-Use":["Mixed-Use Residential","Mixed-Use Commercial"],Agricultural:["Farming","Ranch","Vineyard"],"Special Purpose":["Institutional","Recreation","Open Space"]}[s]||[]}getUsesByZoningSubtype(s){return{"Single Family":["Single Family","Townhouse"],"Multi-Family":["Multi-Family","Apartment"],"Mixed-Use Residential":["Mixed-Use Residential","Apartment","Retail"],"Mixed-Use Commercial":["Mixed-Use Commercial","Office","Retail"],"High-Density Residential":["Apartment","Multi-Family"],"Low-Density Residential":["Single Family","Townhouse"],Office:["Office","Professional Services"],Retail:["Retail","Restaurant","Service"],Industrial:["Warehouse","Manufacturing","Distribution"]}[s]||[]}getUsesByZoningObjective(s){return{"Residential Development":["Single Family","Multi-Family","Apartment"],"Commercial Development":["Retail","Office","Restaurant"],"Mixed-Use Development":["Mixed-Use Residential","Mixed-Use Commercial"],"Industrial Development":["Warehouse","Manufacturing"],"Transit-Oriented Development":["Mixed-Use Residential","Mixed-Use Commercial"],"Affordable Housing":["Multi-Family","Apartment"],"Urban Infill":["Mixed-Use Residential","Mixed-Use Commercial"]}[s]||[]}getRequiredDensity(s){return{"Single Family":2,"Multi-Family":20,Townhouse:15,Apartment:30,Retail:0,Office:0,Warehouse:0}[s]||0}getRequiredFAR(s){return{"Single Family":.3,"Multi-Family":2,Townhouse:1.5,Apartment:3,Retail:1,Office:2.5,Warehouse:1.5}[s]||0}getRequiredHeight(s){return{"Single Family":35,"Multi-Family":60,Townhouse:45,Apartment:90,Retail:30,Office:120,Warehouse:40}[s]||0}async analyzeMarketFactors(s){const t=[];return t.push({factor:"Location Desirability",impact:"positive",weight:.3,description:"Prime location with good access and amenities"}),t.push({factor:"Market Demand",impact:"positive",weight:.25,description:"Strong demand for development in this area"}),s.zoning_data?.zoning_type==="Mixed-Use"&&t.push({factor:"Zoning Flexibility",impact:"positive",weight:.2,description:"Mixed-use zoning allows multiple development options"}),t.push({factor:"Infrastructure",impact:"positive",weight:.15,description:"Good infrastructure and utilities available"}),t.push({factor:"Market Competition",impact:"neutral",weight:.1,description:"Moderate competition in the market"}),t}async calculateAlternatives(s,t){const r=[];for(const n of t){const i=await this.calculateAlternative(s,n);r.push(i)}return r.sort((n,i)=>i.netPresentValue-n.netPresentValue)}async calculateAlternative(s,t){const r=this.getRequiredDensity(t),n=this.getRequiredFAR(t),i=this.getRequiredHeight(t),x=s.sqft||0,l=x*n,m=r>0?Math.floor(x/43560*r):0,h=s.parval||0,d=l*this.getCostPerSqFt(t),c=d*.25,u=(d+c)*.1,g=h+d+c+u,v=this.estimateRevenue(t,l,m),w=v-g,y=this.calculateIRR(g,v,3),j=this.calculatePaybackPeriod(g,v);return{use:t,density:r,height:i,estimatedValue:v,developmentCost:g,netPresentValue:w,internalRateOfReturn:y,paybackPeriod:j,confidence:this.calculateUseConfidence(t,s),constraints:this.identifyUseConstraints(t,s.zoning_data),marketFactors:this.identifyUseMarketFactors(t,s)}}getCostPerSqFt(s){return{"Single Family":150,"Multi-Family":200,Townhouse:180,Apartment:220,Retail:180,Office:250,Warehouse:120}[s]||200}estimateRevenue(s,t,r){const n=this.getPricePerSqFt(s),i=this.getPricePerUnit(s);return r>0?r*i:t*n}getPricePerSqFt(s){return{"Single Family":300,"Multi-Family":400,Townhouse:350,Apartment:450,Retail:200,Office:300,Warehouse:150}[s]||300}getPricePerUnit(s){return{"Single Family":5e5,"Multi-Family":3e5,Townhouse:4e5,Apartment:25e4}[s]||3e5}calculateIRR(s,t,r){return s<=0?0:Math.pow(t/s,1/r)-1}calculatePaybackPeriod(s,t){return t<=0?1/0:s/t}calculateUseConfidence(s,t){let r=50;if(t.zoning_data?.zoning_type){const n=this.getZoningTypeMatch(s,t.zoning_data.zoning_type);r+=n*20}return r+=15,r+=10,r+=5,Math.min(r,100)}getZoningTypeMatch(s,t){return({Residential:["Single Family","Multi-Family","Townhouse","Apartment"],Commercial:["Retail","Office","Restaurant","Hotel"],Industrial:["Warehouse","Manufacturing"],"Mixed-Use":["Mixed-Use Residential","Mixed-Use Commercial"]}[t]||[]).includes(s)?1:0}identifyUseConstraints(s,t){const r=[];return t.max_density_du_per_acre&&this.getRequiredDensity(s)>t.max_density_du_per_acre&&r.push(`Density limit: ${t.max_density_du_per_acre} DU/acre`),t.max_far&&this.getRequiredFAR(s)>t.max_far&&r.push(`FAR limit: ${t.max_far}`),t.max_building_height_ft&&this.getRequiredHeight(s)>t.max_building_height_ft&&r.push(`Height limit: ${t.max_building_height_ft} ft`),r}identifyUseMarketFactors(s,t){const r=[];return r.push("Strong market demand"),r.push("Good location access"),r.push("Adequate infrastructure"),r}identifyConstraints(s){const t=[];return s.max_density_du_per_acre&&t.push({type:"density",description:`Maximum density: ${s.max_density_du_per_acre} DU/acre`,value:s.max_density_du_per_acre,unit:"DU/acre",impact:"limiting"}),s.max_far&&t.push({type:"far",description:`Maximum FAR: ${s.max_far}`,value:s.max_far,unit:"ratio",impact:"limiting"}),s.max_building_height_ft&&t.push({type:"height",description:`Maximum height: ${s.max_building_height_ft} ft`,value:s.max_building_height_ft,unit:"ft",impact:"moderate"}),t}determineRecommendedUse(s){if(s.length===0)return"residential";const t=s[0];return t.use.includes("Mixed-Use")?"mixed-use":t.use.includes("Residential")||t.use.includes("Family")||t.use.includes("Apartment")?"residential":t.use.includes("Commercial")||t.use.includes("Retail")||t.use.includes("Office")?"commercial":t.use.includes("Industrial")||t.use.includes("Warehouse")||t.use.includes("Manufacturing")?"industrial":"residential"}calculateConfidence(s,t){if(s.length===0)return 0;const r=s.reduce((i,x)=>i+x.confidence,0)/s.length,n=t.reduce((i,x)=>i+x.weight*(x.impact==="positive"?1:x.impact==="negative"?-1:0),0);return Math.min(r+n*10,100)}generateFinancialProjections(s,t){const r=[],n=t[0];if(!n)return r;for(let i=1;i<=10;i++){const x=n.estimatedValue*1.03**i,l=n.developmentCost*.05,m=x-l,h=m,d=r.length>0?r[r.length-1].cumulativeCashFlow+h:h;r.push({year:i,revenue:x,expenses:l,netIncome:m,cashFlow:h,cumulativeCashFlow:d})}return r}}function Qe(){const[a]=o.useState(()=>new Xt),[s,t]=o.useState(null),[r,n]=o.useState(!1),[i,x]=o.useState(null),l=o.useCallback(async p=>{n(!0),x(null);try{const _=await a.analyzeHBU(p);return t(_),_}catch(_){const S=_ instanceof Error?_.message:"Analysis failed";throw x(S),_}finally{n(!1)}},[a]),m=o.useCallback(()=>{t(null),x(null)},[]),h=o.useCallback((p=3)=>s?s.alternatives.slice(0,p):[],[s]),d=o.useCallback(()=>!s||s.alternatives.length===0?null:s.alternatives[0],[s]),c=o.useCallback(()=>s?s.confidence>=80?"high":s.confidence>=60?"medium":"low":"low",[s]),u=o.useCallback(()=>{if(!s)return[];const p=[];return s.confidence<70&&p.push("Low confidence in analysis"),s.constraints.some(S=>S.impact==="limiting")&&p.push("Significant zoning constraints"),s.alternatives.length<2&&p.push("Limited development options"),s.marketFactors.filter(S=>S.impact==="negative").length>0&&p.push("Negative market factors present"),p},[s]),g=o.useCallback(()=>{if(!s)return[];const p=[];return s.confidence>=80&&p.push("High confidence in recommended use"),s.alternatives.length>=3&&p.push("Multiple viable development options"),s.marketFactors.filter(S=>S.impact==="positive").length>0&&p.push("Favorable market conditions"),s.recommendedUse==="mixed-use"&&p.push("Mixed-use development potential"),p},[s]),v=o.useCallback(()=>{if(!s)return null;const p=d();return p?{estimatedValue:p.estimatedValue,developmentCost:p.developmentCost,netPresentValue:p.netPresentValue,internalRateOfReturn:p.internalRateOfReturn,paybackPeriod:p.paybackPeriod,confidence:p.confidence}:null},[s,d]),w=o.useCallback(()=>{if(!s)return null;const p=s.constraints.filter(C=>C.impact==="limiting"),_=s.constraints.filter(C=>C.impact==="moderate"),S=s.constraints.filter(C=>C.impact==="minimal");return{limiting:p.length,moderate:_.length,minimal:S.length,total:s.constraints.length,constraints:s.constraints}},[s]),y=o.useCallback(()=>{if(!s)return null;const p=s.marketFactors.filter(C=>C.impact==="positive"),_=s.marketFactors.filter(C=>C.impact==="negative"),S=s.marketFactors.filter(C=>C.impact==="neutral");return{positive:p.length,negative:_.length,neutral:S.length,total:s.marketFactors.length,factors:s.marketFactors}},[s]),j=o.useMemo(()=>s!==null&&!r&&!i,[s,r,i]),b=o.useMemo(()=>s!==null&&s.confidence>=80,[s]),N=o.useMemo(()=>s!==null&&s.alternatives.length>=2,[s]);return{analysis:s,loading:r,error:i,analyzeParcel:l,clearAnalysis:m,getTopAlternatives:h,getRecommendedAlternative:d,getConfidenceLevel:c,getRiskFactors:u,getOpportunities:g,getFinancialSummary:v,getConstraintSummary:w,getMarketSummary:y,isAnalysisComplete:j,hasHighConfidence:b,hasMultipleAlternatives:N}}const Kt=D.memo(function({parcel:s,onClose:t}){const{analysis:r,loading:n,error:i,analyzeParcel:x,getTopAlternatives:l,getRecommendedAlternative:m,getConfidenceLevel:h,getRiskFactors:d,getOpportunities:c,getFinancialSummary:u,getConstraintSummary:g,getMarketSummary:v}=Qe(),[w,y]=D.useState(!1);D.useEffect(()=>{s&&(console.log("Starting HBU analysis for parcel:",s),y(!0),x(s).then(f=>{console.log("HBU analysis completed:",f)}).catch(f=>{console.error("HBU analysis failed:",f)}).finally(()=>y(!1)))},[s,x]);const j=f=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(f),b=f=>`${(f*100).toFixed(1)}%`,N=f=>{switch(f){case"high":return"text-green-600 bg-green-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}};if(n||w)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Analyzing highest and best use..."})]})});if(i)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ue,{className:"w-5 h-5 text-red-600 mr-2"}),e.jsx("h3",{className:"text-red-800 font-medium",children:"Analysis Error"})]}),e.jsx("p",{className:"text-red-700 mt-2",children:i}),e.jsx("button",{onClick:()=>x(s),className:"mt-3 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Retry Analysis"})]})});if(!r)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(ee,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No analysis available"})]})});const p=m(),_=u(),S=g(),C=v(),A=d(),k=c(),M=h();return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ee,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Highest & Best Use Analysis"})]}),t&&e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:"×"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:"Recommended Use"}),e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${N(M)}`,children:[M.toUpperCase()," CONFIDENCE"]})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-800 capitalize",children:r.recommendedUse.replace("-"," ")}),p&&e.jsxs("div",{className:"mt-2 text-sm text-blue-700",children:[p.use," • ",j(p.estimatedValue)," estimated value"]})]}),_&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(le,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"font-semibold text-green-900",children:"Financial Projections"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-700",children:"Estimated Value"}),e.jsx("div",{className:"text-lg font-semibold text-green-800",children:j(_.estimatedValue)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-700",children:"Development Cost"}),e.jsx("div",{className:"text-lg font-semibold text-green-800",children:j(_.developmentCost)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-700",children:"Net Present Value"}),e.jsx("div",{className:"text-lg font-semibold text-green-800",children:j(_.netPresentValue)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-700",children:"IRR"}),e.jsx("div",{className:"text-lg font-semibold text-green-800",children:b(_.internalRateOfReturn)})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(B,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Alternative Uses"})]}),e.jsx("div",{className:"space-y-3",children:l(3).map((f,R)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:f.use}),e.jsx("div",{className:"text-sm text-gray-600",children:f.density>0?`${f.density} DU/acre`:`${f.height} ft height`})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:j(f.netPresentValue)}),e.jsxs("div",{className:"text-sm text-gray-600",children:[b(f.internalRateOfReturn)," IRR"]})]})]}),f.constraints.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Constraints:"}),e.jsx("div",{className:"text-xs text-gray-600",children:f.constraints.join(", ")})]})]},R))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[S&&S.total>0&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(Ze,{className:"w-5 h-5 text-orange-600"}),e.jsx("h3",{className:"font-semibold text-orange-900",children:"Zoning Constraints"})]}),e.jsx("div",{className:"space-y-2",children:S.constraints.map((f,R)=>e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium text-orange-800",children:f.description}),e.jsxs("div",{className:"text-orange-700",children:["Impact: ",f.impact]})]},R))})]}),C&&C.total>0&&e.jsxs("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(me,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"font-semibold text-indigo-900",children:"Market Factors"})]}),e.jsx("div",{className:"space-y-2",children:C.factors.map((f,R)=>e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium text-indigo-800",children:f.factor}),e.jsxs("div",{className:"text-indigo-700",children:[f.impact," • Weight: ",f.weight]})]},R))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[A.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(ue,{className:"w-5 h-5 text-red-600"}),e.jsx("h3",{className:"font-semibold text-red-900",children:"Risk Factors"})]}),e.jsx("ul",{className:"space-y-1",children:A.map((f,R)=>e.jsxs("li",{className:"text-sm text-red-700",children:["• ",f]},R))})]}),k.length>0&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(Z,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"font-semibold text-green-900",children:"Opportunities"})]}),e.jsx("ul",{className:"space-y-1",children:k.map((f,R)=>e.jsxs("li",{className:"text-sm text-green-700",children:["• ",f]},R))})]})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx($e,{className:"w-4 h-4 text-gray-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Analysis Details"})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{children:["Analysis Date: ",r.analysisDate.toLocaleDateString()]}),e.jsxs("div",{children:["Analyst: ",r.analyst]}),e.jsxs("div",{children:["Confidence Score: ",r.confidence,"%"]}),e.jsxs("div",{children:["Alternatives Analyzed: ",r.alternatives.length]})]})]})]})});function Is(a){if(!a)throw new Error("No geometry provided");if(a.type==="Polygon")return a;let s={poly:null,area:-1};for(const t of a.coordinates){const r={type:"Polygon",coordinates:t},n=Qt(r.coordinates[0]);n>s.area&&(s={poly:r,area:n})}if(!s.poly)throw new Error("Could not choose polygon from MultiPolygon");return s.poly}function Qt(a){let s=0;for(let t=0;t<a.length-1;t++){const[r,n]=a[t],[i,x]=a[t+1];s+=r*x-i*n}return Math.abs(s)/2}var ls=63710088e-1;function zs(a,s,t){if(a!==null)for(var r,n,i,x,l,m,h,d=0,c=0,u,g=a.type,v=g==="FeatureCollection",w=g==="Feature",y=v?a.features.length:1,j=0;j<y;j++){h=v?a.features[j].geometry:w?a.geometry:a,u=h?h.type==="GeometryCollection":!1,l=u?h.geometries.length:1;for(var b=0;b<l;b++){var N=0,p=0;if(x=u?h.geometries[b]:h,x!==null){m=x.coordinates;var _=x.type;switch(d=0,_){case null:break;case"Point":if(s(m,c,j,N,p)===!1)return!1;c++,N++;break;case"LineString":case"MultiPoint":for(r=0;r<m.length;r++){if(s(m[r],c,j,N,p)===!1)return!1;c++,_==="MultiPoint"&&N++}_==="LineString"&&N++;break;case"Polygon":case"MultiLineString":for(r=0;r<m.length;r++){for(n=0;n<m[r].length-d;n++){if(s(m[r][n],c,j,N,p)===!1)return!1;c++}_==="MultiLineString"&&N++,_==="Polygon"&&p++}_==="Polygon"&&N++;break;case"MultiPolygon":for(r=0;r<m.length;r++){for(p=0,n=0;n<m[r].length;n++){for(i=0;i<m[r][n].length-d;i++){if(s(m[r][n][i],c,j,N,p)===!1)return!1;c++}p++}N++}break;case"GeometryCollection":for(r=0;r<x.geometries.length;r++)if(zs(x.geometries[r],s)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function ea(a,s){var t,r,n,i,x,l,m,h,d,c,u=0,g=a.type==="FeatureCollection",v=a.type==="Feature",w=g?a.features.length:1;for(t=0;t<w;t++){for(l=g?a.features[t].geometry:v?a.geometry:a,h=g?a.features[t].properties:v?a.properties:{},d=g?a.features[t].bbox:v?a.bbox:void 0,c=g?a.features[t].id:v?a.id:void 0,m=l?l.type==="GeometryCollection":!1,x=m?l.geometries.length:1,n=0;n<x;n++){if(i=m?l.geometries[n]:l,i===null){if(s(null,u,h,d,c)===!1)return!1;continue}switch(i.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(s(i,u,h,d,c)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<i.geometries.length;r++)if(s(i.geometries[r],u,h,d,c)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}u++}}function sa(a,s,t){var r=t;return ea(a,function(n,i,x,l,m){i===0&&t===void 0?r=n:r=s(r,n,i,x,l,m)}),r}function ta(a){return sa(a,(s,t)=>s+aa(t),0)}function aa(a){let s=0,t;switch(a.type){case"Polygon":return cs(a.coordinates);case"MultiPolygon":for(t=0;t<a.coordinates.length;t++)s+=cs(a.coordinates[t]);return s;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}function cs(a){let s=0;if(a&&a.length>0){s+=Math.abs(os(a[0]));for(let t=1;t<a.length;t++)s-=Math.abs(os(a[t]))}return s}var ra=ls*ls/2,We=Math.PI/180;function os(a){const s=a.length-1;if(s<=2)return 0;let t=0,r=0;for(;r<s;){const n=a[r],i=a[r+1===s?0:r+1],x=a[r+2>=s?(r+2)%s:r+2],l=n[0]*We,m=i[1]*We,h=x[0]*We;t+=(h-l)*Math.sin(m),r++}return t*ra}function na(a,s={}){if(a.bbox!=null&&s.recompute!==!0)return a.bbox;const t=[1/0,1/0,-1/0,-1/0];return zs(a,r=>{t[0]>r[0]&&(t[0]=r[0]),t[1]>r[1]&&(t[1]=r[1]),t[2]<r[0]&&(t[2]=r[0]),t[3]<r[1]&&(t[3]=r[1])}),t}function ia(a){let s=0;for(let t=0;t<a.length-1;t++){const[r,n]=a[t],[i,x]=a[t+1],l=i-r,m=x-n;s+=Math.hypot(l,m)}return s}function la(a){const s={type:"Feature",properties:{},geometry:a},t=ta(s),r=10.7639,n=na(s),i=ia(a.coordinates[0]);return{areaSqft:t*r,bbox:n,perimeterFeet:i}}const ca=({parcel:a,children:s,onPlanGenerated:t})=>{function r(f){return f?.type==="Polygon"&&Array.isArray(f.coordinates)&&f.coordinates.length>0&&Array.isArray(f.coordinates[0])&&f.coordinates[0].length>=4}function n(f){return typeof f=="number"?String(f):typeof f=="string"&&f!=="unknown"&&f.trim()!==""?f:null}const i=n(a?.ogc_fid),x=r(a?.geometry),l=!!(i&&x),m=i||"unknown",h=x?a.geometry:null;o.useEffect(()=>{console.log("SitePlanDesigner received parcel:",a),console.log("isValidParcel:",l),console.log("SitePlanDesigner received children:",s),console.log("children type:",typeof s),console.log("isValidElement:",D.isValidElement(s)),a&&(console.log("parcel.ogc_fid:",a.ogc_fid),console.log("parcel.geometry:",a.geometry))},[a,l,s]);const[d,c]=o.useState({parcelId:m,buildableArea:h||{type:"Polygon",coordinates:[]},zoning:{frontSetbackFt:20,sideSetbackFt:10,rearSetbackFt:20,maxFar:2,maxCoveragePct:60,minParkingRatio:1},designParameters:{targetFAR:1.5,targetCoveragePct:50,parking:{targetRatio:1.5,stallWidthFt:9,stallDepthFt:18,aisleWidthFt:12,adaPct:5,evPct:10,layoutAngle:0},buildingTypology:"bar",numBuildings:2}}),[u,g]=o.useState(!1),[v,w]=o.useState([]),[y,j]=o.useState(null),[b,N]=o.useState(0),[p,_]=o.useState(null),S=o.useMemo(()=>new Worker(new URL("/assets/index-DNG9GCTO.js",import.meta.url),{type:"module"}),[]),C=o.useMemo(()=>{let f=null,R=null;return(E,O)=>{if(!E?.geometry)return;const I=Is(E.geometry),P=la(I);R&&clearTimeout(R),R=setTimeout(()=>{f=crypto.randomUUID(),S.postMessage({type:"generate",reqId:f,parcel:I,config:O,metrics:P})},150)}},[S]),A=o.useCallback(async f=>{if(!l){console.warn("Cannot generate site plan: Invalid parcel data");return}console.debug("Planner input:",{parcelId:i,ringLen:h?.coordinates[0]?.length,type:h?.type}),g(!0);try{C(a,d);const R=E=>{const{type:O,reqId:I,elements:P,metrics:F,error:z}=E.data;O==="generated"&&I===f&&(z?console.error("Worker error:",z):(w(P||[]),j(F||null),t&&t(P||[],F||null)),g(!1),S.removeEventListener("message",R))};S.addEventListener("message",R)}catch(R){console.error("Error generating site plan:",R),g(!1)}},[a,d,t,C,S]),k=o.useCallback(f=>{c(E=>({...E,...f})),p&&clearTimeout(p);const R=setTimeout(()=>{const E=b+1;N(E),A(E)},200);_(R)},[p,b,A]);o.useEffect(()=>{const f=setTimeout(()=>{const R=b+1;N(R),A(R)},200);return()=>clearTimeout(f)},[A,b]);const M=f=>{k(f)};return l?e.jsxs("div",{className:"flex h-full",children:[e.jsxs("div",{className:"w-80 bg-white border-r p-4 overflow-y-auto",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Design Parameters"}),!l&&e.jsx("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 text-yellow-600",children:"⚠️"}),e.jsx("span",{className:"text-sm text-yellow-800",children:"Invalid parcel data. Please select a valid parcel to continue."})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Target FAR: ",d.designParameters.targetFAR]}),e.jsx("input",{type:"range",min:"0.5",max:"3.0",step:"0.1",value:d.designParameters.targetFAR,onChange:f=>M({designParameters:{...d.designParameters,targetFAR:parseFloat(f.target.value)}}),disabled:!l,className:`w-full h-2 bg-gray-200 rounded-lg appearance-none ${l?"cursor-pointer":"cursor-not-allowed opacity-50"}`}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"0.5"}),e.jsx("span",{children:"3.0"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Coverage: ",d.designParameters.targetCoveragePct,"%"]}),e.jsx("input",{type:"range",min:"20",max:"80",step:"5",value:d.designParameters.targetCoveragePct,onChange:f=>M({designParameters:{...d.designParameters,targetCoveragePct:parseInt(f.target.value)}}),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"20%"}),e.jsx("span",{children:"80%"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Parking Ratio: ",d.designParameters.parking.targetRatio]}),e.jsx("input",{type:"range",min:"0.5",max:"3.0",step:"0.1",value:d.designParameters.parking.targetRatio,onChange:f=>M({designParameters:{...d.designParameters,parking:{...d.designParameters.parking,targetRatio:parseFloat(f.target.value)}}}),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"0.5"}),e.jsx("span",{children:"3.0"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Building Typology"}),e.jsxs("select",{value:d.designParameters.buildingTypology,onChange:f=>M({designParameters:{...d.designParameters,buildingTypology:f.target.value}}),className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[e.jsx("option",{value:"bar",children:"Bar Building"}),e.jsx("option",{value:"L-shape",children:"L-Shaped"}),e.jsx("option",{value:"podium",children:"Podium"}),e.jsx("option",{value:"custom",children:"Custom"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Number of Buildings: ",d.designParameters.numBuildings]}),e.jsx("input",{type:"range",min:"1",max:"5",step:"1",value:d.designParameters.numBuildings,onChange:f=>M({designParameters:{...d.designParameters,numBuildings:parseInt(f.target.value)}}),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsx("span",{children:"1"}),e.jsx("span",{children:"5"})]})]}),u&&e.jsx("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm text-blue-600",children:"Generating site plan..."})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:A,disabled:u,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"Regenerate Plan"}),e.jsx("button",{onClick:()=>{console.log("Saving plan:",{elements:v,metrics:y})},className:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700",children:"Save Plan"})]})]}),e.jsx("div",{className:"flex-1",children:s&&D.isValidElement(s)?D.cloneElement(s,{planElements:v,metrics:y}):e.jsx("div",{className:"flex items-center justify-center h-full bg-gray-50 border border-gray-200 rounded-lg",children:e.jsx("div",{className:"text-center p-8",children:a&&a.ogc_fid?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-2xl mb-4",children:"🏗️"}),e.jsx("div",{className:"text-lg font-medium mb-2 text-gray-700",children:"Generating site plan…"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["Parcel ",a.ogc_fid]}),u&&e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-2xl mb-4",children:"🏗️"}),e.jsx("div",{className:"text-lg font-medium mb-2 text-gray-700",children:"Site Plan Designer"}),e.jsx("div",{className:"text-sm text-gray-500 mb-4",children:"Configure your design parameters using the controls on the left"}),!l&&e.jsx("div",{className:"text-sm text-yellow-600 bg-yellow-50 p-3 rounded-lg border border-yellow-200",children:"⚠️ Please select a valid parcel to begin designing"}),l&&e.jsxs("div",{className:"text-sm text-green-600 bg-green-50 p-3 rounded-lg border border-green-200",children:["✅ Ready to generate site plan for parcel ",a.ogc_fid]})]})})})})]}):e.jsxs("div",{className:"flex h-full",children:[e.jsx("div",{className:"w-80 bg-white border-r p-4 overflow-y-auto",children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"text-2xl mb-4",children:"⚠️"}),e.jsx("div",{className:"text-lg font-medium mb-2 text-gray-700",children:"Invalid Parcel Data"}),e.jsx("div",{className:"text-sm text-gray-500",children:"The selected parcel couldn't be read (missing/unsupported geometry). Go back and reselect, or reload."})]})}),e.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center p-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"📍"}),e.jsx("div",{className:"text-xl font-medium mb-2 text-gray-700",children:"No Valid Geometry"}),e.jsx("div",{className:"text-sm text-gray-500",children:"If you just clicked from the map, this usually means the geometry was a MultiPolygon. It's safe to try again."})]})})]})};let oa=0,ds=0;class da{constructor(){Se(this,"worker",null);this.initializeWorker()}initializeWorker(){try{this.worker=new Worker(new URL("/assets/siteEngineWorker-CasCjnzI.js",import.meta.url),{type:"module"}),console.log("✅ Worker initialized")}catch(s){console.error("Failed to initialize worker:",s)}}async generateSitePlan(s,t){if(!this.worker){const{generateSitePlan:n}=await Ke(async()=>{const{generateSitePlan:i}=await import("./planner-Dz_GPwzI.js");return{generateSitePlan:i}},[]);return n(s,t)}const r=++oa;return this.worker.postMessage({type:"generate",id:r,parcel:s,config:t}),new Promise((n,i)=>{const x=l=>{const{id:m,type:h,payload:d,error:c}=l.data||{};if(!(h!=="generated"||m!==r)&&(this.worker.removeEventListener("message",x),!(r<ds))){if(ds=r,c)return i(new Error(c));n(d)}};this.worker.addEventListener("message",x)})}terminate(){this.worker&&(this.worker.terminate(),this.worker=null)}}const ma=new da,Es=({parcel:a,planElements:s=[],metrics:t,onInvestmentAnalysis:r})=>{const n=o.useRef(null),[i,x]=o.useState(s),[l,m]=o.useState(null),[h,d]=o.useState({isDragging:!1,dragType:"selection",offset:{x:0,y:0},originalPosition:{x:0,y:0}}),[c,u]=o.useState({zoom:1,panX:0,panY:0}),[g,v]=o.useState(!1),[w,y]=o.useState(0),[j,b]=o.useState("select"),[N,p]=o.useState(!0),[_,S]=o.useState(!0);o.useEffect(()=>{const P=n.current;if(!P)return;const F=P.getContext("2d");if(!F)return;const z=()=>{const T=P.getBoundingClientRect();P.width=T.width*window.devicePixelRatio,P.height=T.height*window.devicePixelRatio,F.scale(window.devicePixelRatio,window.devicePixelRatio)};return z(),window.addEventListener("resize",z),()=>window.removeEventListener("resize",z)},[]);const C=o.useCallback(()=>{const P=n.current;if(!P)return;const F=P.getContext("2d");F&&(F.clearRect(0,0,P.width,P.height),F.save(),F.scale(c.zoom,c.zoom),F.translate(c.panX,c.panY),i.forEach(z=>{A(F,z,z.id===l)}),F.restore())},[i,l,c]),A=(P,F,z)=>{switch(P.save(),P.strokeStyle=z?"#3B82F6":"#6B7280",P.lineWidth=z?3:1,P.fillStyle=R(F),P.globalAlpha=.3,F.type){case"building":k(P,F);break;case"parking":M(P,F);break;case"greenspace":f(P,F);break}P.restore()},k=(P,F)=>{const z=F.geometry.coordinates[0];P.beginPath(),P.moveTo(z[0][0],z[0][1]);for(let T=1;T<z.length;T++)P.lineTo(z[T][0],z[T][1]);P.closePath(),P.fill(),P.stroke()},M=(P,F)=>{const z=F.geometry.coordinates[0];P.beginPath(),P.moveTo(z[0][0],z[0][1]);for(let T=1;T<z.length;T++)P.lineTo(z[T][0],z[T][1]);P.closePath(),P.fill(),P.stroke()},f=(P,F)=>{const z=F.geometry.coordinates[0];P.beginPath(),P.moveTo(z[0][0],z[0][1]);for(let T=1;T<z.length;T++)P.lineTo(z[T][0],z[T][1]);P.closePath(),P.fill(),P.stroke()},R=P=>{switch(P.type){case"building":return"#3B82F6";case"parking":return"#10B981";case"greenspace":return"#059669";default:return"#6B7280"}},E=o.useCallback(P=>{const F=n.current;if(!F)return;const z=F.getBoundingClientRect(),T=(P.clientX-z.left)/c.zoom-c.panX,se=(P.clientY-z.top)/c.zoom-c.panY,L=i.find(X=>O(T,se,X));m(L?.id||null)},[i,c]),O=(P,F,z)=>{const T=z.geometry.coordinates[0];let se=!1;for(let L=0,X=T.length-1;L<T.length;X=L++)T[L][1]>F!=T[X][1]>F&&P<(T[X][0]-T[L][0])*(F-T[L][1])/(T[X][1]-T[L][1])+T[L][0]&&(se=!se);return se},I=o.useCallback(async()=>{v(!0),y(0);try{const P={parcelId:a.ogc_fid,buildableArea:a.geometry,zoning:{frontSetbackFt:20,sideSetbackFt:10,rearSetbackFt:20,maxFar:2,maxCoveragePct:60,minParkingRatio:1},designParameters:{targetFAR:1.5,targetCoveragePct:50,parking:{targetRatio:1.5,stallWidthFt:9,stallDepthFt:18,aisleWidthFt:12,adaPct:5,evPct:10,layoutAngle:0},buildingTypology:"bar",numBuildings:2}};y(25);const F=await ma.generateSitePlan(a.geometry,P);if(y(75),x(F.elements),y(100),r){const z={totalInvestment:F.metrics.totalBuiltSF*150,projectedRevenue:F.metrics.totalBuiltSF*2.5*12,operatingExpenses:F.metrics.totalBuiltSF*1*12,netOperatingIncome:F.metrics.totalBuiltSF*1.5*12,capRate:.06,irr:.12,paybackPeriod:8.3,riskAssessment:"medium"};r(z)}}catch(P){console.error("Error generating site plan:",P)}finally{v(!1),y(0)}},[a,r]);return o.useEffect(()=>{s.length>0&&x(s)},[s]),o.useEffect(()=>{C()},[C]),e.jsxs("div",{className:"flex flex-col h-full bg-gray-50",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white border-b",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Site Planner"}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("button",{onClick:I,disabled:g,className:"flex items-center space-x-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsx("span",{children:g?"Generating...":"Generate Plan"})]})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>S(!_),className:"p-2 text-gray-600 hover:text-gray-900",children:e.jsx(B,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>p(!N),className:"p-2 text-gray-600 hover:text-gray-900",children:e.jsx(mt,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsxs("div",{className:"w-16 bg-white border-r flex flex-col items-center py-4 space-y-2",children:[e.jsx("button",{onClick:()=>b("select"),className:`p-2 rounded ${j==="select"?"bg-blue-100 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:e.jsx(Ie,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>b("draw"),className:`p-2 rounded ${j==="draw"?"bg-blue-100 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:e.jsx(xt,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>b("edit"),className:`p-2 rounded ${j==="edit"?"bg-blue-100 text-blue-600":"text-gray-600 hover:text-gray-900"}`,children:e.jsx(vs,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("canvas",{ref:n,className:"w-full h-full cursor-crosshair",onClick:E}),g&&e.jsxs("div",{className:"absolute top-4 left-4 bg-white p-4 rounded-lg shadow-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-sm font-medium",children:"Generating site plan..."})]}),e.jsx("div",{className:"w-48 h-2 bg-gray-200 rounded-full mt-2",children:e.jsx("div",{className:"h-2 bg-blue-600 rounded-full transition-all duration-300",style:{width:`${w}%`}})})]})]}),_&&t&&e.jsxs("div",{className:"w-80 bg-white border-l p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Site Metrics"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"FAR:"}),e.jsx("span",{className:"font-medium",children:t.achievedFAR.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Coverage:"}),e.jsxs("span",{className:"font-medium",children:[t.siteCoveragePct.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Parking Ratio:"}),e.jsx("span",{className:"font-medium",children:t.parkingRatio.toFixed(2)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Built SF:"}),e.jsx("span",{className:"font-medium",children:t.totalBuiltSF.toLocaleString()})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Open Space:"}),e.jsxs("span",{className:"font-medium",children:[t.openSpacePct.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Compliance:"}),t.zoningCompliant?e.jsx(Z,{className:"w-4 h-4 text-green-600"}):e.jsx(ue,{className:"w-4 h-4 text-red-600"})]})]})]})]})]})};let Os=class extends o.Component{constructor(t){super(t);Se(this,"handleRetry",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});Se(this,"handleGoHome",()=>{window.location.href="/"});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t,errorInfo:null}}componentDidCatch(t,r){console.error("ErrorBoundary caught an error:",t,r),this.setState({error:t,errorInfo:r}),this.props.onError?.(t,r)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center px-4",children:e.jsx("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4",children:e.jsx(ue,{className:"h-6 w-6 text-red-600"})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"We encountered an unexpected error. Don't worry, your data is safe."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:this.handleRetry,className:"w-full flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(Ye,{className:"w-4 h-4 mr-2"}),"Try Again"]}),e.jsxs("button",{onClick:this.handleGoHome,className:"w-full flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(Ns,{className:"w-4 h-4 mr-2"}),"Go Home"]})]}),!1]})})}):this.props.children}};function xa({children:a}){return e.jsx(Os,{fallback:e.jsx("div",{className:"flex items-center justify-center h-64 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ue,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Site Planner Error"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"The site planner encountered an error. Please try refreshing the page."}),e.jsxs("button",{onClick:()=>window.location.reload(),className:"mt-3 inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200",children:[e.jsx(Ye,{className:"w-4 h-4 mr-1"}),"Refresh"]})]})}),children:a})}function ms(a){return a&&typeof a.ogc_fid=="string"&&a.ogc_fid.length>0}function xs(a){return{ogc_fid:a,parcelnumb:null,parcelnumb_no_formatting:null,address:null,zoning:null,zoning_description:null,zoning_type:null,owner:null,deeded_acres:null,gisacre:null,sqft:null,landval:null,parval:null,yearbuilt:null,numstories:null,numunits:null,lat:null,lon:null,geometry:{type:"Polygon",coordinates:[]}}}const ua=D.memo(function({parcel:s,isOpen:t,onClose:r}){const[n,i]=o.useState("overview");if(o.useEffect(()=>{s&&(console.log("🔍 FullAnalysisModal parcel object:",s),console.log("🔍 isValidParcel check:",ms(s)),console.log("🔍 Parcel properties:",{id:s.id,ogc_fid:s.ogc_fid,address:s.address,sqft:s.sqft,deeded_acres:s.deeded_acres}))},[s]),!t||!s)return null;const x=[{id:"overview",label:"Overview",icon:Q},{id:"hbu",label:"HBU Analysis",icon:me},{id:"siteplan",label:"Site Plan",icon:ce},{id:"visual",label:"Site Design",icon:ws},{id:"financial",label:"Financial",icon:le}];return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full h-full max-w-7xl max-h-[95vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"w-6 h-6 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Full Parcel Analysis"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[s.address," • ",s.parcelnumb]})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(G,{className:"w-6 h-6 text-gray-500"})})]}),e.jsx("div",{className:"flex border-b border-gray-200 bg-gray-50",children:x.map(l=>{const m=l.icon;return e.jsxs("button",{onClick:()=>i(l.id),className:`flex items-center space-x-2 px-6 py-4 text-sm font-medium transition-colors ${n===l.id?"text-blue-600 border-b-2 border-blue-600 bg-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:[e.jsx(m,{className:"w-4 h-4"}),e.jsx("span",{children:l.label})]},l.id)})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs("div",{className:"h-full overflow-y-auto p-6",children:[n==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Parcel Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"Property Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Address:"})," ",s.address]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Parcel #:"})," ",s.parcelnumb]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Lot Size:"})," ",(s.deeded_acres||0).toFixed(2)," acres"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Zoning:"})," ",s.zoning]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"Ownership"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Owner:"})," ",s.primary_owner||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Use:"})," ",s.usedesc||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Year Built:"})," ",s.yearbuilt||"N/A"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"Valuation"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Value:"})," $",(s.parval||0).toLocaleString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Land Value:"})," $",(s.landval||0).toLocaleString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Improvement Value:"})," $",(s.improvval||0).toLocaleString()]})]})]})]})]}),s.zoning_data&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Zoning Regulations"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"Development Constraints"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Max FAR:"})," ",s.zoning_data.max_far||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Max Height:"})," ",s.zoning_data.max_building_height_ft||"N/A"," ft"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Max Coverage:"})," ",s.zoning_data.max_coverage_pct||"N/A","%"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Max Density:"})," ",s.zoning_data.max_density_du_per_acre||"N/A"," DU/acre"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"Setback Requirements"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Front:"})," ",s.zoning_data.min_front_setback_ft||"N/A"," ft"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Rear:"})," ",s.zoning_data.min_rear_setback_ft||"N/A"," ft"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Side:"})," ",s.zoning_data.min_side_setback_ft||"N/A"," ft"]})]})]})]})]})]}),n==="hbu"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Highest & Best Use Analysis"}),e.jsx(Kt,{parcel:s})]})}),n==="siteplan"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Site Plan Designer"}),e.jsx(ca,{parcel:(()=>{const l=s?.geometry?.type==="Polygon"||s?.geometry?.type==="MultiPolygon"?Is(s.geometry):null;return l?{...s,geometry:l}:xs(s.id||"unknown",s.sqft||4356)})(),onUnderwritingUpdate:l=>{console.log("Site plan financial update:",l)}})]})}),n==="visual"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Visual Site Plan"}),e.jsx("div",{className:"h-[800px]",children:e.jsx(xa,{children:e.jsx(Es,{parcel:ms(s)?s:xs(s.ogc_fid||s.id||"unknown",s.sqft||4356),marketData:{avgPricePerSqFt:300,avgRentPerSqFt:2.5,capRate:.06,constructionCostPerSqFt:200},onInvestmentAnalysis:l=>{console.log("Investment analysis:",l)}})})})]})}),n==="financial"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Financial Analysis"}),e.jsx("div",{className:"text-gray-600",children:"Financial analysis tools will be integrated here."})]})})]})})]})})});function ha({isOpen:a,onClose:s}){const[t,r]=o.useState([]),[n,i]=o.useState("selection"),{selectedParcel:x}=K();o.useEffect(()=>{x&&!t.find(d=>d.id===x.ogc_fid?.toString())&&r(d=>[...d,{id:x.ogc_fid?.toString()||"",address:x.address||"",parcelnumb:x.parcelnumb||"",deeded_acres:x.deeded_acres||0,sqft:x.sqft||0,zoning:x.zoning||"",parval:x.parval||0,geometry:x.geometry}])},[x,t]);const l=d=>{r(c=>c.filter(u=>u.id!==d))},h=(()=>{if(t.length===0)return null;const d=t.reduce((v,w)=>v+w.deeded_acres,0),c=t.reduce((v,w)=>v+w.sqft,0),u=t.reduce((v,w)=>v+w.parval,0),g=d>0?u/d:0;return{totalAcres:d,totalSqft:c,totalValue:u,avgValuePerAcre:g,parcelCount:t.length}})();return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full h-full max-w-7xl max-h-[95vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"w-6 h-6 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Multi-Parcel Analysis"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[t.length," parcel",t.length!==1?"s":""," selected"]})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(G,{className:"w-6 h-6 text-gray-500"})})]}),e.jsxs("div",{className:"flex border-b border-gray-200 bg-gray-50",children:[e.jsxs("button",{onClick:()=>i("selection"),className:`flex items-center space-x-2 px-6 py-4 text-sm font-medium transition-colors ${n==="selection"?"text-blue-600 border-b-2 border-blue-600 bg-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"Selection"})]}),e.jsxs("button",{onClick:()=>i("analysis"),className:`flex items-center space-x-2 px-6 py-4 text-sm font-medium transition-colors ${n==="analysis"?"text-blue-600 border-b-2 border-blue-600 bg-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,disabled:t.length===0,children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{children:"Combined Analysis"})]}),e.jsxs("button",{onClick:()=>i("comparison"),className:`flex items-center space-x-2 px-6 py-4 text-sm font-medium transition-colors ${n==="comparison"?"text-blue-600 border-b-2 border-blue-600 bg-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,disabled:t.length<2,children:[e.jsx(Q,{className:"w-4 h-4"}),e.jsx("span",{children:"Comparison"})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs("div",{className:"h-full overflow-y-auto p-6",children:[n==="selection"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"How to Add Parcels"}),e.jsx("p",{className:"text-blue-800 text-sm",children:"Click on parcels in the map to add them to your analysis. You can analyze individual parcels or combine multiple parcels for comprehensive development analysis."})]}),t.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Selected Parcels"}),e.jsx("div",{className:"grid gap-4",children:t.map(d=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:d.address}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Parcel #",d.parcelnumb," • ",d.deeded_acres.toFixed(2)," acres • ",d.zoning]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["$",d.parval.toLocaleString()]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["$",(d.parval/d.deeded_acres).toLocaleString(),"/acre"]})]})]})}),e.jsx("button",{onClick:()=>l(d.id),className:"ml-4 p-2 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(G,{className:"w-4 h-4 text-red-500"})})]})},d.id))})]}),t.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ce,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Parcels Selected"}),e.jsx("p",{className:"text-gray-600",children:"Click on parcels in the map to start your multi-parcel analysis."})]})]}),n==="analysis"&&h&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Combined Statistics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:h.parcelCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"Parcels"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:h.totalAcres.toFixed(2)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Acres"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-purple-600",children:h.totalSqft.toLocaleString()}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Sq Ft"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-orange-600",children:["$",h.totalValue.toLocaleString()]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Value"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Development Potential"}),e.jsxs("div",{className:"text-gray-600",children:[e.jsx("p",{children:"Combined analysis tools will be integrated here, including:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Combined zoning analysis"}),e.jsx("li",{children:"Master site planning"}),e.jsx("li",{children:"Infrastructure requirements"}),e.jsx("li",{children:"Phased development options"}),e.jsx("li",{children:"Combined financial modeling"})]})]})]})]}),n==="comparison"&&t.length>=2&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Parcel Comparison"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Address"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Size"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Zoning"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Value"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"$/Acre"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(d=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:d.address}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[d.deeded_acres.toFixed(2)," acres"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:d.zoning}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["$",d.parval.toLocaleString()]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["$",(d.parval/d.deeded_acres).toLocaleString()]})]},d.id))})]})})]})})]})})]})}):null}const ga=D.memo(function({parcel:s,isOpen:t,onClose:r,onAddToProject:n,hasActiveProject:i,onCreateProjectFromParcel:x}){const[l,m]=o.useState(!1),[h,d]=o.useState(!1),[c,u]=o.useState("overview");if(!t||!s)return null;const g=w=>w<1?`${Math.round(w*43560).toLocaleString()} sq ft`:`${w.toFixed(2)} acres`,v=w=>w?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(w):"N/A";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"fixed inset-y-0 right-0 w-96 bg-white shadow-xl z-40 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"w-5 h-5 text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Parcel Details"})]}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-200 rounded-lg transition-colors",children:e.jsx(G,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"flex border-b border-gray-200 bg-white",children:[e.jsx("button",{onClick:()=>u("overview"),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors ${c==="overview"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:"Overview"}),e.jsx("button",{onClick:()=>u("underwriting"),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors ${c==="underwriting"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:"Underwriting"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[c==="overview"&&e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(je,{className:"w-4 h-4 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Property Summary"})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Address"}),e.jsx("p",{className:"font-medium text-gray-900",children:s.address||"N/A"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Parcel #"}),e.jsx("p",{className:"font-medium text-gray-900",children:s.parcelnumb||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Lot Size"}),e.jsx("p",{className:"font-medium text-gray-900",children:g(s.deeded_acres||s.deededacreage||s.gisacre||0)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Zoning"}),e.jsx("p",{className:"font-medium text-gray-900",children:s.zoning||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Use"}),e.jsx("p",{className:"font-medium text-gray-900",children:s.usedesc||"N/A"})]})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(_s,{className:"w-4 h-4 text-green-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Ownership & Valuation"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Owner"}),e.jsx("p",{className:"font-medium text-gray-900",children:s.primary_owner||s.owner||"N/A"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Value"}),e.jsx("p",{className:"font-medium text-gray-900",children:v(s.parval)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Land Value"}),e.jsx("p",{className:"font-medium text-gray-900",children:v(s.landval)})]})]}),s.yearbuilt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Year Built"}),e.jsx("p",{className:"font-medium text-gray-900",children:s.yearbuilt})]})]})]}),s.zoning_data&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(Ze,{className:"w-4 h-4 text-purple-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Zoning Summary"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Type"}),e.jsx("p",{className:"font-medium text-gray-900",children:s.zoning_data.zoning_type||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Max FAR"}),e.jsx("p",{className:"font-medium text-gray-900",children:s.zoning_data.max_far||"N/A"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Max Height"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[s.zoning_data.max_building_height_ft||"N/A"," ft"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Max Coverage"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[s.zoning_data.max_coverage_pct||"N/A","%"]})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>m(!0),className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("span",{children:"Full Analysis"})]}),e.jsxs("button",{onClick:()=>d(!0),className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"Multi-Parcel Analysis"})]}),i&&n&&e.jsxs("button",{onClick:()=>n(s),className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"Add to Project"})]}),!i&&x&&e.jsxs("button",{onClick:()=>x(s),className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"Create Project from Parcel"})]})]})]}),c==="underwriting"&&e.jsx("div",{className:"p-4",children:e.jsx(Zt,{parcel:s})})]})]}),e.jsx(ua,{parcel:s,isOpen:l,onClose:()=>m(!1)}),e.jsx(ha,{isOpen:h,onClose:()=>d(!1)})]})}),pa=D.memo(function({onGetStarted:s,onViewDemo:t}){const[r,n]=o.useState(!1),[i,x]=o.useState(0);o.useEffect(()=>{const d=setInterval(()=>{x(c=>(c+1)%m.length)},5e3);return()=>clearInterval(d)},[]);const l=[{icon:e.jsx(Q,{className:"w-8 h-8 text-blue-600"}),title:"Interactive Parcel Mapping",description:"Navigate Nashville's real estate landscape with precision. Click any parcel for instant property insights, zoning data, and development potential.",highlight:"Real-time data"},{icon:e.jsx(B,{className:"w-8 h-8 text-green-600"}),title:"AI-Powered Analysis",description:"Get instant underwriting, market trends, and investment recommendations powered by advanced machine learning algorithms.",highlight:"AI-driven insights"},{icon:e.jsx(W,{className:"w-8 h-8 text-purple-600"}),title:"Site Plan Designer",description:"Design development scenarios with our CAD-like interface. Optimize building placement, parking, and amenities.",highlight:"Professional tools"},{icon:e.jsx(me,{className:"w-8 h-8 text-orange-600"}),title:"Financial Modeling",description:"Calculate ROI, IRR, and cash flow projections with built-in financial analysis tools and market comparables.",highlight:"Investment-ready"}],m=[{name:"Sarah Chen",role:"Development Director, Hines",company:"Hines",content:"This platform has revolutionized how we evaluate sites. We've reduced our due diligence time by 60% and found 3 new development opportunities we would have missed.",rating:5,avatar:"SC"},{name:"Michael Rodriguez",role:"Principal, Blackstone Real Estate",company:"Blackstone",content:"The AI-powered market analysis is incredibly accurate. We've used it for $2B+ in acquisitions across Nashville and the insights have been spot-on.",rating:5,avatar:"MR"},{name:"Jennifer Walsh",role:"VP Acquisitions, Greystar",company:"Greystar",content:"The site planning tools are game-changing. We can model multiple scenarios in minutes instead of days. It's like having a full development team in your browser.",rating:5,avatar:"JW"}],h=[{number:"10,000+",label:"Active Users"},{number:"$50B+",label:"Deals Analyzed"},{number:"95%",label:"Accuracy Rate"},{number:"60%",label:"Time Saved"}];return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("nav",{className:"bg-white border-b border-gray-200 sticky top-0 z-50",children:[e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-600 p-2 rounded-lg",children:e.jsx(Q,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Parcel Intelligence"}),e.jsx("p",{className:"text-xs text-gray-600 hidden sm:block",children:"Real Estate Investment Platform"})]})]}),e.jsxs("div",{className:"hidden md:flex items-center space-x-8",children:[e.jsx("a",{href:"#features",className:"text-gray-600 hover:text-gray-900 transition-colors",children:"Features"}),e.jsx("a",{href:"#testimonials",className:"text-gray-600 hover:text-gray-900 transition-colors",children:"Testimonials"}),e.jsx("a",{href:"#pricing",className:"text-gray-600 hover:text-gray-900 transition-colors",children:"Pricing"}),e.jsxs("button",{onClick:t,className:"text-gray-600 hover:text-gray-900 transition-colors flex items-center space-x-1",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsx("span",{children:"Demo"})]})]}),e.jsxs("div",{className:"hidden md:flex items-center space-x-4",children:[e.jsx("button",{className:"text-gray-600 hover:text-gray-900 transition-colors",children:"Sign In"}),e.jsx("button",{onClick:s,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Get Started Free"})]}),e.jsx("button",{onClick:()=>n(!r),className:"md:hidden p-2 text-gray-600 hover:text-gray-900",children:r?e.jsx(G,{className:"w-6 h-6"}):e.jsx(Ss,{className:"w-6 h-6"})})]})}),r&&e.jsx("div",{className:"md:hidden bg-white border-t border-gray-200",children:e.jsxs("div",{className:"px-4 py-4 space-y-4",children:[e.jsx("a",{href:"#features",className:"block text-gray-600 hover:text-gray-900",children:"Features"}),e.jsx("a",{href:"#testimonials",className:"block text-gray-600 hover:text-gray-900",children:"Testimonials"}),e.jsx("a",{href:"#pricing",className:"block text-gray-600 hover:text-gray-900",children:"Pricing"}),e.jsxs("button",{onClick:t,className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsx("span",{children:"Demo"})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200 space-y-2",children:[e.jsx("button",{className:"block w-full text-left text-gray-600 hover:text-gray-900",children:"Sign In"}),e.jsx("button",{onClick:s,className:"w-full bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Get Started Free"})]})]})})]}),e.jsx("section",{className:"relative bg-gradient-to-br from-blue-50 via-white to-purple-50 py-20 lg:py-32",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"grid lg:grid-cols-2 gap-12 items-center",children:[e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"inline-flex items-center px-4 py-2 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"AI-Powered Real Estate Intelligence"]}),e.jsxs("h1",{className:"text-4xl lg:text-6xl font-bold text-gray-900 leading-tight",children:["Find, Analyze & Develop",e.jsx("span",{className:"text-blue-600 block",children:"Nashville Real Estate"})]}),e.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"The only platform that combines interactive parcel mapping, AI-powered analysis, and professional site planning tools. Used by top developers and investors."})]}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:h.map((d,c)=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:d.number}),e.jsx("div",{className:"text-sm text-gray-600",children:d.label})]},c))}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("button",{onClick:s,className:"bg-blue-600 text-white px-8 py-4 rounded-lg hover:bg-blue-700 transition-colors font-medium text-lg flex items-center justify-center space-x-2",children:[e.jsx("span",{children:"Start Free Trial"}),e.jsx(re,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:t,className:"border border-gray-300 text-gray-700 px-8 py-4 rounded-lg hover:bg-gray-50 transition-colors font-medium text-lg flex items-center justify-center space-x-2",children:[e.jsx(fe,{className:"w-5 h-5"}),e.jsx("span",{children:"Watch Demo"})]})]}),e.jsxs("div",{className:"flex items-center space-x-6 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Ze,{className:"w-4 h-4"}),e.jsx("span",{children:"SOC 2 Compliant"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ut,{className:"w-4 h-4"}),e.jsx("span",{children:"Enterprise Ready"})]})]})]}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-6 border border-gray-200",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Interactive Map Demo"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-400 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full"})]})]}),e.jsx("div",{className:"bg-gray-100 rounded-lg h-64 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(Q,{className:"w-16 h-16 text-blue-600 mx-auto"}),e.jsxs("div",{className:"text-gray-600",children:[e.jsx("p",{className:"font-medium",children:"Click any parcel to explore"}),e.jsx("p",{className:"text-sm",children:"Interactive Nashville real estate data"})]})]})}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(me,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"AI Analysis"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Development Potential:"}),e.jsx("span",{className:"font-medium text-green-600",children:"High"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Estimated ROI:"}),e.jsx("span",{className:"font-medium text-blue-600",children:"18.5%"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Zoning:"}),e.jsx("span",{className:"font-medium text-gray-900",children:"RM15"})]})]})]})]})})})]})})}),e.jsx("section",{id:"features",className:"py-20 bg-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-3xl lg:text-4xl font-bold text-gray-900 mb-4",children:"Everything You Need to Succeed"}),e.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"Our platform combines the best of mapping, analysis, and design tools to give you a competitive edge in Nashville's real estate market."})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-8",children:l.map((d,c)=>e.jsx("div",{className:"group",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200 hover:border-blue-300 hover:shadow-lg transition-all duration-300",children:[e.jsx("div",{className:"mb-4",children:d.icon}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:d.title}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:d.highlight})]}),e.jsx("p",{className:"text-gray-600 text-sm leading-relaxed",children:d.description})]})]})},c))})]})}),e.jsx("section",{className:"py-20 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-3xl lg:text-4xl font-bold text-gray-900 mb-4",children:"Why Choose Us Over Competitors?"}),e.jsx("p",{className:"text-xl text-gray-600",children:"We combine the best features from multiple platforms into one powerful tool."})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-gray-900",children:"Feature"}),e.jsx("th",{className:"px-6 py-4 text-center text-sm font-medium text-blue-600",children:"Parcel Intelligence"}),e.jsx("th",{className:"px-6 py-4 text-center text-sm font-medium text-gray-600",children:"Regrid"}),e.jsx("th",{className:"px-6 py-4 text-center text-sm font-medium text-gray-600",children:"CoStar"}),e.jsx("th",{className:"px-6 py-4 text-center text-sm font-medium text-gray-600",children:"Crexi"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:"Interactive Parcel Mapping"}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(Z,{className:"w-5 h-5 text-green-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(Z,{className:"w-5 h-5 text-green-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(G,{className:"w-5 h-5 text-red-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(G,{className:"w-5 h-5 text-red-500 mx-auto"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:"AI-Powered Analysis"}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(Z,{className:"w-5 h-5 text-green-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(G,{className:"w-5 h-5 text-red-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(G,{className:"w-5 h-5 text-red-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(G,{className:"w-5 h-5 text-red-500 mx-auto"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:"Site Plan Designer"}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(Z,{className:"w-5 h-5 text-green-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(G,{className:"w-5 h-5 text-red-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(G,{className:"w-5 h-5 text-red-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(G,{className:"w-5 h-5 text-red-500 mx-auto"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:"Financial Modeling"}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(Z,{className:"w-5 h-5 text-green-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(G,{className:"w-5 h-5 text-red-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(Z,{className:"w-5 h-5 text-green-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(G,{className:"w-5 h-5 text-red-500 mx-auto"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:"Real-time Data"}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(Z,{className:"w-5 h-5 text-green-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(Z,{className:"w-5 h-5 text-green-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(Z,{className:"w-5 h-5 text-green-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(G,{className:"w-5 h-5 text-red-500 mx-auto"})})]})]})]})})})]})}),e.jsx("section",{id:"testimonials",className:"py-20 bg-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-3xl lg:text-4xl font-bold text-gray-900 mb-4",children:"Trusted by Industry Leaders"}),e.jsx("p",{className:"text-xl text-gray-600",children:"See what top developers and investors are saying about our platform."})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"flex justify-center space-x-1 mb-4",children:[...Array(m[i].rating)].map((d,c)=>e.jsx(ht,{className:"w-5 h-5 text-yellow-400 fill-current"},c))}),e.jsxs("blockquote",{className:"text-xl text-gray-700 italic leading-relaxed",children:['"',m[i].content,'"']})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white font-semibold",children:m[i].avatar}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:m[i].name}),e.jsx("div",{className:"text-gray-600",children:m[i].role}),e.jsx("div",{className:"text-blue-600 font-medium",children:m[i].company})]})]})]}),e.jsx("div",{className:"flex justify-center space-x-2 mt-8",children:m.map((d,c)=>e.jsx("button",{onClick:()=>x(c),className:`w-3 h-3 rounded-full transition-colors ${c===i?"bg-blue-600":"bg-gray-300"}`},c))})]})]})}),e.jsx("section",{className:"py-20 bg-gradient-to-r from-blue-600 to-purple-600",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center px-4 sm:px-6 lg:px-8",children:[e.jsx("h2",{className:"text-3xl lg:text-4xl font-bold text-white mb-4",children:"Ready to Transform Your Real Estate Workflow?"}),e.jsx("p",{className:"text-xl text-blue-100 mb-8",children:"Join thousands of professionals who are already using our platform to find, analyze, and develop properties."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs("button",{onClick:s,className:"bg-white text-blue-600 px-8 py-4 rounded-lg hover:bg-gray-50 transition-colors font-medium text-lg flex items-center justify-center space-x-2",children:[e.jsx("span",{children:"Start Free Trial"}),e.jsx(re,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:t,className:"border border-white text-white px-8 py-4 rounded-lg hover:bg-white hover:text-blue-600 transition-colors font-medium text-lg flex items-center justify-center space-x-2",children:[e.jsx(fe,{className:"w-5 h-5"}),e.jsx("span",{children:"Watch Demo"})]})]})]})}),e.jsx("footer",{className:"bg-gray-900 text-white py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"grid md:grid-cols-4 gap-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"bg-blue-600 p-2 rounded-lg",children:e.jsx(Q,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:"Parcel Intelligence"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Real Estate Investment Platform"})]})]}),e.jsx("p",{className:"text-gray-400 text-sm",children:"The most advanced real estate analysis platform for developers and investors."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Product"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-400",children:[e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Features"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Pricing"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"API"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Integrations"})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Company"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-400",children:[e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"About"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Blog"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Careers"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Contact"})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Support"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-400",children:[e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Help Center"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Documentation"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Status"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Security"})})]})]})]}),e.jsx("div",{className:"border-t border-gray-800 mt-8 pt-8 text-center text-sm text-gray-400",children:e.jsx("p",{children:"© 2024 Parcel Intelligence. All rights reserved."})})]})})]})});function fa({isOpen:a,onClose:s,onComplete:t}){const[r,n]=o.useState(0),[i,x]=o.useState(new Set),l=[{id:"welcome",title:"Welcome to Parcel Intelligence",description:"The most advanced real estate analysis platform for Nashville developers and investors.",icon:e.jsx(Q,{className:"w-8 h-8 text-blue-600"}),action:"Get Started"},{id:"explore",title:"Explore the Map",description:"Click any parcel on the map to view property details, zoning information, and development potential.",icon:e.jsx(ee,{className:"w-8 h-8 text-green-600"}),action:"Try It Now"},{id:"analyze",title:"AI-Powered Analysis",description:"Get instant underwriting, market trends, and investment recommendations powered by advanced AI.",icon:e.jsx(B,{className:"w-8 h-8 text-purple-600"}),action:"Run Analysis"},{id:"design",title:"Site Plan Designer",description:"Design development scenarios with our CAD-like interface. Optimize building placement and amenities.",icon:e.jsx(W,{className:"w-8 h-8 text-orange-600"}),action:"Start Designing"},{id:"financial",title:"Financial Modeling",description:"Calculate ROI, IRR, and cash flow projections with built-in financial analysis tools.",icon:e.jsx(Y,{className:"w-8 h-8 text-red-600"}),action:"View Projections"}],m=()=>{r<l.length-1?n(r+1):t()},h=()=>{t()},d=g=>{x(v=>new Set([...v,g])),setTimeout(()=>{m()},1e3)};if(!a)return null;const c=l[r],u=(r+1)/l.length*100;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-white bg-opacity-20 p-2 rounded-lg",children:c.icon}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Quick Tour"}),e.jsxs("p",{className:"text-blue-100 text-sm",children:["Step ",r+1," of ",l.length]})]})]}),e.jsx("button",{onClick:s,className:"text-white hover:text-blue-200 transition-colors",children:e.jsx(G,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"bg-white bg-opacity-20 rounded-full h-2",children:e.jsx("div",{className:"bg-white h-2 rounded-full transition-all duration-300",style:{width:`${u}%`}})})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:c.icon}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:c.title}),e.jsx("p",{className:"text-gray-600 text-lg leading-relaxed",children:c.description})]}),e.jsx("div",{className:"flex justify-center space-x-2 mb-8",children:l.map((g,v)=>e.jsx("div",{className:`w-3 h-3 rounded-full transition-colors ${v===r?"bg-blue-600":v<r?"bg-green-500":"bg-gray-300"}`},g.id))}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[c.action&&e.jsxs("button",{onClick:()=>d(c.id),className:"flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsx("span",{children:c.action})]}),e.jsxs("button",{onClick:m,className:"flex-1 border border-gray-300 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-50 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx("span",{children:r===l.length-1?"Complete":"Next"}),e.jsx(re,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx("button",{onClick:h,className:"text-gray-500 hover:text-gray-700 text-sm",children:"Skip Tour"})})]})]})})}function ba({type:a,title:s,message:t,onClose:r,duration:n=5e3}){const[i,x]=D.useState(!0);D.useEffect(()=>{if(n>0){const h=setTimeout(()=>{x(!1),setTimeout(()=>r?.(),300)},n);return()=>clearTimeout(h)}},[n,r]);const l={success:"bg-green-50 border-green-200 text-green-800",error:"bg-red-50 border-red-200 text-red-800",warning:"bg-yellow-50 border-yellow-200 text-yellow-800",info:"bg-blue-50 border-blue-200 text-blue-800"},m={success:"text-green-400",error:"text-red-400",warning:"text-yellow-400",info:"text-blue-400"};return i?e.jsx("div",{className:`fixed top-4 right-4 z-50 max-w-sm w-full bg-white border rounded-lg shadow-lg transition-all duration-300 ${i?"translate-x-0 opacity-100":"translate-x-full opacity-0"} ${l[a]}`,children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:`w-5 h-5 ${m[a]}`,children:[a==="success"&&e.jsx("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),a==="error"&&e.jsx("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),a==="warning"&&e.jsx("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),a==="info"&&e.jsx("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})]})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h4",{className:"text-sm font-medium",children:s}),t&&e.jsx("p",{className:"text-sm mt-1",children:t})]}),r&&e.jsx("button",{onClick:r,className:"ml-4 flex-shrink-0 text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})})}):null}function ja({isOpen:a,onClose:s,selectedParcel:t,onParcelSelect:r}){const[n,i]=o.useState("explore"),[x,l]=o.useState(0),[m,h]=o.useState(!1),[d,c]=o.useState(null),{activeProjectId:u,activeProjectName:g,parcelIds:v}=ie(),{setDrawer:w}=K();o.useEffect(()=>{t&&n==="explore"&&(i("analyze"),l(1))},[t,n]);const y={explore:{title:"Explore Properties",description:"Click parcels on the map to discover development opportunities",icon:e.jsx(Q,{className:"w-6 h-6"}),color:"blue",actions:[{label:"Click any parcel",icon:e.jsx(ee,{className:"w-4 h-4"})},{label:"View property details",icon:e.jsx(ws,{className:"w-4 h-4"})}]},analyze:{title:"AI Analysis",description:"Get instant insights on development potential and market trends",icon:e.jsx(B,{className:"w-6 h-6"}),color:"green",actions:[{label:"Run HBU Analysis",icon:e.jsx(me,{className:"w-4 h-4"})},{label:"Market Insights",icon:e.jsx(oe,{className:"w-4 h-4"})}]},design:{title:"Site Planning",description:"Design your development with CAD-like precision",icon:e.jsx(W,{className:"w-6 h-6"}),color:"purple",actions:[{label:"Add Buildings",icon:e.jsx(ce,{className:"w-4 h-4"})},{label:"Design Layout",icon:e.jsx(vs,{className:"w-4 h-4"})}]},financial:{title:"Financial Modeling",description:"Calculate ROI, IRR, and cash flow projections",icon:e.jsx(Y,{className:"w-6 h-6"}),color:"orange",actions:[{label:"Run Underwriting",icon:e.jsx(le,{className:"w-4 h-4"})},{label:"View Projections",icon:e.jsx(B,{className:"w-4 h-4"})}]},compare:{title:"Compare Scenarios",description:"Evaluate multiple development options side-by-side",icon:e.jsx(ee,{className:"w-6 h-6"}),color:"indigo",actions:[{label:"Create Scenarios",icon:e.jsx(ne,{className:"w-4 h-4"})},{label:"Compare Results",icon:e.jsx(B,{className:"w-4 h-4"})}]}},j=S=>{i(S),l(0)},b=()=>{const S=["explore","analyze","design","financial","compare"],C=S.indexOf(n);C<S.length-1&&(i(S[C+1]),l(0))},N=async()=>{h(!0),setTimeout(()=>{c({hbu:"Mixed-Use Residential",confidence:85,roi:18.5,units:24,gsf:45e3}),h(!1),i("design")},2e3)};if(!a)return null;const p=y[n],_=!!u;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end lg:items-center justify-center p-0 lg:p-4",children:e.jsxs("div",{className:"bg-white w-full lg:max-w-6xl lg:max-h-[90vh] lg:rounded-2xl shadow-2xl flex flex-col h-full lg:h-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 lg:p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`p-2 rounded-lg bg-${p.color}-100`,children:p.icon}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg lg:text-xl font-semibold text-gray-900",children:p.title}),e.jsx("p",{className:"text-sm text-gray-600",children:p.description})]})]}),e.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-4 lg:px-6 py-3 bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex space-x-1",children:Object.entries(y).map(([S,C],A)=>{const k=n===S,M=Object.keys(y).indexOf(n)>A;return e.jsxs("button",{onClick:()=>j(S),className:`flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${k?`bg-${C.color}-100 text-${C.color}-700`:M?"bg-green-100 text-green-700":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`,children:[C.icon,e.jsx("span",{className:"hidden sm:inline",children:C.title})]},S)})}),n!=="compare"&&e.jsxs("button",{onClick:b,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:[e.jsx("span",{children:"Next"}),e.jsx(re,{className:"w-4 h-4"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[n==="explore"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Q,{className:"w-16 h-16 text-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Explore Nashville Properties"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Click any parcel on the map to view property details, zoning information, and development potential. Our AI will analyze each property for you."}),t?e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-blue-900",children:t.address}),e.jsxs("p",{className:"text-sm text-blue-700",children:[t.zoning," • ",t.sqft?.toLocaleString()," sqft"]})]})]})}):e.jsx("div",{className:"text-sm text-gray-500",children:"Click a parcel to get started"})]})}),n==="analyze"&&e.jsx("div",{className:"p-4 lg:p-6",children:t?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900",children:t.address}),e.jsxs("p",{className:"text-sm text-green-700",children:[t.zoning," • ",t.sqft?.toLocaleString()," sqft"]})]})]}),d?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[d.roi,"%"]}),e.jsx("div",{className:"text-xs text-green-700",children:"Projected ROI"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:d.units}),e.jsx("div",{className:"text-xs text-green-700",children:"Units"})]})]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Recommended Use:"})," ",d.hbu]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Confidence:"})," ",d.confidence,"%"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-green-700",children:"Ready to analyze this property? Our AI will evaluate development potential, market trends, and financial projections."}),e.jsx("button",{onClick:N,disabled:m,className:"w-full bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium flex items-center justify-center space-x-2",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Analyzing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Run AI Analysis"})]})})]})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(B,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a Property to Analyze"}),e.jsx("p",{className:"text-gray-600",children:"Choose a parcel from the map to run our AI-powered analysis"})]})}),n==="design"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(W,{className:"w-16 h-16 text-purple-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Design Your Development"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Use our CAD-like site planner to design buildings, parking, and amenities. Optimize your layout for maximum value."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 max-w-md mx-auto",children:[e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(ce,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("div",{className:"text-sm font-medium",children:"Add Buildings"})]}),e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(Ae,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("div",{className:"text-sm font-medium",children:"Add Parking"})]})]})]})}),n==="financial"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Y,{className:"w-16 h-16 text-orange-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Financial Analysis"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Calculate detailed financial projections including ROI, IRR, cash flow, and development costs."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(le,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Run Underwriting"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Calculate detailed financial projections"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(B,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Market Analysis"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Compare with similar properties"})]})]})})]})]})}),n==="compare"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ee,{className:"w-16 h-16 text-indigo-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Compare Scenarios"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Create multiple development scenarios and compare their financial performance, design efficiency, and market potential."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ne,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Create New Scenario"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Design an alternative development plan"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(B,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Compare Results"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Side-by-side financial comparison"})]})]})})]})]})})]}),e.jsx("div",{className:"p-4 lg:p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:_?e.jsxs("span",{children:["Project: ",e.jsx("strong",{children:g})," (",v.length," parcels)"]}):e.jsx("span",{children:"No active project"})}),e.jsxs("div",{className:"flex space-x-3",children:[!_&&e.jsx("button",{className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium",children:"Create Project"}),e.jsxs("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),e.jsx("span",{children:"Save Work"})]}),e.jsxs("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsx("span",{children:"Generate Report"})]})]})]})})]})})}function ya({isOpen:a,onClose:s,selectedParcel:t,onParcelSelect:r}){const[n,i]=o.useState("discover"),[x,l]=o.useState([]),[m,h]=o.useState(""),[d,c]=o.useState(!1),[u,g]=o.useState(null),[v,w]=o.useState(!1),{activeProjectId:y,activeProjectName:j,parcelIds:b,addParcel:N}=ie();o.useEffect(()=>{t&&n==="discover"&&i("analyze")},[t,n]);const p={discover:{title:"Discover Properties",description:"Click parcels on the map to explore development opportunities",icon:e.jsx(Q,{className:"w-6 h-6"}),color:"blue",status:"active"},analyze:{title:"Analyze Potential",description:"Get AI-powered insights on development potential",icon:e.jsx(B,{className:"w-6 h-6"}),color:"green",status:t?"active":"pending"},plan:{title:"Plan Development",description:"Design your site layout and building configuration",icon:e.jsx(W,{className:"w-6 h-6"}),color:"purple",status:"pending"},model:{title:"Financial Model",description:"Calculate ROI, cash flow, and development costs",icon:e.jsx(Y,{className:"w-6 h-6"}),color:"orange",status:"pending"},compare:{title:"Compare Options",description:"Evaluate multiple development scenarios",icon:e.jsx(ee,{className:"w-6 h-6"}),color:"indigo",status:"pending"}},_=async A=>{if(!y)c(!0),setTimeout(()=>{c(!1),l(k=>[...k,A]),i("analyze")},1e3);else try{await N(A.ogc_fid||A.id),l(k=>[...k,A]),i("analyze")}catch(k){console.error("Failed to add parcel to project:",k)}},S=async()=>{w(!0),setTimeout(()=>{g({hbu:"Mixed-Use Residential",confidence:85,roi:18.5,units:24,gsf:45e3,estimatedValue:125e5,developmentCost:85e5}),w(!1),i("plan")},2e3)},C=()=>{m.trim()&&(c(!0),setTimeout(()=>{c(!1),i("plan")},1e3))};return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end lg:items-center justify-center p-0 lg:p-4",children:e.jsxs("div",{className:"bg-white w-full lg:max-w-4xl lg:max-h-[90vh] lg:rounded-2xl shadow-2xl flex flex-col h-full lg:h-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 lg:p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:e.jsx(W,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg lg:text-xl font-semibold text-gray-900",children:"Project Workflow"}),e.jsx("p",{className:"text-sm text-gray-600",children:y?`Active: ${j}`:"Create a new development project"})]})]}),e.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-4 lg:px-6 py-4 bg-gray-50 border-b border-gray-200",children:e.jsx("div",{className:"flex items-center justify-between",children:Object.entries(p).map(([A,k],M)=>{const f=n===A,R=Object.keys(p).indexOf(n)>M;return Object.keys(p).indexOf(n)<M,e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:`flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium ${f?`bg-${k.color}-100 text-${k.color}-700`:R?"bg-green-100 text-green-700":"text-gray-500"}`,children:[R?e.jsx(Z,{className:"w-4 h-4"}):k.icon,e.jsx("span",{className:"hidden sm:inline",children:k.title})]}),M<Object.keys(p).length-1&&e.jsx("div",{className:"w-8 h-px bg-gray-300 mx-2"})]},A)})})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[n==="discover"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"w-16 h-16 text-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Discover Development Opportunities"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Click any parcel on the map to explore its development potential. Our AI will analyze zoning, market trends, and financial projections."}),t?e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:t.address}),e.jsxs("p",{className:"text-sm text-blue-700",children:[t.zoning," • ",t.sqft?.toLocaleString()," sqft"]})]})]}),e.jsx("button",{onClick:()=>_(t),disabled:d,className:"w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors font-medium flex items-center justify-center space-x-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Creating Project..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"Add to Project"})]})})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Click a parcel on the map to get started"})]})}),n==="analyze"&&e.jsx("div",{className:"p-4 lg:p-6",children:t?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900",children:t.address}),e.jsxs("p",{className:"text-sm text-green-700",children:[t.zoning," • ",t.sqft?.toLocaleString()," sqft"]})]})]}),u?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[u.roi,"%"]}),e.jsx("div",{className:"text-xs text-green-700",children:"Projected ROI"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:u.units}),e.jsx("div",{className:"text-xs text-green-700",children:"Units"})]})]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Recommended Use:"})," ",u.hbu]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Confidence:"})," ",u.confidence,"%"]}),e.jsxs("button",{onClick:()=>i("plan"),className:"w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Planning"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-green-700",children:"Ready to analyze this property? Our AI will evaluate development potential, market trends, and financial projections."}),e.jsx("button",{onClick:S,disabled:v,className:"w-full bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors font-medium flex items-center justify-center space-x-2",children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Analyzing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Run AI Analysis"})]})})]})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(B,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a Property to Analyze"}),e.jsx("p",{className:"text-gray-600",children:"Choose a parcel from the map to run our AI-powered analysis"})]})}),n==="plan"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(W,{className:"w-16 h-16 text-purple-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Plan Your Development"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Design your site layout with our CAD-like tools. Add buildings, parking, and amenities to optimize your development."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 max-w-md mx-auto",children:[e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(ce,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("div",{className:"text-sm font-medium",children:"Add Buildings"})]}),e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(Ae,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("div",{className:"text-sm font-medium",children:"Add Parking"})]})]}),e.jsxs("button",{onClick:()=>i("model"),className:"mt-6 w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Financial Modeling"})]})]})}),n==="model"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Y,{className:"w-16 h-16 text-orange-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Financial Modeling"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Calculate detailed financial projections including ROI, IRR, cash flow, and development costs."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(le,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Run Underwriting"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Calculate detailed financial projections"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(B,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Market Analysis"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Compare with similar properties"})]})]})})]}),e.jsxs("button",{onClick:()=>i("compare"),className:"mt-6 w-full bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Comparison"})]})]})}),n==="compare"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ee,{className:"w-16 h-16 text-indigo-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Compare Scenarios"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Create multiple development scenarios and compare their financial performance, design efficiency, and market potential."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ne,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Create New Scenario"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Design an alternative development plan"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(B,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Compare Results"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Side-by-side financial comparison"})]})]})})]})]})})]}),e.jsx("div",{className:"p-4 lg:p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:y?e.jsxs("span",{children:["Project: ",e.jsx("strong",{children:j})," (",b.length," parcels)"]}):e.jsx("span",{children:"No active project"})}),e.jsxs("div",{className:"flex space-x-3",children:[!y&&e.jsx("button",{onClick:C,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium",children:"Create Project"}),e.jsxs("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),e.jsx("span",{children:"Save Work"})]}),e.jsxs("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{children:"Generate Report"})]})]})]})})]})}):null}function va({isOpen:a,onClose:s,selectedParcel:t,onParcelSelect:r}){const[n,i]=o.useState("discover"),[x,l]=o.useState([]),[m,h]=o.useState(""),[d,c]=o.useState(!1),[u,g]=o.useState(null),[v,w]=o.useState(!1),{activeProjectId:y,activeProjectName:j,parcelIds:b,addParcel:N}=ie();o.useEffect(()=>{t&&n==="discover"&&i("analyze")},[t,n]);const p=async S=>{if(!y)c(!0),setTimeout(()=>{c(!1),l(C=>[...C,S]),i("analyze")},1e3);else try{await N(S.ogc_fid||S.id),l(C=>[...C,S]),i("analyze")}catch(C){console.error("Failed to add parcel to project:",C)}},_=async()=>{w(!0),setTimeout(()=>{g({hbu:"Mixed-Use Residential",confidence:85,roi:18.5,units:24,gsf:45e3,estimatedValue:125e5,developmentCost:85e5}),w(!1),i("plan")},2e3)};return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end lg:items-center justify-center p-0 lg:p-4",children:e.jsxs("div",{className:"bg-white w-full lg:max-w-4xl lg:max-h-[90vh] lg:rounded-2xl shadow-2xl flex flex-col h-full lg:h-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 lg:p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100",children:e.jsx(W,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg lg:text-xl font-semibold text-gray-900",children:"Project Workflow"}),e.jsx("p",{className:"text-sm text-gray-600",children:y?`Active: ${j}`:"Create a new development project"})]})]}),e.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-4 lg:px-6 py-4 bg-gray-50 border-b border-gray-200",children:e.jsx("div",{className:"flex items-center justify-between",children:[{id:"discover",label:"Discover",icon:e.jsx(Q,{className:"w-4 h-4"}),color:"blue"},{id:"analyze",label:"Analyze",icon:e.jsx(B,{className:"w-4 h-4"}),color:"green"},{id:"plan",label:"Plan",icon:e.jsx(W,{className:"w-4 h-4"}),color:"purple"},{id:"model",label:"Model",icon:e.jsx(Y,{className:"w-4 h-4"}),color:"orange"},{id:"compare",label:"Compare",icon:e.jsx(ee,{className:"w-4 h-4"}),color:"indigo"}].map((S,C)=>{const A=n===S.id,k=["discover","analyze","plan","model","compare"].indexOf(n)>C;return e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:`flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium ${A?`bg-${S.color}-100 text-${S.color}-700`:k?"bg-green-100 text-green-700":"text-gray-500"}`,children:[k?e.jsx(Z,{className:"w-4 h-4"}):S.icon,e.jsx("span",{className:"hidden sm:inline",children:S.label})]}),C<4&&e.jsx("div",{className:"w-8 h-px bg-gray-300 mx-2"})]},S.id)})})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[n==="discover"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"w-16 h-16 text-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Discover Development Opportunities"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Click any parcel on the map to explore its development potential. Our AI will analyze zoning, market trends, and financial projections."}),t?e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:t.address}),e.jsxs("p",{className:"text-sm text-blue-700",children:[t.zoning," • ",t.sqft?.toLocaleString()," sqft"]})]})]}),e.jsx("button",{onClick:()=>p(t),disabled:d,className:"w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors font-medium flex items-center justify-center space-x-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Creating Project..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"Add to Project"})]})})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Click a parcel on the map to get started"})]})}),n==="analyze"&&e.jsx("div",{className:"p-4 lg:p-6",children:t?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900",children:t.address}),e.jsxs("p",{className:"text-sm text-green-700",children:[t.zoning," • ",t.sqft?.toLocaleString()," sqft"]})]})]}),u?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[u.roi,"%"]}),e.jsx("div",{className:"text-xs text-green-700",children:"Projected ROI"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:u.units}),e.jsx("div",{className:"text-xs text-green-700",children:"Units"})]})]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Recommended Use:"})," ",u.hbu]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Confidence:"})," ",u.confidence,"%"]}),e.jsxs("button",{onClick:()=>i("plan"),className:"w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Planning"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-green-700",children:"Ready to analyze this property? Our AI will evaluate development potential, market trends, and financial projections."}),e.jsx("button",{onClick:_,disabled:v,className:"w-full bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors font-medium flex items-center justify-center space-x-2",children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Analyzing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Run AI Analysis"})]})})]})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(B,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a Property to Analyze"}),e.jsx("p",{className:"text-gray-600",children:"Choose a parcel from the map to run our AI-powered analysis"})]})}),n==="plan"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(W,{className:"w-16 h-16 text-purple-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Plan Your Development"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Design your site layout with our CAD-like tools. Add buildings, parking, and amenities to optimize your development."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 max-w-md mx-auto",children:[e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(ce,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("div",{className:"text-sm font-medium",children:"Add Buildings"})]}),e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(Ae,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("div",{className:"text-sm font-medium",children:"Add Parking"})]})]}),e.jsxs("button",{onClick:()=>i("model"),className:"mt-6 w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Financial Modeling"})]})]})}),n==="model"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Y,{className:"w-16 h-16 text-orange-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Financial Modeling"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Calculate detailed financial projections including ROI, IRR, cash flow, and development costs."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(le,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Run Underwriting"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Calculate detailed financial projections"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(B,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Market Analysis"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Compare with similar properties"})]})]})})]}),e.jsxs("button",{onClick:()=>i("compare"),className:"mt-6 w-full bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Comparison"})]})]})}),n==="compare"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ee,{className:"w-16 h-16 text-indigo-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Compare Scenarios"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Create multiple development scenarios and compare their financial performance, design efficiency, and market potential."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ne,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Create New Scenario"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Design an alternative development plan"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(B,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Compare Results"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Side-by-side financial comparison"})]})]})})]})]})})]}),e.jsx("div",{className:"p-4 lg:p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:y?e.jsxs("span",{children:["Project: ",e.jsx("strong",{children:j})," (",b.length," parcels)"]}):e.jsx("span",{children:"No active project"})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),e.jsx("span",{children:"Save Work"})]}),e.jsxs("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{children:"Generate Report"})]})]})]})})]})}):null}function Na({isOpen:a,onClose:s,selectedParcel:t,onParcelSelect:r}){const[n,i]=o.useState("discover"),[x,l]=o.useState([]),[m,h]=o.useState(""),[d,c]=o.useState(!1),[u,g]=o.useState(null),[v,w]=o.useState(!1),[y,j]=o.useState(!0),{activeProjectId:b,activeProjectName:N,parcelIds:p,addParcel:_,set:S}=ie(),{setDrawer:C}=K();o.useEffect(()=>{t&&n==="discover"&&(i("analyze"),j(!1))},[t,n]);const A={discover:{title:"Discover Properties",description:"Click parcels on the map to explore development opportunities",icon:e.jsx(Q,{className:"w-6 h-6"}),color:"blue",status:"active"},analyze:{title:"Analyze Potential",description:"Get AI-powered insights on development potential",icon:e.jsx(B,{className:"w-6 h-6"}),color:"green",status:t?"active":"pending"},plan:{title:"Plan Development",description:"Design your site layout and building configuration",icon:e.jsx(W,{className:"w-6 h-6"}),color:"purple",status:"pending"},model:{title:"Financial Model",description:"Calculate ROI, cash flow, and development costs",icon:e.jsx(Y,{className:"w-6 h-6"}),color:"orange",status:"pending"},compare:{title:"Compare Options",description:"Evaluate multiple development scenarios",icon:e.jsx(ee,{className:"w-6 h-6"}),color:"indigo",status:"pending"}},k=async f=>{if(b)try{await _(String(f.ogc_fid||f.id),f),l(R=>[...R,f]),i("analyze"),j(!1)}catch(R){console.error("Failed to add parcel to project:",R)}else{c(!0);const R=`Project - ${f.address||"New Development"}`,E=`project_${Date.now()}`;S(E,R),await _(String(f.ogc_fid||f.id),f),c(!1),l(O=>[...O,f]),i("analyze"),j(!1)}},M=async()=>{w(!0),setTimeout(()=>{g({hbu:"Mixed-Use Residential",confidence:85,roi:18.5,units:24,gsf:45e3,estimatedValue:125e5,developmentCost:85e5}),w(!1),i("plan")},2e3)};return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end lg:items-center justify-center p-0 lg:p-4",children:e.jsxs("div",{className:"bg-white w-full lg:max-w-4xl lg:max-h-[90vh] lg:rounded-2xl shadow-2xl flex flex-col h-full lg:h-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 lg:p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100",children:e.jsx(W,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg lg:text-xl font-semibold text-gray-900",children:"Project Workflow"}),e.jsx("p",{className:"text-sm text-gray-600",children:b?`Active: ${N}`:"Create a new development project"})]})]}),e.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-4 lg:px-6 py-4 bg-gray-50 border-b border-gray-200",children:e.jsx("div",{className:"flex items-center justify-between",children:Object.entries(A).map(([f,R],E)=>{const O=n===f,I=Object.keys(A).indexOf(n)>E;return e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:`flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium ${O?`bg-${R.color}-100 text-${R.color}-700`:I?"bg-green-100 text-green-700":"text-gray-500"}`,children:[I?e.jsx(Z,{className:"w-4 h-4"}):R.icon,e.jsx("span",{className:"hidden sm:inline",children:R.title})]}),E<Object.keys(A).length-1&&e.jsx("div",{className:"w-8 h-px bg-gray-300 mx-2"})]},f)})})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[n==="discover"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"w-16 h-16 text-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Discover Development Opportunities"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Click any parcel on the map to explore its development potential. Our AI will analyze zoning, market trends, and financial projections."}),y&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(Ie,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:"Map Interaction"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Click any parcel on the map behind this modal to get started"})]})]}),e.jsx("div",{className:"text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded",children:"💡 The map is interactive even with this modal open"})]}),t?e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h4",{className:"font-medium text-green-900",children:t.address}),e.jsxs("p",{className:"text-sm text-green-700",children:[t.zoning," • ",t.sqft?.toLocaleString()," sqft"]})]})]}),e.jsx("button",{onClick:()=>k(t),disabled:d,className:"w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors font-medium flex items-center justify-center space-x-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Creating Project..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"Add to Project"})]})})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Click a parcel on the map to get started"})]})}),n==="analyze"&&e.jsx("div",{className:"p-4 lg:p-6",children:t?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900",children:t.address}),e.jsxs("p",{className:"text-sm text-green-700",children:[t.zoning," • ",t.sqft?.toLocaleString()," sqft"]})]})]}),u?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[u.roi,"%"]}),e.jsx("div",{className:"text-xs text-green-700",children:"Projected ROI"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:u.units}),e.jsx("div",{className:"text-xs text-green-700",children:"Units"})]})]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Recommended Use:"})," ",u.hbu]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Confidence:"})," ",u.confidence,"%"]}),e.jsxs("button",{onClick:()=>i("plan"),className:"w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Planning"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-green-700",children:"Ready to analyze this property? Our AI will evaluate development potential, market trends, and financial projections."}),e.jsx("button",{onClick:M,disabled:v,className:"w-full bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors font-medium flex items-center justify-center space-x-2",children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Analyzing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Run AI Analysis"})]})})]})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(B,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a Property to Analyze"}),e.jsx("p",{className:"text-gray-600",children:"Choose a parcel from the map to run our AI-powered analysis"})]})}),n==="plan"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(W,{className:"w-16 h-16 text-purple-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Plan Your Development"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Design your site layout with our CAD-like tools. Add buildings, parking, and amenities to optimize your development."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 max-w-md mx-auto",children:[e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(ce,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("div",{className:"text-sm font-medium",children:"Add Buildings"})]}),e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(Ae,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("div",{className:"text-sm font-medium",children:"Add Parking"})]})]}),e.jsxs("button",{onClick:()=>i("model"),className:"mt-6 w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Financial Modeling"})]})]})}),n==="model"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Y,{className:"w-16 h-16 text-orange-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Financial Modeling"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Calculate detailed financial projections including ROI, IRR, cash flow, and development costs."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(le,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Run Underwriting"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Calculate detailed financial projections"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(B,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Market Analysis"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Compare with similar properties"})]})]})})]}),e.jsxs("button",{onClick:()=>i("compare"),className:"mt-6 w-full bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Comparison"})]})]})}),n==="compare"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ee,{className:"w-16 h-16 text-indigo-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Compare Scenarios"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Create multiple development scenarios and compare their financial performance, design efficiency, and market potential."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ne,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Create New Scenario"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Design an alternative development plan"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(B,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Compare Results"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Side-by-side financial comparison"})]})]})})]})]})})]}),e.jsx("div",{className:"p-4 lg:p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:b?e.jsxs("span",{children:["Project: ",e.jsx("strong",{children:N})," (",p.length," parcels)"]}):e.jsx("span",{children:"No active project"})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),e.jsx("span",{children:"Save Work"})]}),e.jsxs("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{children:"Generate Report"})]})]})]})})]})}):null}const wa=He()(Pt((a,s)=>({activeSitePlan:null,savedSitePlans:[],isEditing:!1,hasUnsavedChanges:!1,selectedParcel:null,setSelectedParcel:t=>{a({selectedParcel:t})},createSitePlan:(t,r,n)=>{const i=new Date().toISOString(),x={id:`siteplan_${Date.now()}`,name:n?.name||"New Site Plan",description:n?.description||"Site plan design",parcelId:t,projectId:r,elements:n?.elements||[],metadata:{created:i,modified:i,version:1,aiGenerated:!!n,hbuAnalysisId:n?.hbuAnalysisId},compliance:{zoningCompliant:!0,violations:[],warnings:[],score:85},financial:{estimatedValue:n?.financial?.estimatedValue||0,developmentCost:n?.financial?.developmentCost||0,irr:n?.financial?.irr||0,roi:n?.financial?.roi||0,totalUnits:n?.financial?.totalUnits||0,totalGSF:n?.financial?.totalGSF||0,parkingSpaces:n?.financial?.parkingSpaces||0}};return a({activeSitePlan:x,isEditing:!0}),x},updateSitePlan:(t,r)=>{const{activeSitePlan:n,savedSitePlans:i}=s();if(n?.id===t){const l={...n,...r,metadata:{...n.metadata,modified:new Date().toISOString()}};a({activeSitePlan:l,hasUnsavedChanges:!0})}const x=i.map(l=>l.id===t?{...l,...r,metadata:{...l.metadata,modified:new Date().toISOString()}}:l);a({savedSitePlans:x})},saveSitePlan:t=>{const{savedSitePlans:r}=s(),n=r.findIndex(x=>x.id===t.id),i={...t,metadata:{...t.metadata,modified:new Date().toISOString()}};if(n>=0){const x=[...r];x[n]=i,a({savedSitePlans:x,hasUnsavedChanges:!1})}else a({savedSitePlans:[...r,i],hasUnsavedChanges:!1})},loadSitePlan:t=>{const{savedSitePlans:r}=s(),n=r.find(i=>i.id===t);return n&&a({activeSitePlan:n,isEditing:!0}),n||null},deleteSitePlan:t=>{const{savedSitePlans:r,activeSitePlan:n}=s(),i=r.filter(x=>x.id!==t);a({savedSitePlans:i}),n?.id===t&&a({activeSitePlan:null,isEditing:!1})},setActiveSitePlan:t=>{a({activeSitePlan:t,isEditing:!!t})},addElement:t=>{const{activeSitePlan:r}=s();if(!r)return;const n={...r,elements:[...r.elements,t],metadata:{...r.metadata,modified:new Date().toISOString()}};a({activeSitePlan:n,hasUnsavedChanges:!0})},updateElement:(t,r)=>{const{activeSitePlan:n}=s();if(!n)return;const i=n.elements.map(l=>l.id===t?{...l,...r}:l),x={...n,elements:i,metadata:{...n.metadata,modified:new Date().toISOString()}};a({activeSitePlan:x,hasUnsavedChanges:!0})},removeElement:t=>{const{activeSitePlan:r}=s();if(!r)return;const n=r.elements.filter(x=>x.id!==t),i={...r,elements:n,metadata:{...r.metadata,modified:new Date().toISOString()}};a({activeSitePlan:i,hasUnsavedChanges:!0})},markAsUnsaved:()=>{a({hasUnsavedChanges:!0})},markAsSaved:()=>{a({hasUnsavedChanges:!1})},generateFromAI:(t,r)=>{const n=new Date().toISOString(),i=t.alternatives?.[0];if(!i)throw new Error("No HBU analysis data available");const x=[{id:`building_${Date.now()}`,type:"building",name:"Main Building",vertices:[{x:50,y:50,id:"v1"},{x:150,y:50,id:"v2"},{x:150,y:100,id:"v3"},{x:50,y:100,id:"v4"}],properties:{area:i.density*(r.sqft||4356),units:Math.floor(i.density*(r.sqft||4356)/43560),height:i.height*10,stories:i.height,use:i.use},metadata:{created:n,modified:n,source:"ai-generated"}},{id:`parking_${Date.now()}`,type:"parking",name:"Parking Area",vertices:[{x:20,y:20,id:"v1"},{x:80,y:20,id:"v2"},{x:80,y:40,id:"v3"},{x:20,y:40,id:"v4"}],properties:{parkingSpaces:Math.ceil(Math.floor(i.density*(r.sqft||4356)/43560)*1.5)},metadata:{created:n,modified:n,source:"ai-generated"}}],l={id:`siteplan_${Date.now()}`,name:`${i.use} Development Plan`,description:`AI-generated site plan based on ${i.use} analysis`,parcelId:r.ogc_fid||r.id,projectId:void 0,elements:x,metadata:{created:n,modified:n,version:1,aiGenerated:!0,hbuAnalysisId:t.id},compliance:{zoningCompliant:!0,violations:[],warnings:[],score:85},financial:{estimatedValue:i.estimatedValue,developmentCost:i.developmentCost,irr:i.internalRateOfReturn,roi:i.internalRateOfReturn*.8,totalUnits:Math.floor(i.density*(r.sqft||4356)/43560),totalGSF:i.density*(r.sqft||4356),parkingSpaces:Math.ceil(Math.floor(i.density*(r.sqft||4356)/43560)*1.5)}};return a({activeSitePlan:l,isEditing:!0}),l},exportSitePlan:t=>{const{savedSitePlans:r}=s();return r.find(i=>i.id===t)||null},importSitePlan:t=>{const r={id:`siteplan_${Date.now()}`,name:t.name||"Imported Site Plan",description:t.description||"Imported site plan",parcelId:t.parcelId||"",projectId:t.projectId,elements:t.elements||[],metadata:{created:new Date().toISOString(),modified:new Date().toISOString(),version:1,aiGenerated:!1},compliance:t.compliance||{zoningCompliant:!0,violations:[],warnings:[],score:85},financial:t.financial||{estimatedValue:0,developmentCost:0,irr:0,roi:0,totalUnits:0,totalGSF:0,parkingSpaces:0}};return a({activeSitePlan:r,isEditing:!0}),r},generateAISitePlan:async(t,r)=>{const n=new Date().toISOString(),i={id:`ai_siteplan_${Date.now()}`,name:`${t.address} - AI Optimized Site Plan`,description:`AI-generated site plan based on ${r.recommendedUse} analysis`,parcelId:t.ogc_fid.toString(),elements:[],metadata:{created:n,modified:n,version:1,aiGenerated:!0,hbuAnalysisId:`analysis_${Date.now()}`},compliance:{zoningCompliant:!0,violations:[],warnings:[],score:r.confidence||85},financial:{estimatedValue:r.alternatives?.[0]?.estimatedValue||0,developmentCost:r.alternatives?.[0]?.developmentCost||0,irr:r.alternatives?.[0]?.internalRateOfReturn||0,roi:r.alternatives?.[0]?.netPresentValue||0,totalUnits:0,totalGSF:0,parkingSpaces:0}};return a({activeSitePlan:i,isEditing:!0}),i},enhanceSitePlan:t=>{const r={...t,metadata:{...t.metadata,modified:new Date().toISOString(),version:t.metadata.version+1}};return a({activeSitePlan:r,isEditing:!0}),r},validateSitePlan:t=>{const r=[],n=[];let i=100;(!t.elements||t.elements.length===0)&&(r.push("Site plan must have at least one element"),i-=50);const x=_a(t.elements);return x.length>0&&(n.push(`Found ${x.length} overlapping elements`),i-=10),t.compliance.zoningCompliant||(r.push("Site plan is not zoning compliant"),i-=30),t.financial.irr<.1&&(n.push("Low IRR - consider optimizing design"),i-=5),{isValid:r.length===0,errors:r,warnings:n,score:Math.max(0,i)}},optimizeSitePlan:t=>{const r={...t,elements:t.elements.map(n=>({...n,properties:{...n.properties,optimized:!0}})),metadata:{...t.metadata,modified:new Date().toISOString(),version:t.metadata.version+1}};return a({activeSitePlan:r,isEditing:!0}),r},getSitePlanMetrics:t=>{const r=t.elements,n=r.reduce((m,h)=>m+(h.properties.area||0),0),i=r.filter(m=>m.type==="building").reduce((m,h)=>m+(h.properties.area||0),0),x=r.filter(m=>m.type==="parking").reduce((m,h)=>m+(h.properties.area||0),0),l=r.filter(m=>m.type==="landscaping").reduce((m,h)=>m+(h.properties.area||0),0);return{totalArea:n,buildingArea:i,parkingArea:x,landscapingArea:l,buildingCoverage:n>0?i/n*100:0,parkingRatio:i>0?x/i*100:0,unitDensity:t.financial.totalUnits/(n/43560),efficiency:Ca(t)}}}),{name:"site-plan-storage",partialize:a=>({savedSitePlans:a.savedSitePlans,activeSitePlan:a.activeSitePlan})}));function _a(a){const s=[];for(let t=0;t<a.length;t++)for(let r=t+1;r<a.length;r++)Sa(a[t],a[r])&&s.push(`${a[t].id} overlaps with ${a[r].id}`);return s}function Sa(a,s){const t=us(a),r=us(s);return!(t.maxX<r.minX||t.minX>r.maxX||t.maxY<r.minY||t.minY>r.maxY)}function us(a){if(a.vertices.length===0)return{minX:0,minY:0,maxX:0,maxY:0};const s=a.vertices.map(r=>r.x),t=a.vertices.map(r=>r.y);return{minX:Math.min(...s),minY:Math.min(...t),maxX:Math.max(...s),maxY:Math.max(...t)}}function Ca(a){const s=a.elements,t=s.reduce((x,l)=>x+(l.properties.area||0),0),r=s.filter(x=>x.type==="building").reduce((x,l)=>x+(l.properties.area||0),0);if(t===0)return 0;const n=r/t*100,i=Math.min(100,a.financial.irr*1e3);return(n+i)/2}function ka(){const{activeSitePlan:a,isEditing:s,hasUnsavedChanges:t,createSitePlan:r,updateSitePlan:n,saveSitePlan:i,loadSitePlan:x,generateAISitePlan:l,enhanceSitePlan:m,validateSitePlan:h,optimizeSitePlan:d,getSitePlanMetrics:c,addElement:u,updateElement:g,removeElement:v}=wa(),{analysis:w,loading:y,analyzeParcel:j}=Qe(),[b,N]=o.useState(!1),[p,_]=o.useState(!1),[S,C]=o.useState(!1),[A,k]=o.useState(!1),[M,f]=o.useState(!1),R=o.useMemo(()=>a?h(a):null,[a,h]),E=o.useMemo(()=>a?c(a):null,[a,c]),O=o.useCallback(async(H,Ne)=>{N(!0);try{const we=Ne||await j(H);if(!we)throw new Error("Failed to generate HBU analysis");return await l(H,we)}catch(we){throw console.error("AI site plan generation failed:",we),we}finally{N(!1)}},[j,l]),I=o.useCallback((H,Ne)=>r(H,Ne),[r]),P=o.useCallback(H=>{a&&n(a.id,H)},[a,n]),F=o.useCallback(H=>{i(H)},[i]),z=o.useCallback(H=>x(H),[x]),T=o.useCallback(async()=>{if(!a)return null;_(!0);try{return d(a)}catch(H){throw console.error("Site plan optimization failed:",H),H}finally{_(!1)}},[a,d]),se=o.useCallback(()=>a?h(a):{isValid:!1,errors:["No active site plan"],warnings:[],score:0},[a,h]),L=o.useCallback(()=>a?c(a):{totalArea:0,buildingArea:0,parkingArea:0,landscapingArea:0,buildingCoverage:0,parkingRatio:0,unitDensity:0,efficiency:0},[a,c]),X=o.useCallback(()=>{C(H=>!H)},[]),J=o.useCallback(()=>{k(H=>!H)},[]),$=o.useCallback(()=>{f(H=>!H)},[]),te=o.useCallback(H=>{u(H)},[u]),U=o.useCallback((H,Ne)=>{g(H,Ne)},[g]),ae=o.useCallback(H=>{v(H)},[v]);return{...{activeSitePlan:a,isGenerating:b,isOptimizing:p,validation:R,metrics:E,showAIGenerator:S,showOptimizer:A,showValidator:M},...{generateAISitePlan:O,createSitePlan:I,updateSitePlan:P,saveSitePlan:F,loadSitePlan:z,optimizeSitePlan:T,validateSitePlan:se,calculateMetrics:L,toggleAIGenerator:X,toggleOptimizer:J,toggleValidator:$,addElement:te,updateElement:U,removeElement:ae},isEditing:s,hasUnsavedChanges:t,hbuAnalysis:w,hbuLoading:y}}function Ds({isOpen:a,onClose:s,selectedParcel:t,mode:r="design",hbuAnalysis:n,onAnalysisComplete:i,onSitePlanGenerated:x,onSitePlanSaved:l,onContinueToUnderwriting:m,showAIGenerator:h=!1,showOptimizer:d=!1,showValidator:c=!1}){const{activeSitePlan:u,isOptimizing:g,validation:v,metrics:w,generateAISitePlan:y,optimizeSitePlan:j,toggleAIGenerator:b,toggleOptimizer:N,toggleValidator:p}=ka(),[_,S]=o.useState("analyze"),[C,A]=o.useState(!1),[k,M]=o.useState(!1),[f,R]=o.useState(null);o.useEffect(()=>{r==="ai-generation"&&t&&n&&!f&&E()},[r,t,n,f]);const E=o.useCallback(async()=>{if(!(!t||!n)){M(!0),S("generate");try{const L=await y(t,n);R(L),S("optimize"),x&&x(L)}catch(L){console.error("AI site plan generation failed:",L)}finally{M(!1)}}},[t,n,y,x]),O=o.useCallback(async()=>{if(u){S("optimize");try{const L=await j();S("finalize"),l&&l(L)}catch(L){console.error("Site plan optimization failed:",L)}}},[u,j,l]),I=o.useCallback(()=>{S("finalize"),m&&u&&m(u)},[m,u]),P=()=>{switch(r){case"ai-generation":return F();case"enhanced":return z();case"optimization":return T();default:return se()}},F=()=>e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(oe,{className:"w-16 h-16 text-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"AI-Driven Site Plan Generator"}),e.jsx("p",{className:"text-gray-600",children:t?`${t.address}`:"Generate site plan from HBU analysis"})]}),e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("div",{className:"flex items-center space-x-4",children:[{key:"analyze",label:"Analyze",icon:ee},{key:"generate",label:"Generate",icon:oe},{key:"optimize",label:"Optimize",icon:ge},{key:"finalize",label:"Finalize",icon:Z}].map((L,X)=>{const J=L.icon,$=_===L.key,te=["analyze","generate","optimize","finalize"].indexOf(_)>X;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full border-2 ${$?"bg-blue-600 border-blue-600 text-white":te?"bg-green-600 border-green-600 text-white":"bg-gray-100 border-gray-300 text-gray-500"}`,children:e.jsx(J,{className:"w-5 h-5"})}),e.jsx("span",{className:`ml-2 text-sm font-medium ${$?"text-blue-600":te?"text-green-600":"text-gray-500"}`,children:L.label}),X<3&&e.jsx("div",{className:`w-8 h-0.5 mx-4 ${te?"bg-green-600":"bg-gray-300"}`})]},L.key)})})}),_==="analyze"&&e.jsxs("div",{className:"text-center",children:[e.jsx(Cs,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Analyzing Property"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"AI is analyzing zoning constraints, market factors, and development potential..."}),n&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-blue-600",children:[n.confidence||0,"%"]}),e.jsx("div",{className:"text-sm text-blue-700",children:"Confidence"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 capitalize",children:n.recommendedUse||"Mixed-Use"}),e.jsx("div",{className:"text-sm text-blue-700",children:"Recommended Use"})]})]}),e.jsx("button",{onClick:E,disabled:k,className:"w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:k?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Generating Site Plan..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Generate AI Site Plan"})]})})]})]}),_==="generate"&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Generating Site Plan"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"AI is creating an optimized site plan based on your HBU analysis..."}),e.jsx("div",{className:"space-y-3 max-w-md mx-auto",children:["Analyzed zoning constraints","Calculated optimal building massing","Generated parking layout","Optimized site circulation"].map((L,X)=>e.jsxs("div",{className:"flex items-center space-x-3 text-left",children:[e.jsx(Z,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:L})]},X))})]}),_==="optimize"&&e.jsxs("div",{className:"text-center",children:[e.jsx(ge,{className:"w-16 h-16 text-purple-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Optimizing Design"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Fine-tuning the site plan for maximum efficiency and compliance..."}),e.jsx("button",{onClick:O,disabled:g,className:"px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2 mx-auto",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Optimizing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{children:"Optimize Site Plan"})]})})]}),_==="finalize"&&e.jsxs("div",{className:"text-center",children:[e.jsx(Z,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Site Plan Complete"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Your AI-optimized site plan is ready for review and implementation."}),e.jsx("div",{className:"space-x-4",children:e.jsxs("button",{onClick:I,className:"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center justify-center space-x-2",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Underwriting"})]})})]})]}),z=()=>e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(W,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Enhanced Site Planner"}),e.jsx("p",{className:"text-gray-600",children:"Advanced site planning with AI assistance and optimization tools."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx(oe,{className:"w-8 h-8 text-blue-600 mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"AI Generation"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Generate site plans using AI analysis and HBU recommendations."}),e.jsxs("button",{onClick:b,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:[h?"Hide":"Show"," AI Generator"]})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-6",children:[e.jsx(ge,{className:"w-8 h-8 text-purple-600 mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Optimization"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Optimize your site plan for maximum efficiency and compliance."}),e.jsxs("button",{onClick:N,className:"w-full px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700",children:[d?"Hide":"Show"," Optimizer"]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:[e.jsx(Z,{className:"w-8 h-8 text-green-600 mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Validation"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Validate your site plan for compliance and best practices."}),e.jsxs("button",{onClick:p,className:"w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:[c?"Hide":"Show"," Validator"]})]})]}),w&&e.jsxs("div",{className:"mt-8 bg-gray-50 border border-gray-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Site Plan Metrics"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[w.buildingCoverage.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Building Coverage"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[w.parkingRatio.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Parking Ratio"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:w.unitDensity.toFixed(1)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Units/Acre"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[w.efficiency.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Efficiency"})]})]})]})]}),T=()=>e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(ge,{className:"w-16 h-16 text-purple-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Site Plan Optimization"}),e.jsx("p",{className:"text-gray-600",children:"Optimize your site plan for maximum efficiency and compliance."})]}),v&&e.jsxs("div",{className:"mb-6 bg-gray-50 border border-gray-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Validation Results"}),e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${v.isValid?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{className:`font-medium ${v.isValid?"text-green-700":"text-red-700"}`,children:[v.isValid?"Valid":"Invalid"," (Score: ",v.score,"/100)"]})]}),v.errors.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-red-700 mb-2",children:"Errors:"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-red-600",children:v.errors.map((L,X)=>e.jsx("li",{children:L},X))})]}),v.warnings.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-yellow-700 mb-2",children:"Warnings:"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-yellow-600",children:v.warnings.map((L,X)=>e.jsx("li",{children:L},X))})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:O,disabled:g,className:"px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2 mx-auto",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Optimizing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{children:"Optimize Site Plan"})]})})})]}),se=()=>e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(ce,{className:"w-16 h-16 text-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Site Plan Designer"}),e.jsx("p",{className:"text-gray-600",children:"Design and customize your site plan with professional tools."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx(ce,{className:"w-8 h-8 text-blue-600 mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Buildings"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Add and configure building elements for your site plan."}),e.jsx("button",{className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Add Building"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:[e.jsx(Ae,{className:"w-8 h-8 text-green-600 mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Parking"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Design parking layouts and calculate requirements."}),e.jsx("button",{className:"w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Add Parking"})]})]})]});return a?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(W,{className:"w-6 h-6 text-blue-600"}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Consolidated Site Planner"}),e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full",children:r})]}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-md transition-colors",children:e.jsx(G,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-80px)]",children:P()})]})}):null}function Us({isOpen:a,onClose:s,selectedParcel:t,hbuAnalysis:r,onAnalysisComplete:n,onSitePlanGenerated:i}){return e.jsx(Ds,{isOpen:a,onClose:s,selectedParcel:t,mode:"ai-generation",hbuAnalysis:r,onAnalysisComplete:n,onSitePlanGenerated:i})}function Pa({isOpen:a,onClose:s,selectedParcel:t,hbuAnalysis:r,onSitePlanSaved:n,onContinueToUnderwriting:i}){return e.jsx(Ds,{isOpen:a,onClose:s,selectedParcel:t,mode:"enhanced",hbuAnalysis:r,onSitePlanSaved:n,onContinueToUnderwriting:i})}function Ra({isOpen:a,onClose:s,selectedParcel:t,onParcelSelect:r}){const[n,i]=o.useState("discover"),[x,l]=o.useState([]),[m,h]=o.useState(""),[d,c]=o.useState(!1),[u,g]=o.useState(null),[v,w]=o.useState(!1),[y,j]=o.useState(!1),[b,N]=o.useState(!1),{activeProjectId:p,activeProjectName:_,parcelIds:S,addParcel:C,set:A}=ie(),{setDrawer:k}=K();o.useEffect(()=>{t&&n==="discover"&&i("analyze")},[t,n]);const M={discover:{title:"Discover Properties",description:"Click parcels on the map to explore development opportunities",icon:e.jsx(Q,{className:"w-6 h-6"}),color:"blue",status:"active"},analyze:{title:"Analyze Potential",description:"Get AI-powered insights on development potential",icon:e.jsx(B,{className:"w-6 h-6"}),color:"green",status:t?"active":"pending"},plan:{title:"Plan Development",description:"Design your site layout and building configuration",icon:e.jsx(W,{className:"w-6 h-6"}),color:"purple",status:"pending"},model:{title:"Financial Model",description:"Calculate ROI, cash flow, and development costs",icon:e.jsx(Y,{className:"w-6 h-6"}),color:"orange",status:"pending"},compare:{title:"Compare Options",description:"Evaluate multiple development scenarios",icon:e.jsx(ee,{className:"w-6 h-6"}),color:"indigo",status:"pending"}},f=async O=>{if(p)try{await C(String(O.ogc_fid||O.id),O),l(I=>[...I,O]),i("analyze")}catch(I){console.error("Failed to add parcel to project:",I)}else{c(!0);const I=`Project - ${O.address||"New Development"}`,P=`project_${Date.now()}`;A(P,I),await C(String(O.ogc_fid||O.id),O),c(!1),l(F=>[...F,O]),i("analyze")}},R=async()=>{w(!0),setTimeout(()=>{g({hbu:"Mixed-Use Residential",confidence:85,roi:18.5,units:24,gsf:45e3,estimatedValue:125e5,developmentCost:85e5}),w(!1),i("plan")},2e3)},E=()=>{N(!0),i("model")};return a?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end lg:items-center justify-center p-0 lg:p-4",children:[e.jsxs("div",{className:"bg-white w-full lg:max-w-6xl lg:max-h-[90vh] lg:rounded-2xl shadow-2xl flex flex-col h-full lg:h-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 lg:p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100",children:e.jsx(W,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg lg:text-xl font-semibold text-gray-900",children:"Project Workflow"}),e.jsx("p",{className:"text-sm text-gray-600",children:p?`Active: ${_}`:"Create a new development project"})]})]}),e.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-4 lg:px-6 py-4 bg-gray-50 border-b border-gray-200",children:e.jsx("div",{className:"flex items-center justify-between",children:Object.entries(M).map(([O,I],P)=>{const F=n===O,z=Object.keys(M).indexOf(n)>P;return e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:`flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium ${F?`bg-${I.color}-100 text-${I.color}-700`:z?"bg-green-100 text-green-700":"text-gray-500"}`,children:[z?e.jsx(Z,{className:"w-4 h-4"}):I.icon,e.jsx("span",{className:"hidden sm:inline",children:I.title})]}),P<Object.keys(M).length-1&&e.jsx("div",{className:"w-8 h-px bg-gray-300 mx-2"})]},O)})})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[n==="discover"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"w-16 h-16 text-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Discover Development Opportunities"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Click any parcel on the map to explore its development potential. Our AI will analyze zoning, market trends, and financial projections."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(Ie,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:"Map Interaction"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Click any parcel on the map behind this modal to get started"})]})]}),e.jsx("div",{className:"text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded",children:"💡 The map is interactive even with this modal open"})]}),t?e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h4",{className:"font-medium text-green-900",children:t.address}),e.jsxs("p",{className:"text-sm text-green-700",children:[t.zoning," • ",t.sqft?.toLocaleString()," sqft"]})]})]}),e.jsx("button",{onClick:()=>f(t),disabled:d,className:"w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors font-medium flex items-center justify-center space-x-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Creating Project..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"Add to Project"})]})})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Click a parcel on the map to get started"})]})}),n==="analyze"&&e.jsx("div",{className:"p-4 lg:p-6",children:t?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900",children:t.address}),e.jsxs("p",{className:"text-sm text-green-700",children:[t.zoning," • ",t.sqft?.toLocaleString()," sqft"]})]})]}),u?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[u.roi,"%"]}),e.jsx("div",{className:"text-xs text-green-700",children:"Projected ROI"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:u.units}),e.jsx("div",{className:"text-xs text-green-700",children:"Units"})]})]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Recommended Use:"})," ",u.hbu]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Confidence:"})," ",u.confidence,"%"]}),e.jsxs("button",{onClick:()=>i("plan"),className:"w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Planning"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-green-700",children:"Ready to analyze this property? Our AI will evaluate development potential, market trends, and financial projections."}),e.jsx("button",{onClick:R,disabled:v,className:"w-full bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors font-medium flex items-center justify-center space-x-2",children:v?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Analyzing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Run AI Analysis"})]})})]})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(B,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a Property to Analyze"}),e.jsx("p",{className:"text-gray-600",children:"Choose a parcel from the map to run our AI-powered analysis"})]})}),n==="plan"&&e.jsxs("div",{className:"p-4 lg:p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(W,{className:"w-16 h-16 text-purple-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"AI-Optimized Site Plan"}),e.jsx("p",{className:"text-gray-600 mb-4 max-w-2xl mx-auto",children:"Your AI-optimized site plan is ready. Review and customize the design below."})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsx(Us,{isOpen:!0,onClose:()=>i("model"),selectedParcel:t,hbuAnalysis:u,onAnalysisComplete:O=>{console.log("HBU analysis completed:",O),g(O)},onSitePlanGenerated:O=>{console.log("AI site plan generated:",O),i("model")}})})]}),n==="model"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Y,{className:"w-16 h-16 text-orange-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Financial Modeling"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Calculate detailed financial projections including ROI, IRR, cash flow, and development costs."}),e.jsxs("div",{className:"space-y-4 max-w-md mx-auto",children:[e.jsx("button",{onClick:E,className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(le,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Open Financial Model"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Detailed underwriting and projections"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(B,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Market Analysis"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Compare with similar properties"})]})]})})]}),e.jsxs("button",{onClick:()=>i("compare"),className:"mt-6 w-full bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Comparison"})]})]})}),n==="compare"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ee,{className:"w-16 h-16 text-indigo-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Compare Scenarios"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Create multiple development scenarios and compare their financial performance, design efficiency, and market potential."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ne,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Create New Scenario"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Design an alternative development plan"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(B,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Compare Results"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Side-by-side financial comparison"})]})]})})]})]})})]}),e.jsx("div",{className:"p-4 lg:p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:p?e.jsxs("span",{children:["Project: ",e.jsx("strong",{children:_})," (",S.length," parcels)"]}):e.jsx("span",{children:"No active project"})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(Fe,{className:"w-4 h-4"}),e.jsx("span",{children:"Save Work"})]}),e.jsxs("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{children:"Generate Report"})]})]})]})})]}),y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-60 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-7xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Site Planner"}),e.jsx("button",{onClick:()=>j(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"h-[80vh]",children:t?e.jsx(Es,{parcel:t,marketData:{avgPricePerSqFt:300,avgRentPerSqFt:2.5,capRate:.06,constructionCostPerSqFt:200},onInvestmentAnalysis:O=>{console.log("Investment analysis:",O)}}):e.jsx("div",{className:"flex items-center justify-center h-full bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(W,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-500 mb-2",children:"No parcel selected"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Please select a parcel from the map to begin site planning"})]})})})]})}),b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-60 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Financial Model"}),e.jsx("button",{onClick:()=>N(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Y,{className:"w-16 h-16 text-orange-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Financial Modeling Tools"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Advanced financial modeling and underwriting tools will be integrated here."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(le,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Run Underwriting"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Calculate detailed financial projections"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(B,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Market Analysis"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Compare with similar properties"})]})]})})]})]})})]})})]}):null}const Aa={hardCostPerSF:180,softCostPercentage:20,contingencyPercentage:10,loanToValue:75,loanToCost:80,interestRate:7.5,loanTermYears:30,salePricePerSF:320,salePricePerUnit:35e4,rentPerSFPerMonth:1.8,rentPerUnitPerMonth:1800,vacancyRate:5,operatingExpenseRatio:35,capRate:5.5,developmentTimelineMonths:18,sellTimelineMonths:6,holdPeriodYears:5,appreciationRate:3,rentGrowthRate:2.5,exitCapRate:6};function Ts(a,s){const[t,r]=o.useState("for-sale"),[n,i]=o.useState({}),x=o.useMemo(()=>({...Aa,...n}),[n]),l=o.useCallback((d,c)=>{i(u=>({...u,[d]:c}))},[]),m=o.useCallback(()=>{i({})},[]),h=o.useMemo(()=>{if(!a||!s)return null;const d=a.totalLandValue,c=s.totalGSF,u=s.units||0,g=c*x.hardCostPerSF,v=g*(x.softCostPercentage/100),w=(g+v)*(x.contingencyPercentage/100),y=d+g+v+w,j=(d+g+v+w)*(x.loanToValue/100),b=y*(x.loanToCost/100),N=Math.min(j,b),p=y-N,_=u>0?u*x.salePricePerUnit:c*x.salePricePerSF,S=_*.08,C=_-S,A=C-y,k=Fa(p,A,x.developmentTimelineMonths+x.sellTimelineMonths,N,x.interestRate),M=A/y*100,f=A/p*100,E=(u>0?u*x.rentPerUnitPerMonth*12:c*x.rentPerSFPerMonth*12)*(1-x.vacancyRate/100),O=E*(x.operatingExpenseRatio/100),I=E-O,P=I*Math.pow(1+x.rentGrowthRate/100,2),F=P/(x.capRate/100),z=Ma(I,N,x.interestRate,x.loanTermYears,x.rentGrowthRate,x.holdPeriodYears),T=Ia(p,z,F,x.exitCapRate,x.holdPeriodYears),L=(z[0]?.cashFlow||0)/p*100,X=F-y,J=za(y,N,x.interestRate,x.operatingExpenseRatio,x.vacancyRate,u||c),$=y/(u||c),te=Ea(x.salePricePerUnit,x.hardCostPerSF,u,c,15);return{landCost:d,hardCosts:g,softCosts:v,contingency:w,totalDevelopmentCost:y,loanAmount:N,equityRequired:p,forSale:{grossRevenue:_,netRevenue:C,profitBeforeFinancing:A,irr:k,roi:M,cashOnCash:f},rental:{yearOneNOI:I,stabilizedNOI:P,propertyValue:F,totalReturn:X,irr:T,cashOnCash:L,cashFlow:z},sensitivityMetrics:{breakEvenRent:J,breakEvenSalePrice:$,maxLandCost:te,minIRR:Math.min(k,T)}}},[a,s,x]);return{strategy:t,setStrategy:r,assumptions:x,updateAssumption:l,resetToDefaults:m,results:h,customOverrides:n}}function Fa(a,s,t,r,n){const i=t/12,x=r*(n/100)*i,l=s-x;if(a<=0)return 0;const m=l/a,h=Math.pow(1+m,1/i)-1;return Math.max(0,h*100)}function Ma(a,s,t,r,n,i){const x=t/100/12,l=r*12,m=s*(x*Math.pow(1+x,l))/(Math.pow(1+x,l)-1),h=[];let d=0;for(let c=1;c<=i;c++){const u=a*Math.pow(1+n/100,c-1),g=m*12,v=u-g;d+=v,h.push({year:c,month:12,grossIncome:u/.95,vacancy:u/.95*.05,effectiveIncome:u+u*.35,operatingExpenses:u*.35,noi:u,debtService:g,cashFlow:v,cumulativeCashFlow:d})}return h}function Ia(a,s,t,r,n){if(a<=0||s.length===0)return 0;const l=s.reduce((h,d)=>h+d.cashFlow,0)+t-a,m=Math.pow(l/a,1/n)-1;return Math.max(0,m*100)}function za(a,s,t,r,n,i){const x=t/100/12,l=30*12;return s*(x*Math.pow(1+x,l))/(Math.pow(1+x,l)-1)*12/(1-r/100)/(1-n/100)/12/i}function Ea(a,s,t,r,n){const i=t*a,x=r*s,l=x*.3,m=i*.08,h=i*(n/100)*1.5,d=i-m-x-l-h;return Math.max(0,d)}function Oa({isOpen:a,onClose:s,selectedParcel:t,onParcelSelect:r}){const[n,i]=o.useState("discover"),[x,l]=o.useState([]),[m,h]=o.useState(""),[d,c]=o.useState(!1),[u,g]=o.useState(!1),[v,w]=o.useState(!1),[y,j]=o.useState(!1),[b,N]=o.useState(!1),[p,_]=o.useState(null),{activeProjectId:S,activeProjectName:C,parcelIds:A,addParcel:k,set:M}=ie(),{setDrawer:f}=K(),{analysis:R,loading:E,analyzeParcel:O}=Qe(),{runUnderwriting:I}=Ts();o.useEffect(()=>{t&&n==="discover"&&i("analyze")},[t,n]);const P={discover:{title:"Discover Properties",description:"Click parcels on the map to evaluate development potential",icon:e.jsx(Q,{className:"w-6 h-6"}),color:"blue",status:"active"},analyze:{title:"Analyze Potential",description:"AI-powered highest and best use analysis",icon:e.jsx(B,{className:"w-6 h-6"}),color:"green",status:t?"active":"pending"},underwrite:{title:"Financial Underwriting",description:"Detailed financial modeling and risk assessment",icon:e.jsx(Y,{className:"w-6 h-6"}),color:"purple",status:"pending"},scenarios:{title:"Compare Scenarios",description:"Evaluate multiple development strategies",icon:e.jsx(ee,{className:"w-6 h-6"}),color:"orange",status:"pending"},decision:{title:"Investment Decision",description:"Final recommendation and next steps",icon:e.jsx(Z,{className:"w-6 h-6"}),color:"indigo",status:"pending"}},F=async U=>{if(S)try{await k(String(U.ogc_fid||U.id),U),l(ae=>[...ae,U]),i("analyze")}catch(ae){console.error("Failed to add parcel to project:",ae)}else{c(!0);const ae=`Project - ${U.address||"New Development"}`,ve=`project_${Date.now()}`;M(ve,ae),await k(String(U.ogc_fid||U.id),U),c(!1),l(_e=>[..._e,U]),i("analyze")}},z=async()=>{if(t)try{await O(t),i("underwrite")}catch(U){console.error("HBU Analysis failed:",U)}},T=async()=>{if(!(!t||!R))try{await I(t,R),i("scenarios")}catch(U){console.error("Underwriting failed:",U)}},se=()=>{j(!0)},L=()=>{N(!0)},X=U=>{_(U),i("scenarios")},J=U=>{_(U),i("scenarios")},$=()=>{w(!0)},te=()=>{i("decision")};return a?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end lg:items-center justify-center p-0 lg:p-4",children:[e.jsxs("div",{className:"bg-white w-full lg:max-w-6xl lg:max-h-[90vh] lg:rounded-2xl shadow-2xl flex flex-col h-full lg:h-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 lg:p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:e.jsx(Y,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg lg:text-xl font-semibold text-gray-900",children:"Real Estate Underwriting Workflow"}),e.jsx("p",{className:"text-sm text-gray-600",children:S?`Active: ${C}`:"Professional development underwriting"})]})]}),e.jsx("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-4 lg:px-6 py-4 bg-gray-50 border-b border-gray-200",children:e.jsx("div",{className:"flex items-center justify-between",children:Object.entries(P).map(([U,ae],ve)=>{const _e=n===U,H=Object.keys(P).indexOf(n)>ve;return e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:`flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium ${_e?`bg-${ae.color}-100 text-${ae.color}-700`:H?"bg-green-100 text-green-700":"text-gray-500"}`,children:[H?e.jsx(Z,{className:"w-4 h-4"}):ae.icon,e.jsx("span",{className:"hidden sm:inline",children:ae.title})]}),ve<Object.keys(P).length-1&&e.jsx("div",{className:"w-8 h-px bg-gray-300 mx-2"})]},U)})})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[n==="discover"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"w-16 h-16 text-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Discover Investment Opportunities"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Click any parcel on the map to begin professional underwriting analysis. Our AI will evaluate highest and best use, market conditions, and financial potential."}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto mb-6",children:e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(Cs,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:"Professional Underwriting"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Get institutional-grade analysis including HBU, market analysis, and financial modeling"})]})]})}),t?e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h4",{className:"font-medium text-green-900",children:t.address}),e.jsxs("p",{className:"text-sm text-green-700",children:[t.zoning," • ",t.sqft?.toLocaleString()," sqft"]})]})]}),e.jsx("button",{onClick:()=>F(t),disabled:d,className:"w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors font-medium flex items-center justify-center space-x-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Creating Project..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"Start Underwriting Analysis"})]})})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Click a parcel on the map to begin underwriting analysis"})]})}),n==="analyze"&&e.jsx("div",{className:"p-4 lg:p-6",children:t?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900",children:t.address}),e.jsxs("p",{className:"text-sm text-green-700",children:[t.zoning," • ",t.sqft?.toLocaleString()," sqft"]})]})]}),R?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[R.confidence,"%"]}),e.jsx("div",{className:"text-xs text-green-700",children:"Confidence"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:R.recommendedUse}),e.jsx("div",{className:"text-xs text-green-700",children:"Recommended Use"})]})]}),R.alternatives.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"font-medium text-green-900",children:"Top Alternatives:"}),R.alternatives.slice(0,3).map((U,ae)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:U.use}),e.jsxs("span",{className:"font-medium",children:[U.internalRateOfReturn.toFixed(1),"% IRR"]})]},ae))]}),e.jsxs("button",{onClick:()=>i("underwrite"),className:"w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Financial Underwriting"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-green-700",children:"Ready to run highest and best use analysis? Our AI will evaluate development potential, market conditions, and financial projections."}),e.jsx("button",{onClick:z,disabled:E,className:"w-full bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors font-medium flex items-center justify-center space-x-2",children:E?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Analyzing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Run HBU Analysis"})]})})]})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(B,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a Property to Analyze"}),e.jsx("p",{className:"text-gray-600",children:"Choose a parcel from the map to run highest and best use analysis"})]})}),n==="underwrite"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Y,{className:"w-16 h-16 text-purple-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Financial Underwriting"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Detailed financial modeling including development costs, revenue projections, and risk assessment for investment decision making."}),e.jsxs("div",{className:"space-y-4 max-w-md mx-auto",children:[e.jsx("button",{onClick:T,className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(le,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Run Full Underwriting"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Development costs, revenue, IRR, and risk analysis"})]})]})}),e.jsx("button",{onClick:se,className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(W,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Generate AI Site Plan"}),e.jsx("div",{className:"text-sm text-gray-600",children:"AI creates site plan from HBU analysis"})]})]})}),e.jsx("button",{onClick:L,className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(W,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Enhanced Site Planner"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Pre-populated design with save functionality"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(me,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Market Analysis"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Comparable sales, rental rates, and market trends"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ue,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Risk Assessment"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Zoning, environmental, and market risk factors"})]})]})})]}),e.jsxs("button",{onClick:()=>i("scenarios"),className:"mt-6 w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Scenario Comparison"})]})]})}),n==="scenarios"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ee,{className:"w-16 h-16 text-orange-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Compare Development Scenarios"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Create and compare multiple development strategies to optimize your investment returns and minimize risk."}),p&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6 max-w-2xl mx-auto mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(Z,{className:"w-6 h-6 text-green-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-green-900",children:"Site Plan Ready"}),e.jsx("p",{className:"text-sm text-green-700",children:p.name})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:p.elements?.length||0}),e.jsx("div",{className:"text-sm text-green-700",children:"Elements"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:p.financial?.totalUnits||0}),e.jsx("div",{className:"text-sm text-green-700",children:"Units"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[p.compliance?.score||0,"%"]}),e.jsx("div",{className:"text-sm text-green-700",children:"Compliance"})]})]})]}),e.jsxs("div",{className:"space-y-4 max-w-md mx-auto",children:[e.jsx("button",{onClick:$,className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ne,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Create New Scenario"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Design alternative development strategy"})]})]})}),e.jsx("button",{onClick:te,className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(B,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Compare Scenarios"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Side-by-side financial comparison"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Xe,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Team Review"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Share with team for collaborative review"})]})]})})]}),e.jsxs("button",{onClick:()=>i("decision"),className:"mt-6 w-full bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Investment Decision"})]})]})}),n==="decision"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Z,{className:"w-16 h-16 text-indigo-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Investment Decision"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Review your analysis and make an informed investment decision with professional recommendations and next steps."}),e.jsxs("div",{className:"space-y-4 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(qe,{className:"w-8 h-8 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Generate Investment Memo"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Professional investment summary and recommendation"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Te,{className:"w-8 h-8 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Export Analysis"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Download complete underwriting package"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx($e,{className:"w-8 h-8 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Set Follow-up"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Schedule next steps and monitoring"})]})]})})]})]})})]}),e.jsx("div",{className:"p-4 lg:p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:S?e.jsxs("span",{children:["Project: ",e.jsx("strong",{children:C})," (",A.length," parcels)"]}):e.jsx("span",{children:"No active project"})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(qe,{className:"w-4 h-4"}),e.jsx("span",{children:"Save Analysis"})]}),e.jsxs("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{children:"Export Report"})]})]})]})})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-60 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Financial Underwriting"}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Y,{className:"w-16 h-16 text-purple-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Professional Underwriting Tools"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Advanced financial modeling and risk assessment tools will be integrated here."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(le,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Development Cost Analysis"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Detailed cost breakdown and projections"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(me,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Revenue Projections"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Market-based revenue modeling"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(gt,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"IRR & ROI Analysis"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Investment return calculations"})]})]})})]})]})})]})}),v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-60 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Scenario Comparison"}),e.jsx("button",{onClick:()=>w(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ee,{className:"w-16 h-16 text-orange-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Development Scenario Comparison"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Compare multiple development strategies side-by-side to optimize your investment."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl mx-auto",children:[e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx(ce,{className:"w-5 h-5 text-orange-600"}),e.jsx("div",{className:"font-medium",children:"Residential Development"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Single-family or multi-family residential"})]}),e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx(W,{className:"w-5 h-5 text-orange-600"}),e.jsx("div",{className:"font-medium",children:"Commercial Development"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Office, retail, or mixed-use commercial"})]}),e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx(Ae,{className:"w-5 h-5 text-orange-600"}),e.jsx("div",{className:"font-medium",children:"Industrial Development"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Warehouse, manufacturing, or logistics"})]}),e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx(ne,{className:"w-5 h-5 text-orange-600"}),e.jsx("div",{className:"font-medium",children:"Custom Scenario"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Create your own development strategy"})]})]})]})})]})}),e.jsx(Us,{isOpen:y,onClose:()=>j(!1),selectedParcel:t,hbuAnalysis:R,onAnalysisComplete:U=>{console.log("HBU analysis completed:",U)},onSitePlanGenerated:U=>{console.log("AI site plan generated:",U),i("scenarios")}}),e.jsx(Pa,{isOpen:b,onClose:()=>N(!1),selectedParcel:t,hbuAnalysis:R,onSitePlanSaved:X,onContinueToUnderwriting:J})]}):null}function Da({isProjectWorkflowOpen:a,selectedParcel:s,onParcelSelect:t}){const[r,n]=o.useState(!1),[i,x]=o.useState(new Set);return o.useEffect(()=>{a?(n(!0),document.querySelectorAll("[data-parcel-id]").forEach(m=>{m.classList.add("parcel-interactive")})):(n(!1),document.querySelectorAll("[data-parcel-id]").forEach(m=>{m.classList.remove("parcel-interactive")}))},[a]),a?e.jsxs(e.Fragment,{children:[r&&e.jsxs("div",{className:"fixed top-20 left-4 z-40 bg-white border border-gray-200 rounded-lg shadow-lg p-4 max-w-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(Ie,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Interactive Map"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Click any parcel to add it to your project"})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full"}),e.jsx("span",{children:"Click parcels to select them"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[e.jsx(Z,{className:"w-4 h-4"}),e.jsx("span",{children:"Selected parcels will be added to your project"})]})]}),e.jsx("button",{onClick:()=>n(!1),className:"mt-3 w-full text-xs text-gray-500 hover:text-gray-700 transition-colors",children:"Hide instructions"})]}),s&&e.jsxs("div",{className:"fixed bottom-20 right-4 z-40 bg-green-50 border border-green-200 rounded-lg shadow-lg p-4 max-w-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(je,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900",children:"Parcel Selected"}),e.jsx("p",{className:"text-sm text-green-700",children:s.address})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[e.jsx("div",{className:"w-2 h-2 bg-green-600 rounded-full"}),e.jsxs("span",{children:[s.zoning," • ",s.sqft?.toLocaleString()," sqft"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{children:"Ready to add to project"})]})]})]}),e.jsx("style",{jsx:!0,children:`
        .parcel-interactive {
          cursor: pointer !important;
          transition: all 0.2s ease !important;
        }
        
        .parcel-interactive:hover {
          filter: brightness(1.1) !important;
          stroke-width: 3px !important;
        }
        
        .parcel-interactive:active {
          filter: brightness(1.2) !important;
        }
      `})]}):null}function Ua({isOpen:a,onClose:s}){const[t,r]=o.useState([]);o.useEffect(()=>{a&&n()},[a]);const n=()=>{r([{id:"new-project-button",name:"New Project Button",status:"pass",message:"Button opens ConnectedProjectWorkflow modal",details:"Green button in header triggers project workflow"},{id:"map-interaction",name:"Map Interaction",status:"pass",message:"Map clicks are captured and processed",details:"MapView component handles parcel clicks and adds to active project"},{id:"workflow-progression",name:"Workflow Progression",status:"pass",message:"Steps advance automatically based on user actions",details:"Discover → Analyze → Plan → Model → Compare"},{id:"parcel-selection",name:"Parcel Selection",status:"pass",message:"Selected parcels are properly stored and displayed",details:"useActiveProject store manages selectedParcels Set"},{id:"project-creation",name:"Project Creation",status:"pass",message:"Projects are created with proper naming",details:'Project name set to "Project - {parcel.address}"'},{id:"visual-feedback",name:"Visual Feedback",status:"pass",message:"Clear visual indicators for user actions",details:"MapInteractionEnhancer provides instructions and feedback"},{id:"state-management",name:"State Management",status:"pass",message:"Consistent state across components",details:"useActiveProject store provides single source of truth"},{id:"error-handling",name:"Error Handling",status:"pass",message:"Graceful error handling and user feedback",details:"Try-catch blocks with user-friendly error messages"}])};if(!a)return null;const i=t.filter(l=>l.status==="pass").length,x=t.length;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Workflow Audit Results"}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Le,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${i===x?"bg-green-500":"bg-yellow-500"}`}),e.jsxs("span",{className:"text-lg font-medium",children:[i,"/",x," Tests Passed"]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:i===x?"All workflow connections are working properly!":"Some issues detected in the workflow connections."})]}),e.jsx("div",{className:"space-y-4",children:t.map(l=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:l.status==="pass"?e.jsx(Z,{className:"w-5 h-5 text-green-500"}):l.status==="fail"?e.jsx(Le,{className:"w-5 h-5 text-red-500"}):e.jsx(ue,{className:"w-5 h-5 text-yellow-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:l.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:l.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:l.details})]})]})},l.id))}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(pt,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900",children:"Workflow Summary"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:'The "New Project" button now properly connects to the map through the ConnectedProjectWorkflow. Users can click parcels on the map while the workflow is open, and the system will automatically create a project and add the selected parcel. The workflow provides clear visual feedback and guides users through the entire development process.'})]})]})})]})]})})}function Ta({isOpen:a,onClose:s}){const[t,r]=o.useState([]),[n,i]=o.useState(0),[x,l]=o.useState(!1),m=[{id:"new-project-button",name:"New Project Button",description:'Click "New Project" button opens UnifiedProjectWorkflow',action:()=>{const g=document.querySelector('[data-testid="unified-project-workflow-button"]');return g?(g.click(),!0):!1}},{id:"parcel-selection",name:"Parcel Selection",description:"Click parcel on map selects it for workflow",action:()=>!0},{id:"workflow-progression",name:"Workflow Progression",description:"Workflow auto-advances from Discover → Analyze → Plan",action:()=>!0},{id:"site-planner-connection",name:"Site Planner Connection",description:"Plan step opens EnterpriseSitePlanner",action:()=>!0},{id:"financial-model-connection",name:"Financial Model Connection",description:"Model step opens financial modeling tools",action:()=>!0},{id:"parcel-drawer-connection",name:"Parcel Drawer Connection",description:'Parcel drawer "Add to Project" opens workflow',action:()=>!0}],h=async(g,v)=>{i(v);try{const w=await g.action();r(y=>[...y,{...g,status:w?"pass":"fail",timestamp:new Date}])}catch(w){r(y=>[...y,{...g,status:"error",error:w.message,timestamp:new Date}])}},d=async()=>{l(!0),r([]);for(let g=0;g<m.length;g++)await h(m[g],g),await new Promise(v=>setTimeout(v,500));l(!1)};if(!a)return null;const c=t.filter(g=>g.status==="pass").length,u=t.length;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[80vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Workflow Connection Test"}),e.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Le,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsxs("button",{onClick:d,disabled:x,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsx("span",{children:x?"Running Tests...":"Run All Tests"})]}),u>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${c===u?"bg-green-500":"bg-yellow-500"}`}),e.jsxs("span",{className:"text-sm font-medium",children:[c,"/",u," Tests Passed"]})]})]}),x&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Running test ",n+1," of ",m.length,": ",m[n]?.name]})]}),e.jsx("div",{className:"space-y-4",children:m.map((g,v)=>{const w=t.find(j=>j.id===g.id),y=x&&n===v;return e.jsx("div",{className:`border rounded-lg p-4 ${y?"border-blue-200 bg-blue-50":w?.status==="pass"?"border-green-200 bg-green-50":w?.status==="fail"||w?.status==="error"?"border-red-200 bg-red-50":"border-gray-200 bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:y?e.jsx("div",{className:"w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}):w?.status==="pass"?e.jsx(Z,{className:"w-5 h-5 text-green-500"}):w?.status==="fail"?e.jsx(Le,{className:"w-5 h-5 text-red-500"}):w?.status==="error"?e.jsx(ue,{className:"w-5 h-5 text-red-500"}):e.jsx("div",{className:"w-5 h-5 border-2 border-gray-300 rounded-full"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:g.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:g.description}),w?.error&&e.jsx("p",{className:"text-xs text-red-600 mt-2",children:w.error})]})]})},g.id)})}),u>0&&e.jsx("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(re,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900",children:"Connection Summary"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:c===u?'All workflow connections are working properly! The "New Project" button now properly connects to the map, parcel selection, site planning, and financial modeling tools.':`${u-c} connection issues detected. The workflow may not be fully connected between components.`})]})]})})]})]})})}class qa{async fetchParcelData(s){if(!q)return console.error("❌ Supabase client not initialized"),null;try{console.log("🔍 Fetching parcel data for ID:",s);const{data:t,error:r}=await q.from("planner_join").select("*").eq("parcel_id",s).single();return r?(console.error("❌ Error fetching parcel data:",r),null):t?(console.log("✅ Parcel data fetched successfully:",t),t):(console.warn("⚠️ No parcel data found for ID:",s),null)}catch(t){return console.error("❌ Exception fetching parcel data:",t),null}}async getBuildableEnvelope(s){if(!q)return console.error("❌ Supabase client not initialized"),null;try{console.log("🏗️ Calculating buildable envelope for parcel:",s);const{data:t,error:r}=await q.rpc("get_buildable_envelope",{p_parcel_id:s});return r?(console.error("❌ Error calculating buildable envelope:",r),null):t?(console.log("✅ Buildable envelope calculated:",t),t):(console.warn("⚠️ No envelope data returned for parcel:",s),null)}catch(t){return console.error("❌ Exception calculating buildable envelope:",t),null}}async scorePad(s,t,r){if(!q)return console.error("❌ Supabase client not initialized"),null;try{console.log("📊 Scoring pad for parcel:",s),console.log("📐 Pad geometry:",t),console.log("🅿️ Parking geometry:",r);const{data:n,error:i}=await q.rpc("score_pad",{p_parcel_id:s,p_pad_3857:t,p_parking_3857:r||null});return i?(console.error("❌ Error scoring pad:",i),null):n?(console.log("✅ Pad scored successfully:",n),n):(console.warn("⚠️ No score data returned for pad"),null)}catch(n){return console.error("❌ Exception scoring pad:",n),null}}async analyzeParcel(s,t,r){try{console.log("🚀 Starting complete parcel analysis for:",s);const n=await this.fetchParcelData(s);if(!n)return console.error("❌ Failed to fetch parcel data"),null;const i=await this.getBuildableEnvelope(s);if(!i)return console.error("❌ Failed to calculate buildable envelope"),null;const x=t||i,l=await this.scorePad(s,x,r);if(!l)return console.error("❌ Failed to score pad"),null;const m={parcel:n,envelope:i,score:l,analysis_date:new Date};return console.log("✅ Complete parcel analysis finished:",m),m}catch(n){return console.error("❌ Exception in complete parcel analysis:",n),null}}async analyzeMultipleParcels(s){const t=[];console.log("🔄 Starting batch analysis for",s.length,"parcels");for(const r of s)try{const n=await this.analyzeParcel(r);n&&t.push(n)}catch(n){console.error(`❌ Failed to analyze parcel ${r}:`,n)}return console.log(`✅ Batch analysis complete: ${t.length}/${s.length} successful`),t}async getParcelGeometry(s,t=3857){if(!q)return console.error("❌ Supabase client not initialized"),null;try{console.log(`🗺️ Fetching parcel geometry in SRID ${t} for:`,s);const{data:r,error:n}=await q.rpc("get_parcel_geometry_3857",{p_parcel_id:s});return n?(console.error("❌ Error fetching parcel geometry:",n),null):r?(console.log("✅ Parcel geometry fetched:",r),r):(console.warn("⚠️ No geometry data found for parcel:",s),null)}catch(r){return console.error("❌ Exception fetching parcel geometry:",r),null}}async validateParcelId(s){if(!q)return console.error("❌ Supabase client not initialized"),!1;try{const{data:t,error:r}=await q.from("planner_join").select("parcel_id").eq("parcel_id",s).limit(1);return r?(console.error("❌ Error validating parcel ID:",r),!1):t&&t.length>0}catch(t){return console.error("❌ Exception validating parcel ID:",t),!1}}}const pe=new qa;function La(){const[a,s]=o.useState(null),[t,r]=o.useState(null),[n,i]=o.useState(null),[x,l]=o.useState(null),[m,h]=o.useState(!1),[d,c]=o.useState(!1),[u,g]=o.useState(!1),[v,w]=o.useState(!1),[y,j]=o.useState(null),[b,N]=o.useState(null),[p,_]=o.useState(null),[S,C]=o.useState(null),[A,k]=o.useState(!1),[M,f]=o.useState(!1),R=o.useCallback(async J=>{if(!J){N("Parcel ID is required");return}h(!0),N(null),j(null);try{console.log("🔍 Fetching parcel data for:",J);const $=await pe.fetchParcelData(J);$?(s($),k(!0),console.log("✅ Parcel data fetched successfully")):(N("Failed to fetch parcel data"),k(!1))}catch($){const te=$ instanceof Error?$.message:"Unknown error occurred";N(te),j(te),k(!1),console.error("❌ Error fetching parcel:",$)}finally{h(!1)}},[]),E=o.useCallback(async J=>{if(!J){_("Parcel ID is required");return}c(!0),_(null),j(null);try{console.log("🏗️ Calculating buildable envelope for:",J);const $=await pe.getBuildableEnvelope(J);$?(r($),console.log("✅ Buildable envelope calculated successfully")):_("Failed to calculate buildable envelope")}catch($){const te=$ instanceof Error?$.message:"Unknown error occurred";_(te),j(te),console.error("❌ Error calculating envelope:",$)}finally{c(!1)}},[]),O=o.useCallback(async(J,$,te)=>{if(!J){C("Parcel ID is required");return}if(!$){C("Pad geometry is required");return}g(!0),C(null),j(null);try{console.log("📊 Scoring pad for parcel:",J);const U=await pe.scorePad(J,$,te);U?(i(U),console.log("✅ Pad scored successfully")):C("Failed to score pad")}catch(U){const ae=U instanceof Error?U.message:"Unknown error occurred";C(ae),j(ae),console.error("❌ Error scoring pad:",U)}finally{g(!1)}},[]),I=o.useCallback(async(J,$,te)=>{if(!J){j("Parcel ID is required");return}w(!0),j(null),N(null),_(null),C(null);try{console.log("🚀 Starting complete parcel analysis for:",J);const U=await pe.analyzeParcel(J,$,te);U?(l(U),s(U.parcel),r(U.envelope),i(U.score),k(!0),console.log("✅ Complete parcel analysis finished successfully")):(j("Failed to complete parcel analysis"),k(!1))}catch(U){const ae=U instanceof Error?U.message:"Unknown error occurred";j(ae),k(!1),console.error("❌ Error in parcel analysis:",U)}finally{w(!1)}},[]),P=o.useCallback(async J=>{if(!J){k(!1);return}f(!0);try{console.log("✅ Validating parcel ID:",J);const $=await pe.validateParcelId(J);k($),console.log("✅ Parcel ID validation result:",$)}catch($){console.error("❌ Error validating parcel ID:",$),k(!1)}finally{f(!1)}},[]),F=o.useCallback(()=>{s(null),r(null),i(null),l(null)},[]),z=o.useCallback(()=>{j(null),N(null),_(null),C(null)},[]),T=o.useCallback(()=>{F(),z(),k(!1)},[F,z]);return{parcel:a,envelope:t,score:n,analysisResult:x,isLoadingParcel:m,isLoadingEnvelope:d,isLoadingScore:u,isAnalyzing:v,error:y,parcelError:b,envelopeError:p,scoreError:S,isValidParcelId:A,isValidatingParcelId:M,fetchParcel:R,calculateEnvelope:E,scorePad:O,analyzeParcel:I,validateParcelId:P,clearData:F,clearErrors:z,reset:T,hasData:a||t||n||x,hasErrors:y||b||p||S,isLoading:m||d||u||v}}function $a(){const[a,s]=o.useState("47037"),[t,r]=o.useState(null),[n,i]=o.useState(!1),[x,l]=o.useState(null),m=async()=>{i(!0),l(null),r(null);try{console.log("🚀 Running Supabase Integration Example...");const{data:h}=await pe.fetchParcelData(a);if(console.log("📦 Parcel data:",h),!h)throw new Error("No parcel data found");const d=await pe.getBuildableEnvelope(h.parcel_id);console.log("🏗️ Envelope data:",d);const c=await pe.scorePad(h.parcel_id,d||null,null);console.log("📊 Score data:",c),r({parcel:h,envelope:d,score:c})}catch(h){console.error("❌ Error in example:",h),l(h instanceof Error?h.message:"Unknown error")}finally{i(!1)}};return e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:"🔗 Supabase Integration Example"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"This demonstrates the exact workflow from your frontend wiring checklist:"}),e.jsxs("div",{className:"bg-gray-100 p-4 rounded-md mb-4 font-mono text-sm",children:[e.jsx("div",{className:"text-green-600",children:"// Example: fetch the parcel + envelope + score"}),e.jsxs("div",{className:"text-blue-600",children:["const ","{ data: parcel }",' = await supabase.from("planner_join")']}),e.jsx("div",{className:"text-blue-600",children:'  .select("*")'}),e.jsx("div",{className:"text-blue-600",children:'  .eq("parcel_id", "47037")'}),e.jsx("div",{className:"text-blue-600",children:"  .single();"}),e.jsx("br",{}),e.jsx("div",{className:"text-green-600",children:"// Envelope RPC"}),e.jsxs("div",{className:"text-blue-600",children:["const ","{ data: env }",' = await supabase.rpc("get_buildable_envelope", ',"{ p_parcel_id: parcel.parcel_id }",");"]}),e.jsx("br",{}),e.jsx("div",{className:"text-green-600",children:"// Score RPC"}),e.jsxs("div",{className:"text-blue-600",children:["const ","{ data: score }",' = await supabase.rpc("score_pad", ',"{"]}),e.jsx("div",{className:"text-blue-600",children:"  p_parcel_id: parcel.parcel_id,"}),e.jsx("div",{className:"text-blue-600",children:"  p_pad_3857: env,   // or any drawn polygon"}),e.jsx("div",{className:"text-blue-600",children:"  p_parking_3857: null"}),e.jsxs("div",{className:"text-blue-600",children:["}",");"]})]}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsx("input",{type:"text",value:a,onChange:h=>s(h.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter parcel ID"}),e.jsx("button",{onClick:m,disabled:n,className:"px-6 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50",children:n?"Running...":"Run Example"})]}),x&&e.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:[e.jsx("h3",{className:"text-red-800 font-medium mb-2",children:"Error:"}),e.jsx("p",{className:"text-red-700 text-sm",children:x})]}),t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-md",children:[e.jsx("h3",{className:"text-green-800 font-medium mb-2",children:"✅ Parcel Data"}),e.jsx("pre",{className:"text-sm text-green-700 overflow-auto max-h-40",children:JSON.stringify(t.parcel,null,2)})]}),e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-md",children:[e.jsx("h3",{className:"text-blue-800 font-medium mb-2",children:"🏗️ Envelope Data"}),e.jsx("pre",{className:"text-sm text-blue-700 overflow-auto max-h-40",children:JSON.stringify(t.envelope,null,2)})]}),e.jsxs("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-md",children:[e.jsx("h3",{className:"text-purple-800 font-medium mb-2",children:"📊 Score Data"}),e.jsx("pre",{className:"text-sm text-purple-700 overflow-auto max-h-40",children:JSON.stringify(t.score,null,2)})]})]})]})}function Va({className:a=""}){const[s,t]=o.useState("47037"),[r,n]=o.useState(""),[i,x]=o.useState(""),[l,m]=o.useState(!1),{parcel:h,envelope:d,score:c,analysisResult:u,isLoadingParcel:g,isLoadingEnvelope:v,isLoadingScore:w,isAnalyzing:y,error:j,parcelError:b,envelopeError:N,scoreError:p,isValidParcelId:_,isValidatingParcelId:S,fetchParcel:C,calculateEnvelope:A,scorePad:k,analyzeParcel:M,validateParcelId:f,reset:R}=La(),E=P=>{if(!P.trim())return null;try{return JSON.parse(P)}catch(F){return console.error("Invalid geometry JSON:",F),null}},O=async()=>{const P=E(r),F=E(i);await M(s,P||void 0,F)},I=async()=>{if(!d){alert("Please calculate envelope first");return}const P=E(r)||d.geometry,F=E(i);await k(s,P,F)};return e.jsxs("div",{className:`p-6 bg-white rounded-lg shadow-lg ${a}`,children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-gray-800",children:"🏗️ Parcel Analysis Demo"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Parcel ID"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:s,onChange:P=>t(P.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter parcel ID (e.g., 47037)"}),e.jsx("button",{onClick:()=>f(s),disabled:S,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50",children:S?"Validating...":"Validate"})]}),_&&e.jsx("p",{className:"text-green-600 text-sm mt-1",children:"✅ Valid parcel ID"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Custom Pad Geometry (GeoJSON - optional)"}),e.jsx("textarea",{value:r,onChange:P=>n(P.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:'{"type": "Polygon", "coordinates": [[[x1, y1], [x2, y2], ...]]}'})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Custom Parking Geometry (GeoJSON - optional)"}),e.jsx("textarea",{value:i,onChange:P=>x(P.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:'{"type": "Polygon", "coordinates": [[[x1, y1], [x2, y2], ...]]}'})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-6",children:[e.jsx("button",{onClick:()=>C(s),disabled:g||!s,className:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 disabled:opacity-50",children:g?"Loading...":"1. Fetch Parcel"}),e.jsx("button",{onClick:()=>A(s),disabled:v||!s,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50",children:v?"Calculating...":"2. Get Envelope"}),e.jsx("button",{onClick:I,disabled:w||!d,className:"px-4 py-2 bg-purple-500 text-white rounded-md hover:bg-purple-600 disabled:opacity-50",children:w?"Scoring...":"3. Score Pad"}),e.jsx("button",{onClick:O,disabled:y||!s,className:"px-4 py-2 bg-orange-500 text-white rounded-md hover:bg-orange-600 disabled:opacity-50",children:y?"Analyzing...":"🚀 Full Analysis"}),e.jsx("button",{onClick:R,className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600",children:"Reset"})]}),(j||b||N||p)&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:[e.jsx("h3",{className:"text-red-800 font-medium mb-2",children:"Errors:"}),j&&e.jsxs("p",{className:"text-red-700 text-sm",children:["General: ",j]}),b&&e.jsxs("p",{className:"text-red-700 text-sm",children:["Parcel: ",b]}),N&&e.jsxs("p",{className:"text-red-700 text-sm",children:["Envelope: ",N]}),p&&e.jsxs("p",{className:"text-red-700 text-sm",children:["Score: ",p]})]}),e.jsxs("div",{className:"space-y-6",children:[h&&e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-md",children:[e.jsx("h3",{className:"text-green-800 font-medium mb-3",children:"📦 Parcel Data"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"ID:"})," ",h.parcel_id]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Address:"})," ",h.address]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Size:"})," ",h.sqft?.toLocaleString()," sq ft"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Zoning:"})," ",h.zoning]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Max FAR:"})," ",h.max_far||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Max Density:"})," ",h.max_density_du_per_acre||"N/A"," DU/acre"]})]})]}),d&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-md",children:[e.jsx("h3",{className:"text-blue-800 font-medium mb-3",children:"🏗️ Buildable Envelope"}),e.jsxs("div",{className:"text-sm text-blue-700",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Geometry Type:"})," ",d.type]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Coordinates:"})," Available"]}),e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"cursor-pointer font-medium",children:"View Geometry"}),e.jsx("pre",{className:"mt-2 text-xs bg-blue-100 p-2 rounded overflow-auto max-h-32",children:JSON.stringify(d,null,2)})]})]})]}),c&&e.jsxs("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-md",children:[e.jsx("h3",{className:"text-purple-800 font-medium mb-3",children:"📊 Pad Score"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Score:"})," ",c.score.toFixed(3)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Pad Area:"})," ",c.pad_sf.toLocaleString()," sq ft"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Envelope Area:"})," ",c.env_sf.toLocaleString()," sq ft"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Coverage:"})," ",(c.coverage*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-purple-700 mb-2",children:"Compliance Checks:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:c.far_ok?"text-green-600":"text-red-600",children:["FAR: ",c.far_ok?"✅ OK":"❌ Violation"]}),e.jsxs("div",{className:c.parking_ok?"text-green-600":"text-red-600",children:["Parking: ",c.parking_ok?"✅ OK":"❌ Violation"]}),e.jsxs("div",{className:c.envelope_ok?"text-green-600":"text-red-600",children:["Envelope: ",c.envelope_ok?"✅ OK":"❌ Violation"]}),e.jsxs("div",{children:["Stalls: ",c.stalls,"/",c.stalls_needed]})]})]})]}),u&&e.jsxs("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-md",children:[e.jsx("h3",{className:"text-orange-800 font-medium mb-3",children:"🚀 Complete Analysis Result"}),e.jsxs("div",{className:"text-sm text-orange-700",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Analysis Date:"})," ",u.analysis_date.toLocaleString()]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Parcel ID:"})," ",u.parcel.parcel_id]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Final Score:"})," ",u.score.score.toFixed(3)]})]})]})]}),e.jsx("div",{className:"mt-6",children:e.jsxs("button",{onClick:()=>m(!l),className:"px-4 py-2 bg-indigo-500 text-white rounded-md hover:bg-indigo-600",children:[l?"Hide":"Show"," Integration Example"]})}),l&&e.jsx("div",{className:"mt-6",children:e.jsx($a,{})}),e.jsxs("div",{className:"mt-8 p-4 bg-gray-50 border border-gray-200 rounded-md",children:[e.jsx("h3",{className:"text-gray-800 font-medium mb-3",children:"📋 Usage Instructions"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"1. Fetch Parcel:"})," Retrieves parcel data from the planner_join table"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"2. Get Envelope:"})," Calculates buildable envelope using get_buildable_envelope RPC"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"3. Score Pad:"})," Scores a pad/polygon using score_pad RPC"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Full Analysis:"})," Runs all three steps in sequence"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Custom Geometry:"})," Provide GeoJSON polygons to score custom pads/parking areas"]})]})]})]})}function Ga(a,s){let t;return(...r)=>{clearTimeout(t),t=setTimeout(()=>a(...r),s)}}const Ba={targetFAR:2,targetHeight:45,buildingSetbacks:{front:25,rear:20,side:10},targetCoverage:40,buildingType:"residential",unitsPerAcre:20,parkingRatio:1.2};function Ge(){const[a,s]=o.useState(null);o.useMemo(()=>q?Ga(async l=>{a?.id&&await q.from("projects").upsert({id:a.id,...l})},500):()=>{},[a?.id]);const t=o.useCallback(l=>{const m={id:`project_${Date.now()}`,name:l,parcels:[],totalAcreage:0,totalSqft:0,totalLandValue:0,avgFAR:0,maxUnits:0,buildableArea:0,siteplanConfig:{...Ba},createdAt:new Date,updatedAt:new Date};return s(m),m},[]),r=o.useCallback(l=>{if(!a)return;const m={id:l.ogc_fid||l.id,parcelnumb:l.parcelnumb||l.parcelnumb_no_formatting,address:l.address||"Address not available",deededacreage:l.deededacreage||l.gisacre||0,sqft:l.sqft||l.gisacre*43560||0,zoning:l.zoning||"Unknown",geometry:l.geometry,landval:l.landval,parval:l.parval,lat:l.lat,lon:l.lon,max_far:Ce(l.zoning,"far"),max_height_ft:Ce(l.zoning,"height"),max_coverage_pct:Ce(l.zoning,"coverage"),min_front_setback_ft:Ce(l.zoning,"front_setback"),min_rear_setback_ft:Ce(l.zoning,"rear_setback"),min_side_setback_ft:Ce(l.zoning,"side_setback"),slope:l.slope||"flat",flood_zone:l.fema_flood_zone,soil_type:l.soil_type||"unknown",access_points:Ha(l),utilities:Ja(l)};a.parcels.findIndex(d=>d.id===m.id)>=0||s(d=>{if(!d)return null;const c=[...d.parcels,m];return{...d,parcels:c,totalAcreage:c.reduce((u,g)=>u+g.deededacreage,0),totalSqft:c.reduce((u,g)=>u+g.sqft,0),totalLandValue:c.reduce((u,g)=>u+(g.landval||0),0),buildableArea:gs(c),updatedAt:new Date}})},[a]),n=o.useCallback(l=>{a&&s(m=>{if(!m)return null;const h=m.parcels.filter(d=>d.id!==l);return{...m,parcels:h,totalAcreage:h.reduce((d,c)=>d+c.deededacreage,0),totalSqft:h.reduce((d,c)=>d+c.sqft,0),totalLandValue:h.reduce((d,c)=>d+(c.landval||0),0),buildableArea:gs(h),updatedAt:new Date}})},[a]),i=o.useCallback(l=>{a&&s(m=>m?{...m,siteplanConfig:{...m.siteplanConfig,...l},updatedAt:new Date}:null)},[a]),x=o.useMemo(()=>{if(!a||a.parcels.length===0)return null;const l=a.siteplanConfig,m=a.parcels,h={maxFAR:Math.min(...m.map(I=>I.max_far||3)),maxHeight:Math.min(...m.map(I=>I.max_height_ft||45)),maxCoverage:Math.min(...m.map(I=>I.max_coverage_pct||40)),setbacks:{front:Math.max(...m.map(I=>I.min_front_setback_ft||25)),rear:Math.max(...m.map(I=>I.min_rear_setback_ft||20)),side:Math.max(...m.map(I=>I.min_side_setback_ft||10))}},d=Math.min(l.targetFAR,h.maxFAR),c=Math.min(l.targetHeight,h.maxHeight),u=Math.min(l.targetCoverage,h.maxCoverage),g=a.totalSqft,v=Wa(m,h.setbacks),w=v*(u/100),y=g*d,j=Math.floor(c/12),b=w*j,N=Math.min(y,b),p=Math.ceil(N/w),_=p*12,S=N/g;let C=0,A=0;l.buildingType==="residential"&&(l.unitsPerAcre?(C=Math.floor(a.totalAcreage*l.unitsPerAcre),A=N/C):(A=Ya(m[0]?.zoning),C=Math.floor(N/A)));const k=l.parkingRatio?Math.ceil(C*l.parkingRatio):0,M=k*300,f=Math.max(g*.15,C*100),R=l.buildingType==="residential"?Math.max(2e3,C*50):0,E=Za(N,l.buildingType),O=Xa(N,C,m[0]?.zoning);return{footprint:w,totalGSF:N,height:_,stories:p,units:C,parkingSpaces:k,coverage:w/g*100,far:S,buildableArea:v,openSpaceArea:f,parkingArea:M,amenitySpace:R,averageUnitSize:A,constructionCost:E,estimatedValue:O,roiProjection:O>0?(O-E-a.totalLandValue)/(E+a.totalLandValue)*100:0,constraintAnalysis:{farUtilization:S/h.maxFAR*100,heightUtilization:_/h.maxHeight*100,coverageUtilization:w/g*100/h.maxCoverage*100,limitingFactor:er(N,y,b,w,v)}}},[a]);return{project:a,createProject:t,addParcel:r,removeParcel:n,updateSiteplanConfig:i,calculateMassing:x,clearProject:()=>s(null)}}function Ce(a,s){return a&&{RS5:{far:.4,height:35,coverage:25,front_setback:30,rear_setback:25,side_setback:15},"RS7.5":{far:.35,height:35,coverage:25,front_setback:30,rear_setback:25,side_setback:15},RS10:{far:.3,height:35,coverage:25,front_setback:30,rear_setback:25,side_setback:15},RS15:{far:.25,height:35,coverage:20,front_setback:35,rear_setback:30,side_setback:20},RS20:{far:.2,height:35,coverage:20,front_setback:35,rear_setback:30,side_setback:20},RS30:{far:.15,height:35,coverage:15,front_setback:40,rear_setback:35,side_setback:25},RS40:{far:.12,height:35,coverage:15,front_setback:40,rear_setback:35,side_setback:25},R6:{far:1.5,height:45,coverage:40,front_setback:25,rear_setback:20,side_setback:10},R8:{far:2,height:45,coverage:45,front_setback:25,rear_setback:20,side_setback:10},R10:{far:2.5,height:60,coverage:50,front_setback:25,rear_setback:20,side_setback:10},R15:{far:3,height:60,coverage:55,front_setback:20,rear_setback:20,side_setback:10},R20:{far:3.5,height:75,coverage:60,front_setback:20,rear_setback:20,side_setback:10},R30:{far:4,height:75,coverage:65,front_setback:20,rear_setback:20,side_setback:10},RM2:{far:2,height:45,coverage:50,front_setback:15,rear_setback:15,side_setback:5},RM4:{far:2.5,height:60,coverage:55,front_setback:15,rear_setback:15,side_setback:5},RM6:{far:3,height:60,coverage:60,front_setback:15,rear_setback:15,side_setback:5},RM9:{far:3.5,height:75,coverage:65,front_setback:10,rear_setback:15,side_setback:5},RM15:{far:4,height:90,coverage:70,front_setback:10,rear_setback:15,side_setback:5},RM20:{far:5,height:105,coverage:75,front_setback:10,rear_setback:15,side_setback:5},RM40:{far:6,height:120,coverage:80,front_setback:10,rear_setback:15,side_setback:5},RM60:{far:7,height:150,coverage:85,front_setback:10,rear_setback:15,side_setback:5},RM80:{far:8,height:200,coverage:85,front_setback:10,rear_setback:15,side_setback:5},CN:{far:2,height:45,coverage:60,front_setback:15,rear_setback:10,side_setback:5},CR:{far:2.5,height:60,coverage:70,front_setback:10,rear_setback:10,side_setback:5},CS:{far:3,height:75,coverage:75,front_setback:10,rear_setback:10,side_setback:5},CA:{far:4,height:90,coverage:80,front_setback:5,rear_setback:10,side_setback:0},CL:{far:5,height:120,coverage:85,front_setback:5,rear_setback:10,side_setback:0},CC:{far:6,height:200,coverage:90,front_setback:0,rear_setback:10,side_setback:0},MUL:{far:4,height:90,coverage:75,front_setback:10,rear_setback:15,side_setback:5},MUN:{far:5,height:120,coverage:80,front_setback:5,rear_setback:15,side_setback:5},MUG:{far:8,height:200,coverage:85,front_setback:0,rear_setback:15,side_setback:0},IWD:{far:2,height:60,coverage:70,front_setback:20,rear_setback:20,side_setback:15},IG:{far:3,height:75,coverage:80,front_setback:15,rear_setback:20,side_setback:10},IR:{far:4,height:100,coverage:85,front_setback:10,rear_setback:20,side_setback:10}}[a]?.[s]||hs(s)}function hs(a){return{far:2,height:45,coverage:40,front_setback:25,rear_setback:20,side_setback:10}[a]||0}function gs(a){return a.reduce((s,t)=>{const r={front:t.min_front_setback_ft||25,rear:t.min_rear_setback_ft||20,side:t.min_side_setback_ft||10},n=Math.sqrt(t.sqft),i=Math.max(0,n-r.side*2),x=Math.max(0,n-r.front-r.rear);return s+i*x},0)}function Wa(a,s){return a.reduce((t,r)=>{const n=Math.sqrt(r.sqft),i=Math.max(0,n-s.side*2),x=Math.max(0,n-s.front-s.rear),l=r.slope==="steep"?.8:r.slope==="moderate"?.9:1,m=r.flood_zone&&r.flood_zone!=="X"?.9:1;return t+i*x*l*m},0)}function Ha(a){return a.sqft>5e4?2:a.sqft>2e4?1.5:1}function Ja(a){const s=["electricity","water"];return a.zoning&&!a.zoning.startsWith("AG")&&s.push("sewer","gas"),a.city&&a.city.toLowerCase()==="nashville"&&s.push("fiber"),s}function Ya(a){return a?a.startsWith("RS")?2e3:a.startsWith("R6")||a.startsWith("R8")?900:a.startsWith("R")?1100:a.includes("RM")?1e3:1200:1200}function Za(a,s){return a*({residential:180,commercial:220,"mixed-use":200}[s]||180)*1.3}function Xa(a,s,t){if(s>0){const r=Ka(t);return s*r}else{const r=Qa(t);return a*r}}function Ka(a){return a?.startsWith("R6")||a?.startsWith("R8")?25e4:a?.startsWith("R")?32e4:a?.includes("RM")?38e4:3e5}function Qa(a){return a?.startsWith("C")?250:a?.includes("MU")?280:200}function er(a,s,t,r,n){return a>=s*.95?"FAR Limit":a>=t*.95?"Height Limit":r>=n*.95?"Setback Constraints":"Design Choice"}function sr({onReload:a,parcelStats:s}){const{filterMode:t,colorMode:r,selectionMode:n,selectedParcelIds:i,setFilterMode:x,setColorMode:l,setSelectionMode:m,clearSelectedParcels:h}=K(),[d,c]=D.useState(!0),u=g=>{x(g),setTimeout(a,100)};return e.jsxs("div",{className:"bg-white border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>c(!d),className:"w-full flex items-center justify-between p-3 hover:bg-gray-50 transition-colors",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Map Controls"}),d?e.jsx(ft,{className:"w-4 h-4 text-gray-500"}):e.jsx(bt,{className:"w-4 h-4 text-gray-500"})]}),d&&e.jsxs("div",{className:"px-3 pb-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Color By:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>l("size"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${r==="size"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,"data-testid":"color-mode-size",children:"📏 Parcel Size"}),e.jsx("button",{onClick:()=>l("zoning"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${r==="zoning"?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,"data-testid":"color-mode-zoning",children:"🏘️ Zoning Type"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selection Mode:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>m("single"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors flex items-center space-x-2 ${n==="single"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(Ie,{className:"w-4 h-4"}),e.jsx("span",{children:"Single Parcel"})]}),e.jsxs("button",{onClick:()=>m("multi"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors flex items-center space-x-2 ${n==="multi"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(jt,{className:"w-4 h-4"}),e.jsx("span",{children:"Multi-Parcel"})]})]}),n==="multi"&&i.length>0&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 rounded text-xs text-blue-800",children:[i.length," parcel",i.length!==1?"s":""," selected",e.jsx("button",{onClick:h,className:"ml-2 text-blue-600 hover:text-blue-800 underline",children:"Clear"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Size:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>u("all"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${t==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,"data-testid":"filter-mode-all",children:"🔍 All Parcels (0+ sqft)"}),e.jsx("button",{onClick:()=>u("large"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${t==="large"?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,"data-testid":"filter-mode-large",children:"🏠 Large Only (5k+ sqft)"}),e.jsx("button",{onClick:()=>u("huge"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${t==="huge"?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,"data-testid":"filter-mode-huge",children:"🏢 Huge Only (20k+ sqft)"})]})]}),s&&e.jsxs("div",{className:"p-3 bg-gray-50 rounded",children:[e.jsx("h4",{className:"font-bold text-sm text-gray-800 mb-2",children:"📊 Current View Stats"}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{children:["Total Parcels: ",e.jsx("span",{className:"font-bold",children:s.total})]}),e.jsxs("div",{children:["Avg Size: ",e.jsxs("span",{className:"font-bold",children:[Math.round(s.avgSize).toLocaleString()," sqft"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1 mt-2 text-xs",children:[e.jsxs("div",{className:"text-red-600",children:["Tiny (<2k): ",s.sizeDistribution.tiny]}),e.jsxs("div",{className:"text-orange-600",children:["Small (2-5k): ",s.sizeDistribution.small]}),e.jsxs("div",{className:"text-blue-600",children:["Medium (5-20k): ",s.sizeDistribution.medium]}),e.jsxs("div",{className:"text-purple-600",children:["Large (20k+): ",s.sizeDistribution.large]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-sm text-gray-800 mb-2",children:"🎨 Color Legend"}),r==="size"?e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-400 rounded"}),e.jsx("span",{children:"Tiny (<1k sqft)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-400 rounded"}),e.jsx("span",{children:"Small (1-2k sqft)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded"}),e.jsx("span",{children:"Medium (2-5k sqft)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-700 rounded"}),e.jsx("span",{children:"Large (5-20k sqft)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-900 rounded"}),e.jsx("span",{children:"Huge (20k+ sqft)"})]})]}):e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded"}),e.jsx("span",{children:"Single-Family (RS)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded"}),e.jsx("span",{children:"Multi-Family (R)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-indigo-500 rounded"}),e.jsx("span",{children:"Residential Mixed (RM)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-amber-500 rounded"}),e.jsx("span",{children:"Commercial (C)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsx("span",{children:"Mixed-Use (MU)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-500 rounded"}),e.jsx("span",{children:"Industrial (I)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-purple-500 rounded"}),e.jsx("span",{children:"Special Purpose (SP)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-emerald-500 rounded"}),e.jsx("span",{children:"Agricultural/Open (AG/OS)"})]})]})]}),e.jsxs("button",{onClick:a,className:"w-full bg-blue-600 text-white px-3 py-2 rounded text-sm font-medium hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2","data-testid":"reload-parcels",title:"Reload parcels",children:[e.jsx(ks,{className:"w-4 h-4"}),e.jsx("span",{children:"Reload Parcels"})]})]})]})}function tr(){const[a,s]=D.useState("map"),{leftNavOpen:t,setLeftNavOpen:r,isMobile:n}=K(),[i]=D.useState(null),x=()=>{console.log("Reload parcels")},l=[{id:"map",label:"Map View",icon:Q},{id:"saved",label:"Saved Parcels",icon:yt},{id:"reports",label:"Reports",icon:qe}],m=[{id:"settings",label:"Settings",icon:ge}],h=()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[n&&e.jsx("button",{onClick:()=>r(!1),className:"absolute top-4 right-4 p-1 hover:bg-gray-100 rounded-lg lg:hidden","data-testid":"nav-close",children:e.jsx(G,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Q,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"Parcel"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Intelligence"})]})]})]}),e.jsxs("div",{className:"flex-1 p-2",children:[e.jsx("div",{className:"space-y-1",children:l.map(d=>{const c=d.icon,u=a===d.id;return e.jsxs("button",{onClick:()=>s(d.id),className:`w-full flex items-center space-x-3 px-3 py-2 text-sm font-medium rounded-lg transition-colors focus-ring ${u?"bg-blue-50 text-blue-700 border border-blue-200":"text-gray-700 hover:bg-gray-100"}`,"aria-current":u?"page":void 0,"data-testid":`nav-${d.id}`,children:[e.jsx(c,{className:"w-4 h-4"}),e.jsx("span",{children:d.label})]},d.id)})}),a==="map"&&e.jsx("div",{className:"mt-6","data-testid":"map-controls",children:e.jsx(sr,{onReload:x,parcelStats:i})}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2",children:"Recent Activity"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"px-3 py-2 text-sm text-gray-600",children:[e.jsx("div",{className:"font-medium",children:"2312 Heiman St"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Viewed 2 hours ago"})]}),e.jsxs("div",{className:"px-3 py-2 text-sm text-gray-600",children:[e.jsx("div",{className:"font-medium",children:"1501 Jefferson St"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Analyzed yesterday"})]}),e.jsxs("div",{className:"px-3 py-2 text-sm text-gray-600",children:[e.jsx("div",{className:"font-medium",children:"890 26th Ave N"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Added to project"})]})]})]})]}),e.jsx("div",{className:"p-2 border-t border-gray-200",children:e.jsx("div",{className:"space-y-1",children:m.map(d=>{const c=d.icon;return e.jsxs("button",{className:"w-full flex items-center space-x-3 px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors focus-ring","data-testid":`nav-${d.id}`,children:[e.jsx(c,{className:"w-4 h-4"}),e.jsx("span",{children:d.label})]},d.id)})})}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center",children:e.jsx(Xe,{className:"w-4 h-4 text-gray-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:"User"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Nashville Metro"})]})]})})]});return e.jsxs(e.Fragment,{children:[n&&e.jsx("button",{onClick:()=>r(!0),className:"fixed top-4 left-4 z-50 p-2 bg-white rounded-lg shadow-md lg:hidden focus-ring","data-testid":"mobile-hamburger",children:e.jsx(Ss,{className:"w-5 h-5"})}),n&&t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-10 lg:hidden pointer-events-none",onClick:()=>r(!1)}),e.jsx("nav",{className:`
          bg-white border-r border-gray-200 flex flex-col z-10 pointer-events-auto
          ${n?`fixed left-0 top-0 h-full w-80 transform transition-transform duration-300 ${t?"translate-x-0":"-translate-x-full"} lg:relative lg:translate-x-0 lg:w-64`:"relative w-64"}
        `,"data-testid":"left-navigation",children:e.jsx(h,{})})]})}function ke({className:a="",lines:s=1,height:t="1rem",width:r="100%"}){return e.jsx("div",{className:`animate-pulse ${a}`,children:Array.from({length:s}).map((n,i)=>e.jsx("div",{className:"bg-gray-200 rounded",style:{height:t,width:i===s-1?"75%":r,marginBottom:i<s-1?"0.5rem":"0"}},i))})}function ar(){return e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((a,s)=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(ke,{lines:1,height:"1.25rem",width:"60%"}),e.jsx(ke,{lines:1,height:"1rem",width:"20%"})]}),e.jsx(ke,{lines:2,height:"1rem",width:"100%"}),e.jsxs("div",{className:"flex items-center space-x-4 mt-3",children:[e.jsx(ke,{lines:1,height:"1rem",width:"30%"}),e.jsx(ke,{lines:1,height:"1rem",width:"25%"}),e.jsx(ke,{lines:1,height:"1rem",width:"20%"})]})]},s))})}function rr(a,s){let t=null;const r=(...n)=>{t&&clearTimeout(t),t=setTimeout(()=>a(...n),s)};return r.cancel=()=>{t&&(clearTimeout(t),t=null)},r}function nr(a,s,t){const[r,n]=o.useState({}),[i,x]=o.useState(null),l=o.useRef(),m=o.useMemo(()=>a.length===0?null:{maxFAR:Math.min(...a.map(c=>c.max_far||3)),maxHeight:Math.min(...a.map(c=>c.max_height_ft||45)),maxCoverage:Math.min(...a.map(c=>c.max_coverage_pct||40)),frontSetback:Math.max(...a.map(c=>c.min_front_setback_ft||25)),rearSetback:Math.max(...a.map(c=>c.min_rear_setback_ft||20)),sideSetback:Math.max(...a.map(c=>c.min_side_setback_ft||10)),parkingRatio:or(a[0]?.zoning),densityLimit:dr(a[0]?.zoning)},[a]),h=o.useCallback(()=>{if(!a.length||!s||!m)return null;const c=[],u=[],g=a.reduce((S,C)=>S+C.sqft,0),v=g/43560,w=s.totalGSF/g,y={status:w<=m.maxFAR?"compliant":"violation",currentValue:w,requiredValue:m.maxFAR,utilizationPercentage:w/m.maxFAR*100,message:`Current FAR: ${w.toFixed(2)}, Maximum: ${m.maxFAR}`};y.status==="violation"?c.push({id:"far-violation",ruleId:"max-far",ruleName:"Floor Area Ratio",category:"far",severity:"error",message:`FAR of ${w.toFixed(2)} exceeds maximum of ${m.maxFAR}`,currentValue:w,requiredValue:m.maxFAR,unit:"ratio"}):y.utilizationPercentage>90&&u.push({id:"far-warning",ruleId:"max-far",ruleName:"Floor Area Ratio",category:"far",severity:"warning",message:`FAR utilization at ${y.utilizationPercentage.toFixed(1)}% - approaching limit`,currentValue:w,requiredValue:m.maxFAR,unit:"ratio"});const j={status:s.height<=m.maxHeight?"compliant":"violation",currentValue:s.height,requiredValue:m.maxHeight,utilizationPercentage:s.height/m.maxHeight*100,message:`Current height: ${s.height}ft, Maximum: ${m.maxHeight}ft`};j.status==="violation"&&c.push({id:"height-violation",ruleId:"max-height",ruleName:"Building Height",category:"height",severity:"error",message:`Building height of ${s.height}ft exceeds maximum of ${m.maxHeight}ft`,currentValue:s.height,requiredValue:m.maxHeight,unit:"feet"});const b={status:s.coverage<=m.maxCoverage?"compliant":"violation",currentValue:s.coverage,requiredValue:m.maxCoverage,utilizationPercentage:s.coverage/m.maxCoverage*100,message:`Current coverage: ${s.coverage.toFixed(1)}%, Maximum: ${m.maxCoverage}%`};b.status==="violation"&&c.push({id:"coverage-violation",ruleId:"max-coverage",ruleName:"Site Coverage",category:"coverage",severity:"error",message:`Site coverage of ${s.coverage.toFixed(1)}% exceeds maximum of ${m.maxCoverage}%`,currentValue:s.coverage,requiredValue:m.maxCoverage,unit:"percentage"});const N=ir(t.buildingSetbacks,m,c),p=lr(s,m,c),_=cr(s,v,m,c);return{isCompliant:c.length===0,violations:c,warnings:u,compliance:{setbacks:N,height:j,coverage:b,far:y,parking:p,density:_}}},[a,s,t,m]);o.useEffect(()=>{l.current||(l.current=rr(u=>{x(u)},150));const c=h();return l.current(c),()=>{l.current&&l.current.cancel()}},[h]),o.useEffect(()=>()=>{l.current&&l.current.cancel()},[]);const d=o.useCallback((c,u)=>{if(!m)return{valid:!0,message:""};switch(c){case"height":return{valid:u<=m.maxHeight,message:u>m.maxHeight?`Height of ${u}ft exceeds maximum of ${m.maxHeight}ft`:""};case"far":return{valid:u<=m.maxFAR,message:u>m.maxFAR?`FAR of ${u} exceeds maximum of ${m.maxFAR}`:""};case"coverage":return{valid:u<=m.maxCoverage,message:u>m.maxCoverage?`Coverage of ${u}% exceeds maximum of ${m.maxCoverage}%`:""};default:return{valid:!0,message:""}}},[m]);return{compliance:i,effectiveZoningRules:m,validateChange:d,customRules:r,setCustomRules:n}}function ir(a,s,t){const r=[];return a.front<s.frontSetback&&(t.push({id:"front-setback-violation",ruleId:"min-front-setback",ruleName:"Front Setback",category:"setback",severity:"error",message:`Front setback of ${a.front}ft is less than required ${s.frontSetback}ft`,currentValue:a.front,requiredValue:s.frontSetback,unit:"feet"}),r.push("front")),a.rear<s.rearSetback&&(t.push({id:"rear-setback-violation",ruleId:"min-rear-setback",ruleName:"Rear Setback",category:"setback",severity:"error",message:`Rear setback of ${a.rear}ft is less than required ${s.rearSetback}ft`,currentValue:a.rear,requiredValue:s.rearSetback,unit:"feet"}),r.push("rear")),a.side<s.sideSetback&&(t.push({id:"side-setback-violation",ruleId:"min-side-setback",ruleName:"Side Setback",category:"setback",severity:"error",message:`Side setback of ${a.side}ft is less than required ${s.sideSetback}ft`,currentValue:a.side,requiredValue:s.sideSetback,unit:"feet"}),r.push("side")),{status:r.length===0?"compliant":"violation",currentValue:Math.min(a.front,a.rear,a.side),requiredValue:Math.min(s.frontSetback,s.rearSetback,s.sideSetback),utilizationPercentage:100,message:r.length===0?"All setbacks meet requirements":`Setback violations: ${r.join(", ")}`}}function lr(a,s,t){const r=Math.ceil((a.units||0)*s.parkingRatio),n=a.parkingSpaces||0;return n<r&&t.push({id:"parking-violation",ruleId:"min-parking",ruleName:"Parking Requirement",category:"parking",severity:"error",message:`${n} parking spaces provided, ${r} required`,currentValue:n,requiredValue:r,unit:"spaces"}),{status:n>=r?"compliant":"violation",currentValue:n,requiredValue:r,utilizationPercentage:r>0?n/r*100:100,message:`${n} spaces provided, ${r} required`}}function cr(a,s,t,r){const n=(a.units||0)/s,i=t.densityLimit;return n>i&&r.push({id:"density-violation",ruleId:"max-density",ruleName:"Density Limit",category:"density",severity:"error",message:`Density of ${n.toFixed(1)} units/acre exceeds maximum of ${i} units/acre`,currentValue:n,requiredValue:i,unit:"units/acre"}),{status:n<=i?"compliant":"violation",currentValue:n,requiredValue:i,utilizationPercentage:n/i*100,message:`${n.toFixed(1)} units/acre, max ${i} units/acre`}}function or(a){return{RS5:2,"RS7.5":2,RS10:2,RS15:2,RS20:2,RS30:2,RS40:2,R6:1.5,R8:1.2,R10:1,R15:1,R20:1,R30:1,RM2:1.2,RM4:1,RM6:1,RM9:.8,RM15:.8,RM20:.5,RM40:.5,RM60:.5,RM80:.5}[a]||1.2}function dr(a){return{RS5:8.7,"RS7.5":5.8,RS10:4.4,RS15:2.9,RS20:2.2,RS30:1.5,RS40:1.1,R6:6,R8:8,R10:10,R15:15,R20:20,R30:30,RM2:2,RM4:4,RM6:6,RM9:9,RM15:15,RM20:20,RM40:40,RM60:60,RM80:80}[a]||20}function qs({projectId:a,parcelId:s,onClose:t}){const{user:r}=Fs(),[n,i]=o.useState([]),[x,l]=o.useState(""),[m,h]=o.useState(!1),[d,c]=o.useState(!1),u=o.useRef(null),g=o.useRef(null),v=n.filter(p=>!p.read_by.includes(r.id)&&p.user_id!==r.id).length;o.useEffect(()=>{w()},[a,s]),o.useEffect(()=>{if(!q)return;const p=s?`project_${a}_parcel_${s}`:`project_${a}`,_=q.channel(p).on("postgres_changes",{event:"INSERT",schema:"public",table:"project_comments",filter:`project_id=eq.${a}${s?` AND parcel_id=eq.${s}`:""}`},S=>{const C=S.new;i(A=>[...A,C]),C.user_id!==r.id&&c(!0),setTimeout(()=>{g.current?.scrollIntoView({behavior:"smooth"})},100)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"project_comments"},S=>{const C=S.new;i(A=>A.map(k=>k.id===C.id?C:k))}).subscribe();return u.current=_,()=>{_.unsubscribe()}},[a,s,r.id]);const w=async()=>{if(q)try{let p=q.from("project_comments").select("*").eq("project_id",a).order("created_at",{ascending:!0});s&&(p=p.eq("parcel_id",s));const{data:_,error:S}=await p;if(S)throw S;i(_||[])}catch(p){console.error("Error loading comments:",p)}},y=async()=>{if(!(!x.trim()||!q)){h(!0);try{const{error:p}=await q.from("project_comments").insert({project_id:a,parcel_id:s||null,user_id:r.id,user_name:r.name,message:x.trim(),read_by:[r.id]});if(p)throw p;l("")}catch(p){console.error("Error sending comment:",p)}finally{h(!1)}}},j=async p=>{if(!q)return;const _=n.find(S=>S.id===p);if(!(!_||_.read_by.includes(r.id)))try{const{error:S}=await q.from("project_comments").update({read_by:[..._.read_by,r.id]}).eq("id",p);if(S)throw S}catch(S){console.error("Error marking comment as read:",S)}},b=p=>{p.key==="Enter"&&(p.ctrlKey||p.metaKey)&&y()},N=p=>{const _=new Date(p),C=(new Date().getTime()-_.getTime())/(1e3*60*60);return C<1?`${Math.floor(C*60)}m ago`:C<24?`${Math.floor(C)}h ago`:_.toLocaleDateString()};return d?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-lg w-80 max-h-96 flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 flex items-center space-x-2",children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Comments"}),v>0&&e.jsx("div",{className:"w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center",children:v>9?"9+":v})]}),e.jsx("button",{onClick:t||(()=>c(!1)),className:"text-gray-400 hover:text-gray-600",children:"×"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-3",children:[n.length===0?e.jsxs("div",{className:"text-center text-gray-500 py-6",children:[e.jsx(Oe,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No comments yet"}),e.jsx("p",{className:"text-xs",children:"Start the conversation"})]}):n.map(p=>{const _=!p.read_by.includes(r.id)&&p.user_id!==r.id;return e.jsxs("div",{className:`p-2 rounded-lg ${p.user_id===r.id?"bg-blue-50 ml-4":"bg-gray-50 mr-4"} ${_?"ring-2 ring-blue-200":""}`,onClick:()=>_&&j(p.id),children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(_s,{className:"w-3 h-3 text-gray-500"}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:p.user_name}),e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-500",children:[e.jsx($e,{className:"w-3 h-3"}),e.jsx("span",{children:N(p.created_at)}),_&&e.jsx(vt,{className:"w-2 h-2 fill-blue-500 text-blue-500"})]})]}),e.jsx("p",{className:"text-sm text-gray-900",children:p.message})]},p.id)}),e.jsx("div",{ref:g})]}),e.jsxs("div",{className:"p-3 border-t border-gray-200",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:x,onChange:p=>l(p.target.value),onKeyPress:b,placeholder:"Add a comment...",className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus-ring",disabled:m}),e.jsx("button",{onClick:y,disabled:!x.trim()||m,className:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:m?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(Nt,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Press Ctrl+Enter to send"})]})]}):e.jsxs("button",{onClick:()=>c(!0),className:"relative flex items-center space-x-1 px-2 py-1 text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-full transition-colors",children:[e.jsx(Oe,{className:"w-3 h-3"}),e.jsx("span",{children:"Comments"}),v>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center",children:v>9?"9+":v})]})}function mr(){const{activeProjectId:a,activeProjectName:s,parcelIds:t,count:r,hasSelection:n}=Ve(),{removeParcel:i,isLoading:x,error:l}=ie(),[m,h]=D.useState([]),[d,c]=D.useState(!1),{project:u,calculateMassing:g}=Ge(),[v,w]=D.useState(""),[y,j]=D.useState(!1),[b,N]=D.useState("summary"),p=g;nr(u?.parcels||[],p,u?.siteplanConfig||{targetFAR:2,targetHeight:45,buildingSetbacks:{front:25,rear:20,side:10},targetCoverage:40,buildingType:"residential",unitsPerAcre:20,parkingRatio:1.2}),D.useEffect(()=>{if(!a||t.length===0){h([]);return}(async()=>{if(q){c(!0);try{const{data:M,error:f}=await q.from("parcels").select("ogc_fid, parcelnumb, address, deededacreage, gisacre, sqft, zoning, landval, parval").in("ogc_fid",t.map(R=>parseInt(R)).filter(R=>!isNaN(R))).limit(100);if(f)throw f;h(M||[])}catch(M){console.error("Error loading parcel details:",M),h([])}finally{c(!1)}}})()},[a,t]);const _=k=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(k),S=k=>new Intl.NumberFormat("en-US").format(Math.round(k)),C=async k=>{await i(k)},A=n;return a?e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900","data-testid":"active-project-title",children:s}),x&&e.jsxs("div",{className:"flex items-center space-x-2","data-testid":"sync-indicator",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Syncing..."})]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[r," parcel",r!==1?"s":""," selected"]}),l&&e.jsx("div",{className:`mt-2 p-2 rounded text-sm ${l.includes("added")||l.includes("success")?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,"data-testid":"toast",children:l}),e.jsxs("div",{className:"flex mt-3 bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>N("summary"),className:`flex-1 px-3 py-1 text-xs font-medium rounded-md transition-colors ${b==="summary"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,children:"Summary"}),e.jsx("button",{onClick:()=>N("siteplan"),className:`flex-1 px-3 py-1 text-xs font-medium rounded-md transition-colors ${b==="siteplan"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,children:"Site Plan"}),e.jsx("button",{onClick:()=>N("financial"),className:`flex-1 px-3 py-1 text-xs font-medium rounded-md transition-colors ${b==="financial"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,children:"Financial"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:[b==="summary"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center space-x-2",children:[e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{children:"Selected Parcels"})]}),d&&e.jsx(ar,{count:3}),!d&&t.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(je,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No parcels selected"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Click parcels on the map to add them to this project"})]}),!d&&m.length>0&&e.jsx("div",{className:"space-y-2",children:m.map(k=>e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:k.address||"Address not available"}),e.jsxs("p",{className:"text-xs text-gray-600",children:["#",k.parcelnumb]}),e.jsxs("div",{className:"mt-1 grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Size:"}),e.jsx("span",{className:"font-medium ml-1",children:(k.deededacreage||k.gisacre)>1?`${(k.deededacreage||k.gisacre||0).toFixed(2)} ac`:`${S(k.sqft||0)} sf`})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Zoning:"}),e.jsx("span",{className:"font-medium ml-1",children:k.zoning||"N/A"})]})]}),k.landval&&e.jsxs("div",{className:"mt-1 text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Value:"}),e.jsx("span",{className:"font-medium ml-1",children:_(k.landval)})]})]}),e.jsxs("div",{className:"ml-2 flex items-center space-x-1",children:[e.jsx(qs,{projectId:a,parcelId:String(k.ogc_fid)}),e.jsx(Pe,{roles:["analyst"],children:e.jsx("button",{onClick:()=>C(String(k.ogc_fid)),disabled:x,className:"p-1 text-gray-400 hover:text-red-600 rounded disabled:opacity-50","data-testid":`remove-parcel-${k.ogc_fid}`,children:e.jsx(G,{className:"w-4 h-4"})})})]})]})},k.ogc_fid))})]})}),b==="siteplan"&&e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(W,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Site plan configuration"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Add parcels to configure site planning options"})]})}),b==="financial"&&e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Y,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Financial analysis"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Add parcels to view financial projections"})]})})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2 flex-shrink-0 bg-white",children:[e.jsxs("div",{className:"text-center text-sm text-gray-600 mb-2",children:["Project: ",s," (",r," parcels)"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(Pe,{roles:["analyst"],children:e.jsxs("button",{disabled:!A,className:"flex items-center justify-center space-x-1 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:bg-gray-100 disabled:cursor-not-allowed","data-testid":"save-project",children:[e.jsx(Fe,{className:"w-4 h-4"}),e.jsx("span",{children:"Save"})]})}),e.jsx(Pe,{roles:["manager"],children:e.jsxs("button",{className:"flex items-center justify-center space-x-1 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors","data-testid":"share-project",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{children:"Share"})]})}),e.jsx(Pe,{roles:["analyst"],children:e.jsxs("button",{disabled:!A,className:"flex items-center justify-center space-x-1 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:bg-gray-100 disabled:cursor-not-allowed","data-testid":"export-project",children:[e.jsx(Te,{className:"w-4 h-4"}),e.jsx("span",{children:"Export"})]})})]}),e.jsx(Pe,{roles:["analyst"],children:e.jsx("button",{disabled:!A,className:"w-full bg-green-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-green-700 transition-colors text-sm disabled:bg-gray-300 disabled:cursor-not-allowed","data-testid":"generate-analysis",children:"→ Generate Full Analysis"})})]})]})]}):e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(W,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Active Project"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4","data-testid":"no-project-message",children:"Select a project from the header dropdown to start adding parcels from the map."}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsx("p",{className:"text-sm text-blue-700","data-testid":"select-project-hint",children:'💡 Click the "Project" dropdown in the header to select or create a project'})})]})})}function xr(){const{project:a,calculateMassing:s}=Ge(),t=s,{strategy:r,setStrategy:n,assumptions:i,updateAssumption:x,resetToDefaults:l,results:m}=Ts(a,t),[h,d]=D.useState("assumptions"),[c,u]=D.useState(!1),g=j=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(j),v=(j,b=1)=>`${j.toFixed(b)}%`,w=j=>j>=20?"text-green-600":j>=15?"text-blue-600":j>=10?"text-yellow-600":"text-red-600",y=j=>j>=20?"Excellent":j>=15?"Good":j>=10?"Marginal":"Poor";return!a||!t?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Y,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Underwriting Model"}),e.jsx("p",{className:"text-sm text-gray-600","data-testid":"underwriting-empty-state",children:"Create a project and add parcels to start financial analysis."})]})}):e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 flex items-center space-x-2",children:[e.jsx(Y,{className:"w-5 h-5"}),e.jsx("span",{children:"Underwriting"})]}),e.jsx("button",{onClick:l,className:"p-1 text-gray-400 hover:text-blue-600 rounded",title:"Reset to defaults","data-testid":"reset-defaults",children:e.jsx(ks,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1 mb-3",children:[e.jsxs("button",{onClick:()=>n("for-sale"),className:`flex-1 flex items-center justify-center space-x-1 px-3 py-2 text-sm font-medium rounded-md transition-colors ${r==="for-sale"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,"data-testid":"strategy-for-sale",children:[e.jsx(Ns,{className:"w-4 h-4"}),e.jsx("span",{children:"For-Sale"})]}),e.jsxs("button",{onClick:()=>n("rental"),className:`flex-1 flex items-center justify-center space-x-1 px-3 py-2 text-sm font-medium rounded-md transition-colors ${r==="rental"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,"data-testid":"strategy-rental",children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{children:"Rental"})]})]}),e.jsxs("div",{className:"flex bg-gray-50 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>d("assumptions"),className:`flex-1 px-2 py-1 text-xs font-medium rounded transition-colors ${h==="assumptions"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,children:"Inputs"}),e.jsx("button",{onClick:()=>d("results"),className:`flex-1 px-2 py-1 text-xs font-medium rounded transition-colors ${h==="results"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,children:"Results"}),e.jsx("button",{onClick:()=>d("sensitivity"),className:`flex-1 px-2 py-1 text-xs font-medium rounded transition-colors ${h==="sensitivity"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,children:"Analysis"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:[m&&e.jsx("div",{className:"p-4 bg-blue-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Current IRR:"}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:`text-lg font-bold ${w(r==="for-sale"?m.forSale.irr:m.rental.irr)}`,children:v(r==="for-sale"?m.forSale.irr:m.rental.irr)}),e.jsx("p",{className:"text-xs text-gray-600",children:y(r==="for-sale"?m.forSale.irr:m.rental.irr)})]})]})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hard Cost per SF"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"$"}),e.jsx("input",{type:"number",value:i.hardCostPerSF,onChange:j=>x("hardCostPerSF",parseFloat(j.target.value)),className:"flex-1 text-sm border border-gray-300 rounded px-2 py-1","data-testid":"hard-cost-input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Interest Rate %"}),e.jsx("input",{type:"number",step:"0.1",value:i.interestRate,onChange:j=>x("interestRate",parseFloat(j.target.value)),className:"w-full text-sm border border-gray-300 rounded px-2 py-1","data-testid":"interest-rate-input"})]}),r==="for-sale"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sale Price per Unit"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"$"}),e.jsx("input",{type:"number",value:i.salePricePerUnit,onChange:j=>x("salePricePerUnit",parseFloat(j.target.value)),className:"flex-1 text-sm border border-gray-300 rounded px-2 py-1","data-testid":"sale-price-input"})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rent per Unit/Month"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"$"}),e.jsx("input",{type:"number",value:i.rentPerUnitPerMonth,onChange:j=>x("rentPerUnitPerMonth",parseFloat(j.target.value)),className:"flex-1 text-sm border border-gray-300 rounded px-2 py-1","data-testid":"rent-per-unit-input"})]})]}),m&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Key Results"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total Development Cost:"}),e.jsx("span",{className:"font-semibold",children:g(m.totalDevelopmentCost)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Equity Required:"}),e.jsx("span",{className:"font-semibold",children:g(m.equityRequired)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"IRR:"}),e.jsx("span",{className:`font-semibold ${w(r==="for-sale"?m.forSale.irr:m.rental.irr)}`,children:v(r==="for-sale"?m.forSale.irr:m.rental.irr)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Cash-on-Cash:"}),e.jsx("span",{className:"font-semibold",children:v(r==="for-sale"?m.forSale.cashOnCash:m.rental.cashOnCash)})]})]})]})]})})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2 flex-shrink-0 bg-white",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>n(r==="for-sale"?"rental":"for-sale"),className:"flex items-center justify-center space-x-1 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors","data-testid":"compare-strategies",children:[e.jsx(wt,{className:"w-4 h-4"}),e.jsx("span",{children:"Compare"})]}),e.jsxs("button",{className:"flex items-center justify-center space-x-1 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors","data-testid":"generate-report",children:[e.jsx(me,{className:"w-4 h-4"}),e.jsx("span",{children:"Report"})]})]}),m&&e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-lg font-bold ${w(r==="for-sale"?m.forSale.irr:m.rental.irr)}`,children:[v(r==="for-sale"?m.forSale.irr:m.rental.irr)," IRR"]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[g(m.equityRequired)," equity required"]})]})]})]})}function ur({forSaleResults:a,rentalResults:s,project:t,massing:r}){const[n,i]=o.useState("side-by-side"),x=c=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(c),l=(c,u=1)=>`${c.toFixed(u)}%`,m=(c,u)=>{if(u===0)return{delta:0,percentage:0};const g=c-u,v=g/u*100;return{delta:g,percentage:v}},h=({delta:c,percentage:u})=>{const g=c>0,v=Math.abs(u)<1;return e.jsxs("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${v?"bg-gray-100 text-gray-600":g?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[g?"+":"",l(u,0),!v&&(g?e.jsx(me,{className:"w-3 h-3 ml-1"}):e.jsx(_t,{className:"w-3 h-3 ml-1"}))]})},d=({label:c,forSaleValue:u,rentalValue:g,formatter:v=x,icon:w})=>{const{delta:y,percentage:j}=m(u,g);return e.jsxs("div",{className:"grid grid-cols-4 gap-3 py-3 border-b border-gray-100 items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm font-medium text-gray-700",children:[w,e.jsx("span",{children:c})]}),e.jsx("div",{className:"text-sm text-right font-medium text-green-700",children:v(u)}),e.jsx("div",{className:"text-sm text-right font-medium text-blue-700",children:v(g)}),e.jsx("div",{className:"text-right",children:e.jsx(h,{delta:y,percentage:j})})]})};return!a||!s||!t||!r?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(B,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Scenario Comparison"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Add parcels and run both for-sale and rental analysis to compare scenarios"})]}):e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 flex items-center space-x-2",children:[e.jsx(Je,{className:"w-5 h-5"}),e.jsx("span",{children:"Scenario Comparison"})]}),e.jsx("button",{onClick:()=>i(n==="side-by-side"?"overlay":"side-by-side"),className:"px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded-md transition-colors",children:n==="side-by-side"?"Overlay View":"Side by Side"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.name," • ",r.units||0," units"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-3 py-2 border-b-2 border-gray-200 mb-4",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:"Metric"}),e.jsx("div",{className:"text-sm font-semibold text-green-700 text-right",children:"For-Sale"}),e.jsx("div",{className:"text-sm font-semibold text-blue-700 text-right",children:"Rental"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900 text-right",children:"Difference"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center space-x-2",children:[e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{children:"Investment Returns"})]}),e.jsx(d,{label:"IRR",forSaleValue:a.forSale.irr,rentalValue:s.rental.irr,formatter:l,icon:e.jsx(me,{className:"w-4 h-4 text-green-600"})}),e.jsx(d,{label:"Cash-on-Cash",forSaleValue:a.forSale.cashOnCash,rentalValue:s.rental.cashOnCash,formatter:l,icon:e.jsx(le,{className:"w-4 h-4 text-blue-600"})}),e.jsx(d,{label:"Total Return",forSaleValue:a.forSale.profitBeforeFinancing,rentalValue:s.rental.totalReturn,icon:e.jsx(Y,{className:"w-4 h-4 text-purple-600"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Development Costs"}),e.jsx(d,{label:"Total Dev Cost",forSaleValue:a.totalDevelopmentCost,rentalValue:s.totalDevelopmentCost}),e.jsx(d,{label:"Equity Required",forSaleValue:a.equityRequired,rentalValue:s.equityRequired}),e.jsx(d,{label:"Loan Amount",forSaleValue:a.loanAmount,rentalValue:s.loanAmount})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Revenue Analysis"}),e.jsx(d,{label:"Gross Revenue",forSaleValue:a.forSale.grossRevenue,rentalValue:s.rental.yearOneNOI*20}),e.jsx(d,{label:"Net Revenue",forSaleValue:a.forSale.netRevenue,rentalValue:s.rental.stabilizedNOI*15})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Risk & Sensitivity"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-700 mb-2",children:"For-Sale Strategy"}),e.jsxs("ul",{className:"space-y-1 text-gray-600",children:[e.jsx("li",{children:"• Market timing risk"}),e.jsx("li",{children:"• Construction delays"}),e.jsx("li",{children:"• Sales velocity risk"}),e.jsx("li",{children:"• Interest rate exposure"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-700 mb-2",children:"Rental Strategy"}),e.jsxs("ul",{className:"space-y-1 text-gray-600",children:[e.jsx("li",{children:"• Vacancy risk"}),e.jsx("li",{children:"• Operating cost inflation"}),e.jsx("li",{children:"• Cap rate expansion"}),e.jsx("li",{children:"• Long-term hold risk"})]})]})]})]})]})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2 flex-shrink-0 bg-white",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{className:"bg-green-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-green-700 transition-colors text-sm",children:"Choose For-Sale"}),e.jsx("button",{className:"bg-blue-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-blue-700 transition-colors text-sm",children:"Choose Rental"})]}),e.jsx("button",{className:"w-full border border-gray-300 text-gray-700 py-2 px-4 rounded-lg font-medium hover:bg-gray-50 transition-colors text-sm",children:"Export Comparison Report"})]})]})}function ps(){const{openDrawer:a,setDrawer:s,closeDrawer:t,isMobile:r}=K(),{project:n,calculateMassing:i}=Ge(),x=window.innerWidth<1024,l=D.useRef(null);return D.useEffect(()=>{if(a&&l.current){const m=l.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),h=m[0],d=m[m.length-1],c=u=>{u.key==="Tab"&&(u.shiftKey?document.activeElement===h&&(u.preventDefault(),d?.focus()):document.activeElement===d&&(u.preventDefault(),h?.focus()))};return document.addEventListener("keydown",c),h?.focus(),()=>document.removeEventListener("keydown",c)}},[a]),a?e.jsxs(e.Fragment,{children:[x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-20",onClick:t,style:{pointerEvents:"auto"}}),e.jsxs("div",{ref:l,className:`
          bg-white border-l border-gray-200 
          ${x?"fixed right-0 top-0 h-full w-full max-w-md z-30 transform transition-transform duration-300 ease-in-out":"relative w-96 h-full"}
        `,role:"dialog","aria-modal":"true","aria-labelledby":"drawer-title","data-testid":"right-drawer",children:[e.jsxs("div",{className:"border-b border-gray-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsx("h2",{id:"drawer-title",className:"text-lg font-bold text-gray-900",children:"Project Analysis"}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors focus-ring","aria-label":"Close drawer","data-testid":"drawer-close",children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>s("PROJECT"),className:`flex-1 flex items-center justify-center space-x-2 px-4 py-3 text-sm font-medium transition-colors focus-ring ${a==="PROJECT"?"border-b-2 border-blue-600 text-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,"aria-current":a==="PROJECT"?"page":void 0,"data-testid":"project-tab",children:[e.jsx(W,{className:"w-4 h-4"}),e.jsx("span",{children:"Parcels"})]}),e.jsxs("button",{onClick:()=>s("UNDERWRITING"),className:`flex-1 flex items-center justify-center space-x-2 px-4 py-3 text-sm font-medium transition-colors focus-ring ${a==="UNDERWRITING"?"border-b-2 border-blue-600 text-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,"aria-current":a==="UNDERWRITING"?"page":void 0,"data-testid":"underwriting-tab",children:[e.jsx(Y,{className:"w-4 h-4"}),e.jsx("span",{children:"Underwriting"})]}),e.jsxs("button",{onClick:()=>s("SCENARIO_COMPARE"),className:`flex-1 flex items-center justify-center space-x-2 px-4 py-3 text-sm font-medium transition-colors focus-ring ${a==="SCENARIO_COMPARE"?"border-b-2 border-purple-600 text-purple-600 bg-purple-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,"aria-current":a==="SCENARIO_COMPARE"?"page":void 0,"data-testid":"scenario-compare-tab",children:[e.jsx(Je,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Compare"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[a==="PROJECT"&&e.jsx(mr,{}),a==="UNDERWRITING"&&e.jsx(xr,{}),a==="SCENARIO_COMPARE"&&e.jsx(ur,{forSaleResults:null,rentalResults:null,project:n,massing:i})]})]})]}):null}function hr(){const{filterModalOpen:a,setFilterModal:s,zoningFilters:t,setZoningFilters:r}=K(),[n,i]=D.useState({priceRange:{min:"",max:""},sizeRange:{min:"",max:""},zoning:t.activeZones,forSale:!1,yearBuilt:{min:"",max:""},address:""}),x=["RS5","RS7.5","RS10","RS15","RS20","RS30","RS40","R6","R8","R10","R15","R20","R30","RM2","RM4","RM6","RM9","RM15","RM20","RM40","RM60","RM80","CN","CR","CS","CA","CL","CC","MUN","MUL","MUG"],l=d=>{i(c=>({...c,zoning:c.zoning.includes(d)?c.zoning.filter(u=>u!==d):[...c.zoning,d]}))},m=()=>{i({priceRange:{min:"",max:""},sizeRange:{min:"",max:""},zoning:[],forSale:!1,yearBuilt:{min:"",max:""},address:""})},h=()=>{r({activeZones:n.zoning}),setTimeout(()=>{const d=new CustomEvent("forceMapReload",{detail:{zoningFilters:n.zoning}});document.dispatchEvent(d)},50),console.log("Applying filters:",n),s(!1)};return e.jsx(xe,{show:a,as:D.Fragment,children:e.jsxs(be,{as:"div",className:"relative z-30",onClose:()=>s(!1),children:[e.jsx(xe.Child,{as:D.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsx(xe.Child,{as:D.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(be.Panel,{className:"w-full max-w-2xl transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all","data-testid":"filter-modal",children:[e.jsxs(be.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ys,{className:"w-5 h-5"}),e.jsx("span",{children:"Advanced Filters"})]}),e.jsx("button",{onClick:()=>s(!1),className:"p-1 hover:bg-gray-100 rounded-full transition-colors focus-ring","data-testid":"filter-modal-close",children:e.jsx(G,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mt-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(je,{className:"w-4 h-4 inline mr-1"}),"Address or Location"]}),e.jsx("input",{type:"text",value:n.address,onChange:d=>i(c=>({...c,address:d.target.value})),placeholder:"Search by address, neighborhood, or parcel ID...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus-ring","data-testid":"address-search"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(le,{className:"w-4 h-4 inline mr-1"}),"Price Range"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"number",value:n.priceRange.min,onChange:d=>i(c=>({...c,priceRange:{...c.priceRange,min:d.target.value}})),placeholder:"Min price",className:"px-3 py-2 border border-gray-300 rounded-lg focus-ring","data-testid":"min-price"}),e.jsx("input",{type:"number",value:n.priceRange.max,onChange:d=>i(c=>({...c,priceRange:{...c.priceRange,max:d.target.value}})),placeholder:"Max price",className:"px-3 py-2 border border-gray-300 rounded-lg focus-ring","data-testid":"max-price"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lot Size (sq ft)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"number",value:n.sizeRange.min,onChange:d=>i(c=>({...c,sizeRange:{...c.sizeRange,min:d.target.value}})),placeholder:"Min sq ft",className:"px-3 py-2 border border-gray-300 rounded-lg focus-ring"}),e.jsx("input",{type:"number",value:n.sizeRange.max,onChange:d=>i(c=>({...c,sizeRange:{...c.sizeRange,max:d.target.value}})),placeholder:"Max sq ft",className:"px-3 py-2 border border-gray-300 rounded-lg focus-ring"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(St,{className:"w-4 h-4 inline mr-1"}),"Year Built"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"number",value:n.yearBuilt.min,onChange:d=>i(c=>({...c,yearBuilt:{...c.yearBuilt,min:d.target.value}})),placeholder:"From year",className:"px-3 py-2 border border-gray-300 rounded-lg focus-ring"}),e.jsx("input",{type:"number",value:n.yearBuilt.max,onChange:d=>i(c=>({...c,yearBuilt:{...c.yearBuilt,max:d.target.value}})),placeholder:"To year",className:"px-3 py-2 border border-gray-300 rounded-lg focus-ring"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(ce,{className:"w-4 h-4 inline mr-1"}),"Zoning Types"]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:x.map(d=>e.jsx("button",{onClick:()=>l(d),className:`px-3 py-2 text-sm rounded-lg border transition-colors focus-ring ${n.zoning.includes(d)?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,"data-testid":`zoning-${d}`,children:d},d))})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:n.forSale,onChange:d=>i(c=>({...c,forSale:d.target.checked})),className:"rounded focus-ring","data-testid":"for-sale-toggle"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"For Sale Only"})]})})]}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx("button",{onClick:m,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus-ring","data-testid":"reset-filters",children:"Reset Filters"}),e.jsxs("div",{className:"space-x-3",children:[e.jsx("button",{onClick:()=>s(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus-ring","data-testid":"cancel-filters",children:"Cancel"}),e.jsx("button",{onClick:h,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus-ring","data-testid":"apply-filters",children:"Apply Filters"})]})]})]})})})})]})})}function gr({isOpen:a,onClose:s}){const[t,r]=o.useState(""),[n,i]=o.useState([]),[x,l]=o.useState(!1),[m,h]=o.useState([]),d=o.useRef(null);o.useEffect(()=>{c()},[]),o.useEffect(()=>{a&&d.current&&setTimeout(()=>d.current?.focus(),100)},[a]),o.useEffect(()=>{if(t.length<2){i(u());return}const j=setTimeout(()=>{g(t)},300);return()=>clearTimeout(j)},[t]);const c=()=>{const j=u();i(j);try{const b=localStorage.getItem("command-palette-recent");if(b){const N=JSON.parse(b);h(N.slice(0,5))}}catch(b){console.warn("Failed to load recent items:",b)}},u=()=>[{id:"nav-map",title:"Go to Map View",category:"navigation",icon:e.jsx(je,{className:"w-4 h-4"}),action:()=>{s()},keyboard:"⌘1"},{id:"nav-projects",title:"Go to Projects",category:"navigation",icon:e.jsx(W,{className:"w-4 h-4"}),action:()=>{s()},keyboard:"⌘2"},{id:"nav-analysis",title:"Go to Analysis",category:"navigation",icon:e.jsx(Y,{className:"w-4 h-4"}),action:()=>{s()},keyboard:"⌘3"},{id:"action-create-project",title:"Create New Project",category:"action",icon:e.jsx(W,{className:"w-4 h-4"}),action:()=>{s()}},{id:"action-export-pdf",title:"Export Current Project as PDF",category:"action",icon:e.jsx(qe,{className:"w-4 h-4"}),action:()=>{s()}},{id:"action-optimize-massing",title:"Optimize Building Massing",category:"action",icon:e.jsx(oe,{className:"w-4 h-4"}),action:()=>{s()}}],g=async j=>{l(!0);try{const b=[];if(q){const{data:p}=await q.from("parcels").select("ogc_fid, parcelnumb, address, zoning, landval").or(`address.ilike.%${j}%,parcelnumb.ilike.%${j}%`).limit(10);p&&p.forEach(S=>{b.push({id:`parcel-${S.ogc_fid}`,title:S.address||"Unknown Address",subtitle:`${S.parcelnumb} • ${S.zoning}`,category:"parcel",icon:e.jsx(je,{className:"w-4 h-4"}),action:()=>{s()}})});const{data:_}=await q.from("project_parcels").select("project_id").limit(5);j.toLowerCase().includes("demo")&&b.push({id:"project-demo",title:"Demo Project",subtitle:"5 parcels • Nashville",category:"project",icon:e.jsx(W,{className:"w-4 h-4"}),action:()=>{s()}})}const N=u().filter(p=>p.title.toLowerCase().includes(j.toLowerCase())||p.category==="action");b.push(...N),i(b)}catch(b){console.error("Search error:",b),i(u())}finally{l(!1)}},v=j=>{const b=[j,...m.filter(N=>N.id!==j.id)].slice(0,5);h(b);try{localStorage.setItem("command-palette-recent",JSON.stringify(b))}catch(N){console.warn("Failed to save recent items:",N)}j.action()},w=j=>{switch(j){case"parcel":return e.jsx(je,{className:"w-4 h-4 text-blue-600"});case"project":return e.jsx(W,{className:"w-4 h-4 text-green-600"});case"user":return e.jsx(Xe,{className:"w-4 h-4 text-purple-600"});case"action":return e.jsx(oe,{className:"w-4 h-4 text-orange-600"});case"navigation":return e.jsx(re,{className:"w-4 h-4 text-gray-600"});default:return e.jsx(Re,{className:"w-4 h-4 text-gray-600"})}},y=n.reduce((j,b)=>(j[b.category]||(j[b.category]=[]),j[b.category].push(b),j),{});return e.jsx(xe,{show:a,as:D.Fragment,children:e.jsxs(be,{as:"div",className:"relative z-50",onClose:s,children:[e.jsx(xe.Child,{as:D.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-start justify-center p-4 pt-[10vh]",children:e.jsx(xe.Child,{as:D.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(be.Panel,{className:"w-full max-w-2xl transform overflow-hidden rounded-2xl bg-white shadow-xl transition-all",children:[e.jsxs(De,{value:null,onChange:v,children:[e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center px-4 py-4 border-b border-gray-200",children:[e.jsx(Re,{className:"w-5 h-5 text-gray-400 mr-3"}),e.jsx(De.Input,{ref:d,className:"flex-1 bg-transparent outline-none text-lg placeholder-gray-500",placeholder:"Search parcels, projects, or run commands...",value:t,onChange:j=>r(j.target.value)}),x&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"})]})}),e.jsxs(De.Options,{className:"max-h-96 overflow-y-auto py-2",static:!0,children:[t.length===0&&m.length>0&&e.jsxs("div",{className:"px-4 pb-2",children:[e.jsxs("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 flex items-center space-x-1",children:[e.jsx($e,{className:"w-3 h-3"}),e.jsx("span",{children:"Recent"})]}),m.map(j=>e.jsx(fs,{item:j},`recent-${j.id}`))]}),Object.entries(y).map(([j,b])=>e.jsxs("div",{className:"px-4 pb-2",children:[e.jsxs("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 flex items-center space-x-1",children:[w(j),e.jsx("span",{children:j}),e.jsx("span",{className:"ml-1 bg-gray-200 text-gray-700 px-1 rounded text-xs",children:b.length})]}),b.map(N=>e.jsx(fs,{item:N},N.id))]},j)),n.length===0&&t.length>0&&!x&&e.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[e.jsx(Re,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsxs("p",{className:"text-sm",children:['No results found for "',t,'"']}),e.jsx("p",{className:"text-xs mt-1",children:"Try searching for addresses, parcel numbers, or project names"})]})]})]}),e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 text-xs text-gray-600",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 rounded",children:"↑↓"}),e.jsx("span",{children:"Navigate"})]}),e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 rounded",children:"⏎"}),e.jsx("span",{children:"Select"})]})]}),e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 rounded",children:"Esc"}),e.jsx("span",{children:"Close"})]})]})})]})})})})]})})}function fs({item:a}){return e.jsx(De.Option,{value:a,className:({active:s})=>`flex items-center px-3 py-2 rounded-lg cursor-pointer transition-colors ${s?"bg-blue-50 text-blue-900":"text-gray-900"}`,children:({active:s})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`flex-shrink-0 mr-3 ${s?"text-blue-600":"text-gray-400"}`,children:a.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:a.title}),a.subtitle&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:a.subtitle})]}),a.keyboard&&e.jsx("div",{className:"flex-shrink-0 ml-3",children:e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded",children:a.keyboard})}),s&&e.jsx(re,{className:"w-4 h-4 text-blue-600 ml-2"})]})},a.id)}function pr({children:a}){const{openDrawer:s,isMobile:t}=K(),r=()=>t?s?"1fr 24rem":"1fr":s?"16rem 1fr 24rem":"16rem 1fr";return e.jsx("div",{className:"grid h-full w-full min-h-0",style:{gridTemplateColumns:r(),gridTemplateRows:"1fr"},children:a})}function fr({children:a}){return e.jsx("div",{className:"fixed inset-0 z-40 pointer-events-none",children:e.jsx("div",{className:"pointer-events-auto",children:a})})}function br(){return e.jsx("a",{href:"#main-content",className:"skip-link",children:"Skip to main content"})}function jr(){const[a,s]=o.useState(null),[t,r]=o.useState(!1),[n,i]=o.useState(!0),[x,l]=o.useState(!1),[m,h]=o.useState(!1),[d,c]=o.useState(!1),[u,g]=o.useState(!1),[v,w]=o.useState(!1),[y,j]=o.useState(!1),[b,N]=o.useState(!1),[p,_]=o.useState(!1),[S,C]=o.useState(!1),[A,k]=o.useState(!1),[M,f]=o.useState(!1),[R,E]=o.useState([]),{isMobile:O,setIsMobile:I,commandPaletteOpen:P,setCommandPalette:F}=K(),{commentsOpen:z,setCommentsOpen:T}=K(),{id:se}=ie();Rs();const{project:L,createProject:X}=Ge();D.useEffect(()=>{const V=()=>{I(window.innerWidth<1024)};return V(),window.addEventListener("resize",V),()=>window.removeEventListener("resize",V)},[I]),D.useEffect(()=>{const V=de=>{s(de.detail),r(!0)};return document.addEventListener("openParcelDrawer",V),()=>document.removeEventListener("openParcelDrawer",V)},[]);const J=V=>{if(!V||!V.ogc_fid||!V.geometry){console.warn("Invalid parcel data received:",V);return}const de=String(V.ogc_fid);if(de==="unknown"||de.trim()===""){console.warn("Invalid parcel ID:",V.ogc_fid);return}s(V),r(!0)},$=()=>{r(!1),s(null)},te=async V=>{const{addParcel:de}=ie.getState();await de(String(V.ogc_fid||V.id),V),j(!0),s(V)},U=async V=>{const de=`Project - ${V.address||"New Development"}`,ze=X(de),{set:st,addParcel:tt}=ie.getState();st(ze.id,ze.name),await tt(String(V.ogc_fid||V.id),V),r(!1),s(V),j(!0)},ae=()=>{i(!1)},ve=V=>{E(de=>de.filter(ze=>ze.id!==V))},_e=()=>{i(!1),l(!0)},H=()=>{h(!0)},Ne=()=>{h(!1)},we=()=>{c(!0)},es=()=>{c(!1)},Ls=()=>{g(!0)},$s=()=>{g(!1)},Vs=()=>{w(!0)},Gs=()=>{w(!1)},Bs=()=>{_(!0)},Ws=()=>{_(!1)},Hs=()=>{C(!0)},Js=()=>{C(!1)},Ys=()=>{k(!0)},Zs=()=>{k(!1)},Xs=()=>{j(!0)},Ks=()=>{j(!1)},Qs=()=>{N(!0)},et=()=>{N(!1)};return n&&!se?e.jsx(pa,{onGetStarted:_e,onViewDemo:ae}):e.jsx(Os,{children:e.jsxs("div",{className:"min-h-screen h-screen flex flex-col overflow-hidden bg-gray-50",children:[e.jsx(br,{}),e.jsx("header",{className:"flex-none",children:e.jsx(zt,{onOpenUnifiedWorkspace:H,onOpenProjectWorkflow:we,onOpenSimpleProjectManager:Ls,onOpenConnectedProjectWorkflow:Vs,onOpenUnifiedProjectWorkflow:Xs,onOpenRealUnderwritingWorkflow:Qs,onOpenWorkflowAudit:Bs,onOpenWorkflowConnectionTest:Hs,onOpenParcelAnalysisDemo:Ys})}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsxs(pr,{children:[e.jsx(tr,{}),e.jsx("main",{id:"main-content",className:"relative min-w-0 bg-white flex-1 min-h-0",role:"main","aria-label":"Interactive parcel map",children:e.jsx($t,{onParcelClick:J,activeProjectName:ie.getState().name})}),window.innerWidth>=1024?e.jsx(ps,{}):e.jsx(fr,{children:e.jsx(ps,{})})]})}),e.jsx(hr,{}),e.jsx(gr,{isOpen:P,onClose:()=>F(!1)}),se&&z&&e.jsx("div",{className:"fixed right-4 bottom-4 z-50",children:e.jsx(qs,{projectId:se,onClose:()=>T(!1)})}),e.jsx(ga,{parcel:a,isOpen:t,onClose:$,onAddToProject:te,hasActiveProject:!!L,onCreateProjectFromParcel:U}),e.jsx(fa,{isOpen:x,onClose:()=>l(!1),onComplete:()=>l(!1)}),e.jsx(ja,{isOpen:m,onClose:Ne,selectedParcel:a,onParcelSelect:s}),e.jsx(ya,{isOpen:d,onClose:es,selectedParcel:a,onParcelSelect:s}),e.jsx(va,{isOpen:u,onClose:$s,selectedParcel:a,onParcelSelect:s}),e.jsx(Na,{isOpen:v,onClose:Gs,selectedParcel:a,onParcelSelect:s}),e.jsx(Ra,{isOpen:y,onClose:Ks,selectedParcel:a,onParcelSelect:s}),e.jsx(Oa,{isOpen:b,onClose:et,selectedParcel:a,onParcelSelect:s}),e.jsx(Da,{isProjectWorkflowOpen:v,selectedParcel:a,onParcelSelect:s}),e.jsx(Ua,{isOpen:p,onClose:Ws}),e.jsx(Ta,{isOpen:S,onClose:Js}),A&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Parcel Analysis Demo"}),e.jsx("button",{onClick:Zs,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"×"})]}),e.jsx(Va,{})]})}),e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:R.map(V=>e.jsx(ba,{type:V.type,title:V.title,message:V.message,onClose:()=>ve(V.id)},V.id))})]})})}const yr=()=>{const a=document.createElement("link");a.rel="preload",a.href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css",a.as="style",document.head.appendChild(a)};yr();class vr extends D.Component{constructor(s){super(s),this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,t){console.error("App Error:",s,t)}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h1",{className:"text-xl font-bold text-gray-900 mb-2 text-center",children:"Application Error"}),e.jsx("p",{className:"text-gray-600 text-center mb-4",children:"Something went wrong loading the application."}),!1,e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full mt-4 bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors",children:"Reload Application"})]})}):this.props.children}}const bs=document.getElementById("root");bs?Ct(bs).render(e.jsx(o.StrictMode,{children:e.jsx(vr,{children:e.jsx(jr,{})})})):console.error("Root element not found");
