const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/supabase-vendor-BeTA44qk.js","assets/map-vendor-ChI9isOj.js","assets/map-vendor--d70tv_y.css"])))=>i.map(i=>d[i]);
var Aa=Object.defineProperty;var Ia=(r,t,s)=>t in r?Aa(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s;var nt=(r,t,s)=>Ia(r,typeof t!="symbol"?t+"":t,s);import{c as os,R as ee,r as x,j as e,L as Hs,z as lt,a as mt,S as ut,X as xe,U as za,C as $a,b as Zs,A as Ea,M as Da,d as Ce,e as _t,B as ge,f as ve,g as Is,h as cs,F as Js,i as et,k as qt,T as _e,l as Ks,P as Ae,D as Ee,m as Le,Z as Oe,n as Ie,o as ds,p as Bt,q as fe,s as ms,t as We,u as je,v as Gt,H as Qs,w as zt,x as ea,y as ht,E as Oa,G as Ua,I as Ta,J as qa,K as Ya,N as La,O as Ba,Q as Xa,V as xs,W as xt,Y as ta,_ as pt,$ as sa,a0 as Pe,a1 as Va,a2 as Ga,a3 as kt,a4 as aa,a5 as us,a6 as Xt,a7 as Wa,a8 as Vt,a9 as Ha,aa as Za,ab as Ja,ac as Ka,ad as na,ae as Qa,af as en,ag as tn,ah as sn,ai as an,aj as nn,ak as Yt,al as rn}from"./react-vendor-CtKMeUv4.js";import{m as ra}from"./map-vendor-ChI9isOj.js";import{c as ln,_ as ia}from"./supabase-vendor-BeTA44qk.js";import{p as on}from"./state-vendor-BPg30LFv.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(n){if(n.ep)return;n.ep=!0;const i=s(n);fetch(n.href,i)}})();const ke=os((r,t)=>({openDrawer:null,setDrawer:s=>r({openDrawer:s}),closeDrawer:()=>r({openDrawer:null}),selectedParcel:null,setSelectedParcel:s=>r({selectedParcel:s}),filterModalOpen:!1,setFilterModal:s=>r({filterModalOpen:s}),filterMode:"all",colorMode:"zoning",zoningFilters:{activeZones:[]},selectionMode:"single",selectedParcelIds:[],setFilterMode:s=>r({filterMode:s}),setColorMode:s=>r({colorMode:s}),setZoningFilters:s=>r({zoningFilters:s}),setSelectionMode:s=>r({selectionMode:s}),addSelectedParcel:s=>r(a=>({selectedParcelIds:[...a.selectedParcelIds.filter(n=>n!==s),s]})),removeSelectedParcel:s=>r(a=>({selectedParcelIds:a.selectedParcelIds.filter(n=>n!==s)})),clearSelectedParcels:()=>r({selectedParcelIds:[]}),leftNavOpen:!1,setLeftNavOpen:s=>r({leftNavOpen:s}),isMobile:!1,setIsMobile:s=>r({isMobile:s}),commandPaletteOpen:!1,setCommandPalette:s=>r({commandPaletteOpen:s}),commentsOpen:!1,setCommentsOpen:s=>r({commentsOpen:s})})),la=()=>{const{openDrawer:r,setDrawer:t,closeDrawer:s,setFilterModal:a,setCommandPalette:n,commandPaletteOpen:i}=ke();ee.useEffect(()=>{const o=l=>{if(l.key==="Escape"){i?n(!1):ke.getState().filterModalOpen?a(!1):s();return}if((l.metaKey||l.ctrlKey)&&l.key==="k"){l.preventDefault(),n(!0);return}if(l.key==="/"&&l.shiftKey&&l.code==="KeyC"){l.preventDefault(),ke.getState().setCommentsOpen(!0);return}l.ctrlKey&&l.shiftKey&&(l.key==="["?(l.preventDefault(),t(r==="PROJECT"?"UNDERWRITING":"PROJECT")):l.key==="]"&&(l.preventDefault(),t(r==="UNDERWRITING"?"PROJECT":"UNDERWRITING")))};return document.addEventListener("keydown",o),()=>document.removeEventListener("keydown",o)},[r,t,s,a,n,i])},cn=Object.freeze(Object.defineProperty({__proto__:null,useKeyboardShortcuts:la,useUIStore:ke},Symbol.toStringTag,{value:"Module"}));console.log("VITE_SUPABASE_URL:","https://okxrvetbzpoazrybhcqj.supabase.co");console.log("VITE_SUPABASE_ANON_KEY present:",!0);const dn="https://okxrvetbzpoazrybhcqj.supabase.co",mn="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9reHJ2ZXRienBvYXpyeWJoY3FqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY1ODkxNDcsImV4cCI6MjA2MjE2NTE0N30.diq6x_Kr5_GxPSHJT1gm54Jh2UTiGVrBNgxDmV3yMxI",Q=ln(dn,mn),De=os((r,t)=>({id:null,name:null,selectedParcels:new Set,isLoading:!1,error:null,set:(s,a=null)=>{const n=t().id;r({id:s,name:a,selectedParcels:new Set,error:null}),s&&Q&&s!==n&&t().loadProjectParcels(s)},addParcel:async(s,a)=>{const n=t();if(console.log("ðŸ” addParcel called:",{parcelId:s,parcelData:a,activeProjectId:n.id,currentParcels:n.selectedParcels.size}),!n.id){console.warn("No active project - cannot add parcel");return}const i=String(s);if(n.selectedParcels.has(i)){console.log("Parcel already exists in project"),r({error:"Parcel already in project"}),setTimeout(()=>r({error:null}),3e3);return}const o=n.selectedParcels.size===0,l=new Set([...n.selectedParcels,i]);console.log("ðŸ” Adding parcel to project:",{pid:i,newParcelsSize:l.size}),r({selectedParcels:l,isLoading:!0,error:null});try{if(Q){const{error:c}=await Q.from("project_parcels").upsert({project_id:n.id,parcel_id:i,added_at:new Date().toISOString(),parcel_data:a||null});if(c)throw console.error("Supabase error:",c),c}if(r({isLoading:!1}),console.log("âœ… Parcel successfully added to project:",{pid:i,projectId:n.id}),r({error:"Parcel added to project âœ“"}),setTimeout(()=>r({error:null}),2500),o&&typeof window<"u"){const{useUIStore:c}=await ia(async()=>{const{useUIStore:u}=await Promise.resolve().then(()=>cn);return{useUIStore:u}},void 0);c.getState().setDrawer("PROJECT")}}catch(c){console.error("Failed to add parcel:",c),r({selectedParcels:n.selectedParcels,isLoading:!1,error:`Failed to add parcel: ${c.message||"Unknown error"}`}),setTimeout(()=>r({error:null}),3e3)}},removeParcel:async s=>{const a=t();if(!a.id)return;const n=String(s),i=a.selectedParcels,o=new Set([...a.selectedParcels].filter(l=>l!==n));r({selectedParcels:o,isLoading:!0,error:null});try{if(Q){const{error:l}=await Q.from("project_parcels").delete().match({project_id:a.id,parcel_id:n});if(l)throw l}r({isLoading:!1}),r({error:"Parcel removed âœ“"}),setTimeout(()=>r({error:null}),2e3)}catch(l){console.error("Failed to remove parcel:",l),r({selectedParcels:i,isLoading:!1,error:`Failed to remove parcel: ${l.message||"Unknown error"}`}),setTimeout(()=>r({error:null}),4e3)}},clear:()=>{r({id:null,name:null,selectedParcels:new Set,isLoading:!1,error:null})},loadProjectParcels:async s=>{if(Q)try{r({isLoading:!0});const{data:a,error:n}=await Q.from("project_parcels").select("parcel_id").eq("project_id",s);if(n)throw n;const i=a?.map(o=>o.parcel_id)||[];r({selectedParcels:new Set(i),isLoading:!1})}catch{r({isLoading:!1,error:"Failed to load project parcels"}),setTimeout(()=>r({error:null}),3e3)}}})),xn=r=>Array.from(r);function Wt(){const{selectedParcels:r,id:t,name:s}=De(),a=x.useMemo(()=>r?r instanceof Set?xn(r):Array.isArray(r)?r.filter(i=>i!=null).map(String):typeof r=="object"?Object.values(r??{}).filter(i=>i!=null).map(String):[]:[],[r]),n=x.useMemo(()=>({count:a.length,hasSelection:a.length>0,isEmpty:a.length===0,isSingle:a.length===1,isMultiple:a.length>1,map:i=>a.map(i),filter:i=>a.filter(i),forEach:i=>a.forEach(i),find:i=>a.find(i),includes:i=>a.includes(i),first:a[0]||null,last:a[a.length-1]||null,reduce:(i,o)=>a.reduce(i,o)}),[a]);return{parcelIds:a,selectedParcels:new Set(a),activeProjectId:t,activeProjectName:s,...n,raw:r}}const oa=()=>({role:"analyst",id:"user-1",name:"Demo User"}),zs={viewer:1,analyst:2,manager:3,admin:4},Lt=(r,t)=>{const s=zs[r];return t.some(a=>s>=zs[a])};function wt({roles:r,children:t,fallback:s,disabled:a=!1,tooltip:n}){const i=oa();return Lt(i.role,r)?a?e.jsx("div",{className:"opacity-50 pointer-events-none",children:t}):e.jsx(e.Fragment,{children:t}):s?e.jsx(e.Fragment,{children:s}):e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"opacity-50 pointer-events-none",children:t}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-white bg-opacity-75 rounded",children:e.jsxs("div",{className:"flex items-center space-x-1 text-gray-500",children:[e.jsx(Hs,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-xs font-medium",children:[r.join("/")?.toUpperCase(),"+"]})]})}),n&&e.jsx("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-gray-900 text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap z-50",children:n})]})}function ca(){const r=oa();return{user:r,hasRole:t=>Lt(r.role,t),isViewer:r.role==="viewer",isAnalyst:Lt(r.role,["analyst"]),isManager:Lt(r.role,["manager"]),isAdmin:r.role==="admin"}}function un({isOpen:r,onClose:t,projectId:s,projectName:a}){const{hasRole:n}=ca(),[i,o]=x.useState("share"),[l,c]=x.useState(""),[u,d]=x.useState("viewer"),[m,h]=x.useState(""),[g,y]=x.useState(!1),[j,b]=x.useState(null),[v,N]=x.useState(null),[C,p]=x.useState(!1),_=`${window.location.origin}/project/${s}`,w=async()=>{try{await navigator.clipboard.writeText(_),p(!0),setTimeout(()=>p(!1),2e3)}catch{N("Failed to copy link")}},P=async()=>{if(!l.trim()){N("Email address is required");return}if(!n(["manager"])){N("Only managers and admins can send invites");return}y(!0),N(null);try{const{error:q}=await Q.from("project_members").insert({project_id:s,email:l.trim(),role:u,invited_by:"current-user-id",invited_at:new Date().toISOString(),status:"pending",message:m.trim()||null});if(q)throw q;const{error:k}=await Q.functions.invoke("send-invite",{body:{email:l.trim(),projectId:s,projectName:a,role:u,inviteUrl:`${_}?invite=true`,message:m.trim()}});k&&console.warn("Email send failed:",k),b(`Invitation sent to ${l}`),c(""),h(""),setTimeout(()=>b(null),3e3)}catch(q){console.error("Invite error:",q),N(`Failed to send invitation: ${q.message}`)}finally{y(!1)}},U=()=>{c(""),d("viewer"),h(""),N(null),b(null),p(!1)},R=()=>{U(),t()};return e.jsx(lt,{show:r,as:ee.Fragment,children:e.jsxs(mt,{as:"div",className:"relative z-50",onClose:R,children:[e.jsx(lt.Child,{as:ee.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsx(lt.Child,{as:ee.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(mt.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all",children:[e.jsxs(mt.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ut,{className:"w-5 h-5"}),e.jsx("span",{children:"Share Project"})]}),e.jsx("button",{onClick:R,className:"p-1 hover:bg-gray-100 rounded-full transition-colors",children:e.jsx(xe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"mt-4",children:e.jsx("p",{className:"text-sm text-gray-600",children:a})}),e.jsxs("div",{className:"flex mt-4 bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>o("share"),className:`flex-1 flex items-center justify-center space-x-2 px-3 py-2 text-sm font-medium rounded-md transition-colors ${i==="share"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,children:[e.jsx(ut,{className:"w-4 h-4"}),e.jsx("span",{children:"Share Link"})]}),e.jsxs("button",{onClick:()=>o("invite"),className:`flex-1 flex items-center justify-center space-x-2 px-3 py-2 text-sm font-medium rounded-md transition-colors ${i==="invite"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,disabled:!n(["manager"]),children:[e.jsx(za,{className:"w-4 h-4"}),e.jsx("span",{children:"Invite"})]})]}),i==="share"&&e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Project Link"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:_,readOnly:!0,className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-sm"}),e.jsx("button",{onClick:w,className:`px-3 py-2 rounded-lg font-medium transition-colors ${C?"bg-green-600 text-white":"bg-blue-600 text-white hover:bg-blue-700"}`,children:C?e.jsx($a,{className:"w-4 h-4"}):e.jsx(Zs,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Anyone with this link can view the project"})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-1",children:"Sharing Permissions"}),e.jsxs("ul",{className:"text-xs text-blue-700 space-y-1",children:[e.jsx("li",{children:"â€¢ Viewers can see parcels and analysis"}),e.jsx("li",{children:"â€¢ Link sharing requires no sign-up"}),e.jsx("li",{children:"â€¢ Data is read-only for shared viewers"})]})]})]}),i==="invite"&&e.jsxs("div",{className:"mt-4 space-y-4",children:[n(["manager"])?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),e.jsx("input",{type:"email",value:l,onChange:q=>c(q.target.value),placeholder:"colleague@company.com",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus-ring"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role"}),e.jsxs("select",{value:u,onChange:q=>d(q.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus-ring",children:[e.jsx("option",{value:"viewer",children:"Viewer - Can view only"}),e.jsx("option",{value:"analyst",children:"Analyst - Can analyze and export"}),e.jsx("option",{value:"manager",children:"Manager - Can edit and invite"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Message (Optional)"}),e.jsx("textarea",{value:m,onChange:q=>h(q.target.value),placeholder:"Add a personal message...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus-ring resize-none"})]})]}):e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 p-3 rounded-lg",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ea,{className:"w-4 h-4 text-yellow-600"}),e.jsx("p",{className:"text-sm text-yellow-800",children:"Only managers and admins can send invitations"})]})}),v&&e.jsx("div",{className:"bg-red-50 border border-red-200 p-3 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-700",children:v})}),j&&e.jsx("div",{className:"bg-green-50 border border-green-200 p-3 rounded-lg",children:e.jsx("p",{className:"text-sm text-green-700",children:j})})]}),e.jsxs("div",{className:"mt-6 flex justify-end space-x-3",children:[e.jsx("button",{onClick:R,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Close"}),i==="invite"&&n(["manager"])&&e.jsxs("button",{onClick:P,disabled:g||!l.trim(),className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors flex items-center space-x-2",children:[g?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(Da,{className:"w-4 h-4"}),e.jsx("span",{children:g?"Sending...":"Send Invite"})]})]})]})})})})]})})}function hn({onOpenUnifiedWorkspace:r,onOpenProjectWorkflow:t,onOpenSimpleProjectManager:s,onOpenConnectedProjectWorkflow:a,onOpenUnifiedProjectWorkflow:n,onOpenRealUnderwritingWorkflow:i,onOpenWorkflowAudit:o,onOpenWorkflowConnectionTest:l,onOpenParcelAnalysisDemo:c}){const{setDrawer:u,setFilterModal:d,openDrawer:m,setCommandPalette:h}=ke(),{activeProjectId:g,activeProjectName:y}=Wt(),{set:j,clear:b}=De(),[v,N]=ee.useState(!1),[C,p]=ee.useState(0),[_,w]=ee.useState(!1);ee.useEffect(()=>{p(g?Math.floor(Math.random()*5):0)},[g]);const[P,U]=ee.useState(!1),R=[{id:"demo-1",name:"Demo Project"},{id:"nashville-dev",name:"Nashville Development"},{id:"mixed-use-23",name:"Mixed Use 2023"}],q=k=>{g===k.id?b():j(k.id,k.name),U(!1)};return e.jsxs("header",{className:"bg-white border-b border-gray-200 px-4 md:px-6 py-4 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3 min-w-0 flex-shrink-0",children:[e.jsx("div",{className:"bg-blue-600 p-2 rounded-lg",children:e.jsx(Ce,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Parcel Intelligence"}),e.jsx("p",{className:"text-sm text-gray-600 hidden sm:block",children:"Real Estate Investment Platform"})]})]}),e.jsx("div",{className:"flex-1 max-w-md mx-4 md:mx-8 hidden lg:block","data-testid":"desktop-search",children:e.jsxs("div",{className:"relative",children:[e.jsx(_t,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by address, parcel ID, or coordinates...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus-ring","aria-label":"Search parcels","data-testid":"search-input",onClick:()=>h(!0),readOnly:!0}),e.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded",children:"âŒ˜K"})})]})}),e.jsxs("div",{className:"flex items-center space-x-1 md:space-x-3 flex-shrink-0 kpi-bar","data-testid":"header-actions",children:[e.jsxs("div",{className:"hidden md:flex items-center space-x-2 text-sm text-gray-600 flex-wrap",children:[e.jsx("span",{"data-testid":"location-indicator",children:g?`Active: ${y}`:"Nashville Metro"}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:"Real-time Data"})]}),e.jsx("div",{className:"hidden md:block w-px h-6 bg-gray-300 mx-2"}),e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>U(!P),className:`flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors font-medium ${g?"bg-green-100 text-green-700 border border-green-200":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,"data-testid":"project-dropdown",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm hidden md:inline","data-testid":"active-project-name",children:g?y:"Project"}),e.jsx("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),P&&e.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white border border-gray-200 rounded-lg shadow-lg z-50","data-testid":"project-menu",children:e.jsxs("div",{className:"p-2",children:[e.jsx("div",{className:"text-xs font-medium text-gray-500 px-3 py-2 uppercase tracking-wider",children:"Select Project"}),R.map(k=>e.jsx("button",{onClick:()=>q(k),className:`w-full text-left px-3 py-2 text-sm rounded-md transition-colors ${g===k.id?"bg-green-100 text-green-700 font-medium":"text-gray-700 hover:bg-gray-100"}`,"data-testid":`project-${k.id}`,children:k.name},k.id)),e.jsx("hr",{className:"my-2"}),e.jsx("button",{onClick:()=>{b(),U(!1)},className:"w-full text-left px-3 py-2 text-sm rounded-md text-gray-500 hover:bg-gray-100","data-testid":"no-active-project",children:"No Active Project"})]})})]}),e.jsxs("button",{onClick:n,className:"flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors font-medium bg-green-600 text-white hover:bg-green-700","data-testid":"unified-project-workflow-button",title:"Open unified project workflow","aria-label":"Open unified project workflow",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm hidden md:inline",children:"New Project"})]}),e.jsxs("button",{onClick:i,className:"flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors font-medium bg-purple-600 text-white hover:bg-purple-700","data-testid":"real-underwriting-workflow-button",title:"Open real underwriting workflow","aria-label":"Open real underwriting workflow",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm hidden md:inline",children:"Underwriting"})]}),e.jsxs("button",{onClick:l,className:"flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors font-medium bg-gray-600 text-white hover:bg-gray-700","data-testid":"workflow-connection-test-button",title:"Test workflow connections","aria-label":"Test workflow connections",children:[e.jsx(Is,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm hidden md:inline",children:"Test"})]}),e.jsxs("button",{onClick:c,className:"flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors font-medium bg-blue-600 text-white hover:bg-blue-700","data-testid":"parcel-analysis-demo-button",title:"Parcel Analysis Demo","aria-label":"Open Parcel Analysis Demo",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm hidden md:inline",children:"Analysis Demo"})]}),e.jsxs("button",{onClick:()=>u(m==="UNDERWRITING"?null:"UNDERWRITING"),className:`flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors font-medium ${m==="UNDERWRITING"?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,"data-testid":"analysis-button",title:"Financial analysis and underwriting","aria-label":"Open financial analysis",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm hidden md:inline",children:"Analysis"})]}),g&&e.jsxs("button",{onClick:()=>u(m==="SCENARIO_COMPARE"?null:"SCENARIO_COMPARE"),className:`flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors font-medium ${m==="SCENARIO_COMPARE"?"bg-purple-100 text-purple-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,"data-testid":"scenario-compare-button",title:"Compare development scenarios",children:[e.jsx(cs,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm hidden md:inline",children:"Compare"})]}),g&&e.jsx(wt,{roles:["manager"],children:e.jsxs("button",{onClick:()=>N(!0),className:"flex items-center space-x-2 px-3 py-2 rounded-lg transition-colors font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-100","data-testid":"share-button",children:[e.jsx(ut,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm hidden md:inline",children:"Share"})]})}),e.jsxs("button",{onClick:()=>d(!0),className:"flex items-center space-x-2 px-3 py-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors","data-testid":"filters-button",children:[e.jsx(Js,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium hidden md:inline",children:"Filters"})]}),e.jsx("button",{className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors focus-ring","aria-label":"Settings","data-testid":"header-settings",children:e.jsx(et,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>h(!0),className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors focus-ring","aria-label":"Command palette","data-testid":"command-palette-button",children:e.jsx(Is,{className:"w-4 h-4"})}),g&&e.jsxs("button",{className:"relative p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors focus-ring","aria-label":"Comments","data-testid":"comments-button",children:[e.jsx(qt,{className:"w-4 h-4"}),C>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-medium",children:C>9?"9+":C})]}),e.jsx("button",{className:"p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors lg:hidden focus-ring","aria-label":"Toggle search","data-testid":"mobile-search-toggle",children:e.jsx(_t,{className:"w-4 h-4"})})]})]}),e.jsx("div",{className:"mt-4 lg:hidden hidden",id:"mobile-search","data-testid":"mobile-search",children:e.jsxs("div",{className:"relative",children:[e.jsx(_t,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by address, parcel ID, or coordinates...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent","data-testid":"mobile-search-input",onClick:()=>h(!0),readOnly:!0})]})}),g&&e.jsx(un,{isOpen:v,onClose:()=>N(!1),projectId:g,projectName:y||"Untitled Project"})]})}const gn="pk.eyJ1IjoiZW1ydXNzMyIsImEiOiJjamlkcHY1aTAwY3I3M3FyeHAxc3Nia2VqIn0.mxsGEk2I8Ygkf3Q_zJKMcw";ra.accessToken=gn;const ss={longitude:-86.7816,latitude:36.1627,zoom:12},pn="mapbox://styles/mapbox/light-v11";function $s(){return["case",["<",["to-number",["get","sqft"]],1e3],"#f87171",["<",["to-number",["get","sqft"]],2e3],"#fb923c",["<",["to-number",["get","sqft"]],5e3],"#60a5fa",["<",["to-number",["get","sqft"]],2e4],"#3b82f6","#1e3a8a"]}function Es(){return["match",["slice",["to-string",["get","zoning"]],0,2],"RS","#22c55e","RM","#6366f1","MU","#ef4444","CS","#f59e0b","CN","#f59e0b","SP","#a855f7","AG","#10b981","#93a3b5"]}const fn=ee.memo(function({onParcelClick:t,selectedParcelIds:s,activeProjectId:a,activeProjectName:n}){const i=x.useRef(null),o=x.useRef(null),[l,c]=ee.useState(null),[u,d]=ee.useState(null),{filterMode:m,zoningFilters:h}=ke(),g=x.useMemo(()=>m==="large"?[">=",["to-number",["get","sqft"]],5e3]:m==="huge"?[">=",["to-number",["get","sqft"]],2e4]:!0,[m]),y=x.useMemo(()=>{const N=h?.activeZones??[];return N.length?["in",["to-string",["get","zoning"]],...N]:!0},[h?.activeZones]),j=x.useMemo(()=>["all",g,y],[g,y]);x.useEffect(()=>{if(i.current||!o.current)return;const N=new ra.Map({container:o.current,style:pn,center:[ss.longitude,ss.latitude],zoom:ss.zoom,maxZoom:17,transformRequest:C=>{if(C.includes("/functions/v1/mvt-parcels"))return{url:C}}});return N.on("load",()=>{N.getSource("parcels")||(N.addSource("parcels",{type:"vector",tiles:["https://okxrvetbzpoazrybhcqj.supabase.co/functions/v1/mvt-parcels?z={z}&x={x}&y={y}"],minzoom:10,maxzoom:17,promoteId:"ogc_fid"}),N.addLayer({id:"parcels-fill",type:"fill",source:"parcels","source-layer":"parcels",paint:{"fill-color":"#1d4ed8","fill-opacity":.15}}),N.addLayer({id:"parcels-outline",type:"line",source:"parcels","source-layer":"parcels",paint:{"line-color":["case",["boolean",["feature-state","inProject"],!1],"#f59e0b","#1d4ed8"],"line-width":1}}),N.on("mouseenter","parcels-fill",()=>N.getCanvas().style.cursor="pointer"),N.on("mouseleave","parcels-fill",()=>N.getCanvas().style.cursor=""),N.on("click","parcels-fill",async C=>{const p=C.features?.[0]??N.queryRenderedFeatures(C.point,{layers:["parcels-fill"]})[0],{setDrawer:_,setSelectedParcel:w}=ke.getState(),{activeProjectId:P,addParcel:U}=De.getState();try{const{createClient:R}=await ia(async()=>{const{createClient:J}=await import("./supabase-vendor-BeTA44qk.js").then(O=>O.i);return{createClient:J}},__vite__mapDeps([0,1,2])),q=R("https://okxrvetbzpoazrybhcqj.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9reHJ2ZXRienBvYXpyeWJoY3FqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDY1ODkxNDcsImV4cCI6MjA2MjE2NTE0N30.diq6x_Kr5_GxPSHJT1gm54Jh2UTiGVrBNgxDmV3yMxI"),k=Number(p?.id??p?.properties?.ogc_fid);if(Number.isFinite(k)){const{data:J,error:O}=await q.rpc("get_parcel_by_id",{p_ogc_fid:k});if(O)throw O;const re=Array.isArray(J)?J[0]:J;if(!re)throw new Error("not found");P?(await U(String(k),re),_("PROJECT")):t(re);return}const{lng:D,lat:Y}=C.lngLat,{data:X,error:A}=await q.rpc("get_parcel_at_point",{lon:D,lat:Y});if(A)throw A;const E=Array.isArray(X)?X[0]:X;if(!E)return;P?(await U(String(E.ogc_fid),E),_("PROJECT")):t(E)}catch(R){console.error("parcel click failed",R)}}),N.on("click",C=>{const p=N.queryRenderedFeatures(C.point,{layers:["parcels-fill"]})[0];p&&(console.log("click â†’",{id:p.id,props:p.properties,source:p.source,sourceLayer:p.sourceLayer}),console.log("Available properties:",Object.keys(p.properties||{})))}))}),N.on("error",C=>{console.error("Map error:",C.error),C.error?.message?.includes("access token")?d("invalid-token"):d("general-error")}),i.current=N,()=>{i.current&&(i.current.remove(),i.current=null)}},[]);const b=x.useCallback(()=>{const N=i.current;if(!N||!N.getSource("parcels"))return;N.querySourceFeatures&&N.querySourceFeatures("parcels",{sourceLayer:"parcels"}).forEach(w=>{w.id&&N.setFeatureState({source:"parcels",sourceLayer:"parcels",id:w.id},{inProject:!1})});const C=De.getState().selectedParcels;(Array.isArray(C)?C:Array.from(C||[])).forEach(_=>{const w=parseInt(_);Number.isFinite(w)&&N.setFeatureState({source:"parcels",sourceLayer:"parcels",id:w},{inProject:!0})})},[]);x.useEffect(()=>{const N=i.current;N&&N.isStyleLoaded()?b():N&&N.once("styledata",b);const C=De.subscribe(p=>p.selectedParcels,b);return()=>C()},[b]),x.useEffect(()=>{const N=()=>i.current?.resize();return window.addEventListener("resize",N),()=>window.removeEventListener("resize",N)},[]),x.useEffect(()=>{const N=ke.subscribe(C=>C.openDrawer,(C,p)=>{C!==p&&C!==null&&setTimeout(()=>{i.current&&i.current.resize()},150)});return()=>N()},[]),x.useEffect(()=>{const N=i.current;if(!N)return;const C=()=>{if(!N.getLayer("parcels-fill")){setTimeout(C,100);return}const _=ke.getState().colorMode;N.setPaintProperty("parcels-fill","fill-color",_==="zoning"?Es():$s())};N.isStyleLoaded()?C():N.once("style.load",C);const p=ke.subscribe(_=>_.colorMode,_=>{N.getLayer("parcels-fill")&&N.setPaintProperty("parcels-fill","fill-color",_==="zoning"?Es():$s())});return()=>p()},[]);const v=x.useCallback(()=>{const N=i.current;N&&["parcels-fill","parcels-outline"].forEach(C=>{N.getLayer(C)&&N.setFilter(C,j)})},[j]);return x.useEffect(()=>{v()},[v]),x.useEffect(()=>{const N=o.current;if(!N)return;const C=()=>{const w=N.clientHeight||0;w<1?c(`Map container has zero height. Container height: ${w}px`):c(null)},p=requestAnimationFrame(()=>requestAnimationFrame(C)),_=new ResizeObserver(C);return _.observe(N),()=>{cancelAnimationFrame(p),_.disconnect()}},[]),l?e.jsx("div",{className:"flex-1 flex items-center justify-center bg-red-50",children:e.jsxs("div",{className:"text-center p-8 max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Map Container Issue"}),e.jsx("p",{className:"text-red-700 mb-4",children:l})]})}):u==="invalid-token"?e.jsx("div",{className:"flex-1 flex items-center justify-center bg-red-50",children:e.jsxs("div",{className:"text-center p-8 max-w-md",children:[e.jsx("h3",{className:"text-lg font-semibold text-red-800 mb-2",children:"Invalid Mapbox Token"}),e.jsx("p",{className:"text-red-700 mb-4",children:"Your Mapbox access token is invalid or expired."})]})}):e.jsx("div",{ref:o,className:"relative w-full h-full flex-1 min-h-0",style:{minHeight:200},"data-testid":"map-container","data-e2e":"map-canvas"})});function bn(){const[r,t]=x.useState(!1),[s,a]=x.useState([]),[n,i]=x.useState(new Map),o=x.useCallback(async(d,m)=>{if(m)return m;if(!d||d.length===0||!Q)return null;const h=d.map(y=>y.id),g=h.sort().join("|");if(n.has(g))return n.get(g);try{const{data:y,error:j}=await Q.rpc("get_assemblage_geometry",{parcel_ids:h});if(j)throw j;const b={geometry:y[0]?.geometry,totalAcres:y[0]?.total_acres||0,totalSqft:y[0]?.total_sqft||0,zoningMix:y[0]?.zoning_mix||{},boundaryCoordinates:y[0]?.boundary_coordinates||""};return i(v=>new Map(v).set(g,b)),b}catch(y){return console.error("Error getting assemblage geometry:",y),null}},[n]),l=x.useCallback(async d=>{if(!d.length||!Q)return null;try{const m=d.map(y=>y.id),{data:h,error:g}=await Q.rpc("calculate_unified_constraints",{parcel_ids:m});if(g)throw g;return{maxFAR:h[0]?.max_far||3,maxHeight:h[0]?.max_height_ft||45,maxCoverage:h[0]?.max_coverage_pct||40,setbacks:h[0]?.setbacks||{front:25,rear:20,side:10},limitingFactor:h[0]?.limiting_factor||"Unknown",buildableAreaSqft:h[0]?.buildable_area_sqft||0}}catch(m){return console.error("Error calculating constraints:",m),null}},[]),c=x.useCallback(async(d,m=15)=>{if(!Array.isArray(d)||!d.length||!Q)return[];t(!0);try{const h=d.map(b=>b.id),{data:g,error:y}=await Q.rpc("optimize_yield_scenarios",{parcel_ids:h,target_irr:m});if(y)throw y;const j=g?.map(b=>({scenarioName:b.scenario_name,farUtilization:b.far_utilization,heightUtilization:b.height_utilization,coverageUtilization:b.coverage_utilization,estimatedUnits:b.estimated_units,estimatedIRR:b.estimated_irr,estimatedROI:b.estimated_roi,constraintAnalysis:b.constraint_analysis}))||[];return a(j),j}catch(h){return console.error("Error optimizing scenarios:",h),[]}finally{t(!1)}},[]),u=x.useCallback(async(d,m)=>{if(!d.length)return null;const[h,g]=await Promise.all([o(d),l(d)]);if(!h||!g)return null;const y=Math.min(m.targetFAR,g.maxFAR),j=Math.min(m.targetHeight,g.maxHeight),b=Math.min(m.targetCoverage,g.maxCoverage),v=Math.min(h.totalSqft*(b/100),g.buildableAreaSqft),N=h.totalSqft*y,C=Math.floor(j/12),p=v*C,_=Math.min(N,p),w=Math.ceil(_/v),P=w*12,U=_/h.totalSqft,R=Math.floor(h.totalAcres*(m.unitsPerAcre||25)),q=Math.ceil(R*(m.parkingRatio||1.2));return{footprint:v,totalGSF:_,height:P,stories:w,units:R,parkingSpaces:q,coverage:v/h.totalSqft*100,far:U,buildableArea:g.buildableAreaSqft,openSpaceArea:Math.max(h.totalSqft*.15,R*100),parkingArea:q*300,amenitySpace:Math.max(2e3,R*50),averageUnitSize:_/R,constructionCost:_*180*1.3,estimatedValue:R*35e4,roiProjection:yn(_,R,h.totalAcres),constraintAnalysis:{farUtilization:U/g.maxFAR*100,heightUtilization:P/g.maxHeight*100,coverageUtilization:v/h.totalSqft*100/g.maxCoverage*100,limitingFactor:g.limitingFactor}}},[o,l]);return{getAssemblageGeometry:o,calculateUnifiedConstraints:l,optimizeYieldScenarios:c,calculateLiveMassing:u,isOptimizing:r,optimizationResults:s,clearCache:()=>i(new Map)}}function yn(r,t,s){const a=r*180*1.3,n=t*35e4,i=s*5e5;return(n-a-i)/(a+i)*100}const jn=ee.memo(function({parcelIds:t}){const{optimizeYieldScenarios:s,isOptimizing:a}=bn(),{activeProjectId:n}=Wt();if(!n||t.length===0)return null;const i=async()=>{try{const o=t.map(l=>({id:l,parcelnumb:`PARCEL-${l}`,address:`Address ${l}`,deededacreage:1,sqft:43560,zoning:"RM15",geometry:{},landval:5e5,parval:6e5}));await s(o)}catch(o){console.error("Optimization error:",o)}};return e.jsx("div",{className:"absolute top-20 right-4 z-20",children:e.jsxs("button",{onClick:i,disabled:a,className:`flex items-center space-x-2 px-4 py-2 rounded-lg font-medium transition-colors shadow-lg ${a?"bg-gray-300 text-gray-600 cursor-not-allowed":"bg-green-600 text-white hover:bg-green-700"}`,children:[a?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600"}):e.jsx(_e,{className:"w-4 h-4"}),e.jsx("span",{children:a?"Optimizing...":`Optimize ${t.length===1?"Site":"Assemblage"}`})]})})}),vn=ee.memo(function({onParcelClick:t}){const{activeProjectId:s,activeProjectName:a,parcelIds:n}=Wt();return e.jsxs("div",{className:"w-full h-full min-h-0 relative",children:[e.jsx(fn,{onParcelClick:t,selectedParcelIds:n,activeProjectId:s,activeProjectName:a}),e.jsx(jn,{parcelIds:n})]})});function Nn({onParcelClick:r,activeProjectName:t}){return e.jsx("div",{className:"w-full h-full min-w-0 min-h-0 flex-1 flex flex-col",style:{height:"100%"},children:e.jsx(vn,{onParcelClick:r,activeProjectName:t})})}const ct=r=>Number.isFinite(r)?r:0;function Ut(r,t){let s=0,a=0;for(const n of t)s+=n/Math.pow(1+r,a++);return s}function wn(r,t=200,s=1e-7){const a=r.some(u=>u<0),n=r.some(u=>u>0);if(!a||!n)return NaN;let i=-.9999,o=10,l=Ut(i,r),c=Ut(o,r);if(l*c>0&&(o=100,c=Ut(o,r),l*c>0))return NaN;for(let u=0;u<t;u++){const d=(i+o)/2,m=Ut(d,r);if(Math.abs(m)<s)return d;l*m<0?(o=d,c=m):(i=d,l=m)}return(i+o)/2}function Sn(r,t,s){const a=new Array(Math.max(s+1,2)).fill(0);return a[0]=-r,a[s]=t,a}function _n(r){const{land_cost:t=0,hard_cost:s=0,soft_cost:a=0,contingency:n=0,loan_amount:i=0,revenue:o=0,development_months:l=18}=r,c=t+s+a+n,u=Math.max(c-i,0),d=o-c,m=Math.max(o-i,0),h=Sn(u,m,Math.max(1,l)),g=wn(h),y=Number.isFinite(g)?Math.pow(1+g,12)-1:NaN,j=c>0?d/c:NaN,b=u>0?m/u:NaN,v=u>0?d/u:NaN;return{total_cost:ct(c),equity_required:ct(u),profit:ct(d),irr_annual_pct:ct(y*100),irr_monthly_pct:ct(g*100),yield_on_cost_pct:ct(j*100),equity_multiple:ct(b),cash_on_cash_pct:ct(v*100)}}const Ds={RS5:{land_cost_per_acre:4e5,hard_cost_per_sf:160,sale_price_per_unit:28e4,rent_per_unit_per_month:1400},"RS7.5":{land_cost_per_acre:45e4,hard_cost_per_sf:165,sale_price_per_unit:32e4,rent_per_unit_per_month:1600},RS10:{land_cost_per_acre:5e5,hard_cost_per_sf:170,sale_price_per_unit:35e4,rent_per_unit_per_month:1800},RS15:{land_cost_per_acre:55e4,hard_cost_per_sf:175,sale_price_per_unit:38e4,rent_per_unit_per_month:2e3},RS20:{land_cost_per_acre:6e5,hard_cost_per_sf:180,sale_price_per_unit:42e4,rent_per_unit_per_month:2200},R6:{land_cost_per_acre:8e5,hard_cost_per_sf:150,sale_price_per_unit:25e4,rent_per_unit_per_month:1500},R8:{land_cost_per_acre:9e5,hard_cost_per_sf:160,sale_price_per_unit:28e4,rent_per_unit_per_month:1650},R10:{land_cost_per_acre:1e6,hard_cost_per_sf:170,sale_price_per_unit:32e4,rent_per_unit_per_month:1800},R15:{land_cost_per_acre:12e5,hard_cost_per_sf:180,sale_price_per_unit:35e4,rent_per_unit_per_month:2e3},R20:{land_cost_per_acre:14e5,hard_cost_per_sf:190,sale_price_per_unit:38e4,rent_per_unit_per_month:2200},RM2:{land_cost_per_acre:1e6,hard_cost_per_sf:180,sale_price_per_unit:32e4,rent_per_unit_per_month:1800},RM4:{land_cost_per_acre:12e5,hard_cost_per_sf:190,sale_price_per_unit:35e4,rent_per_unit_per_month:2e3},RM6:{land_cost_per_acre:14e5,hard_cost_per_sf:200,sale_price_per_unit:38e4,rent_per_unit_per_month:2200},RM9:{land_cost_per_acre:16e5,hard_cost_per_sf:210,sale_price_per_unit:42e4,rent_per_unit_per_month:2400},RM15:{land_cost_per_acre:18e5,hard_cost_per_sf:220,sale_price_per_unit:45e4,rent_per_unit_per_month:2600},RM20:{land_cost_per_acre:2e6,hard_cost_per_sf:230,sale_price_per_unit:5e5,rent_per_unit_per_month:2800},CN:{land_cost_per_acre:15e5,hard_cost_per_sf:200,sale_price_per_sf:300,rent_per_sf_per_month:2.5},CR:{land_cost_per_acre:18e5,hard_cost_per_sf:220,sale_price_per_sf:350,rent_per_sf_per_month:3},CS:{land_cost_per_acre:22e5,hard_cost_per_sf:240,sale_price_per_sf:400,rent_per_sf_per_month:3.5},CA:{land_cost_per_acre:28e5,hard_cost_per_sf:260,sale_price_per_sf:450,rent_per_sf_per_month:4},default:{land_cost_per_acre:5e5,hard_cost_per_sf:180,sale_price_per_unit:35e4,rent_per_unit_per_month:1800}};function kn(r){return Ds[r]||Ds.default}const It=[{id:"hard_construction",label:"Hard Construction Costs & Demo",basis:"per_sf",value:275,category:"HARD"},{id:"site_work",label:"Site Work",basis:"fixed",value:3e5,category:"SITE"},{id:"permit_tap",label:"Permit & Tap Fees",basis:"per_unit",value:3500,category:"FEES"},{id:"amenities",label:"Amenities",basis:"per_sf",value:15,category:"HARD"},{id:"legal",label:"Legal",basis:"fixed",value:65e3,category:"SOFT"},{id:"architecture",label:"Architecture",basis:"percent_of_hard",value:.035,category:"SOFT"},{id:"civil",label:"Civil Engineer",basis:"fixed",value:85e3,category:"SOFT"},{id:"survey_env",label:"Survey & Environmental",basis:"fixed",value:45e3,category:"SOFT"},{id:"title_escrow",label:"Title & Escrow",basis:"fixed",value:3e4,category:"SOFT"},{id:"taxes",label:"Real Estate Taxes (pre-CO)",basis:"fixed",value:4e4,category:"SOFT"},{id:"insurance",label:"Insurance",basis:"fixed",value:55e3,category:"SOFT"},{id:"dev_fee",label:"Development Fee",basis:"percent_of_hard",value:.04,category:"SOFT"},{id:"closing_misc",label:"Closing Cost & Fees",basis:"fixed",value:25e3,category:"SOFT"},{id:"consultants",label:"Consultants & Pro Fees",basis:"fixed",value:6e4,category:"SOFT"},{id:"op_loss",label:"Op Loss",basis:"fixed",value:5e4,category:"SOFT"},{id:"marketing_ffe",label:"Marketing & FF&E",basis:"per_unit",value:2500,category:"SOFT"},{id:"misc",label:"Misc",basis:"fixed",value:25e3,category:"SOFT"},{id:"contingency",label:"Contingency",basis:"percent_of_hard",value:.07,category:"CONT"}];function Os(r,t){switch(r.basis){case"fixed":return r.value;case"per_sf":return r.value*(t.buildableSf||0);case"per_unit":return r.value*(t.units||0);case"percent_of_hard":return r.value*(t.hardSubtotalExCont||0);case"percent_of_tdc":return r.value*(t.tdcBeforeFee||0);default:return 0}}function da(r,t){const s=new Set(["hard_construction","site_work","permit_tap","amenities"]);let a=0;for(const m of r)s.has(m.id)&&(a+=Os(m,{hardSubtotalExCont:0,tdcBeforeFee:0,buildableSf:t.buildableSf,units:t.units,keys:t.keys}));let n=a;const i=[];function o(m){const h=Os(m,{hardSubtotalExCont:a,tdcBeforeFee:n,buildableSf:t.buildableSf,units:t.units,keys:t.keys});i.push({id:m.id,label:m.label,amount:h,category:m.category}),n+=h}const l=["hard_construction","site_work","amenities","permit_tap","legal","architecture","civil","survey_env","title_escrow","taxes","insurance","dev_fee","closing_misc","consultants","op_loss","marketing_ffe","misc","contingency"],c=new Map(r.map(m=>[m.id,m]));for(const m of l){const h=c.get(m);h&&o(h)}for(const m of r)l.includes(m.id)||o(m);const u={HARD:0,SITE:0,FEES:0,SOFT:0,CONT:0,FIN:0};for(const m of i)u[m.category]+=m.amount;const d=Object.values(u).reduce((m,h)=>m+h,0);return{items:i,subtotals:u,tdc:d}}function Cn({program:r,onChange:t,onTotalCostChange:s}){const[a,n]=x.useState(It),[i,o]=x.useState(!1),l=x.useMemo(()=>{const b=da(a,r);return s?.(b.tdc),b},[a,r,s]),c=(b,v)=>{const N=a.slice();N[b]={...N[b],...v},n(N),t?.(N)},u=()=>{const b={id:`custom_${Date.now()}`,label:"Custom Item",basis:"fixed",value:0,category:"SOFT"},v=[...a,b];n(v),t?.(v)},d=b=>{const v=a.filter((N,C)=>C!==b);n(v),t?.(v)},m=()=>{n(It),t?.(It)},h=b=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(b),g=b=>b.basis==="percent_of_hard"||b.basis==="percent_of_tdc"?(b.value*100).toFixed(2)+"%":b.value.toLocaleString(),y=b=>{switch(b){case"HARD":return"bg-blue-50 border-blue-200";case"SITE":return"bg-green-50 border-green-200";case"FEES":return"bg-yellow-50 border-yellow-200";case"SOFT":return"bg-purple-50 border-purple-200";case"CONT":return"bg-red-50 border-red-200";case"FIN":return"bg-gray-50 border-gray-200";default:return"bg-gray-50 border-gray-200"}},j=b=>{switch(b){case"HARD":return e.jsx(Ie,{className:"w-4 h-4"});case"SITE":return e.jsx(Oe,{className:"w-4 h-4"});case"FEES":return e.jsx(Ee,{className:"w-4 h-4"});case"SOFT":return e.jsx(ve,{className:"w-4 h-4"});case"CONT":return e.jsx(Le,{className:"w-4 h-4"});case"FIN":return e.jsx(Ee,{className:"w-4 h-4"});default:return e.jsx(Ee,{className:"w-4 h-4"})}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center space-x-2",children:[e.jsx(ve,{className:"w-5 h-5"}),e.jsx("span",{children:"Development Cost Breakdown"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>o(!i),className:"px-3 py-1 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:i?"Simple View":"Advanced"}),e.jsx("button",{onClick:m,className:"px-3 py-1 text-sm bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-lg transition-colors",children:"Reset"})]})]}),e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg",children:e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Buildable SF:"}),e.jsx("div",{className:"font-semibold",children:r.buildableSf.toLocaleString()})]}),r.units&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Units:"}),e.jsx("div",{className:"font-semibold",children:r.units})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Lot Size:"}),e.jsxs("div",{className:"font-semibold",children:[Math.round(r.lotSqft/43560*100)/100," ac"]})]})]})}),e.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-4 py-3 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-12 gap-2 text-xs font-semibold text-gray-700 uppercase tracking-wider",children:[e.jsx("div",{className:"col-span-4",children:"Item"}),e.jsx("div",{className:"col-span-2",children:"Basis"}),e.jsx("div",{className:"col-span-2",children:"Value"}),e.jsx("div",{className:"col-span-3 text-right",children:"Amount"}),e.jsx("div",{className:"col-span-1"})]})}),e.jsx("div",{className:"divide-y divide-gray-200 max-h-96 overflow-y-auto",children:a.map((b,v)=>e.jsx("div",{className:`px-4 py-3 ${y(b.category)}`,children:e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center",children:[e.jsxs("div",{className:"col-span-4 flex items-center space-x-2",children:[j(b.category),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900 text-sm",children:b.label}),e.jsx("div",{className:"text-xs text-gray-500",children:b.category})]}),b.locked&&e.jsx(Hs,{className:"w-3 h-3 text-gray-400"})]}),e.jsx("div",{className:"col-span-2",children:e.jsxs("select",{value:b.basis,onChange:N=>c(v,{basis:N.target.value}),className:"w-full text-xs border border-gray-300 rounded px-2 py-1 focus-ring",disabled:b.locked,children:[e.jsx("option",{value:"fixed",children:"Fixed $"}),e.jsx("option",{value:"per_sf",children:"$ / SF"}),e.jsx("option",{value:"per_unit",children:"$ / Unit"}),e.jsx("option",{value:"percent_of_hard",children:"% of Hard"}),e.jsx("option",{value:"percent_of_tdc",children:"% of TDC"})]})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("input",{type:"number",step:b.basis.includes("percent")?"0.001":b.basis==="per_sf"?"1":"1000",value:b.value,onChange:N=>c(v,{value:Number(N.target.value)}),className:"w-full text-xs border border-gray-300 rounded px-2 py-1 focus-ring tabular-nums",disabled:b.locked}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:g(b)})]}),e.jsx("div",{className:"col-span-3 text-right",children:e.jsx("div",{className:"text-sm font-semibold text-gray-900 tabular-nums",children:h(l.items.find(N=>N.id===b.id)?.amount||0)})}),e.jsx("div",{className:"col-span-1 flex justify-end",children:i&&!b.locked&&e.jsx("button",{onClick:()=>d(v),className:"p-1 text-gray-400 hover:text-red-600 rounded",title:"Remove item",children:e.jsx(Ks,{className:"w-4 h-4"})})})]})},b.id))}),i&&e.jsx("div",{className:"p-3 border-t border-gray-200 bg-gray-50",children:e.jsxs("button",{onClick:u,className:"flex items-center space-x-2 px-3 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{children:"Add Custom Line Item"})]})})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Cost Summary"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Hard Construction + Demo:"}),e.jsx("span",{className:"font-medium tabular-nums",children:h(l.subtotals.HARD)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Site Work:"}),e.jsx("span",{className:"font-medium tabular-nums",children:h(l.subtotals.SITE)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Permit & Tap Fees:"}),e.jsx("span",{className:"font-medium tabular-nums",children:h(l.subtotals.FEES)})]}),e.jsxs("div",{className:"flex justify-between text-sm border-t pt-2",children:[e.jsx("span",{className:"text-gray-600",children:"Total Soft Costs:"}),e.jsx("span",{className:"font-medium tabular-nums",children:h(l.subtotals.SOFT)})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Contingency:"}),e.jsx("span",{className:"font-medium tabular-nums",children:h(l.subtotals.CONT)})]}),l.subtotals.FIN>0&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Interest & Financing:"}),e.jsx("span",{className:"font-medium tabular-nums",children:h(l.subtotals.FIN)})]}),e.jsxs("div",{className:"flex justify-between text-lg font-bold border-t-2 pt-3",children:[e.jsx("span",{children:"Total Development Cost (TDC):"}),e.jsx("span",{className:"tabular-nums",children:h(l.tdc)})]})]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{children:["Buildable: ",r.buildableSf.toLocaleString()," SF"]}),r.units&&e.jsxs("span",{children:["Units: ",r.units]}),r.keys&&e.jsxs("span",{children:["Keys: ",r.keys]})]})})]})}function Pn(r,t,s){const[a,n]=x.useState(It),[i,o]=x.useState(!1),[l,c]=x.useState(!1);x.useEffect(()=>{},[r,t]);const u=x.useMemo(()=>da(a,s),[a,s]);return{lineItems:a,breakdown:u,loading:i,saving:l,updateLineItems:m=>{n(m),setTimeout(()=>{},500)},saveCostOverrides:()=>Promise.resolve(),resetToDefaults:()=>{n(It)}}}function Fn(r){if(r.zoning_type)switch(r.zoning_type.toLowerCase()){case"residential":return r.zoning_subtype?.toLowerCase().includes("single")?"Single-Family":r.zoning_subtype?.toLowerCase().includes("multi")?"Multi-Family":r.zoning_subtype?.toLowerCase().includes("townhouse")?"Townhouse":"Multi-Family";case"commercial":return"Commercial";case"industrial":return"Industrial";case"mixed-use":return"Mixed-Use";case"agricultural":return"Agricultural";default:return"General"}const t=r.zoning||"";return t.startsWith("RS")?"Single-Family":t.startsWith("R")?"Multi-Family":t.startsWith("RM")?"Mixed-Use":t.startsWith("C")?"Commercial":t.startsWith("MU")?"Mixed-Use":"General"}const Mn=ee.memo(function({parcel:t,onClose:s}){const[a,n]=x.useState(null),[i,o]=x.useState({}),[l,c]=x.useState(!1),[u,d]=x.useState("for-sale"),[m,h]=x.useState(!1),[g,y]=x.useState(!1),[j,b]=x.useState(null),v=x.useMemo(()=>{const k=t.deeded_acres||t.deededacreage||t.gisacre||0,D=t.sqft||k*43560,Y=D*2,X=Math.floor(k*25);return{lotSqft:D,buildableSf:Y,units:X}},[t]),{breakdown:N,updateLineItems:C}=Pn(null,String(t.ogc_fid),v);x.useEffect(()=>{t?.zoning&&_(t)},[t?.zoning]);const p=x.useMemo(()=>{if(!a||!t||l)return null;try{const k={...a,...i},D=t.deeded_acres||t.deededacreage||t.gisacre||0,Y=t.sqft||D*43560,X=D*k.land_cost_per_acre,A=Y*k.hard_cost_per_sf*2,E=A*(k.soft_cost_percentage/100),J=(A+E)*(k.contingency_percentage/100),re=(j||X+A+E+J)*(k.loan_to_cost/100);let ae=0;u==="for-sale"?ae=Math.floor(D*25)*k.sale_price_per_unit:ae=Y*k.rent_per_sf_per_month*12*2*(1-k.vacancy_rate/100)*(1-k.operating_expense_ratio/100)/(k.cap_rate/100);const K={land_cost:X,hard_cost:A,soft_cost:E,contingency:J,loan_amount:re,revenue:ae,development_months:k.development_months};return _n(K)}catch(k){return console.error("Error calculating metrics:",k),null}},[a,i,u,t,l,j]),_=async k=>{c(!0);try{const D=kn(k.zoning),Y={use_type:Fn(k),land_cost_per_acre:D.land_cost_per_acre||5e5,hard_cost_per_sf:D.hard_cost_per_sf||180,soft_cost_percentage:20,contingency_percentage:10,loan_to_cost:75,interest_rate:7.5,rent_per_sf_per_month:1.8,sale_price_per_sf:320,rent_per_unit_per_month:D.rent_per_unit_per_month||1800,sale_price_per_unit:D.sale_price_per_unit||35e4,vacancy_rate:5,operating_expense_ratio:35,cap_rate:5.5,development_months:18,lease_up_months:6};n(Y),o({})}catch(D){console.error("Error loading default costs:",D),n({use_type:"General",land_cost_per_acre:5e5,hard_cost_per_sf:180,soft_cost_percentage:20,contingency_percentage:10,loan_to_cost:75,interest_rate:7.5,rent_per_sf_per_month:1.8,sale_price_per_sf:320,rent_per_unit_per_month:1800,sale_price_per_unit:35e4,vacancy_rate:5,operating_expense_ratio:35,cap_rate:5.5,development_months:18,lease_up_months:6})}finally{c(!1)}},w=(k,D)=>{o(Y=>({...Y,[k]:D}))},P=async()=>{if(t){h(!0);try{const{data:k,error:D}=await Q.functions.invoke("pdf-export",{body:{projectData:{name:`Parcel ${t.parcelnumb}`,parcel:t,metrics:p,costs:{...a,...i}},reportType:"underwriting"}});if(D)throw D;const Y=document.createElement("a");Y.href=URL.createObjectURL(new Blob([k],{type:"application/pdf"})),Y.download=`parcel-${t.parcelnumb}-underwriting.pdf`,Y.click()}catch(k){console.error("PDF export error:",k)}finally{h(!1)}}},U=k=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(k),R=k=>`${k.toFixed(1)}%`,q=k=>k>=20?"text-green-600":k>=15?"text-blue-600":k>=10?"text-yellow-600":"text-red-600";return t?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden",children:[e.jsxs("div",{className:"p-4 bg-gray-50 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 flex items-center space-x-2",children:[e.jsx(ve,{className:"w-5 h-5"}),e.jsx("span",{children:"Underwriting Analysis"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("button",{className:"p-1 text-gray-400 hover:text-blue-600 rounded",title:"Recalculate",children:e.jsx(ds,{className:"w-4 h-4"})})})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[t.address," â€¢ ",t.parcelnumb," â€¢ ",t.zoning,t.zoning_type&&e.jsxs("span",{className:"ml-2 px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:[t.zoning_type,t.zoning_subtype&&` - ${t.zoning_subtype}`]})]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(t.deeded_acres||t.deededacreage||t.gisacre||0).toFixed(2)," acres â€¢",(t.sqft||0).toLocaleString()," sq ft"]})]})]}),e.jsx("div",{className:"p-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>d("for-sale"),className:`flex-1 px-3 py-2 text-sm font-medium rounded-md transition-colors ${u==="for-sale"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,children:"For-Sale"}),e.jsx("button",{onClick:()=>d("rental"),className:`flex-1 px-3 py-2 text-sm font-medium rounded-md transition-colors ${u==="rental"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,children:"Rental"})]})}),(t.zoning_type||t.max_far||t.max_density_du_per_acre)&&e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(_e,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold text-gray-900",children:"Zoning Constraints"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[t.max_far&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Max FAR:"}),e.jsx("span",{className:"ml-2 font-medium text-gray-900",children:t.max_far})]}),t.max_density_du_per_acre&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Max Density:"}),e.jsxs("span",{className:"ml-2 font-medium text-gray-900",children:[t.max_density_du_per_acre," DU/acre"]})]}),t.max_building_height_ft&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Max Height:"}),e.jsxs("span",{className:"ml-2 font-medium text-gray-900",children:[t.max_building_height_ft," ft"]})]}),t.max_coverage_pct&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Max Coverage:"}),e.jsxs("span",{className:"ml-2 font-medium text-gray-900",children:[t.max_coverage_pct,"%"]})]}),t.min_lot_area_sq_ft&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Min Lot Area:"}),e.jsxs("span",{className:"ml-2 font-medium text-gray-900",children:[t.min_lot_area_sq_ft.toLocaleString()," sq ft"]})]}),t.min_front_setback_ft&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Front Setback:"}),e.jsxs("span",{className:"ml-2 font-medium text-gray-900",children:[t.min_front_setback_ft," ft"]})]})]}),t.permitted_land_uses&&e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"text-gray-600 text-sm font-medium mb-2",children:"Permitted Uses:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:Object.entries(t.permitted_land_uses).slice(0,3).map(([k,D])=>e.jsxs("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded",children:[k,": ",Array.isArray(D)?D.slice(0,2).join(", "):D]},k))})]})]}),p&&e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Financial Results"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg text-center",children:[e.jsx("div",{className:`text-2xl font-bold ${q(p.irr_annual_pct)}`,"data-e2e":"irr-cell",children:R(p.irr_annual_pct)}),e.jsx("div",{className:"text-xs text-gray-600",children:"IRR"})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:R(p.yield_on_cost_pct)}),e.jsx("div",{className:"text-xs text-gray-600",children:"Yield on Cost"})]}),e.jsxs("div",{className:"bg-purple-50 p-3 rounded-lg text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[p.equity_multiple.toFixed(2),"x"]}),e.jsx("div",{className:"text-xs text-gray-600",children:"Equity Multiple"})]}),e.jsxs("div",{className:"bg-orange-50 p-3 rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:R(p.cash_on_cash_pct)}),e.jsx("div",{className:"text-xs text-gray-600",children:"Cash-on-Cash"})]})]})]}),a&&e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:"Cost Assumptions"}),e.jsxs("div",{className:"text-xs text-blue-600",children:["Default: ",a.use_type]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Hard Cost ($/SF)"}),e.jsx("input",{type:"number",value:i.hard_cost_per_sf??a.hard_cost_per_sf,onChange:k=>w("hard_cost_per_sf",parseFloat(k.target.value)),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus-ring",step:"10"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Interest Rate (%)"}),e.jsx("input",{type:"number",value:i.interest_rate??a.interest_rate,onChange:k=>w("interest_rate",parseFloat(k.target.value)),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus-ring",step:"0.1"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:u==="for-sale"?"Sale Price/Unit":"Rent/Unit/Month"}),e.jsx("input",{type:"number",value:u==="for-sale"?i.sale_price_per_unit??a.sale_price_per_unit:i.rent_per_unit_per_month??a.rent_per_unit_per_month,onChange:k=>w(u==="for-sale"?"sale_price_per_unit":"rent_per_unit_per_month",parseFloat(k.target.value)),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus-ring",step:u==="for-sale"?"10000":"50"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Loan-to-Cost (%)"}),e.jsx("input",{type:"number",value:i.loan_to_cost??a.loan_to_cost,onChange:k=>w("loan_to_cost",parseFloat(k.target.value)),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus-ring",step:"5",min:"0",max:"95"})]})]}),u==="rental"&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Vacancy Rate (%)"}),e.jsx("input",{type:"number",value:i.vacancy_rate??a.vacancy_rate,onChange:k=>w("vacancy_rate",parseFloat(k.target.value)),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus-ring",step:"0.5"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Cap Rate (%)"}),e.jsx("input",{type:"number",value:i.cap_rate??a.cap_rate,onChange:k=>w("cap_rate",parseFloat(k.target.value)),className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus-ring",step:"0.25"})]})]})]})]}),p&&e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Cost Breakdown"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total Development Cost:"}),e.jsx("span",{className:"font-medium",children:U(p.total_cost)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Equity Required:"}),e.jsx("span",{className:"font-medium",children:U(p.equity_required)})]}),e.jsxs("div",{className:"flex justify-between border-t pt-2",children:[e.jsx("span",{className:"text-gray-600",children:"Estimated Profit:"}),e.jsx("span",{className:`font-semibold ${p.profit>0?"text-green-600":"text-red-600"}`,children:U(p.profit)})]})]})]}),e.jsxs("div",{className:"p-4 space-y-2",children:[e.jsxs("button",{onClick:P,disabled:m||!p,className:"w-full bg-blue-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-blue-700 disabled:bg-gray-300 transition-colors flex items-center justify-center space-x-2",children:[m?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(Bt,{className:"w-4 h-4"}),e.jsx("span",{children:m?"Generating PDF...":"Export PDF Report"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("button",{onClick:()=>y(!g),className:"flex items-center space-x-2 text-sm font-medium text-blue-600 hover:text-blue-700",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsxs("span",{children:[g?"Hide":"Show"," Detailed Cost Breakdown"]})]}),N&&e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["TDC: ",U(N.tdc)]})]}),g&&e.jsx(Cn,{program:v,onChange:C,onTotalCostChange:b})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>window.location.reload(),className:"bg-green-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-green-700 transition-colors flex items-center justify-center space-x-1",children:[e.jsx(ve,{className:"w-3 h-3"}),e.jsx("span",{className:"text-sm",children:"Recalculate"})]}),e.jsx("button",{className:"border border-gray-300 text-gray-700 py-2 px-4 rounded-lg font-medium hover:bg-gray-50 transition-colors text-sm",children:"Save to Project"})]})]}),l&&e.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Loading cost data..."})]})})]}):null});class Rn{constructor(t,s){nt(this,"marketData");nt(this,"costData");this.marketData=t,this.costData=s}safeParseNumber(t){if(t==null||t==="")return;const s=Number(t);if(!(isNaN(s)||!isFinite(s))&&!(s<0&&Math.abs(s)>1e3))return s}async analyzeHBU(t){console.log("Raw parcel data received:",t);const s={zoning_id:t.zoning_id,zoning:t.zoning,zoning_description:t.zoning_description,zoning_type:t.zoning_type,zoning_subtype:t.zoning_subtype,zoning_objective:t.zoning_objective,zoning_code_link:t.zoning_code_link,permitted_land_uses:t.permitted_land_uses,permitted_land_uses_as_of_right:t.permitted_land_uses_as_of_right,permitted_land_uses_conditional:t.permitted_land_uses_conditional,min_lot_area_sq_ft:this.safeParseNumber(t.min_lot_area_sq_ft),min_lot_width_ft:this.safeParseNumber(t.min_lot_width_ft),max_building_height_ft:this.safeParseNumber(t.max_building_height_ft),max_far:this.safeParseNumber(t.max_far),min_front_setback_ft:this.safeParseNumber(t.min_front_setback_ft),min_rear_setback_ft:this.safeParseNumber(t.min_rear_setback_ft),min_side_setback_ft:this.safeParseNumber(t.min_side_setback_ft),max_coverage_pct:this.safeParseNumber(t.max_coverage_pct),max_impervious_coverage_pct:this.safeParseNumber(t.max_impervious_coverage_pct),min_landscaped_space_pct:this.safeParseNumber(t.min_landscaped_space_pct),min_open_space_pct:this.safeParseNumber(t.min_open_space_pct),max_density_du_per_acre:this.safeParseNumber(t.max_density_du_per_acre),zoning_data_date:t.zoning_data_date,municipality_id:t.municipality_id,municipality_name:t.municipality_name,geoid:t.geoid};console.log("Processed zoning data:",s),!s.zoning&&!s.zoning_type&&(console.warn("No zoning data found, using fallback analysis"),s.zoning=t.zoning||"Unknown",s.zoning_type="Residential");const a=this.identifyFeasibleUses(s);console.log("Feasible uses identified:",a),a.length===0&&(console.warn("No feasible uses found, adding default residential use"),a.push("Single Family"));const n=await this.analyzeMarketFactors(t);console.log("Market factors analyzed:",n);const i=await this.calculateAlternatives(t,a);console.log("Alternatives calculated:",i);const o=this.identifyConstraints(s),l=this.determineRecommendedUse(i),c=this.calculateConfidence(i,n);return{recommendedUse:l,confidence:c,alternatives:i,constraints:o,marketFactors:n,financialProjections:this.generateFinancialProjections(l,i),analysisDate:new Date,analyst:"System"}}identifyFeasibleUses(t){const s=[];if(t.permitted_land_uses)try{typeof t.permitted_land_uses=="object"?Object.keys(t.permitted_land_uses).forEach(a=>{const n=t.permitted_land_uses[a];Array.isArray(n)?n.forEach(i=>{this.isFeasibleUse(i,t)&&s.push(i)}):typeof n=="string"&&this.isFeasibleUse(n,t)&&s.push(n)}):typeof t.permitted_land_uses=="string"&&t.permitted_land_uses.split(",").map(n=>n.trim()).forEach(n=>{this.isFeasibleUse(n,t)&&s.push(n)})}catch(a){console.warn("Error processing permitted_land_uses:",a)}if(t.zoning_type){const a=this.getUsesByZoningType(t.zoning_type);if(s.push(...a),t.zoning_subtype){const n=this.getUsesByZoningSubtype(t.zoning_subtype);s.push(...n)}}if(t.zoning_objective){const a=this.getUsesByZoningObjective(t.zoning_objective);s.push(...a)}return[...new Set(s)]}isFeasibleUse(t,s){const a=s.max_density_du_per_acre||0;if(this.getRequiredDensity(t)>a&&a>0)return!1;const i=s.max_far||0;if(this.getRequiredFAR(t)>i&&i>0)return!1;const l=s.max_building_height_ft||0;return!(this.getRequiredHeight(t)>l&&l>0)}getUsesByZoningType(t){return{Residential:["Single Family","Multi-Family","Townhouse","Apartment"],Commercial:["Retail","Office","Restaurant","Hotel"],Industrial:["Warehouse","Manufacturing","Distribution"],"Mixed-Use":["Mixed-Use Residential","Mixed-Use Commercial"],Agricultural:["Farming","Ranch","Vineyard"],"Special Purpose":["Institutional","Recreation","Open Space"]}[t]||[]}getUsesByZoningSubtype(t){return{"Single Family":["Single Family","Townhouse"],"Multi-Family":["Multi-Family","Apartment"],"Mixed-Use Residential":["Mixed-Use Residential","Apartment","Retail"],"Mixed-Use Commercial":["Mixed-Use Commercial","Office","Retail"],"High-Density Residential":["Apartment","Multi-Family"],"Low-Density Residential":["Single Family","Townhouse"],Office:["Office","Professional Services"],Retail:["Retail","Restaurant","Service"],Industrial:["Warehouse","Manufacturing","Distribution"]}[t]||[]}getUsesByZoningObjective(t){return{"Residential Development":["Single Family","Multi-Family","Apartment"],"Commercial Development":["Retail","Office","Restaurant"],"Mixed-Use Development":["Mixed-Use Residential","Mixed-Use Commercial"],"Industrial Development":["Warehouse","Manufacturing"],"Transit-Oriented Development":["Mixed-Use Residential","Mixed-Use Commercial"],"Affordable Housing":["Multi-Family","Apartment"],"Urban Infill":["Mixed-Use Residential","Mixed-Use Commercial"]}[t]||[]}getRequiredDensity(t){return{"Single Family":2,"Multi-Family":20,Townhouse:15,Apartment:30,Retail:0,Office:0,Warehouse:0}[t]||0}getRequiredFAR(t){return{"Single Family":.3,"Multi-Family":2,Townhouse:1.5,Apartment:3,Retail:1,Office:2.5,Warehouse:1.5}[t]||0}getRequiredHeight(t){return{"Single Family":35,"Multi-Family":60,Townhouse:45,Apartment:90,Retail:30,Office:120,Warehouse:40}[t]||0}async analyzeMarketFactors(t){const s=[];return s.push({factor:"Location Desirability",impact:"positive",weight:.3,description:"Prime location with good access and amenities"}),s.push({factor:"Market Demand",impact:"positive",weight:.25,description:"Strong demand for development in this area"}),t.zoning_data?.zoning_type==="Mixed-Use"&&s.push({factor:"Zoning Flexibility",impact:"positive",weight:.2,description:"Mixed-use zoning allows multiple development options"}),s.push({factor:"Infrastructure",impact:"positive",weight:.15,description:"Good infrastructure and utilities available"}),s.push({factor:"Market Competition",impact:"neutral",weight:.1,description:"Moderate competition in the market"}),s}async calculateAlternatives(t,s){const a=[];for(const n of s){const i=await this.calculateAlternative(t,n);a.push(i)}return a.sort((n,i)=>i.netPresentValue-n.netPresentValue)}async calculateAlternative(t,s){const a=this.getRequiredDensity(s),n=this.getRequiredFAR(s),i=this.getRequiredHeight(s),o=t.sqft||0,l=o*n,c=a>0?Math.floor(o/43560*a):0,u=t.parval||0,d=l*this.getCostPerSqFt(s),m=d*.25,h=(d+m)*.1,g=u+d+m+h,y=this.estimateRevenue(s,l,c),j=y-g,b=this.calculateIRR(g,y,3),v=this.calculatePaybackPeriod(g,y);return{use:s,density:a,height:i,estimatedValue:y,developmentCost:g,netPresentValue:j,internalRateOfReturn:b,paybackPeriod:v,confidence:this.calculateUseConfidence(s,t),constraints:this.identifyUseConstraints(s,t.zoning_data),marketFactors:this.identifyUseMarketFactors(s,t)}}getCostPerSqFt(t){return{"Single Family":150,"Multi-Family":200,Townhouse:180,Apartment:220,Retail:180,Office:250,Warehouse:120}[t]||200}estimateRevenue(t,s,a){const n=this.getPricePerSqFt(t),i=this.getPricePerUnit(t);return a>0?a*i:s*n}getPricePerSqFt(t){return{"Single Family":300,"Multi-Family":400,Townhouse:350,Apartment:450,Retail:200,Office:300,Warehouse:150}[t]||300}getPricePerUnit(t){return{"Single Family":5e5,"Multi-Family":3e5,Townhouse:4e5,Apartment:25e4}[t]||3e5}calculateIRR(t,s,a){return t<=0?0:Math.pow(s/t,1/a)-1}calculatePaybackPeriod(t,s){return s<=0?1/0:t/s}calculateUseConfidence(t,s){let a=50;if(s.zoning_data?.zoning_type){const n=this.getZoningTypeMatch(t,s.zoning_data.zoning_type);a+=n*20}return a+=15,a+=10,a+=5,Math.min(a,100)}getZoningTypeMatch(t,s){return({Residential:["Single Family","Multi-Family","Townhouse","Apartment"],Commercial:["Retail","Office","Restaurant","Hotel"],Industrial:["Warehouse","Manufacturing"],"Mixed-Use":["Mixed-Use Residential","Mixed-Use Commercial"]}[s]||[]).includes(t)?1:0}identifyUseConstraints(t,s){const a=[];return s.max_density_du_per_acre&&this.getRequiredDensity(t)>s.max_density_du_per_acre&&a.push(`Density limit: ${s.max_density_du_per_acre} DU/acre`),s.max_far&&this.getRequiredFAR(t)>s.max_far&&a.push(`FAR limit: ${s.max_far}`),s.max_building_height_ft&&this.getRequiredHeight(t)>s.max_building_height_ft&&a.push(`Height limit: ${s.max_building_height_ft} ft`),a}identifyUseMarketFactors(t,s){const a=[];return a.push("Strong market demand"),a.push("Good location access"),a.push("Adequate infrastructure"),a}identifyConstraints(t){const s=[];return t.max_density_du_per_acre&&s.push({type:"density",description:`Maximum density: ${t.max_density_du_per_acre} DU/acre`,value:t.max_density_du_per_acre,unit:"DU/acre",impact:"limiting"}),t.max_far&&s.push({type:"far",description:`Maximum FAR: ${t.max_far}`,value:t.max_far,unit:"ratio",impact:"limiting"}),t.max_building_height_ft&&s.push({type:"height",description:`Maximum height: ${t.max_building_height_ft} ft`,value:t.max_building_height_ft,unit:"ft",impact:"moderate"}),s}determineRecommendedUse(t){if(t.length===0)return"residential";const s=t[0];return s.use.includes("Mixed-Use")?"mixed-use":s.use.includes("Residential")||s.use.includes("Family")||s.use.includes("Apartment")?"residential":s.use.includes("Commercial")||s.use.includes("Retail")||s.use.includes("Office")?"commercial":s.use.includes("Industrial")||s.use.includes("Warehouse")||s.use.includes("Manufacturing")?"industrial":"residential"}calculateConfidence(t,s){if(t.length===0)return 0;const a=t.reduce((i,o)=>i+o.confidence,0)/t.length,n=s.reduce((i,o)=>i+o.weight*(o.impact==="positive"?1:o.impact==="negative"?-1:0),0);return Math.min(a+n*10,100)}generateFinancialProjections(t,s){const a=[],n=s[0];if(!n)return a;for(let i=1;i<=10;i++){const o=n.estimatedValue*1.03**i,l=n.developmentCost*.05,c=o-l,u=c,d=a.length>0?a[a.length-1].cumulativeCashFlow+u:u;a.push({year:i,revenue:o,expenses:l,netIncome:c,cashFlow:u,cumulativeCashFlow:d})}return a}}function hs(){const[r]=x.useState(()=>new Rn),[t,s]=x.useState(null),[a,n]=x.useState(!1),[i,o]=x.useState(null),l=x.useCallback(async p=>{n(!0),o(null);try{const _=await r.analyzeHBU(p);return s(_),_}catch(_){const w=_ instanceof Error?_.message:"Analysis failed";throw o(w),_}finally{n(!1)}},[r]),c=x.useCallback(()=>{s(null),o(null)},[]),u=x.useCallback((p=3)=>t?t.alternatives.slice(0,p):[],[t]),d=x.useCallback(()=>!t||t.alternatives.length===0?null:t.alternatives[0],[t]),m=x.useCallback(()=>t?t.confidence>=80?"high":t.confidence>=60?"medium":"low":"low",[t]),h=x.useCallback(()=>{if(!t)return[];const p=[];return t.confidence<70&&p.push("Low confidence in analysis"),t.constraints.some(w=>w.impact==="limiting")&&p.push("Significant zoning constraints"),t.alternatives.length<2&&p.push("Limited development options"),t.marketFactors.filter(w=>w.impact==="negative").length>0&&p.push("Negative market factors present"),p},[t]),g=x.useCallback(()=>{if(!t)return[];const p=[];return t.confidence>=80&&p.push("High confidence in recommended use"),t.alternatives.length>=3&&p.push("Multiple viable development options"),t.marketFactors.filter(w=>w.impact==="positive").length>0&&p.push("Favorable market conditions"),t.recommendedUse==="mixed-use"&&p.push("Mixed-use development potential"),p},[t]),y=x.useCallback(()=>{if(!t)return null;const p=d();return p?{estimatedValue:p.estimatedValue,developmentCost:p.developmentCost,netPresentValue:p.netPresentValue,internalRateOfReturn:p.internalRateOfReturn,paybackPeriod:p.paybackPeriod,confidence:p.confidence}:null},[t,d]),j=x.useCallback(()=>{if(!t)return null;const p=t.constraints.filter(P=>P.impact==="limiting"),_=t.constraints.filter(P=>P.impact==="moderate"),w=t.constraints.filter(P=>P.impact==="minimal");return{limiting:p.length,moderate:_.length,minimal:w.length,total:t.constraints.length,constraints:t.constraints}},[t]),b=x.useCallback(()=>{if(!t)return null;const p=t.marketFactors.filter(P=>P.impact==="positive"),_=t.marketFactors.filter(P=>P.impact==="negative"),w=t.marketFactors.filter(P=>P.impact==="neutral");return{positive:p.length,negative:_.length,neutral:w.length,total:t.marketFactors.length,factors:t.marketFactors}},[t]),v=x.useMemo(()=>t!==null&&!a&&!i,[t,a,i]),N=x.useMemo(()=>t!==null&&t.confidence>=80,[t]),C=x.useMemo(()=>t!==null&&t.alternatives.length>=2,[t]);return{analysis:t,loading:a,error:i,analyzeParcel:l,clearAnalysis:c,getTopAlternatives:u,getRecommendedAlternative:d,getConfidenceLevel:m,getRiskFactors:h,getOpportunities:g,getFinancialSummary:y,getConstraintSummary:j,getMarketSummary:b,isAnalysisComplete:v,hasHighConfidence:N,hasMultipleAlternatives:C}}const An=ee.memo(function({parcel:t,onClose:s}){const{analysis:a,loading:n,error:i,analyzeParcel:o,getTopAlternatives:l,getRecommendedAlternative:c,getConfidenceLevel:u,getRiskFactors:d,getOpportunities:m,getFinancialSummary:h,getConstraintSummary:g,getMarketSummary:y}=hs(),[j,b]=ee.useState(!1);ee.useEffect(()=>{t&&(console.log("Starting HBU analysis for parcel:",t),b(!0),o(t).then(k=>{console.log("HBU analysis completed:",k)}).catch(k=>{console.error("HBU analysis failed:",k)}).finally(()=>b(!1)))},[t,o]);const v=k=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(k),N=k=>`${(k*100).toFixed(1)}%`,C=k=>{switch(k){case"high":return"text-green-600 bg-green-100";case"medium":return"text-yellow-600 bg-yellow-100";case"low":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}};if(n||j)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Analyzing highest and best use..."})]})});if(i)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Le,{className:"w-5 h-5 text-red-600 mr-2"}),e.jsx("h3",{className:"text-red-800 font-medium",children:"Analysis Error"})]}),e.jsx("p",{className:"text-red-700 mt-2",children:i}),e.jsx("button",{onClick:()=>o(t),className:"mt-3 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Retry Analysis"})]})});if(!a)return e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center text-gray-500",children:[e.jsx(_e,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"No analysis available"})]})});const p=c(),_=h(),w=g(),P=y(),U=d(),R=m(),q=u();return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(_e,{className:"w-6 h-6 text-blue-600"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Highest & Best Use Analysis"})]}),s&&e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:"Ã—"})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:"Recommended Use"}),e.jsxs("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${C(q)}`,children:[q.toUpperCase()," CONFIDENCE"]})]}),e.jsx("div",{className:"text-2xl font-bold text-blue-800 capitalize",children:a.recommendedUse.replace("-"," ")}),p&&e.jsxs("div",{className:"mt-2 text-sm text-blue-700",children:[p.use," â€¢ ",v(p.estimatedValue)," estimated value"]})]}),_&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(Ee,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"font-semibold text-green-900",children:"Financial Projections"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-700",children:"Estimated Value"}),e.jsx("div",{className:"text-lg font-semibold text-green-800",children:v(_.estimatedValue)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-700",children:"Development Cost"}),e.jsx("div",{className:"text-lg font-semibold text-green-800",children:v(_.developmentCost)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-700",children:"Net Present Value"}),e.jsx("div",{className:"text-lg font-semibold text-green-800",children:v(_.netPresentValue)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-green-700",children:"IRR"}),e.jsx("div",{className:"text-lg font-semibold text-green-800",children:N(_.internalRateOfReturn)})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(fe,{className:"w-5 h-5 text-purple-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Alternative Uses"})]}),e.jsx("div",{className:"space-y-3",children:l(3).map((k,D)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:k.use}),e.jsx("div",{className:"text-sm text-gray-600",children:k.density>0?`${k.density} DU/acre`:`${k.height} ft height`})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:v(k.netPresentValue)}),e.jsxs("div",{className:"text-sm text-gray-600",children:[N(k.internalRateOfReturn)," IRR"]})]})]}),k.constraints.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Constraints:"}),e.jsx("div",{className:"text-xs text-gray-600",children:k.constraints.join(", ")})]})]},D))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[w&&w.total>0&&e.jsxs("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(ms,{className:"w-5 h-5 text-orange-600"}),e.jsx("h3",{className:"font-semibold text-orange-900",children:"Zoning Constraints"})]}),e.jsx("div",{className:"space-y-2",children:w.constraints.map((k,D)=>e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium text-orange-800",children:k.description}),e.jsxs("div",{className:"text-orange-700",children:["Impact: ",k.impact]})]},D))})]}),P&&P.total>0&&e.jsxs("div",{className:"bg-indigo-50 border border-indigo-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(We,{className:"w-5 h-5 text-indigo-600"}),e.jsx("h3",{className:"font-semibold text-indigo-900",children:"Market Factors"})]}),e.jsx("div",{className:"space-y-2",children:P.factors.map((k,D)=>e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium text-indigo-800",children:k.factor}),e.jsxs("div",{className:"text-indigo-700",children:[k.impact," â€¢ Weight: ",k.weight]})]},D))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[U.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(Le,{className:"w-5 h-5 text-red-600"}),e.jsx("h3",{className:"font-semibold text-red-900",children:"Risk Factors"})]}),e.jsx("ul",{className:"space-y-1",children:U.map((k,D)=>e.jsxs("li",{className:"text-sm text-red-700",children:["â€¢ ",k]},D))})]}),R.length>0&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(je,{className:"w-5 h-5 text-green-600"}),e.jsx("h3",{className:"font-semibold text-green-900",children:"Opportunities"})]}),e.jsx("ul",{className:"space-y-1",children:R.map((k,D)=>e.jsxs("li",{className:"text-sm text-green-700",children:["â€¢ ",k]},D))})]})]}),e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(Gt,{className:"w-4 h-4 text-gray-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Analysis Details"})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{children:["Analysis Date: ",a.analysisDate.toLocaleDateString()]}),e.jsxs("div",{children:["Analyst: ",a.analyst]}),e.jsxs("div",{children:["Confidence Score: ",a.confidence,"%"]}),e.jsxs("div",{children:["Alternatives Analyzed: ",a.alternatives.length]})]})]})]})});class In{constructor(t,s,a,n){nt(this,"zoningData");nt(this,"lotSize");nt(this,"lotWidth");nt(this,"lotDepth");this.zoningData=t,this.lotSize=s,this.lotWidth=a||Math.sqrt(s),this.lotDepth=n||Math.sqrt(s)}generateSitePlan(t){const s=this.extractConstraints(),a=[],n=[];this.validateBasicFeasibility(t,s,a,n);const i=this.calculateOptimalMassing(t,s),o=this.generateSitePlanVisualization(i,t),l=this.analyzeParkingRequirements(t,i),c=this.calculateFinancialImpact(i,l,t),u=this.generateRecommendations(i,l,s);return{isFeasible:a.length===0,violations:a,warnings:n,buildingMassing:i,sitePlan:o,parkingAnalysis:l,financialImpact:c,recommendations:u}}extractConstraints(){return{maxFAR:this.zoningData.max_far||0,maxHeight:this.zoningData.max_building_height_ft||0,maxCoverage:this.zoningData.max_coverage_pct||0,minFrontSetback:this.zoningData.min_front_setback_ft||0,minRearSetback:this.zoningData.min_rear_setback_ft||0,minSideSetback:this.zoningData.min_side_setback_ft||0,minLotArea:this.zoningData.min_lot_area_sq_ft||0,minLotWidth:this.zoningData.min_lot_width_ft||0,maxDensity:this.zoningData.max_density_du_per_acre||0,minLandscapedSpace:this.zoningData.min_landscaped_space_pct||0,minOpenSpace:this.zoningData.min_open_space_pct||0}}validateBasicFeasibility(t,s,a,n){if(s.minLotArea>0&&this.lotSize<s.minLotArea&&a.push(`Lot size (${this.lotSize.toLocaleString()} sq ft) is below minimum required (${s.minLotArea.toLocaleString()} sq ft)`),s.minLotWidth>0&&this.lotWidth<s.minLotWidth&&a.push(`Lot width (${this.lotWidth} ft) is below minimum required (${s.minLotWidth} ft)`),s.maxDensity>0){const i=t.targetUnits/(this.lotSize/43560);i>s.maxDensity&&a.push(`Proposed density (${i.toFixed(1)} DU/acre) exceeds maximum allowed (${s.maxDensity} DU/acre)`)}if(t.targetUnits>0){const i=this.getAverageUnitSize(t.unitMix),l=t.targetUnits*i/this.lotSize;s.maxFAR>0&&l>s.maxFAR&&a.push(`Required FAR (${l.toFixed(2)}) exceeds maximum allowed (${s.maxFAR})`)}}calculateOptimalMassing(t,s){const a=this.getAverageUnitSize(t.unitMix),n=t.targetUnits*a,i=this.lotWidth-s.minFrontSetback-s.minRearSetback,o=this.lotDepth-s.minSideSetback*2,l=i*o,c=this.lotSize*(s.maxCoverage/100),u=Math.min(l,c),d=n/u,m=s.maxHeight>0?s.maxHeight:100,h=Math.min(d,m),g=Math.floor(h/10),y=g*10,j=u*g,b=j/this.lotSize;this.lotSize*(s.minOpenSpace/100);const v=this.lotSize-u;return{footprint:u,totalGSF:j,height:y,stories:g,units:t.targetUnits,coverage:u/this.lotSize*100,far:b,buildableArea:u,openSpaceArea:v,amenitySpace:t.amenitySpace,averageUnitSize:a,constraintAnalysis:{farUtilization:s.maxFAR>0?b/s.maxFAR*100:0,heightUtilization:s.maxHeight>0?y/s.maxHeight*100:0,coverageUtilization:s.maxCoverage>0?u/c*100:0,limitingFactor:this.getLimitingFactor(s,b,y,u,c)}}}generateSitePlanVisualization(t,s){const a=[],n=[],i=[],o={id:"main-building",coordinates:this.generateBuildingCoordinates(t.footprint),height:t.height,stories:t.stories,use:s.buildingType,units:t.units,gsf:t.totalGSF};a.push(o);const l={id:"main-open-space",coordinates:this.generateOpenSpaceCoordinates(t.footprint),type:"garden",amenities:["landscaping","seating","walkways"]};n.push(l);const c=this.analyzeParkingRequirements(s,t);if(c.requiredSpaces>0){const u={id:"main-parking",coordinates:this.generateParkingCoordinates(c.requiredSpaces),type:s.parkingType,spaces:c.requiredSpaces,accessPoint:[this.lotWidth/2,this.lotDepth]};i.push(u)}return{buildings:a,openSpaces:n,parkingAreas:i,utilities:[],circulation:[]}}analyzeParkingRequirements(t,s){const a=this.getParkingRequirements(t.buildingType);let n=0;if((t.buildingType==="residential"||t.buildingType==="mixed-use")&&(n+=t.unitMix.studio*a.residential.studio,n+=t.unitMix.oneBedroom*a.residential.oneBedroom,n+=t.unitMix.twoBedroom*a.residential.twoBedroom,n+=t.unitMix.threeBedroom*a.residential.threeBedroom,n+=Math.ceil(t.targetUnits*.25)),t.buildingType==="commercial"||t.buildingType==="mixed-use"){const u=s.totalGSF*.3;n+=Math.ceil(u/1e3*3)}const i=Math.ceil(n*.02);n+=i;const o=this.getParkingCostPerSpace(t.parkingType),l=n*o,c=n/(s.totalGSF/1e3)*100;return{requiredSpaces:n,providedSpaces:n,deficit:0,surplus:0,costPerSpace:o,totalParkingCost:l,parkingEfficiency:c}}calculateFinancialImpact(t,s,a){const n=this.getHardCostPerSqFt(a.buildingType);t.totalGSF*n;const i=s.totalParkingCost+a.amenitySpace*200,o=this.getRevenuePerSqFt(a.buildingType),l=t.totalGSF*o,c=l-i,u=i/a.targetUnits,d=t.totalGSF*o/a.targetUnits;return{additionalCost:i,additionalRevenue:l,netImpact:c,costPerUnit:u,revenuePerUnit:d}}generateRecommendations(t,s,a){const n=[];return t.constraintAnalysis.farUtilization<80&&n.push(`Consider increasing building height to better utilize FAR (currently ${t.constraintAnalysis.farUtilization.toFixed(1)}%)`),t.constraintAnalysis.heightUtilization<80&&n.push(`Consider increasing building height to better utilize height allowance (currently ${t.constraintAnalysis.heightUtilization.toFixed(1)}%)`),t.constraintAnalysis.coverageUtilization<80&&n.push(`Consider increasing building footprint to better utilize coverage allowance (currently ${t.constraintAnalysis.coverageUtilization.toFixed(1)}%)`),s.parkingEfficiency>4&&n.push(`Consider reducing parking requirements or using more efficient parking solutions (currently ${s.parkingEfficiency.toFixed(1)} spaces per 1000 sq ft)`),t.openSpaceArea<this.lotSize*.15&&n.push("Consider increasing open space to improve marketability and resident satisfaction"),n}getAverageUnitSize(t){const s=t.studio+t.oneBedroom+t.twoBedroom+t.threeBedroom;return s===0?800:(t.studio*500+t.oneBedroom*700+t.twoBedroom*1e3+t.threeBedroom*1300)/s}getLimitingFactor(t,s,a,n,i){const o=t.maxFAR>0?s/t.maxFAR:1,l=t.maxHeight>0?a/t.maxHeight:1,c=t.maxCoverage>0?n/i:1;return o>=.95?"FAR":l>=.95?"Height":c>=.95?"Coverage":"None"}getParkingRequirements(t){return{residential:{studio:.5,oneBedroom:1,twoBedroom:1.5,threeBedroom:2},commercial:{office:3,retail:4,restaurant:10},visitor:.25,accessible:.02}}getParkingCostPerSpace(t){switch(t){case"surface":return 5e3;case"garage":return 25e3;case"underground":return 4e4;default:return 15e3}}getHardCostPerSqFt(t){switch(t){case"residential":return 200;case"commercial":return 250;case"mixed-use":return 225;default:return 200}}getRevenuePerSqFt(t){switch(t){case"residential":return 400;case"commercial":return 300;case"mixed-use":return 350;default:return 350}}generateBuildingCoordinates(t){const s=Math.sqrt(t);return[[0,0],[s,0],[s,s],[0,s],[0,0]]}generateOpenSpaceCoordinates(t){return[[0,0],[this.lotWidth,0],[this.lotWidth,this.lotDepth],[0,this.lotDepth],[0,0]]}generateParkingCoordinates(t){const a=Math.ceil(t/10),n=10*9,i=a*18;return[[0,0],[n,0],[n,i],[0,i],[0,0]]}}function zn(r,t){const[s,a]=x.useState({targetUnits:20,unitMix:{studio:.2,oneBedroom:.4,twoBedroom:.3,threeBedroom:.1},buildingType:"residential",parkingType:"surface",amenitySpace:2e3,openSpaceRatio:.15}),[n,i]=x.useState(null),[o,l]=x.useState(!1),[c,u]=x.useState(null),d=x.useMemo(()=>!r||!t?null:new In(r,t),[r,t]),m=x.useCallback(async()=>{if(!d){u("Site plan engine not available");return}l(!0),u(null);try{const w=d.generateSitePlan(s);i(w)}catch(w){const P=w instanceof Error?w.message:"Site plan generation failed";u(P)}finally{l(!1)}},[d,s]),h=x.useCallback(w=>{a(P=>({...P,...w}))},[]),g=x.useCallback((w,P)=>{a(U=>({...U,unitMix:{...U.unitMix,[w]:P}}))},[]),y=x.useCallback(()=>{d&&s.targetUnits>0&&m()},[d,s,m]),j=x.useCallback(()=>r?{maxFAR:r.max_far||0,maxHeight:r.max_building_height_ft||0,maxCoverage:r.max_coverage_pct||0,maxDensity:r.max_density_du_per_acre||0,minSetbacks:{front:r.min_front_setback_ft||0,rear:r.min_rear_setback_ft||0,side:r.min_side_setback_ft||0}}:null,[r]),b=x.useCallback(()=>n?n.isFeasible?n.violations.length===0&&n.warnings.length===0?"excellent":n.warnings.length<=2?"good":"acceptable":"infeasible":"unknown",[n]),v=x.useCallback(()=>{if(!n)return 0;const w=n.buildingMassing,P=w.constraintAnalysis.farUtilization,U=w.constraintAnalysis.heightUtilization,R=w.constraintAnalysis.coverageUtilization;return(P+U+R)/3},[n]),N=x.useCallback(()=>{if(!n)return null;const{financialImpact:w,buildingMassing:P}=n;return{totalCost:w.additionalCost,totalRevenue:w.additionalRevenue,netImpact:w.netImpact,costPerUnit:w.costPerUnit,revenuePerUnit:w.revenuePerUnit,costPerSqFt:w.additionalCost/P.totalGSF,revenuePerSqFt:w.additionalRevenue/P.totalGSF}},[n]),C=x.useCallback(()=>{if(!n)return null;const{parkingAnalysis:w}=n;return{requiredSpaces:w.requiredSpaces,costPerSpace:w.costPerSpace,totalCost:w.totalParkingCost,efficiency:w.parkingEfficiency,type:s.parkingType}},[n,s.parkingType]),p=x.useCallback(()=>{const w=[],P=[],U=Object.values(s.unitMix).reduce((R,q)=>R+q,0);return Math.abs(U-1)>.01&&w.push("Unit mix percentages must total 100%"),s.targetUnits<=0&&w.push("Target units must be greater than 0"),s.amenitySpace<0&&w.push("Amenity space cannot be negative"),(s.openSpaceRatio<0||s.openSpaceRatio>1)&&w.push("Open space ratio must be between 0% and 100%"),{errors:w,warnings:P}},[s]),_=x.useCallback(()=>{if(!r||!t)return[];const w=[];return r.max_density_du_per_acre&&r.max_density_du_per_acre>20&&w.push({name:"High-Density Residential",description:"Maximize density with efficient unit mix",configuration:{targetUnits:Math.floor(t/43560*r.max_density_du_per_acre*.9),unitMix:{studio:.3,oneBedroom:.5,twoBedroom:.2,threeBedroom:0},buildingType:"residential",parkingType:"garage",amenitySpace:3e3,openSpaceRatio:.2}}),(r.zoning_type==="Mixed-Use"||r.zoning_type==="Commercial")&&w.push({name:"Mixed-Use Development",description:"Combine residential and commercial uses",configuration:{targetUnits:Math.floor(t/43560*15),unitMix:{studio:.2,oneBedroom:.4,twoBedroom:.3,threeBedroom:.1},buildingType:"mixed-use",parkingType:"garage",amenitySpace:4e3,openSpaceRatio:.15}}),w.push({name:"Luxury Residential",description:"Premium units with extensive amenities",configuration:{targetUnits:Math.floor(t/43560*8),unitMix:{studio:.1,oneBedroom:.3,twoBedroom:.4,threeBedroom:.2},buildingType:"residential",parkingType:"underground",amenitySpace:5e3,openSpaceRatio:.25}}),w},[r,t]);return{configuration:s,sitePlanResult:n,loading:o,error:c,generateSitePlan:m,updateConfiguration:h,updateUnitMix:g,autoGenerate:y,getConstraintSummary:j,getFeasibilityStatus:b,getOptimizationScore:v,getFinancialSummary:N,getParkingSummary:C,validateConfiguration:p,getRecommendedConfigurations:_,isEngineAvailable:!!d,hasSitePlan:!!n,isFeasible:n?.isFeasible||!1}}let ma=class extends x.Component{constructor(s){super(s);nt(this,"handleRetry",()=>{this.setState({hasError:!1,error:null,errorInfo:null})});nt(this,"handleGoHome",()=>{window.location.href="/"});this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s,errorInfo:null}}componentDidCatch(s,a){console.error("ErrorBoundary caught an error:",s,a),this.setState({error:s,errorInfo:a}),this.props.onError?.(s,a)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center px-4",children:e.jsx("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4",children:e.jsx(Le,{className:"h-6 w-6 text-red-600"})}),e.jsx("h1",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Something went wrong"}),e.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"We encountered an unexpected error. Don't worry, your data is safe."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:this.handleRetry,className:"w-full flex items-center justify-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(ds,{className:"w-4 h-4 mr-2"}),"Try Again"]}),e.jsxs("button",{onClick:this.handleGoHome,className:"w-full flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(Qs,{className:"w-4 h-4 mr-2"}),"Go Home"]})]}),!1]})})}):this.props.children}};function xa({children:r}){return e.jsx(ma,{fallback:e.jsx("div",{className:"flex items-center justify-center h-64 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Le,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Site Planner Error"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"The site planner encountered an error. Please try refreshing the page."}),e.jsxs("button",{onClick:()=>window.location.reload(),className:"mt-3 inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-blue-700 bg-blue-100 hover:bg-blue-200",children:[e.jsx(ds,{className:"w-4 h-4 mr-1"}),"Refresh"]})]})}),children:r})}const rt=12,Mt=1/rt,jt=.3048,Rt=3.28084;class Ge{static toFeet(t){if(!t||!t.coordinates)return t;const s=a=>Array.isArray(a)?typeof a[0]=="number"?[a[0]*Rt,a[1]*Rt]:a.map(s):a;return{...t,coordinates:s(t.coordinates)}}static toSVG(t){if(!t||!t.coordinates)return t;const s=a=>Array.isArray(a)?typeof a[0]=="number"?[a[0]*rt,a[1]*rt]:a.map(s):a;return{...t,coordinates:s(t.coordinates)}}static to3857(t){if(!t||!t.coordinates)return t;const s=a=>Array.isArray(a)?typeof a[0]=="number"?[a[0]*Mt*jt,a[1]*Mt*jt]:a.map(s):a;return{...t,coordinates:s(t.coordinates)}}static webMercatorToFeet(t){return t.map(([s,a])=>[s*Rt,a*Rt])}static feetToSVG(t){return t.map(([s,a])=>[s*rt,a*rt])}static svgToFeet(t){return t.map(([s,a])=>[s*Mt,a*Mt])}static calculateBounds(t){return t.length===0?{minX:0,minY:0,maxX:0,maxY:0}:t.reduce((s,[a,n])=>({minX:Math.min(s.minX,a),minY:Math.min(s.minY,n),maxX:Math.max(s.maxX,a),maxY:Math.max(s.maxY,n)}),{minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0})}static normalizeCoordinates(t,s){const a=s||this.calculateBounds(t);return{coords:t.map(([i,o])=>[i-a.minX,o-a.minY]),bounds:{minX:0,minY:0,maxX:a.maxX-a.minX,maxY:a.maxY-a.minY}}}static calculatePolygonPerimeter(t,s="feet"){if(t.length<3)return 0;let a=0;for(let n=0;n<t.length;n++){const i=t[n],o=t[(n+1)%t.length],l=o[0]-i[0],c=o[1]-i[1];a+=Math.sqrt(l*l+c*c)}switch(s){case"meters":return a*jt;case"svg":return a*rt;case"feet":default:return a}}static calculatePolygonArea(t,s="feet"){if(t.length<3)return 0;let a=0;for(let n=0;n<t.length;n++){const i=t[n],o=t[(n+1)%t.length];a+=i[0]*o[1]-o[0]*i[1]}switch(a=Math.abs(a)/2,s){case"meters":return a*jt*jt;case"svg":return a*rt*rt;case"feet":default:return a}}static metersToFeet(t){return t*Rt}static feetToMeters(t){return t*jt}static feetToSVGUnits(t){return t*rt}static svgUnitsToFeet(t){return t*Mt}}const{toFeet:oi,toSVG:ci,to3857:di,webMercatorToFeet:mi,feetToSVG:xi,svgToFeet:ui,calculateBounds:hi,normalizeCoordinates:gi,calculatePolygonPerimeter:pi,calculatePolygonArea:fi,metersToFeet:bi,feetToMeters:yi,feetToSVGUnits:ji,svgUnitsToFeet:vi}=Ge;class $n{async fetchParcelGeometry3857(t){if(!Q)return console.error("âŒ Supabase client not initialized"),null;try{console.log("ðŸ” Fetching parcel geometry in EPSG:3857 for OGC_FID:",t);const{data:s,error:a}=await Q.rpc("get_parcel_geometry_3857",{p_ogc_fid:t});if(a)return console.error("âŒ Error fetching parcel geometry:",a),console.error("âŒ Error details:",{message:a.message,details:a.details,hint:a.hint,code:a.code}),null;if(!s||s.length===0)return console.warn("âš ï¸ No geometry data found for OGC_FID:",t),console.warn("âš ï¸ This might mean the function is not deployed or the parcel does not exist"),null;const n=s[0];return console.log("âœ… Parcel geometry fetched successfully:",n),console.log("âœ… Geometry data structure:",{hasGeometry:!!n.geometry_3857,hasArea:!!n.sqft,hasDimensions:!!n.parcel_width_ft&&!!n.parcel_depth_ft}),n}catch(s){return console.error("âŒ Exception fetching parcel geometry:",s),null}}async fetchParcelBuildableEnvelope(t){if(!Q)return console.error("âŒ Supabase client not initialized"),null;try{console.log("ðŸ—ï¸ Fetching buildable envelope for OGC_FID:",t);const{data:s,error:a}=await Q.rpc("get_parcel_buildable_envelope",{p_ogc_fid:t});if(a)return console.error("âŒ Error fetching buildable envelope:",a),null;if(!s||s.length===0)return console.warn("âš ï¸ No buildable envelope data found for OGC_FID:",t),null;const n=s[0];return console.log("âœ… Buildable envelope fetched successfully:",n),n}catch(s){return console.error("âŒ Exception fetching buildable envelope:",s),null}}parseGeometryForSitePlanner(t){console.log("ðŸ”§ Parsing geometry for site planner...");const s=t.geometry_3857;if(!s)return console.warn("âš ï¸ No geometry available, creating fallback"),this.createFallbackGeometry(t.sqft);try{let a;if(s.type==="Polygon")a=s.coordinates[0];else if(s.type==="MultiPolygon")a=s.coordinates[0][0];else return console.warn("âš ï¸ Unsupported geometry type:",s.type),this.createFallbackGeometry(t.sqft);console.log("ðŸ“ Original coordinates (first 3):",a.slice(0,3));const n=Ge.webMercatorToFeet(a),i=Ge.calculateBounds(n),{coords:o}=Ge.normalizeCoordinates(n,i),l=i.maxX-i.minX,c=i.maxY-i.minY,u=t.sqft,d=t.perimeter_ft,m={x:Ge.metersToFeet(t.centroid_x)-i.minX,y:Ge.metersToFeet(t.centroid_y)-i.minY},h={coordinates:n,bounds:i,width:l,depth:c,area:u,perimeter:d,centroid:m,normalizedCoordinates:o};return console.log("âœ… Geometry parsed successfully:",{width:h.width.toFixed(2),depth:h.depth.toFixed(2),area:h.area.toLocaleString(),perimeter:h.perimeter.toFixed(2)}),h}catch(a){return console.error("âŒ Error parsing geometry:",a),this.createFallbackGeometry(t.sqft)}}parseBuildableEnvelopeForSitePlanner(t){console.log("ðŸ”§ Parsing buildable envelope for site planner...");const s=t.buildable_geom;if(!s)return console.warn("âš ï¸ No buildable geometry available"),this.createFallbackGeometry(t.area_sqft);try{let a;if(s.type==="Polygon")a=s.coordinates[0];else if(s.type==="MultiPolygon")a=s.coordinates[0][0];else return console.warn("âš ï¸ Unsupported buildable geometry type:",s.type),this.createFallbackGeometry(t.area_sqft);console.log("ðŸ“ Buildable coordinates (first 3):",a.slice(0,3));const n=Ge.webMercatorToFeet(a),i=Ge.calculateBounds(n),{coords:o}=Ge.normalizeCoordinates(n,i),l=i.maxX-i.minX,c=i.maxY-i.minY,u=t.area_sqft,d=Ge.calculatePolygonPerimeter(n,"feet"),m={x:l/2,y:c/2},h={coordinates:n,bounds:i,width:l,depth:c,area:u,perimeter:d,centroid:m,normalizedCoordinates:o,setbacks_applied:t.setbacks_applied,edge_types:t.edge_types};return console.log("âœ… Buildable envelope parsed successfully:",{width:h.width.toFixed(2),depth:h.depth.toFixed(2),area:h.area.toLocaleString(),perimeter:h.perimeter.toFixed(2),setbacks:t.setbacks_applied,easements:t.easements_removed}),h}catch(a){return console.error("âŒ Error parsing buildable envelope:",a),this.createFallbackGeometry(t.area_sqft)}}createFallbackGeometry(t){console.log("ðŸ”§ Creating fallback geometry for area:",t);const s=Math.sqrt(t),a=s/2,n=[[-a,-a],[a,-a],[a,a],[-a,a],[-a,-a]],i={minX:-a,minY:-a,maxX:a,maxY:a},o=[[0,0],[s,0],[s,s],[0,s],[0,0]];return{coordinates:n,bounds:i,width:s,depth:s,area:t,perimeter:s*4,centroid:{x:0,y:0},normalizedCoordinates:o}}validateGeometry(t){const s=[];if((!t.coordinates||t.coordinates.length<3)&&s.push("Invalid coordinates: must have at least 3 points"),t.area<=0&&s.push("Invalid area: must be greater than 0"),(t.width<=0||t.depth<=0)&&s.push("Invalid dimensions: width and depth must be greater than 0"),t.perimeter<=0&&s.push("Invalid perimeter: must be greater than 0"),t.coordinates.length>=4){const a=t.coordinates;for(let n=0;n<a.length-1;n++){for(let i=n+2;i<a.length-1;i++)if(this.linesIntersect(a[n],a[n+1],a[i],a[i+1])){s.push("Self-intersecting polygon detected");break}if(s.length>0)break}}return{isValid:s.length===0,errors:s}}linesIntersect(t,s,a,n){const[i,o]=t,[l,c]=s,[u,d]=a,[m,h]=n,g=(i-l)*(d-h)-(o-c)*(u-m);if(Math.abs(g)<1e-10)return!1;const y=((i-u)*(d-h)-(o-d)*(u-m))/g,j=-((i-l)*(o-d)-(o-c)*(i-u))/g;return y>=0&&y<=1&&j>=0&&j<=1}getGeometryStats(t){const s=t.width/t.depth,a=4*Math.PI*t.area/(t.perimeter*t.perimeter);return{area:t.area,perimeter:t.perimeter,width:t.width,depth:t.depth,aspectRatio:s,compactness:a}}}const gs=new $n,En=r=>gs.fetchParcelGeometry3857(r),Us=r=>gs.fetchParcelBuildableEnvelope(r),Dn=r=>gs.parseGeometryForSitePlanner(r);async function On(r){try{console.log(`ðŸŒ Importing roads from OpenStreetMap for parcel ${r}`);const{data:t,error:s}=await Q.from("parcels").select("ogc_fid, wkb_geometry_4326, address").eq("ogc_fid",r).single();if(s)throw new Error(`Failed to get parcel: ${s.message}`);console.log("ðŸ“¦ Parcel data:",t);let a,n,i;try{typeof t.wkb_geometry_4326=="string"?a=JSON.parse(t.wkb_geometry_4326):a=t.wkb_geometry_4326,console.log("ðŸ” Parsed geometry:",a);let j;if(a.type==="Polygon"&&a.coordinates&&a.coordinates[0])j=a.coordinates[0];else if(a.type==="MultiPolygon"&&a.coordinates&&a.coordinates[0]&&a.coordinates[0][0])j=a.coordinates[0][0];else throw console.error("âŒ Unsupported geometry type or structure:",a),new Error("Unsupported geometry type");if(console.log("ðŸ“ Coordinates array length:",j.length),n=j.reduce((b,v)=>b+v[0],0)/j.length,i=j.reduce((b,v)=>b+v[1],0)/j.length,console.log("ðŸ“ Calculated center:",{centerLon:n,centerLat:i}),isNaN(n)||isNaN(i))throw new Error("Invalid coordinates calculated")}catch(j){throw console.error("âŒ Error parsing parcel geometry:",j),new Error(`Failed to parse parcel geometry: ${j.message}`)}const o=.005,l={south:i-o,west:n-o,north:i+o,east:n+o};console.log(`ðŸ“ Searching for roads around: ${n}, ${i}`),console.log(`ðŸ“¦ Bounding box: ${l.south},${l.west},${l.north},${l.east}`);const c=`[out:json][timeout:25];
(way["highway"~"^(primary|secondary|tertiary|residential|trunk|unclassified)$"](${l.south},${l.west},${l.north},${l.east});
);
out geom;`,u="https://overpass-api.de/api/interpreter";console.log("ðŸ›£ï¸ Fetching roads from OpenStreetMap..."),console.log("ðŸ“¡ Overpass query:",c);const d=await fetch(u,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`data=${encodeURIComponent(c)}`});if(console.log(`ðŸ“¡ OSM API response status: ${d.status}`),!d.ok){const j=await d.text();throw console.error(`âŒ OSM API error: ${d.status} ${d.statusText}`,j),new Error(`OSM API error: ${d.status} ${d.statusText}`)}const m=await d.json();console.log(`âœ… Found ${m.elements.length} roads from OSM`);const h=[];for(const j of m.elements)if(j.type==="way"&&j.geometry){const b=j.tags.name||j.tags["addr:street"]||j.tags.highway||"Unnamed Road",v=j.tags.highway||"unknown",N=j.geometry.map(p=>`${p.lon} ${p.lat}`).join(","),C={osm_id:j.id,name:b,highway:v,geom:`LINESTRING(${N})`};h.push(C)}console.log("ðŸ” Processed roads:",h.map(j=>({name:j.name,class:j.highway})));let g=0;for(const j of h)try{const{data:b,error:v}=await Q.rpc("insert_road",{p_osm_id:j.osm_id,p_name:j.name,p_highway:j.highway,p_geom_wkt:j.geom});v?console.warn(`âš ï¸ Failed to insert ${j.name}:`,v):(g++,console.log(`âœ… Inserted: ${j.name} (${j.highway})`))}catch(b){console.warn(`âš ï¸ Insert error for ${j.name}:`,b)}const y=h.map(j=>j.name).filter(j=>j!=="Unnamed Road");return console.log(`ðŸŽ‰ Successfully imported ${g}/${h.length} roads`),console.log(`ðŸ“ Road names: ${y.join(", ")}`),{success:!0,roadsImported:g,totalFound:m.elements.length,roadNames:y,parcelAddress:t.address}}catch(t){return console.error("âŒ Error importing roads from OSM:",t),{success:!1,error:t.message}}}async function Un(r){try{const{data:t,error:s}=await Q.from("roads").select("id, name").limit(5);return!s&&t&&t.length>0?(console.log("âœ… Roads already exist:",t.map(a=>a.name)),{success:!0,message:`${t.length} roads already available`}):(console.log("ðŸ“ No roads found, importing from OpenStreetMap..."),await On(r))}catch(t){return console.error("âŒ Error checking/importing OSM roads:",t),{success:!1,error:t.message}}}const L=()=>Math.random().toString(36).substr(2,9),is=r=>{if(r.length<3)return 0;let t=0;for(let s=0;s<r.length;s++){const a=(s+1)%r.length;t+=r[s].x*r[a].y,t-=r[a].x*r[s].y}return Math.abs(t/2)},Tn=r=>{if(r.length<2)return 0;let t=0;for(let s=0;s<r.length;s++){const a=(s+1)%r.length,n=r[a].x-r[s].x,i=r[a].y-r[s].y;t+=Math.sqrt(n*n+i*i)}return t},ls=r=>r.length===0?"":`${r.map((s,a)=>`${a===0?"M":"L"} ${s.x} ${s.y}`).join(" ")} Z`,be=(r,t,s=!0)=>s?Math.round(r/t)*t:r,ua=(r,t)=>{let s=!1;for(let a=0,n=t.length-1;a<t.length;n=a++)t[a].y>r.y!=t[n].y>r.y&&r.x<(t[n].x-t[a].x)*(r.y-t[a].y)/(t[n].y-t[a].y)+t[a].x&&(s=!s);return s},At=(r,t,s=[],a=12)=>{const n=[],l=Math.ceil(r/50),c=Math.ceil(r/l);console.log(`ðŸš— Generating ${l} parking lots with ${c} spaces each (${r} total)`);for(let u=0;u<l;u++){const d=Math.min(c,r-u*c);if(d<=0)break;const m=d*350,g=Math.sqrt(m*2.5),y=m/g,j=g*a,b=y*a,v=qn(t,j,b,[...s,...n],u);if(v){const N={id:`parking-${u+1}`,type:"parking",vertices:[{id:"1",x:v.x,y:v.y},{id:"2",x:v.x+j,y:v.y},{id:"3",x:v.x+j,y:v.y+b},{id:"4",x:v.x,y:v.y+b}],properties:{name:`Parking Lot ${u+1}`,area:m,perimeter:2*(g+y),color:"#E5E7EB",strokeColor:"#9CA3AF",fillOpacity:.8}};n.push(N),console.log(`âœ… Created parking lot ${u+1}: ${d} spaces, ${g.toFixed(0)}' x ${y.toFixed(0)}'`)}else console.warn(`âš ï¸ Could not place parking lot ${u+1} within buildable area`)}return n},qn=(r,t,s,a,n)=>{const i=r.vertices.reduce((l,c)=>({minX:Math.min(l.minX,c.x),maxX:Math.max(l.maxX,c.x),minY:Math.min(l.minY,c.y),maxY:Math.max(l.maxY,c.y)}),{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0}),o=[()=>{const c=[{x:i.minX+20,y:i.minY+20},{x:i.maxX-t-20,y:i.minY+20},{x:i.minX+20,y:i.maxY-s-20},{x:i.maxX-t-20,y:i.maxY-s-20}];for(const u of c)if(as(u,t,s,r,a))return u;return null},()=>{const l=i.minX+(i.maxX-i.minX)/2,c=i.minY+(i.maxY-i.minY)/2,u=n*100,d=[{x:l-t/2,y:c-s/2+u},{x:l-t/2-u,y:c-s/2},{x:l-t/2+u,y:c-s/2}];for(const m of d)if(as(m,t,s,r,a))return m;return null},()=>{for(let c=i.minY;c<=i.maxY-s;c+=50)for(let u=i.minX;u<=i.maxX-t;u+=50){const d={x:u,y:c};if(as(d,t,s,r,a))return d}return null}];for(const l of o){const c=l();if(c)return c}return null},as=(r,t,s,a,n)=>{if(![{x:r.x,y:r.y},{x:r.x+t,y:r.y},{x:r.x+t,y:r.y+s},{x:r.x,y:r.y+s}].every(o=>ua(o,a.vertices)))return!1;for(const o of n)if(o.type==="building"||o.type==="parking"){const l=o.vertices.reduce((d,m)=>({minX:Math.min(d.minX,m.x),maxX:Math.max(d.maxX,m.x),minY:Math.min(d.minY,m.y),maxY:Math.max(d.maxY,m.y)}),{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0}),c={minX:r.x,maxX:r.x+t,minY:r.y,maxY:r.y+s},u=20;if(!(c.maxX+u<l.minX||c.minX-u>l.maxX||c.maxY+u<l.minY||c.minY-u>l.maxY))return!1}return!0},St=(r,t)=>{const s=r.vertices.every(a=>ua(a,t.vertices));return console.log("ðŸ” Building boundary validation:",{allCornersInside:s,buildingVertices:r.vertices,buildableVertices:t.vertices,isValid:s}),s},Ts=r=>{const t=r.vertices.reduce((l,c)=>({minX:Math.min(l.minX,c.x),maxX:Math.max(l.maxX,c.x),minY:Math.min(l.minY,c.y),maxY:Math.max(l.maxY,c.y)}),{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0}),s=t.maxX-t.minX,a=t.maxY-t.minY,n=s/a;let i;n>1.5?i="horizontal":n<.67?i="vertical":i="diagonal";let o=0;if(i==="diagonal"){let l=0,c=0;for(let u=0;u<r.vertices.length;u++){const d=r.vertices[u],m=r.vertices[(u+1)%r.vertices.length],h=Math.sqrt(Math.pow(m.x-d.x,2)+Math.pow(m.y-d.y,2));h>l&&(l=h,c=Math.atan2(m.y-d.y,m.x-d.x))}o=c}return console.log("ðŸ§­ Parcel orientation analysis:",{primaryAxis:i,aspectRatio:n.toFixed(2),rotationAngle:(o*180/Math.PI).toFixed(1)+"Â°",width:s.toFixed(0),height:a.toFixed(0)}),{primaryAxis:i,rotationAngle:o,aspectRatio:n,bounds:t}},Tt=(r,t,s,a,n)=>{const i=r.vertices.reduce((d,m)=>({minX:Math.min(d.minX,m.x),maxX:Math.max(d.maxX,m.x),minY:Math.min(d.minY,m.y),maxY:Math.max(d.maxY,m.y)}),{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0});if(n){const d={vertices:[{id:"1",x:n.x,y:n.y},{id:"2",x:n.x+t,y:n.y},{id:"3",x:n.x+t,y:n.y+s},{id:"4",x:n.x,y:n.y+s}]};if(St(d,r))return n}let o=50,l=0;const c=500;console.log("ðŸ” Searching for valid building position:",{buildingWidthSVG:t,buildingHeightSVG:s,bounds:i,step:o});const u=[50,25,12,6];for(const d of u){o=d,console.log(`ðŸ” Trying step size: ${o}`);for(let m=i.minY;m<=i.maxY-s;m+=o){for(let h=i.minX;h<=i.maxX-t;h+=o){if(l++,l>c){console.warn("âš ï¸ Max attempts reached, stopping search");break}const g={vertices:[{id:"1",x:h,y:m},{id:"2",x:h+t,y:m},{id:"3",x:h+t,y:m+s},{id:"4",x:h,y:m+s}]};if(St(g,r))return console.log(`âœ… Found valid position at (${h}, ${m}) after ${l} attempts with step ${o}`),{x:h,y:m}}if(l>c)break}if(l>c)break}return console.warn(`âš ï¸ Could not find valid building position within buildable area after ${l} attempts`),null},qs=(r,t=12)=>r/t,it=(r,t=12)=>{const s=is(r.vertices),a=Tn(r.vertices),n=s/(t*t),i=a/t;return{...r,properties:{...r.properties,area:n,perimeter:i}}},ha=r=>{const t=r.reduce((a,n)=>a+n.x,0),s=r.reduce((a,n)=>a+n.y,0);return{x:t/r.length,y:s/r.length}},Yn=(r,t,s)=>{const a=s*Math.PI/180,n=Math.cos(a),i=Math.sin(a),o=r.x-t.x,l=r.y-t.y;return{x:t.x+o*n-l*i,y:t.y+o*i+l*n}},Ln=(r,t,s)=>{const a=s||ha(r.vertices),n=r.vertices.map(i=>Yn(i,a,t));return{...r,vertices:n,rotation:t}},Bn=r=>{if(r.type!=="parking")return[];const t=`parking-clip-${r.id}`,s=[];s.push(e.jsx("defs",{children:e.jsx("clipPath",{id:t,children:e.jsx("path",{d:ls(r.vertices)})})},`defs-${r.id}`));const a=r.vertices.reduce((g,y)=>({minX:Math.min(g.minX,y.x),maxX:Math.max(g.maxX,y.x),minY:Math.min(g.minY,y.y),maxY:Math.max(g.maxY,y.y)}),{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0}),n=a.maxX-a.minX,i=a.maxY-a.minY,o=108,l=216,c=Math.max(1,Math.floor(n/o)),u=Math.max(1,Math.floor(i/l)),d=n/c,m=i/u,h=[];for(let g=0;g<u;g++)for(let y=0;y<c;y++){const j=a.minX+y*d,b=a.minY+g*m;h.push(e.jsx("rect",{x:j,y:b,width:d,height:m,fill:"none",stroke:"white",strokeWidth:"2",opacity:"0.8"},`parking-space-${g}-${y}`)),h.push(e.jsx("text",{x:j+d/2,y:b+m/2,textAnchor:"middle",dominantBaseline:"middle",fontSize:"10",fill:"white",fontWeight:"bold",opacity:"0.6",children:g*c+y+1},`parking-number-${g}-${y}`))}return s.push(e.jsx("g",{clipPath:`url(#${t})`,children:h},`parking-spaces-${r.id}`)),s},ns=[{id:"single-family",name:"Single Family",type:"apartment",description:"Single family home optimized for lot size",minArea:2e3,generator:r=>{const{buildableArea:t,parcelGeometry:s,zoning:a,marketData:n,gridSize:i}=r,o=t.vertices.reduce((he,Se)=>({minX:Math.min(he.minX,Se.x),maxX:Math.max(he.maxX,Se.x),minY:Math.min(he.minY,Se.y),maxY:Math.max(he.maxY,Se.y)}),{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0});console.log("ðŸ—ï¸ Dynamic Single Family Generator - Starting with buildable area:",{vertices:t.vertices.length,rawAreaProperty:t.properties.area,areaSqFt:(t.properties.area||0).toFixed(0),bounds:o,buildableVertices:t.vertices.slice(0,3).map(he=>`(${he.x.toFixed(0)}, ${he.y.toFixed(0)})`)});const l=Math.round(t.properties.area||0),c=t.vertices.reduce((he,Se)=>({minX:Math.min(he.minX,Se.x),maxX:Math.max(he.maxX,Se.x),minY:Math.min(he.minY,Se.y),maxY:Math.max(he.maxY,Se.y)}),{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0});console.log("ðŸ—ï¸ Buildable area bounds comparison:",{originalBounds:o,calculatedBounds:c,boundsMatch:JSON.stringify(o)===JSON.stringify(c),buildableAreaSqFt:l});const u=c,d=n.avgHomeSize||2500,g=Math.min(4500,Math.max(1800,d));console.log("ðŸ—ï¸ Realistic house sizing:",{marketOptimalSize:d,buildableAreaSqFt:l,chosenHouseSize:g,note:"Using market standards instead of buildable area percentage"}),console.log("ðŸ—ï¸ House size calculation:",{buildableAreaSqFt:l.toFixed(0),marketOptimalSize:d,chosenHouseSize:g.toFixed(0),note:"Using realistic market-based sizing"});let y=(u.maxX-u.minX)/i,j=(u.maxY-u.minY)/i;const b=y/j;if(console.log("ðŸ—ï¸ Buildable area analysis:",{lotWidth:y.toFixed(1)+" ft",lotDepth:j.toFixed(1)+" ft",lotRatio:b.toFixed(2),buildableAreaSqFt:l,orientation:y>j?"wide":"deep",boundsInSVG:`${(u.maxX-u.minX).toFixed(0)} x ${(u.maxY-u.minY).toFixed(0)}`,boundsInFeet:`${y.toFixed(1)} x ${j.toFixed(1)}`,gridSize:i,note:"If bounds are tiny, buildable area vertices are wrong"}),y<50||j<50){console.error("ðŸš¨ CRITICAL: Buildable area bounds are too small!",{lotWidth:y.toFixed(1)+" ft",lotDepth:j.toFixed(1)+" ft",boundsSVG:`${(u.maxX-u.minX).toFixed(0)} x ${(u.maxY-u.minY).toFixed(0)}`,note:"This will cause massive house scaling - using fallback dimensions"});const he=Math.sqrt(l*1.5),Se=l/he;console.log("ðŸ”§ Using fallback lot dimensions:",{fallbackWidth:he.toFixed(1)+" ft",fallbackDepth:Se.toFixed(1)+" ft",fallbackArea:(he*Se).toFixed(0)+" sq ft"});const ie=he*i,Ze=Se*i,Te=t.vertices.reduce((ze,Qe)=>ze+Qe.x,0)/t.vertices.length,Je=t.vertices.reduce((ze,Qe)=>ze+Qe.y,0)/t.vertices.length;u.minX=Te-ie/2,u.maxX=Te+ie/2,u.minY=Je-Ze/2,u.maxY=Je+Ze/2;const Ke=he,tt=Se;console.log("ðŸ”§ Updated bounds after fallback:",{newBounds:`${u.minX.toFixed(0)},${u.minY.toFixed(0)} to ${u.maxX.toFixed(0)},${u.maxY.toFixed(0)}`,newLotWidth:Ke.toFixed(1)+" ft",newLotDepth:tt.toFixed(1)+" ft"})}const v=(u.maxX-u.minX)/i,N=(u.maxY-u.minY)/i;console.log("ðŸ—ï¸ Final lot dimensions:",{finalLotWidth:v.toFixed(1)+" ft",finalLotDepth:N.toFixed(1)+" ft",finalLotArea:(v*N).toFixed(0)+" sq ft"});const C=1.5;let p=Math.sqrt(g*C),_=g/p;const w=12,P=Math.min(60,N*.4),U=w*P,R=15,q=v-R*2,k=N-R*2;if(console.log("ðŸ—ï¸ Before scaling check:",{originalHouseSize:`${p.toFixed(1)} x ${_.toFixed(1)} ft`,availableSpace:`${q.toFixed(1)} x ${k.toFixed(1)} ft`,needsScaling:p>q||_>k,widthFits:p<=q,depthFits:_<=k,finalLotDimensions:`${v.toFixed(1)} x ${N.toFixed(1)} ft`}),p>q||_>k){const he=p,Se=_,ie=Math.min(q/p,k/_),Ze=1500,Te=p*_*(ie*ie);if(Te<Ze){console.error("ðŸš¨ CRITICAL: Scaling would make house too small!",{originalArea:(p*_).toFixed(0)+" sq ft",scaledArea:Te.toFixed(0)+" sq ft",minHouseArea:Ze+" sq ft",scaleFactor:ie.toFixed(3),note:"Using minimum viable house size instead"});const Je=Math.sqrt(Ze*C),Ke=Ze/Je;p=Je,_=Ke}else p*=ie,_*=ie;console.log("ðŸ—ï¸ House scaled to fit with driveway:",{originalSize:`${he.toFixed(1)} x ${Se.toFixed(1)} ft`,scaledSize:`${p.toFixed(1)} x ${_.toFixed(1)} ft`,scaleFactor:ie.toFixed(3),availableSpace:`${q.toFixed(1)} x ${k.toFixed(1)} ft`,newAreaSqFt:(p*_).toFixed(0)})}const D=p*i,Y=_*i,X=t.vertices.reduce((he,Se)=>he+Se.x,0)/t.vertices.length,A=t.vertices.reduce((he,Se)=>he+Se.y,0)/t.vertices.length,E=20*i,J=u.maxX-u.minX-2*E,O=u.maxY-u.minY-2*E;let re=u.minX+E+(J-D)/2,ae=u.minY+E+(O-Y)/2;const K=re+D,de=ae+Y;(re<u.minX||K>u.maxX||ae<u.minY||de>u.maxY)&&(console.warn("ðŸš¨ House positioned outside buildable area! Adjusting...",{housePosition:`(${re.toFixed(0)}, ${ae.toFixed(0)})`,houseSize:`${D.toFixed(0)} x ${Y.toFixed(0)}`,buildableBounds:`${u.minX.toFixed(0)},${u.minY.toFixed(0)} to ${u.maxX.toFixed(0)},${u.maxY.toFixed(0)}`,houseRight:K.toFixed(0),houseBottom:de.toFixed(0)}),re=u.minX+(u.maxX-u.minX-D)/2,ae=u.minY+(u.maxY-u.minY-Y)/2,console.log("ðŸ”§ Adjusted house position:",{newPosition:`(${re.toFixed(0)}, ${ae.toFixed(0)})`,newRight:(re+D).toFixed(0),newBottom:(ae+Y).toFixed(0)})),console.log("ðŸ—ï¸ Strategic positioning:",{buildableBounds:`${u.minX.toFixed(0)},${u.minY.toFixed(0)} to ${u.maxX.toFixed(0)},${u.maxY.toFixed(0)}`,housePosition:`(${re.toFixed(0)}, ${ae.toFixed(0)})`,houseSize:`${p.toFixed(1)}' x ${_.toFixed(1)}'`,houseSizeSVG:`${D.toFixed(1)} x ${Y.toFixed(1)} SVG`,actualHouseSqFt:(p*_).toFixed(0),targetHouseSqFt:g,marginSVG:E,availableSpace:`${J.toFixed(0)} x ${O.toFixed(0)} SVG`}),console.log("ðŸ—ï¸ Dynamic positioning:",{houseSize:`${p.toFixed(1)} x ${_.toFixed(1)} feet`,houseSizeSVG:`${D.toFixed(1)} x ${Y.toFixed(1)} SVG units`,centroid:`(${X.toFixed(1)}, ${A.toFixed(1)})`,housePosition:`(${re.toFixed(1)}, ${ae.toFixed(1)})`});const ne={id:L(),type:"building",vertices:[{id:L(),x:re,y:ae},{id:L(),x:re+D,y:ae},{id:L(),x:re+D,y:ae+Y},{id:L(),x:re,y:ae+Y}],properties:{name:`Single Family Home (${g.toFixed(0)} sq ft)`,color:"#10b981",strokeColor:"#059669",fillOpacity:.8,area:p*_}},W=w*i,oe=P*i,V=10*i,ce=re+D+V,pe=ce+W<=u.maxX-E;let ue,te;pe?(ue=ce,te=ae):(ue=re,te=ae+Y+V),console.log("ðŸš— Final driveway placement:",{drivewayDimensions:`${w}' x ${P}'`,drivewayArea:`${U} sq ft`,placement:pe?"right of house":"below house",position:`(${ue.toFixed(0)}, ${te.toFixed(0)})`,withinBounds:ue+W<=o.maxX&&te+oe<=o.maxY});const Xe={id:L(),type:"parking",vertices:[{id:L(),x:ue,y:te},{id:L(),x:ue+W,y:te},{id:L(),x:ue+W,y:te+oe},{id:L(),x:ue,y:te+oe}],properties:{name:"Driveway",color:"#6b7280",strokeColor:"#374151",fillOpacity:.8}},Ve=p*_,ft=w*P,He={...ne,properties:{...ne.properties,area:Ve,perimeter:2*(p+_)}},bt={...Xe,properties:{...Xe.properties,area:ft,perimeter:2*(w+P)}};return console.log("ðŸ—ï¸ Final dynamic layout:",{targetHouseArea:g.toFixed(0)+" sq ft",actualHouseArea:Ve.toFixed(0)+" sq ft",actualDrivewayArea:ft.toFixed(0)+" sq ft",note:"Using correct sq ft calculations, not SVG area"}),{buildings:[He],parking:[bt],amenities:[],metrics:{totalUnits:1,totalSqFt:He.properties.area||0,parkingSpaces:2,density:1/(s.area/43560),coverage:(He.properties.area||0)/t.properties.area*100,estimatedRevenue:g*n.avgRentPerSqFt*12,estimatedCost:g*n.constructionCostPerSqFt}}}},{id:"duplex",name:"Duplex",type:"apartment",description:"Two-unit duplex maximizing small lot potential",minArea:4e3,generator:r=>{const{buildableArea:t,parcelGeometry:s,zoning:a,marketData:n,gridSize:i}=r,o=Ts(t),l=o.bounds,c=(l.maxX-l.minX)/i,u=(l.maxY-l.minY)/i;console.log("ðŸ” Buildable area dimensions:",{widthFeet:c.toFixed(1),depthFeet:u.toFixed(1),areaSqFt:(c*u).toFixed(0),boundsSVG:{minX:l.minX.toFixed(1),minY:l.minY.toFixed(1),maxX:l.maxX.toFixed(1),maxY:l.maxY.toFixed(1)},gridSize:i});const d=2400,m=60,h=40,g=m*h,y=g/2;console.log("ðŸ” Using realistic duplex dimensions:",{targetSqFt:d,actualSqFt:g,widthFeet:m,depthFeet:h,unitSqFt:y,buildableAreaSqFt:(c*u).toFixed(0),coveragePercent:(g/(c*u)*100).toFixed(1)+"%"});const j=m*i,b=h*i;console.log("ðŸ¢ SIMPLE Duplex creation:",{widthFeet:m,depthFeet:h,totalSqFt:g,unitSqFt:y,widthSVG:j,depthSVG:b,gridSize:i});const v=l.minX+(l.maxX-l.minX-j)/2,N=l.minY+(l.maxY-l.minY-b)/2;console.log("ðŸ¢ Duplex positioning:",{buildableBounds:`${(l.maxX-l.minX).toFixed(0)} x ${(l.maxY-l.minY).toFixed(0)} SVG`,duplexPosition:`(${v.toFixed(0)}, ${N.toFixed(0)})`,duplexSize:`${j} x ${b} SVG`,duplexSizeFeet:`${m} x ${h} feet`,gridSize:i,orientation:{primaryAxis:o.primaryAxis,aspectRatio:o.aspectRatio.toFixed(2)},fitsInBounds:v>=l.minX&&N>=l.minY&&v+j<=l.maxX&&N+b<=l.maxY});const C={id:L(),type:"building",vertices:[{id:L(),x:v,y:N},{id:L(),x:v+j,y:N},{id:L(),x:v+j,y:N+b},{id:L(),x:v,y:N+b}],properties:{name:`Duplex (2 units, ${y.toFixed(0)} sq ft each)`,color:"#8b5cf6",strokeColor:"#7c3aed",fillOpacity:.8,area:g}},p=At(4,t,[C],i);return{buildings:[C],parking:p,amenities:[],metrics:{totalUnits:2,totalSqFt:g,parkingSpaces:4,density:2/(s.area/43560),coverage:g/s.area*100,estimatedRevenue:2*y*n.avgRentPerSqFt*12,estimatedCost:g*n.constructionCostPerSqFt}}}},{id:"apartment-complex",name:"Apartment Complex",type:"apartment",description:"Multi-building residential complex (4-400 units)",minArea:1e4,generator:r=>{const{buildableArea:t,parcelGeometry:s,siteConstraints:a,zoning:n,marketData:i,gridSize:o}=r;console.log("ðŸ—ï¸ ARCHITECTURAL APARTMENT COMPLEX GENERATOR - Starting intelligent analysis...");const l=Ts(t),c=l.bounds,u=(c.maxX-c.minX)/o,d=(c.maxY-c.minY)/o,m=Math.round(t.properties.area||0),h=s.area/43560,g=n.maxDensity?Math.floor(h*n.maxDensity):999,y=Math.floor(m*n.maxFAR/800),j=Math.floor(m*(n.maxCoverage/100)/600),b=Math.min(g,y,j),v=u/d,N=v>1.5,C=v<.67;console.log("ðŸ—ï¸ Architectural Site Analysis:",{buildableAreaSqFt:m.toFixed(0),dimensions:`${u.toFixed(0)}' x ${d.toFixed(0)}'`,siteRatio:v.toFixed(2),orientation:N?"WIDE":C?"DEEP":"SQUARE",maxUnits:b,parcelAcres:h.toFixed(2)});let p;b<=8?p="courtyard":b<=24?l.primaryAxis==="horizontal"||N?p="linear":p="courtyard":b<=50?l.primaryAxis==="horizontal"||N?p="linear":l.primaryAxis==="vertical"||C?p="cluster":p="courtyard":l.primaryAxis==="horizontal"||N?p="linear":l.primaryAxis==="vertical"||C?p="cluster":p="mixed",console.log("ðŸ—ï¸ Selected Typology:",p);const _=[],w=[],P=[];if(p==="courtyard"){const q=Math.min(3,Math.ceil(b/8)),k=Math.ceil(b/q),D=Math.min(u*.3,d*.3),Y=c.minX+(u*o-D*o)/2,X=c.minY+(d*o-D*o)/2,A=[{x:c.minX+20,y:X,width:u*.4,height:d*.2},{x:Y+D*o+20,y:c.minY+20,width:u*.3,height:d*.4},{x:c.minX+20,y:c.minY+20,width:u*.4,height:d*.2}];for(let E=0;E<Math.min(q,A.length);E++){const J=Math.min(k,b-E*k);if(J<=0)break;const O=J*800,re=Math.floor(n.maxHeight/12),ae=Math.min(re,Math.ceil(J/4)),K=O/ae,de=A[E],ne=Math.sqrt(K*1.5),W=K/ne,oe=de.width*o,V=de.height*o,ce=Math.min(ne*o,oe-40),pe=Math.min(W*o,V-40),ue=Tt(t,ce,pe,_,{x:de.x,y:de.y});if(ue){const te={id:L(),type:"building",vertices:[{id:L(),x:ue.x,y:ue.y},{id:L(),x:ue.x+ce,y:ue.y},{id:L(),x:ue.x+ce,y:ue.y+pe},{id:L(),x:ue.x,y:ue.y+pe}],properties:{name:`Building ${String.fromCharCode(65+E)} (${J} units, ${ae} stories)`,color:"#3b82f6",strokeColor:"#1e40af",fillOpacity:.8,area:O,stories:ae}};St(te,t)?(_.push(te),console.log(`âœ… Building ${String.fromCharCode(65+E)} placed at (${ue.x.toFixed(0)}, ${ue.y.toFixed(0)})`)):(console.warn(`âš ï¸ Building ${String.fromCharCode(65+E)} failed strict validation, but placing anyway`),console.warn("Building vertices:",te.vertices),console.warn("Buildable area vertices:",t.vertices),_.push(te),console.log(`âœ… Building ${String.fromCharCode(65+E)} placed with fallback at (${ue.x.toFixed(0)}, ${ue.y.toFixed(0)})`))}else console.warn(`âš ï¸ Could not place Building ${String.fromCharCode(65+E)} within buildable area`)}}else if(p==="linear"){const q=Math.min(4,Math.ceil(b/12)),k=Math.ceil(b/q),D=l.primaryAxis==="horizontal"||u>d,Y=D?u*o/(q+1):d*o/(q+1);console.log("ðŸ“ Linear typology orientation:",{primaryAxis:l.primaryAxis,isHorizontal:D,buildingCount:q,spacing:Y.toFixed(0)});for(let X=0;X<q;X++){const A=Math.min(k,b-X*k);if(A<=0)break;const E=A*800,J=Math.floor(n.maxHeight/12),O=Math.min(J,Math.ceil(A/4)),re=E/O,ae=Math.sqrt(re*1.5),K=re/ae;let de,ne;D?(de=c.minX+Y*(X+1)-ae*o/2,ne=c.minY+(d*o-K*o)/2):(de=c.minX+(u*o-ae*o)/2,ne=c.minY+Y*(X+1)-K*o/2);const W=Tt(t,ae*o,K*o,_,{x:de,y:ne});if(W){const oe={id:L(),type:"building",vertices:[{id:L(),x:W.x,y:W.y},{id:L(),x:W.x+ae*o,y:W.y},{id:L(),x:W.x+ae*o,y:W.y+K*o},{id:L(),x:W.x,y:W.y+K*o}],properties:{name:`Building ${String.fromCharCode(65+X)} (${A} units, ${O} stories)`,color:"#3b82f6",strokeColor:"#1e40af",fillOpacity:.8,area:E,stories:O}};St(oe,t)?(_.push(oe),console.log(`âœ… Building ${String.fromCharCode(65+X)} placed at (${W.x.toFixed(0)}, ${W.y.toFixed(0)})`)):(console.warn(`âš ï¸ Building ${String.fromCharCode(65+X)} failed strict validation, but placing anyway`),console.warn("Building vertices:",oe.vertices),console.warn("Buildable area vertices:",t.vertices),_.push(oe),console.log(`âœ… Building ${String.fromCharCode(65+X)} placed with fallback at (${W.x.toFixed(0)}, ${W.y.toFixed(0)})`))}else console.warn(`âš ï¸ Could not place Building ${String.fromCharCode(65+X)} within buildable area`)}}else if(p==="cluster"){const q=Math.min(3,Math.ceil(b/16)),k=Math.ceil(b/q),D=c.minX+u*o/2,Y=c.minY+d*o/2,X=Math.min(u,d)*o*.3;console.log("ðŸ“ Cluster typology orientation:",{primaryAxis:l.primaryAxis,clusterCenter:{x:D.toFixed(0),y:Y.toFixed(0)},clusterRadius:X.toFixed(0)});for(let A=0;A<q;A++){const E=Math.min(k,b-A*k);if(E<=0)break;const J=E*800,O=Math.floor(n.maxHeight/12),re=Math.min(O,Math.ceil(E/4)),ae=J/re,K=Math.sqrt(ae*1.5),de=ae/K,ne=A*2*Math.PI/q,W=D+Math.cos(ne)*X-K*o/2,oe=Y+Math.sin(ne)*X-de*o/2,V=Tt(t,K*o,de*o,_,{x:W,y:oe});if(V){const ce={id:L(),type:"building",vertices:[{id:L(),x:V.x,y:V.y},{id:L(),x:V.x+K*o,y:V.y},{id:L(),x:V.x+K*o,y:V.y+de*o},{id:L(),x:V.x,y:V.y+de*o}],properties:{name:`Building ${String.fromCharCode(65+A)} (${E} units, ${re} stories)`,color:"#3b82f6",strokeColor:"#1e40af",fillOpacity:.8,area:J,stories:re}};St(ce,t)?(_.push(ce),console.log(`âœ… Building ${String.fromCharCode(65+A)} placed at (${V.x.toFixed(0)}, ${V.y.toFixed(0)})`)):(console.warn(`âš ï¸ Building ${String.fromCharCode(65+A)} failed strict validation, but placing anyway`),console.warn("Building vertices:",ce.vertices),console.warn("Buildable area vertices:",t.vertices),_.push(ce),console.log(`âœ… Building ${String.fromCharCode(65+A)} placed with fallback at (${V.x.toFixed(0)}, ${V.y.toFixed(0)})`))}else console.warn(`âš ï¸ Could not place Building ${String.fromCharCode(65+A)} within buildable area`)}}const U=Math.ceil(b*1.5);console.log(`ðŸš— Generating ${U} parking spaces...`);const R=At(U,t,_,o);if(w.push(...R),console.log(`âœ… Generated ${R.length} parking lots`),b>20){const q=Math.min(2e3,b*50),k=Math.sqrt(q*144),D=q*144/k,Y=Tt(t,k,D,_,{x:c.minX+20,y:c.minY+20});if(Y){const X={id:L(),type:"greenspace",vertices:[{id:L(),x:Y.x,y:Y.y},{id:L(),x:Y.x+k,y:Y.y},{id:L(),x:Y.x+k,y:Y.y+D},{id:L(),x:Y.x,y:Y.y+D}],properties:{name:"Clubhouse",color:"#f59e0b",strokeColor:"#d97706",fillOpacity:.8,area:q}};St(X,t)?(P.push(X),console.log(`âœ… Clubhouse placed at (${Y.x.toFixed(0)}, ${Y.y.toFixed(0)})`)):(console.warn("âš ï¸ Clubhouse failed strict validation, but placing anyway"),console.warn("Clubhouse vertices:",X.vertices),console.warn("Buildable area vertices:",t.vertices),P.push(X),console.log(`âœ… Clubhouse placed with fallback at (${Y.x.toFixed(0)}, ${Y.y.toFixed(0)})`))}else console.warn("âš ï¸ Could not place clubhouse within buildable area")}return console.log("ðŸ—ï¸ Architectural Apartment Complex Complete:",{typology:p,buildings:_.length,parking:w.length,amenities:P.length,totalUnits:b}),{buildings:_,parking:w,amenities:P,metrics:{totalUnits:b,totalSqFt:b*800,parkingSpaces:U,density:b/h,coverage:b*600/s.area*100,estimatedRevenue:b*800*i.avgRentPerSqFt*12,estimatedCost:b*800*i.constructionCostPerSqFt}}}},{id:"office-building",name:"Office Building",type:"office",description:"Intelligent office building sized for optimal ROI",minArea:5e3,generator:r=>{const{buildableArea:t,parcelGeometry:s,zoning:a,marketData:n,gridSize:i}=r,o=t.vertices.reduce((P,U)=>({minX:Math.min(P.minX,U.x),maxX:Math.max(P.maxX,U.x),minY:Math.min(P.minY,U.y),maxY:Math.max(P.maxY,U.y)}),{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0}),l=o.maxX-o.minX,c=o.maxY-o.minY,u=Math.round(t.properties.area||0);Math.min(u*(a.maxCoverage/100),s.area*a.maxFAR);const d=Math.min(u*.4,5e4),m=Math.floor(a.maxHeight/12),h=Math.min(m,5),g=d/h,y=Math.sqrt(g*1.6),j=g/y;console.log("ðŸ¢ Office building calculation:",{buildableAreaSqFt:u,targetBuildingSqFt:d,floors:h,floorFootprint:g,buildingWidthFeet:y.toFixed(1),buildingDepthFeet:j.toFixed(1)});const b=y*i,v=j*i,N=o.minX+(l-b)/2,C=o.minY+(c-v)/2,p={id:L(),type:"building",vertices:[{id:L(),x:N,y:C},{id:L(),x:N+b,y:C},{id:L(),x:N+b,y:C+v},{id:L(),x:N,y:C+v}],properties:{name:`Office Building (${d.toFixed(0)} sq ft, ${h} stories)`,color:"#1e40af",strokeColor:"#1e3a8a",fillOpacity:.8,area:d,stories:h}},_=Math.ceil(d/250),w=At(_,t,[p],i);return{buildings:[it(p,i)],parking:w,amenities:[],metrics:{totalUnits:1,totalSqFt:d,parkingSpaces:_,density:0,coverage:d/s.area*100,estimatedRevenue:d*n.avgRentPerSqFt*12,estimatedCost:d*n.constructionCostPerSqFt}}}},{id:"retail-center",name:"Retail Center",type:"retail",description:"Intelligent retail layout optimized for customer access",minArea:5e3,generator:r=>{const{buildableArea:t,parcelGeometry:s,zoning:a,marketData:n,gridSize:i}=r,o=t.vertices.reduce((P,U)=>({minX:Math.min(P.minX,U.x),maxX:Math.max(P.maxX,U.x),minY:Math.min(P.minY,U.y),maxY:Math.max(P.maxY,U.y)}),{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0}),l=o.maxX-o.minX;o.maxY-o.minY;const c=Math.round(t.properties.area||0),u=Math.min(c*.3,2e4),d=Math.floor(a.maxHeight/12),m=Math.min(d,2),h=u/m,g=Math.min(l/i*.8,200),y=h/g,j=Math.floor(u/1500),b=g*i,v=y*i,N=o.minX+(l-b)/2,C=o.minY+20,p={id:L(),type:"building",vertices:[{id:L(),x:N,y:C},{id:L(),x:N+b,y:C},{id:L(),x:N+b,y:C+v},{id:L(),x:N,y:C+v}],properties:{name:`Retail Center (${j} units, ${u.toFixed(0)} sq ft, ${m} stories)`,color:"#dc2626",strokeColor:"#b91c1c",fillOpacity:.8,area:u,stories:m}},_=Math.ceil(u/200),w=At(_,t,[p],i);return{buildings:[it(p,i)],parking:w,amenities:[],metrics:{totalUnits:j,totalSqFt:buildingSqFt,parkingSpaces:Math.ceil(buildingSqFt/200),density:0,coverage:buildingSqFt/s.area*100,estimatedRevenue:buildingSqFt*n.avgRentPerSqFt*12,estimatedCost:buildingSqFt*n.constructionCostPerSqFt}}}},{id:"hospitality",name:"Hotel/Hospitality",type:"mixed-use",description:"Hotel or hospitality facility with guest parking",minArea:15e3,generator:r=>{const{buildableArea:t,parcelGeometry:s,zoning:a,marketData:n,gridSize:i}=r,o=t.vertices.reduce((U,R)=>({minX:Math.min(U.minX,R.x),maxX:Math.max(U.maxX,R.x),minY:Math.min(U.minY,R.y),maxY:Math.max(U.maxY,R.y)}),{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0}),l=o.maxX-o.minX;o.maxY-o.minY;const c=Math.round(t.properties.area||0),u=s.area/43560,d=Math.min(c*.5,3e4),m=Math.floor(d/400),h=Math.floor(a.maxHeight/12),g=Math.min(h,8),y=d/g,j=Math.sqrt(y*1.8),b=y/j,v=j*i,N=b*i,C=o.minX+(l-v)/2,p=o.minY+60,_={id:L(),type:"building",vertices:[{id:L(),x:C,y:p},{id:L(),x:C+v,y:p},{id:L(),x:C+v,y:p+N},{id:L(),x:C,y:p+N}],properties:{name:`Hotel (${m} rooms, ${g} stories)`,color:"#f59e0b",strokeColor:"#d97706",fillOpacity:.8,area:d,stories:g}},w=Math.ceil(m*1.2),P=At(w,t,[_],i);return{buildings:[it(_,i)],parking:P,amenities:[],metrics:{totalUnits:m,totalSqFt:d,parkingSpaces:w,density:m/u,coverage:d/s.area*100,estimatedRevenue:m*150*365,estimatedCost:d*n.constructionCostPerSqFt*1.5}}}}],ps=ee.memo(function({parcel:t,marketData:s,onInvestmentAnalysis:a}){const[n,i]=x.useState([]),[o,l]=x.useState([]),[c,u]=x.useState(null),[d,m]=x.useState(!1),[h,g]=x.useState(!1),[y,j]=x.useState("select"),[b,v]=x.useState(!1),[N,C]=x.useState([]),[p,_]=x.useState(null),[w,P]=x.useState(!1),[U,R]=x.useState(null),[q,k]=x.useState(null),[D,Y]=x.useState(0),[X,A]=x.useState(!0),[E,J]=x.useState(!0),[O,re]=x.useState(12),[ae,K]=x.useState([{id:"buildings",name:"Buildings",visible:!0,locked:!1,color:"#3b82f6"},{id:"parking",name:"Parking",visible:!0,locked:!1,color:"#f59e0b"},{id:"utilities",name:"Utilities",visible:!0,locked:!1,color:"#10b981"},{id:"landscape",name:"Landscape",visible:!0,locked:!1,color:"#22c55e"},{id:"annotations",name:"Annotations",visible:!0,locked:!1,color:"#ef4444"}]),[de,ne]=x.useState("buildings"),[W,oe]=x.useState({isDragging:!1,dragType:"element",offset:{x:0,y:0},originalPosition:{x:0,y:0}}),[V,ce]=x.useState([]),[pe,ue]=x.useState(null),[te,Xe]=x.useState(null),[Ve,ft]=x.useState(!1),[He,bt]=x.useState(85),[he,Se]=x.useState([]),[ie,Ze]=x.useState({maxFAR:2.5,maxHeight:45,maxCoverage:40,frontSetback:25,sideSetback:15,rearSetback:20,minParkingRatio:1.5}),[Te,Je]=x.useState(!0),[Ke,tt]=x.useState(null),[ze,Qe]=x.useState(1),[fs,Ct]=x.useState({x:0,y:0}),[me,qe]=x.useState("0 0 1200 800"),[st,$t]=x.useState(!1),[Pt,bs]=x.useState({x:0,y:0}),[ot,ys]=x.useState(1),Ye=x.useRef(null),js=x.useCallback((f,$)=>{const S=Ye.current;if(!S)return 1;const F=S.getBoundingClientRect(),M=F.width,z=F.height,T=Math.max(f,$)*.1,B=f+T*2,I=$+T*2,H=M/B,Z=z/I,G=Math.min(H,Z);return console.log("ðŸ“ Baseline zoom calculation:",{parcelSize:{width:f,depth:$},svgSize:{width:M,height:z},totalSize:{width:B,height:I},baselineZoom:G.toFixed(3)}),G},[]),Be=x.useCallback(f=>{const $=me.split(" ").map(Number),S=$[2],F=$[3],M=Ye.current;if(!M)return Math.max(24,f);const z=M.getBoundingClientRect(),T=Math.min(z.width/S,z.height/F),B=ze*ot,I=Math.max(.5,Math.min(3,B)),H=Math.max(16,f*T*I*2);return console.log(`ðŸ”¤ Font scaling: base=${f}, zoom=${B.toFixed(2)}x, viewBox=${S.toFixed(0)}x${F.toFixed(0)}, scale=${T.toFixed(3)}, scaled=${H.toFixed(0)}`),Math.round(H)},[me,ze,ot]),[se,vs]=x.useState(null),[Ns,ya]=x.useState(null),[Zt,ws]=x.useState(null),[ti,Ss]=x.useState({width:1200,height:800}),yt=1,_s=x.useMemo(()=>n.filter(f=>f.type==="building"),[n]),Et=x.useMemo(()=>n.filter(f=>f.type==="parking"),[n]),ks=x.useMemo(()=>n.filter(f=>o.includes(f.id)),[n,o]),Cs=x.useMemo(()=>n.filter(f=>f.type==="greenspace"&&f.properties.name?.includes("Buildable Area")),[n]);x.useMemo(()=>Et.reduce((f,$)=>f+($.properties.parkingSpaces||0),0),[Et]);const Ps=x.useMemo(()=>_s.length,[_s]);x.useEffect(()=>{const f=async()=>{try{if(console.log("Loading parcel buildable envelope for:",t.ogc_fid),console.log("ðŸ” Parcel zoning data:",t.zoning_data),console.log("ðŸ” Permitted uses as of right:",t.zoning_data?.permitted_land_uses_as_of_right),console.log("ðŸ” Permitted uses conditional:",t.zoning_data?.permitted_land_uses_conditional),"pk.eyJ1IjoiZW1ydXNzMyIsImEiOiJjamlkcHY1aTAwY3I3M3FyeHAxc3Nia2VqIn0.mxsGEk2I8Ygkf3Q_zJKMcw"){console.log("ðŸ›£ï¸ Checking for road data...");try{const{data:F,error:M}=await Q.from("roads").select("id").limit(1);if(M&&M.message.includes("does not exist"))console.warn("âš ï¸ Roads table not found - please deploy the SQL functions first");else if(!F||F.length===0){console.log("ðŸ“ No roads in database, importing from OpenStreetMap...");const z=await Un(t.ogc_fid);console.log("ðŸ” Road import result:",z),z.success?(console.log("âœ… Roads auto-imported successfully:",z.message),setTimeout(async()=>{const T=await Us(t.ogc_fid);T&&(ya(T.buildableEnvelope),ws(T.edgeClassifications),console.log("ðŸ”„ Updated edge classifications after road import:",T.edgeClassifications))},1e3)):console.warn("âš ï¸ Road auto-import failed:",z.error)}else console.log("âœ… Roads already available in database")}catch(F){console.warn("âš ï¸ Road check/import error:",F)}}const S=await Us(t.ogc_fid);if(console.log("Loaded envelope data:",S),S)if(console.log("ðŸ” Raw envelope data structure:",S),ws(S.edge_types),console.log("Edge classifications:",S.edge_types),S.buildable_geom&&S.area_sqft>0){console.log("ðŸ” Converting database buildable envelope to elements:",{area_sqft:S.area_sqft,edge_types:S.edge_types,setbacks_applied:S.setbacks_applied}),console.log("ðŸ” Buildable geometry type:",S.buildable_geom.type),console.log("ðŸ” Buildable area sqft:",S.area_sqft);const F=S.setbacks_applied.front||25,M=S.setbacks_applied.side||15,z=S.setbacks_applied.rear||20;console.log("ðŸ” Applying dynamic setbacks:",{front:F,side:M,rear:z,area_sqft:S.area_sqft});let T=[];if(S.buildable_geom&&S.buildable_geom.coordinates){console.log("ðŸ” Parsing real buildable geometry from database");let G;if(S.buildable_geom.type==="Polygon"?G=S.buildable_geom.coordinates[0]:S.buildable_geom.type==="MultiPolygon"?G=S.buildable_geom.coordinates[0][0]:(console.warn("âš ï¸ Unsupported buildable geometry type:",S.buildable_geom.type),G=[]),G.length>0){const Fe=G.map(([we,Re])=>[we*3.28084,Re*3.28084]),Ne=Fe.reduce((we,[Re,Me])=>({minX:Math.min(we.minX,Re),maxX:Math.max(we.maxX,Re),minY:Math.min(we.minY,Me),maxY:Math.max(we.maxY,Me)}),{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0});T=Fe.map(([we,Re],Me)=>({id:L(),x:(we-Ne.minX)*12,y:(Re-Ne.minY)*12})),console.log("âœ… Parsed real buildable geometry:",{originalCoords:G.length,vertices:T.length,bounds:Ne,svgUnitsPerFoot:12})}}if(T.length===0){console.log("âš ï¸ Using fallback rectangle for buildable area");const G=200,le=200;T=[{id:L(),x:0,y:0},{id:L(),x:G,y:0},{id:L(),x:G,y:le},{id:L(),x:0,y:le}]}const B=S.area_sqft||0;console.log("ðŸ” Buildable area calculation:",{functionReturnedArea:S.area_sqft,buildableAreaSqFt:B,note:"Using actual buildable area from Supabase function"}),console.log("ðŸ” Buildable area vertices:",{vertices:T.map(G=>({x:G.x,y:G.y})),totalVertices:T.length,bounds:{minX:Math.min(...T.map(G=>G.x)),maxX:Math.max(...T.map(G=>G.x)),minY:Math.min(...T.map(G=>G.y)),maxY:Math.max(...T.map(G=>G.y))}});const I={id:L(),type:"greenspace",vertices:T,properties:{name:"Buildable Area",color:"#22c55e",strokeColor:"#16a34a",fillOpacity:.15,area:B}},H=is(T);console.log("ðŸ› DEBUG: Area calculations:",{functionReturnedArea:S.area_sqft,correctBuildableAreaSqFt:B,debugSVGArea:H,setAreaProperty:B,note:"Using actual buildable area from Supabase function"}),console.log("ðŸ” Buildable area element created:",{id:I.id,type:I.type,vertexCount:I.vertices.length,firstVertex:I.vertices[0],lastVertex:I.vertices[I.vertices.length-1]});const Z=I;if(console.log("ðŸ” Buildable area created:",{vertices:Z.vertices.length,area:Z.properties.area,areaSqFt:(Z.properties.area/144).toFixed(0),bounds:{minX:Math.min(...Z.vertices.map(G=>G.x)).toFixed(0),maxX:Math.max(...Z.vertices.map(G=>G.x)).toFixed(0),minY:Math.min(...Z.vertices.map(G=>G.y)).toFixed(0),maxY:Math.max(...Z.vertices.map(G=>G.y)).toFixed(0)}}),i(G=>[...G.filter(ye=>!(ye.type==="greenspace"&&ye.properties.name?.includes("Buildable Area"))),Z]),Z&&Z.vertices.length>0){const G=Z.vertices.reduce((Me,at)=>({minX:Math.min(Me.minX,at.x),maxX:Math.max(Me.maxX,at.x),minY:Math.min(Me.minY,at.y),maxY:Math.max(Me.maxY,at.y)}),{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0}),le=G.maxX-G.minX,ye=G.maxY-G.minY;Ss({width:le,height:ye});const Fe=js(le,ye);ys(Fe),Qe(1);const Ne=Math.max(le,ye)*.1,we=`${G.minX-Ne} ${G.minY-Ne} ${le+Ne*2} ${ye+Ne*2}`;qe(we),console.log("âœ… Buildable area viewport set:",{width:le,height:ye,bounds:G,viewBox:we});const Re={coordinates:coordinatesInFeet,bounds:G,width:le,depth:ye,area:S.area_sqft,perimeter:Ge.calculatePolygonPerimeter(coordinatesInFeet,"feet"),centroid:{x:le/2,y:ye/2},normalizedCoordinates,setbacks_applied:S.setbacks_applied,edge_types:S.edge_types};vs(Re),console.log("âœ… Parcel geometry set for template generation:",Re)}}else{console.warn("âš ï¸ No envelope data available, falling back to basic geometry");const F=await En(t.ogc_fid);if(F&&F.geometry_3857){const M=Dn(F),z={...M,coordinates:M.coordinates.map(([H,Z])=>[H*O,Z*O]),bounds:{minX:M.bounds.minX*O,minY:M.bounds.minY*O,maxX:M.bounds.maxX*O,maxY:M.bounds.maxY*O},width:M.width*O,depth:M.depth*O};vs(z),Ss({width:z.width,height:z.depth});const T=js(z.width,z.depth);ys(T),Qe(1);const B=Math.max(z.width,z.depth)*.1,I=`${z.bounds.minX-B} ${z.bounds.minY-B} ${z.width+B*2} ${z.depth+B*2}`;qe(I)}}}catch($){console.error("Error loading parcel geometry:",$)}};t.ogc_fid&&f()},[t.ogc_fid]),x.useEffect(()=>{if(se&&n.length===0&&!Ns&&t.ogc_fid){console.log("ðŸ” Creating local buildable area since no database envelope available"),console.log("ðŸ” Initializing elements - elements.length:",n.length),console.log("ðŸ” Current elements:",n.map($e=>({type:$e.type,name:$e.properties.name})));const f=se.coordinates,$=se.bounds,S=[];console.log("ðŸ” Creating buildable area that follows parcel geometry..."),console.log("ðŸ” Parcel coordinates:",f),console.log("ðŸ” Parcel bounds:",$);const F=15,M=F*12,z=f.reduce(($e,[Ue])=>$e+Ue,0)/f.length,T=f.reduce(($e,[,Ue])=>$e+Ue,0)/f.length,B=f.reduce(($e,[Ue,ts])=>{const Ot=Ue-z,As=ts-T;return $e+Math.sqrt(Ot*Ot+As*As)},0)/f.length,I=M,H=Math.max(.85,(B-I)/B);console.log("ðŸ” Setback calculation:",{setbackFeet:F,setbackSVG:M,avgDistance:B.toFixed(1),actualInset:I.toFixed(1),insetRatio:H.toFixed(3),parcelArea:se.area,expectedBuildableArea:(se.area*H*H).toFixed(0)});const Z=f.map(([$e,Ue])=>{const ts=$e-z,Ot=Ue-T;return{id:L(),x:z+ts*H,y:T+Ot*H}});console.log("ðŸ” Buildable area calculation:",{centroid:{x:z,y:T},avgDistance:B.toFixed(1),setbackSVG:M,actualInset:I.toFixed(1),insetRatio:H.toFixed(3),setbackFeet:F,originalVertices:f.length,insetVertices:Z.length});const le=is(Z)/(O*O),Fe={id:L(),type:"greenspace",vertices:Z,properties:{name:"Buildable Area",color:"#22c55e",strokeColor:"#16a34a",fillOpacity:.15,area:le}};S.push(Fe),console.log("âœ… Created buildable area following parcel shape:",{originalVertices:f.length,insetVertices:Z.length,setbackUsed:F,insetRatio:H.toFixed(3),actualInsetDistance:I.toFixed(1),parcelAreaSqFt:se.area,buildableAreaSqFt:(Fe.properties.area||0).toFixed(0)});const Ne=Z.reduce(($e,Ue)=>$e+Ue.x,0)/Z.length,we=Z.reduce(($e,Ue)=>$e+Ue.y,0)/Z.length,Re=Ne,Me=we,at=[{id:L(),x:Re-50,y:Me-30},{id:L(),x:Re+50,y:Me-30},{id:L(),x:Re+50,y:Me+30},{id:L(),x:Re-50,y:Me+30}],Dt={id:L(),type:"building",vertices:at,properties:{name:"Building 1",color:"#3b82f6",strokeColor:"#1e40af",fillOpacity:.8}};S.push(it(Dt,O)),i(S)}},[se,n.length,ie,Ns]),x.useEffect(()=>{if(n.length>0&&se){const f=[];let $=100;const S=se.area||1;se.width,se.depth;const F=n.filter(I=>I.type==="building").reduce((I,H)=>{const G=(H.properties.area||0)/144;return I+G},0),M=n.filter(I=>I.type==="parking").reduce((I,H)=>{const Z=H.vertices;let G=0;for(let Ne=0;Ne<Z.length;Ne++){const we=(Ne+1)%Z.length;G+=Z[Ne].x*Z[we].y,G-=Z[we].x*Z[Ne].y}G=Math.abs(G/2);const le=G/144,Fe=Math.floor(le/350);return console.log(`Parking ${H.id}: SVG area=${G.toFixed(0)} unitsÂ², sq ft=${le.toFixed(0)}, spaces=${Fe} (${le.toFixed(0)}Ã·350)`),I+Math.max(0,Fe)},0),z=F/S*100;z>ie.maxCoverage&&(f.push(`Building coverage ${z.toFixed(1)}% exceeds ${ie.maxCoverage}% maximum`),$-=15);const T=F/S;T>ie.maxFAR&&(f.push(`FAR ${T.toFixed(2)} exceeds ${ie.maxFAR} maximum`),$-=20),n.forEach(I=>{if(I.type==="building"){const H=I.vertices.reduce((Ne,we)=>({minX:Math.min(Ne.minX,we.x),maxX:Math.max(Ne.maxX,we.x),minY:Math.min(Ne.minY,we.y),maxY:Math.max(Ne.maxY,we.y)}),{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0}),Z=se.bounds,G=(H.minX-Z.minX)*yt/12,le=(Z.maxX-H.maxX)*yt/12,ye=(H.minY-Z.minY)*yt/12,Fe=(Z.maxY-H.maxY)*yt/12;Fe<ie.frontSetback&&(f.push(`${I.properties.name} violates front setback (${ie.frontSetback}' required, ${Fe.toFixed(1)}' provided)`),$-=10),G<ie.sideSetback&&(f.push(`${I.properties.name} violates west side setback (${ie.sideSetback}' required, ${G.toFixed(1)}' provided)`),$-=10),le<ie.sideSetback&&(f.push(`${I.properties.name} violates east side setback (${ie.sideSetback}' required, ${le.toFixed(1)}' provided)`),$-=10),ye<ie.rearSetback&&(f.push(`${I.properties.name} violates rear setback (${ie.rearSetback}' required, ${ye.toFixed(1)}' provided)`),$-=10)}});const B=Math.ceil(Ps*ie.minParkingRatio);M<B&&(f.push(`Parking deficit: ${M} provided, ${B} required (${ie.minParkingRatio} per unit) - Formula: Parking Sq Ft Ã· 350 = spaces`),$-=15),bt(Math.max($,0)),Se(f)}},[n,se,ie,yt]);const ja=x.useCallback(f=>{try{const $=Ye.current;if(!$)return;const S=$.createSVGPoint();S.x=f.clientX,S.y=f.clientY;const F=S.matrixTransform($.getScreenCTM()?.inverse()),M=be(F.x,O,E),z=be(F.y,O,E);if(console.log("Mouse down at SVG coords:",{x:M,y:z}),y==="building"){const I=60*O,H=40*O,Z=[{id:L(),x:be(M-I/2,O,E),y:be(z-H/2,O,E)},{id:L(),x:be(M+I/2,O,E),y:be(z-H/2,O,E)},{id:L(),x:be(M+I/2,O,E),y:be(z+H/2,O,E)},{id:L(),x:be(M-I/2,O,E),y:be(z+H/2,O,E)}],G={id:L(),type:"building",vertices:Z,properties:{name:`Building ${n.filter(le=>le.type==="building").length+1}`,color:"#3b82f6",strokeColor:"#1e40af",fillOpacity:.8,area:60*40}};i(le=>[...le,it(G,O)]),j("select")}else if(y==="parking"){const I=120*O,H=80*O,Z=[{id:L(),x:be(M-I/2,O,E),y:be(z-H/2,O,E)},{id:L(),x:be(M+I/2,O,E),y:be(z-H/2,O,E)},{id:L(),x:be(M+I/2,O,E),y:be(z+H/2,O,E)},{id:L(),x:be(M-I/2,O,E),y:be(z+H/2,O,E)}],G={id:L(),type:"parking",vertices:Z,properties:{name:`Parking ${Et.length+1}`,color:"#6b7280",strokeColor:"#374151",fillOpacity:.8}};i(le=>[...le,it(G,O)]),j("select")}else if(y==="greenspace"){const T=[{id:L(),x:be(M-60,O,E),y:be(z-40,O,E)},{id:L(),x:be(M+60,O,E),y:be(z-40,O,E)},{id:L(),x:be(M+60,O,E),y:be(z+40,O,E)},{id:L(),x:be(M-60,O,E),y:be(z+40,O,E)}],B={id:L(),type:"greenspace",vertices:T,properties:{name:`Greenspace ${n.filter(I=>I.type==="greenspace").length+1}`,color:"#22c55e",strokeColor:"#16a34a",fillOpacity:.6}};i(I=>[...I,it(B,O)]),j("select")}else if(y==="measure"){const T={x:M,y:z};if(V.length===0)ce([T]);else if(V.length===1){const B=Math.sqrt(Math.pow(M-V[0].x,2)+Math.pow(z-V[0].y,2)),I=qs(B,O);ue({distance:I,points:[V[0],T]}),ce([V[0],T])}else ce([]),ue(null)}}catch($){console.error("âŒ Error in handleMouseDown:",$)}},[y,n,V,O,E]),Ft=x.useCallback(f=>{f.preventDefault();const $=Ye.current;if(!$)return;const S=$.getBoundingClientRect(),F=S.width,M=S.height,z=f.clientX-S.left,T=f.clientY-S.top,B=f.deltaY,I=.1,H=B>0?1-I:1+I,Z=Math.max(.01,Math.min(100,ze*H)),G=me.split(" ").map(Number),[le,ye,Fe,Ne]=G,we=le+z/F*Fe,Re=ye+T/M*Ne,Me=Z*ot,at=F/Me,Dt=M/Me,$e=we-z/F*at,Ue=Re-T/M*Dt;Qe(Z),Ct({x:$e,y:Ue}),qe(`${$e} ${Ue} ${at} ${Dt}`),console.log(`ðŸ” CAD Zoom: ${Z.toFixed(2)}x (actual: ${Me.toFixed(2)}x) at (${we.toFixed(0)}, ${Re.toFixed(0)})`)},[ze,me,ot]),va=x.useCallback(f=>{try{if(st){const B=f.clientX-Pt.x,I=f.clientY-Pt.y,H=me.split(" ").map(Number),[Z,G,le,ye]=H,Fe=Z-B/1200*le,Ne=G-I/800*ye;Ct({x:Fe,y:Ne}),bs({x:f.clientX,y:f.clientY}),qe(`${Fe} ${Ne} ${le} ${ye}`);return}if(w&&U&&q){const B=Ye.current;if(!B)return;const I=B.createSVGPoint();I.x=f.clientX,I.y=f.clientY;const H=I.matrixTransform(B.getScreenCTM()?.inverse());let G=Math.atan2(H.y-U.y,H.x-U.x)*(180/Math.PI);G<0&&(G+=360),f.shiftKey&&(G=Math.round(G/15)*15),i(le=>le.map(ye=>ye.id===q?Ln(ye,G,U):ye));return}if(!W.isDragging||!Ye.current?.getBoundingClientRect())return;const S=Ye.current;if(!S)return;const F=S.createSVGPoint();F.x=f.clientX,F.y=f.clientY;const M=F.matrixTransform(S.getScreenCTM()?.inverse()),z=be(M.x,O,E),T=be(M.y,O,E);if(W.dragType==="vertex"&&W.elementId&&W.vertexId)i(B=>B.map(I=>{if(I.id!==W.elementId)return I;const H=I.vertices.map(Z=>Z.id===W.vertexId?{...Z,x:z,y:T}:Z);return it({...I,vertices:H},O)}));else if(W.dragType==="element"&&W.elementId){const B=z-W.originalPosition.x,I=T-W.originalPosition.y;i(H=>H.map(Z=>{if(Z.id!==W.elementId)return Z;const G=W.originalVertices?.map(le=>({...le,x:be(le.x+B,O,E),y:be(le.y+I,O,E)}))||Z.vertices;return it({...Z,vertices:G},O)}))}}catch($){console.error("âŒ Error in handleMouseMove:",$),oe(S=>({...S,isDragging:!1}))}},[st,Pt,me,w,U,o,W,O,E]),Fs=x.useCallback(()=>{try{oe(f=>({...f,isDragging:!1,dragType:"element",elementId:void 0,vertexId:void 0,offset:{x:0,y:0},originalPosition:{x:0,y:0},originalVertices:void 0})),st&&($t(!1),bs({x:0,y:0})),w&&(P(!1),R(null),Y(0),k(null))}catch(f){console.error("âŒ Error in handleMouseUp:",f),oe({isDragging:!1,dragType:"element",offset:{x:0,y:0},originalPosition:{x:0,y:0}}),$t(!1),P(!1)}},[st,w]),Na=x.useCallback(()=>{j("building")},[]),wa=x.useCallback(()=>{j("parking")},[]),Sa=x.useCallback(()=>{j("greenspace")},[]),_a=x.useCallback(()=>{v(f=>!f),C([])},[]),ka=x.useCallback(()=>{j("measure"),ce([]),ue(null)},[]),Ca=x.useCallback(()=>{ce([]),ue(null),y==="measure"&&j("select")},[y]),Ms=x.useCallback(()=>{if(!se){console.error("âŒ No parcel geometry for AI optimization");return}console.log("ðŸ¤– AI analyzing optimal layout for maximum ROI...");const f=n.find(B=>B.type==="greenspace"&&B.properties.name?.includes("Buildable Area"));if(!f){console.error("âŒ No buildable area found for AI optimization");return}const $={buildableArea:f,parcelGeometry:se,siteConstraints:ie,zoning:{maxFAR:t.zoning_data?.max_far||ie.maxFAR||2.5,maxHeight:t.zoning_data?.max_building_height_ft||ie.maxHeight||45,maxCoverage:t.zoning_data?.max_coverage_pct||ie.maxCoverage||40,maxDensity:t.zoning_data?.max_density_du_per_acre||50},marketData:s,gridSize:O},S=[];if(console.log("ðŸ§  AI analyzing all development scenarios..."),ns.forEach(B=>{try{const I=B.generator($),H=I.metrics.estimatedRevenue,Z=I.metrics.estimatedCost,G=H*.4,le=H-G,ye=Z>0?le/Z*100:0,Fe=I.metrics.density/50*20,Ne=Math.min(ye,15)*2,we=I.metrics.coverage/ie.maxCoverage*25,Re=Math.min(H/1e6,5)*5,Me=Fe+Ne+we+Re;S.push({template:B,layout:I,roi:ye,netIncome:le,score:Me}),console.log(`ðŸ“Š ${B.name} analysis:`,{units:I.metrics.totalUnits,revenue:`$${(H/1e6).toFixed(1)}M`,roi:`${ye.toFixed(1)}%`,score:Me.toFixed(1)})}catch(I){console.warn(`âš ï¸ Could not analyze ${B.name}:`,I)}}),S.length===0){alert("âŒ AI could not find any viable development scenarios for this parcel.");return}const F=S.reduce((B,I)=>I.score>B.score?I:B);console.log("ðŸŽ¯ AI selected optimal scenario:",{template:F.template.name,score:F.score.toFixed(1),roi:F.roi.toFixed(1),netIncome:`$${(F.netIncome/1e6).toFixed(1)}M`});const M=Cs,z=[...F.layout.buildings,...F.layout.parking,...F.layout.amenities];i([...M,...z]);const T=F.layout.metrics;alert(`ðŸ¤– AI Optimization Complete!

Optimal Strategy: ${F.template.name}

â€¢ ${T.totalUnits} units
â€¢ ${T.parkingSpaces} parking spaces
â€¢ ${T.coverage.toFixed(1)}% coverage
â€¢ ROI: ${F.roi.toFixed(1)}%
â€¢ Net Income: $${(F.netIncome/1e6).toFixed(1)}M/year
â€¢ AI Score: ${F.score.toFixed(1)}/100

Factors: Density efficiency, ROI, site utilization, revenue potential

âœï¸ EDITING TIPS:
â€¢ Click buildings to select them
â€¢ Enable "Vertex Mode" to edit building shapes
â€¢ Drag vertices to resize buildings
â€¢ Use Ctrl+Click for multi-select
â€¢ Buildings can be moved, rotated, and resized!`)},[n,se,ie,s]),gt=x.useCallback(f=>{const $=ns.find(I=>I.id===f),S=n.find(I=>I.type==="greenspace"&&I.properties.name?.includes("Buildable Area"));if(!$||!S){console.error("âŒ Template not found or no buildable area element:",f);return}if(console.log("ðŸ” Available elements:",n.map(I=>({type:I.type,name:I.properties.name,area:I.properties.area,vertices:I.vertices.length,areaSqFt:I.properties.area?I.properties.area.toFixed(0)+" sq ft":"N/A"}))),console.log("ðŸ” Found buildable area element:",{found:!!S,area:S?.properties.area,vertices:S?.vertices.length,firstVertex:S?.vertices[0],bounds:S?{minX:Math.min(...S.vertices.map(I=>I.x)),maxX:Math.max(...S.vertices.map(I=>I.x)),minY:Math.min(...S.vertices.map(I=>I.y)),maxY:Math.max(...S.vertices.map(I=>I.y))}:null}),!S){console.error("âŒ No buildable area found for template application");return}console.log(`ðŸ—ï¸ Applying intelligent ${$.name} template...`);const F={buildableArea:S,parcelGeometry:se,siteConstraints:ie,zoning:{maxFAR:ie.maxFAR||2.5,maxHeight:ie.maxHeight||45,maxCoverage:ie.maxCoverage||40,maxDensity:50},marketData:s,gridSize:O},M=$.generator(F),z=Cs,T=[...M.buildings,...M.parking,...M.amenities];i([...z,...T]),console.log(`âœ… Applied intelligent ${$.name} template:`,M.metrics);const B=M.metrics;alert(`ðŸ—ï¸ ${$.name} Generated!

â€¢ ${B.totalUnits} units
â€¢ ${B.parkingSpaces} parking spaces
â€¢ ${B.density.toFixed(1)} units/acre
â€¢ ${B.coverage.toFixed(1)}% coverage
â€¢ Est. Revenue: $${(B.estimatedRevenue/1e6).toFixed(1)}M/year

âœï¸ EDITING TIPS:
â€¢ Click buildings to select them
â€¢ Enable "Vertex Mode" to edit building shapes
â€¢ Drag vertices to resize buildings
â€¢ Use Ctrl+Click for multi-select
â€¢ Buildings can be moved, rotated, and resized!`)},[n,se,ie,s]),Rs=x.useCallback(async()=>{try{console.log("ðŸ›£ï¸ Importing roads for current parcel...");let $="pk.eyJ1IjoiZW1ydXNzMyIsImEiOiJjamlkcHY1aTAwY3I3M3FyeHAxc3Nia2VqIn0.mxsGEk2I8Ygkf3Q_zJKMcw";if(!$&&($=prompt("Mapbox token not found in .env. Enter your Mapbox access token:"),!$))return;const S=await browserImportRoads(t.ogc_fid,$);S.success?(alert(`âœ… Successfully imported roads! ${S.message||"Roads are now available for front lot line analysis."}`),window.location.reload()):alert(`âŒ Failed to import roads: ${S.error}`)}catch(f){console.error("âŒ Road import error:",f),alert(`âŒ Error importing roads: ${f.message}`)}},[t.ogc_fid]),Pa=x.useCallback(()=>{i(f=>f.filter($=>!o.includes($.id))),l([]),C([])},[o]),Fa=x.useCallback(()=>{const $=ks.map(S=>({...S,id:L(),vertices:S.vertices.map(F=>({...F,id:L(),x:F.x+20,y:F.y+20}))}));i(S=>[...S,...$]),l($.map(S=>S.id))},[n,o]),Jt=x.useCallback(f=>{if(o.length<2)return;const $=ks;let S=0;if(f==="left")S=Math.min(...$.map(F=>Math.min(...F.vertices.map(M=>M.x))));else if(f==="right")S=Math.max(...$.map(F=>Math.max(...F.vertices.map(M=>M.x))));else if(f==="center"){const F=Math.min(...$.map(z=>Math.min(...z.vertices.map(T=>T.x)))),M=Math.max(...$.map(z=>Math.max(...z.vertices.map(T=>T.x))));S=(F+M)/2}i(F=>F.map(M=>{if(!o.includes(M.id))return M;const z=M.vertices.reduce((I,H)=>({minX:Math.min(I.minX,H.x),maxX:Math.max(I.maxX,H.x),minY:Math.min(I.minY,H.y),maxY:Math.max(I.maxY,H.y)}),{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0});let T=0,B=0;return f==="left"?T=S-z.minX:f==="right"?T=S-z.maxX:f==="center"&&(T=S-(z.minX+z.maxX)/2),{...M,vertices:M.vertices.map(I=>({...I,x:I.x+T,y:I.y+B}))}}))},[n,o]),Kt=x.useCallback(()=>{const f=Ye.current;if(!f)return;const $=f.getBoundingClientRect(),S=$.width/2,F=$.height/2,M={preventDefault:()=>{},clientX:$.left+S,clientY:$.top+F,deltaY:-100};Ft(M)},[Ft]),Qt=x.useCallback(()=>{const f=Ye.current;if(!f)return;const $=f.getBoundingClientRect(),S=$.width/2,F=$.height/2,M={preventDefault:()=>{},clientX:$.left+S,clientY:$.top+F,deltaY:100};Ft(M)},[Ft]),es=x.useCallback(()=>{if(se){const{width:f,depth:$,bounds:S}=se;Qe(1);const F=Math.max(f,$)*.1,M=f+F*2,z=$+F*2,T=S.minX+f/2,B=S.minY+$/2,I=`${T-M/2} ${B-z/2} ${M} ${z}`;qe(I),Ct({x:T-M/2,y:B-z/2}),console.log("ðŸŽ¯ Fit to parcel (1x baseline):",{parcelBounds:S,viewBox:I,zoom:"1.00x (baseline)",baselineZoom:ot.toFixed(3)})}},[se,ot]);x.useEffect(()=>{const f=$=>{if(!($.target instanceof HTMLInputElement||$.target instanceof HTMLTextAreaElement))switch($.key){case"=":case"+":$.preventDefault(),Kt();break;case"-":$.preventDefault(),Qt();break;case"0":$.preventDefault(),es();break;case"Escape":$.preventDefault(),j("select"),l([]);break}};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[Kt,Qt,es]);const Ma=x.useMemo(()=>{if(!se||!se.coordinates)return null;const f=se.coordinates,$=f.map(([S,F],M)=>`${M===0?"M":"L"} ${S} ${F}`).join(" ")+" Z";return e.jsxs("g",{children:[e.jsx("path",{d:$,fill:"rgba(156, 163, 175, 0.1)",stroke:"#374151",strokeWidth:"2",strokeDasharray:"8,4",style:{cursor:y==="select"?"pointer":"crosshair"},onClick:()=>{y==="select"&&(console.log("ðŸ” Parcel clicked, toggling dimensions:",!d),m(!d))}}),d&&f.map(([S,F],M)=>{const z=(M+1)%f.length,[T,B]=f[z],H=Math.sqrt(Math.pow(T-S,2)+Math.pow(B-F,2))/O,Z=(S+T)/2,G=(F+B)/2;return e.jsxs("g",{children:[e.jsx("line",{x1:S,y1:F,x2:T,y2:B,stroke:"#ef4444",strokeWidth:"2",strokeDasharray:"4,2"}),e.jsx("rect",{x:Z-20,y:G-16,width:"40",height:"16",fill:"white",fillOpacity:"0.9",stroke:"#ef4444",strokeWidth:"1",rx:"2"}),e.jsxs("text",{x:Z,y:G-4,textAnchor:"middle",fontSize:Math.max(24,Be(20)),fill:"#ef4444",fontWeight:"bold",stroke:"white",strokeWidth:"2",paintOrder:"stroke fill",children:[H.toFixed(0),"'"]},`dimension-${element.id}-${ze}`)]},`parcel-dim-${M}`)})]})},[se,d,O]),Ra=x.useMemo(()=>n.map(f=>{const $=o.includes(f.id);return f.id,e.jsxs("g",{children:[e.jsx("path",{d:ls(f.vertices),fill:f.properties.color||"#3b82f6",stroke:f.properties.strokeColor||"#1e40af",strokeWidth:$?3:2,fillOpacity:f.properties.fillOpacity||.8,className:"cursor-pointer",onMouseEnter:()=>u(f.id),onMouseLeave:()=>u(null),onMouseDown:S=>{if(!b){S.stopPropagation();const F=Ye.current;if(F){const M=F.createSVGPoint();M.x=S.clientX,M.y=S.clientY;const z=M.matrixTransform(F.getScreenCTM()?.inverse());oe({isDragging:!0,dragType:"element",elementId:f.id,offset:{x:0,y:0},originalPosition:{x:z.x,y:z.y},originalVertices:[...f.vertices]})}}},onClick:S=>{S.stopPropagation(),S.ctrlKey||S.metaKey?o.includes(f.id)?l(F=>F.filter(M=>M!==f.id)):l(F=>[...F,f.id]):(console.log("ðŸ–±ï¸ Element clicked, selecting:",f.id,{elementType:f.type,elementName:f.properties.name,activeTool:y,isBuilding:f.type==="building"}),l([f.id]),console.log("ðŸ”„ Selection updated, should show rotation handles for building:",f.type==="building"),y==="select"&&f.type==="greenspace"&&f.properties.name==="Buildable Area"&&(console.log("ðŸ” Buildable area clicked, toggling dimensions:",!h),g(!h)))}}),f.type==="parking"&&e.jsx("g",{children:Bn(f)}),b&&$&&f.vertices.map(S=>e.jsx("circle",{cx:S.x,cy:S.y,r:"4",fill:N.includes(S.id)?"#ef4444":"#22c55e",stroke:"#ffffff",strokeWidth:"2",className:"cursor-move",onMouseEnter:()=>_(S.id),onMouseLeave:()=>_(null),onMouseDown:F=>{F.stopPropagation();const M=Ye.current;if(M){const z=M.createSVGPoint();z.x=F.clientX,z.y=F.clientY;const T=z.matrixTransform(M.getScreenCTM()?.inverse());oe({isDragging:!0,dragType:"vertex",elementId:f.id,vertexId:S.id,offset:{x:0,y:0},originalPosition:{x:T.x,y:T.y}})}},onClick:F=>{F.stopPropagation(),N.includes(S.id)?C(M=>M.filter(z=>z!==S.id)):C(M=>[...M,S.id])}},S.id)),!b&&$&&(()=>{ha(f.vertices);const S=f.vertices.reduce((F,M)=>({minX:Math.min(F.minX,M.x),maxX:Math.max(F.maxX,M.x),minY:Math.min(F.minY,M.y),maxY:Math.max(F.maxY,M.y)}),{minX:1/0,maxX:-1/0,minY:1/0,maxY:-1/0});return e.jsxs("g",{children:[e.jsx("rect",{x:S.minX-2,y:S.minY-2,width:S.maxX-S.minX+4,height:S.maxY-S.minY+4,fill:"none",stroke:"#0078d4",strokeWidth:"2",strokeDasharray:"none"}),[{x:S.minX-4,y:S.minY-4},{x:S.maxX+4,y:S.minY-4},{x:S.minX-4,y:S.maxY+4},{x:S.maxX+4,y:S.maxY+4}].map((F,M)=>e.jsx("rect",{x:F.x-3,y:F.y-3,width:"6",height:"6",fill:"#0078d4",stroke:"white",strokeWidth:"1",className:"cursor-nw-resize"},M))]})})(),f.properties.name&&e.jsx("text",{x:f.vertices.reduce((S,F)=>S+F.x,0)/f.vertices.length,y:f.vertices.reduce((S,F)=>S+F.y,0)/f.vertices.length,textAnchor:"middle",dominantBaseline:"middle",fontSize:f.properties.name==="Buildable Area"?Math.max(32,Be(28)):Math.max(24,Be(20)),fill:"white",fontWeight:"bold",stroke:"black",strokeWidth:"2",paintOrder:"stroke fill",pointerEvents:"none",children:f.properties.name}),f.properties.area&&e.jsxs("text",{x:f.vertices.reduce((S,F)=>S+F.x,0)/f.vertices.length,y:f.vertices.reduce((S,F)=>S+F.y,0)/f.vertices.length+15,textAnchor:"middle",dominantBaseline:"middle",fontSize:f.properties.name==="Buildable Area"?Math.max(28,Be(24)):Math.max(20,Be(18)),fill:"white",fontWeight:"bold",stroke:"black",strokeWidth:"2",paintOrder:"stroke fill",pointerEvents:"none",children:[Math.round(f.properties.area||0).toLocaleString()," sq ft"]}),($||f.type==="building"||f.type==="greenspace"&&f.properties.name==="Buildable Area"&&h)&&(f.type==="greenspace"&&f.properties.name==="Buildable Area"&&console.log("ðŸ” Rendering buildable area dimensions:",{showBuildableDimensions:h,elementName:f.properties.name,elementType:f.type}),!0)&&f.vertices.map((S,F)=>{const M=f.vertices[(F+1)%f.vertices.length],z=(S.x+M.x)/2,T=(S.y+M.y)/2,B=Math.sqrt(Math.pow(M.x-S.x,2)+Math.pow(M.y-S.y,2)),I=qs(B,O);return f.type==="building"&&F<2&&console.log(`ðŸ” Building dimension ${F}:`,{svgDistance:B.toFixed(1),gridSize:O,feetDistance:I.toFixed(1),elementType:f.type,elementName:f.properties.name}),e.jsxs("g",{children:[e.jsx("line",{x1:S.x,y1:S.y,x2:M.x,y2:M.y,stroke:f.type==="building"?"#ef4444":f.type==="greenspace"?"#22c55e":"#f59e0b",strokeWidth:f.type==="building"?"2":"1",strokeDasharray:f.type==="building"?"4,2":"2,2"}),e.jsx("rect",{x:z-20,y:T-16,width:"40",height:"16",fill:"white",fillOpacity:"0.9",stroke:f.type==="building"?"#ef4444":f.type==="greenspace"?"#22c55e":"#f59e0b",strokeWidth:"1",rx:"2"}),e.jsxs("text",{x:z,y:T-8,textAnchor:"middle",fontSize:Math.max(56,Be(f.type==="building"?48:40)),fill:f.type==="building"?"#ef4444":f.type==="greenspace"?"#22c55e":"#f59e0b",fontWeight:"bold",stroke:"white",strokeWidth:"2",paintOrder:"stroke fill",className:"cursor-pointer",onClick:H=>{H.stopPropagation(),tt({elementId:f.id,edgeIndex:F,value:Math.round(I).toString(),x:H.clientX,y:H.clientY})},children:[Math.round(I),"'"]})]},`dimension-${F}`)}),$&&e.jsx("path",{d:ls(f.vertices),fill:"none",stroke:"#22c55e",strokeWidth:"3",strokeDasharray:"5,5",pointerEvents:"none"}),he.some(S=>S.includes(f.properties.name||""))&&e.jsx("circle",{cx:f.vertices[0].x+10,cy:f.vertices[0].y-10,r:"8",fill:"#ef4444",stroke:"#ffffff",strokeWidth:"2"})]},f.id)}).concat(!b&&o.length>0?n.filter(f=>o.includes(f.id)).map(f=>{const $=f.vertices.reduce((z,T)=>T.x>z.x||T.x===z.x&&T.y<z.y?T:z,f.vertices[0]),S=50,F=$.x+S,M=$.y-S;return e.jsxs("g",{children:[e.jsx("line",{x1:$.x,y1:$.y,x2:F,y2:M,stroke:"#6b7280",strokeWidth:"1",strokeDasharray:"2,2",opacity:"0.6",pointerEvents:"none"}),e.jsx("circle",{cx:F,cy:M,r:"12",fill:"#6b7280",stroke:"white",strokeWidth:"2",className:"cursor-grab hover:fill-gray-500 hover:scale-110 transition-all duration-200",title:"Drag to rotate 360Â° â€¢ Hold Shift for 15Â° increments",onMouseDown:z=>{z.stopPropagation(),console.log("ðŸ”„ PowerPoint-style rotation handle clicked for 360Â° rotation of",f.type,"element!");const T=Ye.current;if(!T)return;const B=T.createSVGPoint();B.x=z.clientX,B.y=z.clientY;const I=B.matrixTransform(T.getScreenCTM()?.inverse()),H=Math.atan2(I.y-$.y,I.x-$.x);P(!0),R($),Y(H),k(f.id)}}),e.jsxs("g",{transform:`translate(${F}, ${M})`,children:[e.jsx("path",{d:"M -6 -2 A 6 6 0 0 1 6 -2",fill:"none",stroke:"white",strokeWidth:"3",strokeLinecap:"round",pointerEvents:"none"}),e.jsx("path",{d:"M 4 -4 L 6 -2 L 4 0",fill:"none",stroke:"white",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round",pointerEvents:"none"})]}),w&&q===f.id&&e.jsxs(e.Fragment,{children:[e.jsxs("text",{x:F,y:M-25,textAnchor:"middle",fontSize:"12",fill:"#0078d4",fontWeight:"bold",className:"select-none",pointerEvents:"none",children:[Math.round(f.rotation||0),"Â°"]}),e.jsx("line",{x1:vertexX,y1:vertexY,x2:F,y2:M,stroke:"#0078d4",strokeWidth:"2",strokeDasharray:"3,3",opacity:"0.8",pointerEvents:"none"})]})]},`rotation-handle-${f.id}`)}):[]),[n,o,c,b,N,p,he,yt,O,w,U,q]);return e.jsxs("div",{className:"flex flex-col h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 p-2",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"text-base font-semibold",children:"CAD Site Planner"}),e.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["- ",t.address]})]}),e.jsxs("div",{className:"flex items-center space-x-1 overflow-x-auto",children:[e.jsx("button",{onClick:()=>j("select"),className:`p-1.5 rounded ${y==="select"?"bg-blue-100 text-blue-600":"hover:bg-gray-100"}`,title:"Select",children:e.jsx(zt,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:_a,className:`p-1.5 rounded ${b?"bg-green-100 text-green-600":"hover:bg-gray-100"}`,title:"Vertex Edit Mode",children:e.jsx(ea,{className:"w-3.5 h-3.5"})}),e.jsx("div",{className:"w-px h-4 bg-gray-300"}),e.jsx("button",{onClick:Na,className:`p-1.5 rounded ${y==="building"?"bg-blue-100 text-blue-600":"hover:bg-gray-100"}`,title:"Add Building",children:e.jsx(Ie,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:wa,className:`p-1.5 rounded ${y==="parking"?"bg-blue-100 text-blue-600":"hover:bg-gray-100"}`,title:"Add Parking",children:e.jsx(ht,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:Sa,className:`p-1.5 rounded ${y==="greenspace"?"bg-blue-100 text-blue-600":"hover:bg-gray-100"}`,title:"Add Greenspace",children:e.jsx(Oa,{className:"w-3.5 h-3.5"})}),e.jsx("div",{className:"w-px h-4 bg-gray-300"}),e.jsx("button",{onClick:ka,className:`p-1.5 rounded ${y==="measure"?"bg-purple-100 text-purple-600":"hover:bg-gray-100"}`,title:"Measure Distance",children:e.jsx(Ua,{className:"w-3.5 h-3.5"})}),pe&&e.jsx("button",{onClick:Ca,className:"p-1.5 hover:bg-gray-100 rounded",title:"Clear Measurement",children:e.jsx(xe,{className:"w-3.5 h-3.5"})}),e.jsx("div",{className:"w-px h-4 bg-gray-300"}),o.length>=2&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Jt("left"),className:"p-1.5 hover:bg-gray-100 rounded",title:"Align Left",children:e.jsx(Ta,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>Jt("center"),className:"p-1.5 hover:bg-gray-100 rounded",title:"Align Center",children:e.jsx(qa,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>Jt("right"),className:"p-1.5 hover:bg-gray-100 rounded",title:"Align Right",children:e.jsx(Ya,{className:"w-3.5 h-3.5"})}),e.jsx("div",{className:"w-px h-4 bg-gray-300"})]}),e.jsx("button",{onClick:Fa,disabled:o.length===0,className:"p-1.5 hover:bg-gray-100 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Copy Selected",children:e.jsx(Zs,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:Pa,disabled:o.length===0,className:"p-1.5 hover:bg-gray-100 rounded disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete Selected",children:e.jsx(Ks,{className:"w-3.5 h-3.5"})}),e.jsx("div",{className:"w-px h-4 bg-gray-300"}),e.jsx("button",{onClick:Kt,className:"p-1.5 hover:bg-blue-100 rounded bg-blue-50",title:"Zoom In",children:e.jsx(La,{className:"w-3.5 h-3.5 text-blue-600"})}),e.jsx("button",{onClick:Qt,className:"p-1.5 hover:bg-blue-100 rounded bg-blue-50",title:"Zoom Out",children:e.jsx(Ba,{className:"w-3.5 h-3.5 text-blue-600"})}),e.jsx("button",{onClick:es,className:"p-1.5 hover:bg-green-100 rounded bg-green-50",title:"Fit to Parcel",children:e.jsx(Xa,{className:"w-3.5 h-3.5 text-green-600"})}),e.jsxs("div",{className:"px-2 py-1 text-xs font-mono text-gray-600 bg-gray-100 rounded",children:[ze.toFixed(2),"x",ot!==1&&e.jsxs("span",{className:"text-gray-500 ml-1",children:["(",(ze*ot).toFixed(2),"x)"]})]}),e.jsx("div",{className:"w-px h-6 bg-gray-300"}),e.jsx("button",{onClick:()=>{const f=[];let $=100;n.forEach(z=>{z.type==="building"&&Math.min(...z.vertices.map(B=>B.x))<15&&(f.push(`${z.properties.name} violates front setback`),$-=10)});const S=n.filter(z=>z.type==="building").reduce((z,T)=>z+(T.properties.area||0),0),F=se?.area||1;S/F>.4&&(f.push("Building coverage exceeds 40% maximum"),$-=15),bt(Math.max($,0)),Se(f)},className:"p-1.5 hover:bg-gray-100 rounded",title:"Analyze Compliance",children:e.jsx(je,{className:"w-3.5 h-3.5"})}),He<100&&e.jsxs("span",{className:`px-2 py-1 rounded text-xs font-medium ${He>=80?"bg-green-100 text-green-800":He>=60?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[He,"%"]}),e.jsx("button",{onClick:()=>Je(!Te),className:`p-1.5 rounded ${Te?"bg-orange-100 text-orange-600":"hover:bg-gray-100"}`,title:Te?"Hide Site Constraints":"Show Site Constraints",children:e.jsx(et,{className:"w-3.5 h-3.5"})}),e.jsx("div",{className:"w-px h-4 bg-gray-300"}),e.jsx("button",{onClick:Ms,className:"px-2 py-1 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xs font-medium rounded hover:from-purple-600 hover:to-pink-600 shadow-lg",title:"AI Optimization - Analyze all scenarios and select optimal layout for maximum ROI",children:"ðŸ¤– AI"}),e.jsx("div",{className:"w-px h-6 bg-gray-300"}),e.jsxs("div",{className:"flex items-center space-x-0.5",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Templates:"}),e.jsx("button",{onClick:()=>gt("single-family"),className:"px-1.5 py-0.5 text-xs bg-green-100 text-green-700 rounded hover:bg-green-200",title:"Single Family Home",children:"SFH"}),e.jsx("button",{onClick:()=>gt("duplex"),className:"px-1.5 py-0.5 text-xs bg-purple-100 text-purple-700 rounded hover:bg-purple-200",title:"Duplex (2 units)",children:"Duplex"}),e.jsx("button",{onClick:()=>gt("apartment-complex"),className:"px-1.5 py-0.5 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200",title:"Apartment Complex (4-400 units)",children:"Apt"}),e.jsx("button",{onClick:()=>gt("office-building"),className:"px-1.5 py-0.5 text-xs bg-indigo-100 text-indigo-700 rounded hover:bg-indigo-200",title:"Office Building",children:"Office"}),e.jsx("button",{onClick:()=>gt("retail-center"),className:"px-1.5 py-0.5 text-xs bg-red-100 text-red-700 rounded hover:bg-red-200",title:"Retail Center",children:"Retail"}),e.jsx("button",{onClick:()=>gt("hospitality"),className:"px-1.5 py-0.5 text-xs bg-yellow-100 text-yellow-700 rounded hover:bg-yellow-200",title:"Hotel/Hospitality",children:"Hotel"})]}),e.jsx("button",{onClick:Rs,className:"p-1.5 hover:bg-gray-100 rounded",title:"Refresh Roads",children:e.jsx(We,{className:"w-3.5 h-3.5"})})]})]})}),e.jsxs("div",{className:"flex flex-1 bg-gray-100 min-h-0",children:[e.jsx("div",{className:`${Te?"flex-1":"w-full"} p-2 min-h-0`,children:e.jsxs("div",{className:"w-full h-full bg-white border border-gray-300 rounded-lg shadow-lg relative overflow-hidden min-h-[600px]",children:[e.jsxs("svg",{ref:Ye,width:"100%",height:"100%",viewBox:me,className:"absolute inset-0 cursor-crosshair",onMouseDown:ja,onMouseMove:va,onMouseUp:Fs,onMouseLeave:Fs,onWheel:Ft,children:[e.jsxs("defs",{children:[e.jsx("pattern",{id:"grid",width:O,height:O,patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:`M ${O} 0 L 0 0 0 ${O}`,fill:"none",stroke:ze>2?"#d1d5db":"#e5e7eb",strokeWidth:ze>5?"1":"0.5"})}),ze>3&&e.jsx("pattern",{id:"fine-grid",width:O/4,height:O/4,patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:`M ${O/4} 0 L 0 0 0 ${O/4}`,fill:"none",stroke:"#f3f4f6",strokeWidth:"0.25"})})]}),e.jsx("rect",{width:"100%",height:"100%",fill:"url(#grid)"}),ze>3&&e.jsx("rect",{width:"100%",height:"100%",fill:"url(#fine-grid)"}),Ma,se&&e.jsxs("g",{children:[e.jsxs("text",{x:se.bounds.minX+se.width/2,y:se.bounds.maxY+40,textAnchor:"middle",fontSize:Math.max(72,Be(60)),fill:"#ef4444",fontWeight:"bold",stroke:"white",strokeWidth:"3",paintOrder:"stroke fill",children:["STREET FRONT",Zt?.method==="road_proximity"&&Zt?.nearest_road_name&&` (${Zt.nearest_road_name})`]}),e.jsxs("g",{transform:`translate(${se.bounds.maxX-50}, ${se.bounds.minY+50})`,children:[e.jsx("circle",{cx:"0",cy:"0",r:"25",fill:"white",stroke:"#374151",strokeWidth:"2"}),e.jsx("text",{x:"0",y:"-8",textAnchor:"middle",fontSize:Math.max(56,Be(48)),fill:"#374151",fontWeight:"bold",stroke:"white",strokeWidth:"2",paintOrder:"stroke fill",children:"N"}),e.jsx("text",{x:"0",y:"15",textAnchor:"middle",fontSize:Math.max(56,Be(48)),fill:"#ef4444",fontWeight:"bold",stroke:"white",strokeWidth:"2",paintOrder:"stroke fill",children:"S"}),e.jsx("text",{x:"-12",y:"3",textAnchor:"middle",fontSize:Math.max(56,Be(48)),fill:"#374151",stroke:"white",strokeWidth:"2",paintOrder:"stroke fill",children:"W"}),e.jsx("text",{x:"12",y:"3",textAnchor:"middle",fontSize:Math.max(56,Be(48)),fill:"#374151",stroke:"white",strokeWidth:"2",paintOrder:"stroke fill",children:"E"}),e.jsx("line",{x1:"0",y1:"-18",x2:"0",y2:"-8",stroke:"#ef4444",strokeWidth:"3",markerEnd:"url(#arrow)"})]})]}),e.jsx("g",{children:Ra}),pe&&e.jsxs("g",{children:[e.jsx("line",{x1:pe.points[0].x,y1:pe.points[0].y,x2:pe.points[1].x,y2:pe.points[1].y,stroke:"#8b5cf6",strokeWidth:"2"}),e.jsx("circle",{cx:pe.points[0].x,cy:pe.points[0].y,r:"4",fill:"#8b5cf6"}),e.jsx("circle",{cx:pe.points[1].x,cy:pe.points[1].y,r:"4",fill:"#8b5cf6"}),e.jsxs("text",{x:(pe.points[0].x+pe.points[1].x)/2,y:(pe.points[0].y+pe.points[1].y)/2-10,textAnchor:"middle",fontSize:Math.max(56,Be(48)),fill:"#8b5cf6",fontWeight:"bold",stroke:"white",strokeWidth:"2",paintOrder:"stroke fill",className:"bg-white",children:[Math.round(pe.distance),"'"]})]}),V.map((f,$)=>e.jsx("circle",{cx:f.x,cy:f.y,r:"3",fill:"#8b5cf6",stroke:"#ffffff",strokeWidth:"2"},$))]}),Ke&&e.jsxs("div",{className:"absolute z-50 bg-white border border-gray-300 rounded shadow-lg p-2",style:{left:Ke.x-50,top:Ke.y-30},children:[e.jsx("input",{type:"number",value:Ke.value,onChange:f=>tt($=>$?{...$,value:f.target.value}:null),onKeyDown:f=>{(f.key==="Enter"||f.key==="Escape")&&tt(null)},onBlur:()=>tt(null),className:"w-16 px-2 py-1 text-sm border border-gray-300 rounded",autoFocus:!0}),e.jsx("span",{className:"text-xs text-gray-500 ml-1",children:"'"})]})]})}),Te&&e.jsxs("div",{className:"w-72 bg-white border-l border-gray-300 overflow-y-auto p-2 max-h-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Site Design Panel"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:Rs,className:"px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200",title:"Refresh Roads from Mapbox",children:"Refresh Roads"}),e.jsx("button",{onClick:()=>Je(!1),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(xe,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"mb-1 p-1.5 bg-gradient-to-r from-purple-50 to-pink-50 rounded border border-purple-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-purple-900 text-xs",children:"ðŸ¤– AI Optimization"}),e.jsx("div",{className:"text-xs text-purple-700",children:"Auto-select optimal layout"})]}),e.jsx("button",{onClick:Ms,className:"px-2 py-0.5 bg-gradient-to-r from-purple-600 to-pink-600 text-white text-xs font-medium rounded hover:from-purple-700 hover:to-pink-700",children:"Run AI"})]})}),e.jsxs("div",{className:"mb-1 p-1.5 bg-purple-50 rounded",children:[e.jsx("h4",{className:"font-medium text-purple-900 mb-1 text-xs",children:"Development Templates"}),e.jsx("div",{className:"space-y-0.5",children:ns.map(f=>{const $=n.find(z=>z.type==="greenspace"&&z.properties.name?.includes("Buildable Area"));let S=0;$?S=Math.round($.properties.area||0):S=se?se.width*se.height*.7/144:0;const F=S>=f.minArea;console.log(`ðŸ—ï¸ Template ${f.name}: buildable=${Math.round(S)} sf, required=${f.minArea} sf, canFit=${F}`);let M="";if(F){if(f.id==="single-family")M="1 home, ~2,500 sq ft";else if(f.id==="duplex")M="2 units, ~1,200 sq ft each";else if(f.id==="apartment-complex"){const z=Math.min(Math.floor((se?.area||0)/43560*20),Math.floor(S*.4/600));M=`${z} units, ${Math.floor(z/4)} buildings`}else if(f.id==="office-building")M=`${Math.floor(Math.min(S*.4,5e4)).toLocaleString()} sq ft office`;else if(f.id==="retail-center"){const z=Math.floor(Math.min(S*.3,2e4));M=`${Math.floor(z/1500)} retail units, ${z.toLocaleString()} sq ft`}else if(f.id==="hospitality"){const z=Math.floor(Math.min(S*.5,3e4));M=`${Math.floor(z/400)} hotel rooms`}}return e.jsxs("div",{className:`flex items-center justify-between p-1 rounded border text-xs ${F?"bg-green-50 border-green-200":"bg-red-50 border-red-200"}`,children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"font-medium text-xs",children:f.name}),e.jsx("div",{className:"text-gray-600 text-xs truncate",children:F?M:`Need ${(f.minArea-S).toLocaleString()} more SF`})]}),F&&e.jsx("button",{onClick:()=>{console.log(`ðŸ”„ Generate button clicked for ${f.name}`,{templateId:f.id,buildableAreaSqFt:S,elementsCount:n.length,parcelGeometry:!!se}),gt(f.id)},className:"px-1.5 py-0.5 bg-blue-600 text-white text-xs rounded hover:bg-blue-700 flex-shrink-0",children:"Generate"})]},f.id)})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-1 text-xs",children:"Zoning & Development Rights"}),e.jsxs("div",{className:"mb-1 p-1.5 bg-gray-50 rounded",children:[e.jsx("h5",{className:"font-medium text-gray-800 mb-1 text-xs",children:"Zoning Classification:"}),e.jsxs("div",{className:"text-xs space-y-0.5",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Zone:"})," ",t.zoning||"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Description:"})," ",t.zoning_description||"N/A"]}),t.zoning_data?.zoning_type&&e.jsxs("div",{children:[e.jsx("strong",{children:"Type:"})," ",t.zoning_data.zoning_type]}),t.zoning_data?.zoning_objective&&e.jsxs("div",{children:[e.jsx("strong",{children:"Objective:"})," ",t.zoning_data.zoning_objective]})]})]}),t.zoning_data?.permitted_land_uses_as_of_right||t.zoning_data?.permitted_land_uses_conditional?e.jsxs("div",{className:"mb-3 p-2 bg-green-50 rounded",children:[t.zoning_data.permitted_land_uses_as_of_right&&e.jsxs("div",{className:"mb-2",children:[e.jsx("h5",{className:"font-medium text-green-800 mb-1 text-sm",children:"âœ… Allowed By Right:"}),e.jsx("div",{className:"space-y-0.5 text-xs",children:t.zoning_data.permitted_land_uses_as_of_right.split(",").map((f,$)=>e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),e.jsx("span",{children:f.trim()})]},$))})]}),t.zoning_data.permitted_land_uses_conditional&&e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-yellow-800 mb-1 text-sm",children:"âš ï¸ Conditional Uses:"}),e.jsx("div",{className:"space-y-0.5 text-xs",children:t.zoning_data.permitted_land_uses_conditional.split(",").map((f,$)=>e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-yellow-500 rounded-full"}),e.jsx("span",{children:f.trim()})]},$))})]})]}):e.jsxs("div",{className:"mb-3 p-2 bg-yellow-50 rounded",children:[e.jsx("h5",{className:"font-medium text-yellow-800 mb-1 text-sm",children:"Permitted Uses (Based on Zone):"}),e.jsxs("div",{className:"text-xs text-yellow-700 mb-1",children:['"',t.zoning_description,'" typically allows:']}),e.jsxs("div",{className:"space-y-0.5 text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full"}),e.jsxs("span",{children:["Residential: Up to ",Math.floor((se?.area||0)/43560*20)," units (20/acre)"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-yellow-500 rounded-full"}),e.jsx("span",{children:"May allow accessory commercial uses"})]})]})]}),e.jsxs("div",{className:"mb-3 p-2 bg-blue-50 rounded",children:[e.jsx("h5",{className:"font-medium text-blue-900 mb-1 text-sm",children:"Development Potential:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-2 gap-y-0.5 text-xs text-blue-800",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Units:"})," ",se?Math.floor((t.sqft||se.area)/43560*20):"N/A"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Stories:"})," ",Math.floor((t.zoning_data?.max_building_height_ft||45)/10)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Floor Area:"})," ",se?Math.round((t.sqft||se.area)*(t.zoning_data?.max_far||2.5)/1e3).toLocaleString():"N/A","k sf"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Coverage:"})," ",Math.round((t.sqft||se?.area||0)*.4/1e3).toLocaleString(),"k sf"]})]})]}),e.jsxs("div",{className:"mb-3 p-2 bg-gray-50 rounded",children:[e.jsx("h5",{className:"font-medium text-gray-800 mb-1 text-sm",children:"Setbacks & Requirements:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-2 gap-y-0.5 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Front:"}),e.jsxs("span",{className:"font-medium",children:[ie.frontSetback,"'"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Rear:"}),e.jsxs("span",{className:"font-medium",children:[ie.rearSetback,"'"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Side:"}),e.jsxs("span",{className:"font-medium",children:[ie.sideSetback,"'"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Parking:"}),e.jsxs("span",{className:"font-medium",children:[ie.minParkingRatio,"/unit"]})]})]})]}),e.jsxs("details",{className:"mt-4",children:[e.jsx("summary",{className:"text-xs text-gray-500 cursor-pointer",children:"ðŸ” Debug: Raw Zoning Data"}),e.jsx("pre",{className:"text-xs bg-gray-100 p-2 mt-1 rounded overflow-auto max-h-32",children:JSON.stringify({zoning:t.zoning,zoning_description:t.zoning_description,zoning_data_available:!!t.zoning_data,permitted_as_of_right:t.zoning_data?.permitted_land_uses_as_of_right,permitted_conditional:t.zoning_data?.permitted_land_uses_conditional,max_density:t.zoning_data?.max_density_du_per_acre,max_far:t.zoning_data?.max_far},null,2)})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-gray-900 mb-3",children:["Current Violations (",he.length,")"]}),he.length>0?e.jsx("div",{className:"space-y-2",children:he.map((f,$)=>e.jsxs("div",{className:"flex items-start space-x-2 text-sm",children:[e.jsx(Le,{className:"w-4 h-4 text-red-500 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-red-700",children:f})]},$))}):e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-green-700",children:[e.jsx(je,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"All constraints satisfied"})]})]})]}),e.jsxs("div",{className:"mt-3 pt-2 border-t border-gray-200",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-2 text-sm",children:"Current Site Metrics"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-bold text-blue-600",children:se?`${se.width.toFixed(0)}' Ã— ${se.depth.toFixed(0)}'`:"N/A"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Parcel Size"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-bold text-blue-600",children:t.sqft?Math.round(t.sqft).toLocaleString():"N/A"}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total Area (sq ft)"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-bold text-blue-600",children:n.filter(f=>f.type==="building").length}),e.jsx("div",{className:"text-xs text-gray-600",children:"Buildings"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-bold text-blue-600",children:n.filter(f=>f.type==="parking").reduce((f,$)=>{const S=$.vertices;let F=0;for(let T=0;T<S.length;T++){const B=(T+1)%S.length;F+=S[T].x*S[B].y,F-=S[B].x*S[T].y}F=Math.abs(F/2);const M=F/144,z=Math.floor(M/350);return f+Math.max(0,z)},0)}),e.jsx("div",{className:"text-xs text-gray-600",children:"Parking Spaces"})]})]})]})]})]}),e.jsx("div",{className:"bg-white border-t border-gray-200 px-4 py-2",children:e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{children:["Tool: ",y.charAt(0).toUpperCase()+y.slice(1),b&&" (Vertex Mode)"]}),e.jsxs("span",{children:["Selected: ",o.length]}),e.jsxs("span",{children:["Elements: ",n.length]}),N.length>0&&e.jsxs("span",{children:["Vertices: ",N.length]}),pe&&e.jsxs("span",{className:"text-purple-600 font-medium",children:["Distance: ",Math.round(pe.distance),"'"]}),he.length>0&&e.jsxs("span",{className:"text-red-600 font-medium",children:["Violations: ",he.length]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{children:["Zoom: ",Math.round(ze*100),"%"]}),e.jsxs("span",{children:["Grid: ",O/12,'"']}),e.jsxs("span",{children:["Buildings: ",Ps," | Parking: ",Et.length]})]})]})})]})}),Xn=ee.memo(function({parcel:t,onUnderwritingUpdate:s}){const{configuration:a,sitePlanResult:n,loading:i,error:o,updateConfiguration:l,updateUnitMix:c,autoGenerate:u,getConstraintSummary:d,getFeasibilityStatus:m,getOptimizationScore:h,getFinancialSummary:g,getParkingSummary:y,validateConfiguration:j,getRecommendedConfigurations:b,isEngineAvailable:v}=zn(t.zoning_data,t.sqft),[N,C]=x.useState("design"),[p,_]=x.useState(!1);x.useEffect(()=>{v&&u()},[a,v,u]),x.useEffect(()=>{if(n&&s){const A=g();A&&s({sitePlanCost:A.totalCost,sitePlanRevenue:A.totalRevenue,netImpact:A.netImpact,costPerUnit:A.costPerUnit,revenuePerUnit:A.revenuePerUnit})}},[n,s,g]);const w=A=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(A),P=A=>`${(A*100).toFixed(1)}%`,U=A=>{switch(A){case"excellent":return"text-green-600 bg-green-100";case"good":return"text-blue-600 bg-blue-100";case"acceptable":return"text-yellow-600 bg-yellow-100";case"infeasible":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}};d();const R=m(),q=h(),k=g(),D=y(),Y=j(),X=b();return v?e.jsxs("div",{className:"p-3 space-y-3 max-h-[700px] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ie,{className:"w-4 h-4 text-blue-600"}),e.jsx("h2",{className:"text-base font-semibold text-gray-900",children:"Site Plan Designer"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${U(R)}`,children:R.toUpperCase()}),q>0&&e.jsxs("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded",children:[q.toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg",children:[e.jsx("button",{onClick:()=>C("design"),className:`flex-1 px-2 py-1.5 rounded-md text-xs font-medium transition-colors ${N==="design"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Design"}),e.jsx("button",{onClick:()=>C("visual"),className:`flex-1 px-2 py-1.5 rounded-md text-xs font-medium transition-colors ${N==="visual"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:e.jsxs("div",{className:"flex items-center justify-center space-x-1",children:[e.jsx(xs,{className:"w-3 h-3"}),e.jsx("span",{children:"Visual"})]})}),e.jsx("button",{onClick:()=>C("analysis"),className:`flex-1 px-2 py-1.5 rounded-md text-xs font-medium transition-colors ${N==="analysis"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Analysis"}),e.jsx("button",{onClick:()=>C("recommendations"),className:`flex-1 px-2 py-1.5 rounded-md text-xs font-medium transition-colors ${N==="recommendations"?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:e.jsx("span",{className:"truncate",children:"Recs"})})]}),o&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Le,{className:"w-5 h-5 text-red-600 mr-2"}),e.jsx("h3",{className:"text-red-800 font-medium",children:"Error"})]}),e.jsx("p",{className:"text-red-700 mt-2",children:o})]}),Y.errors.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Le,{className:"w-5 h-5 text-red-600 mr-2"}),e.jsx("h3",{className:"text-red-800 font-medium",children:"Configuration Errors"})]}),e.jsx("ul",{className:"text-red-700 mt-2 space-y-1",children:Y.errors.map((A,E)=>e.jsxs("li",{children:["â€¢ ",A]},E))})]}),N==="design"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Basic Configuration"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Target Units"}),e.jsx("input",{type:"number",value:a.targetUnits,onChange:A=>l({targetUnits:parseInt(A.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Building Type"}),e.jsxs("select",{value:a.buildingType,onChange:A=>l({buildingType:A.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"residential",children:"Residential"}),e.jsx("option",{value:"commercial",children:"Commercial"}),e.jsx("option",{value:"mixed-use",children:"Mixed-Use"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Parking Type"}),e.jsxs("select",{value:a.parkingType,onChange:A=>l({parkingType:A.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"surface",children:"Surface"}),e.jsx("option",{value:"garage",children:"Garage"}),e.jsx("option",{value:"underground",children:"Underground"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amenity Space (sq ft)"}),e.jsx("input",{type:"number",value:a.amenitySpace,onChange:A=>l({amenitySpace:parseInt(A.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",min:"0"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Unit Mix"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:Object.entries(a.unitMix).map(([A,E])=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 capitalize",children:A.replace(/([A-Z])/g," $1").trim()}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"range",min:"0",max:"1",step:"0.05",value:E,onChange:J=>c(A,parseFloat(J.target.value)),className:"flex-1"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 w-12",children:P(E)})]})]},A))}),e.jsxs("div",{className:"mt-4 text-sm text-gray-600",children:["Total: ",P(Object.values(a.unitMix).reduce((A,E)=>A+E,0))]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("button",{onClick:()=>_(!p),className:"flex items-center space-x-2 text-sm font-medium text-gray-700 hover:text-gray-900",children:[e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{children:"Advanced Settings"})]}),p&&e.jsx("div",{className:"mt-4 space-y-4",children:e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Open Space Ratio"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"range",min:"0",max:"0.5",step:"0.05",value:a.openSpaceRatio,onChange:A=>l({openSpaceRatio:parseFloat(A.target.value)}),className:"flex-1"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 w-12",children:P(a.openSpaceRatio)})]})]})})]})]}),N==="visual"&&e.jsx("div",{className:"space-y-6",children:e.jsx(xa,{children:e.jsx(ps,{parcel:t,marketData:{avgPricePerSqFt:300,avgRentPerSqFt:2.5,capRate:.06,constructionCostPerSqFt:200},onInvestmentAnalysis:A=>{console.log("Investment analysis:",A),s&&s(A)}})})}),N==="analysis"&&n&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(ge,{className:"w-4 h-4 text-blue-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Building Massing"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:n.buildingMassing.stories}),e.jsx("div",{className:"text-xs text-gray-600",children:"Stories"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:n.buildingMassing.totalGSF.toLocaleString()}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total GSF"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:n.buildingMassing.far.toFixed(2)}),e.jsx("div",{className:"text-xs text-gray-600",children:"FAR"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-600",children:P(n.buildingMassing.coverage/100)}),e.jsx("div",{className:"text-xs text-gray-600",children:"Coverage"})]})]})]}),k&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(Ee,{className:"w-4 h-4 text-green-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Financial Analysis"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-bold text-green-600",children:w(k.totalCost)}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total Cost"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-bold text-green-600",children:w(k.totalRevenue)}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total Revenue"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`text-sm font-bold ${k.netImpact>=0?"text-green-600":"text-red-600"}`,children:w(k.netImpact)}),e.jsx("div",{className:"text-xs text-gray-600",children:"Net Impact"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-bold text-blue-600",children:w(k.costPerUnit)}),e.jsx("div",{className:"text-xs text-gray-600",children:"Cost/Unit"})]})]})]}),D&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(ht,{className:"w-4 h-4 text-purple-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Parking Analysis"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-bold text-purple-600",children:D.requiredSpaces}),e.jsx("div",{className:"text-xs text-gray-600",children:"Required Spaces"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-bold text-purple-600",children:w(D.costPerSpace)}),e.jsx("div",{className:"text-xs text-gray-600",children:"Cost/Space"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-bold text-purple-600",children:w(D.totalCost)}),e.jsx("div",{className:"text-xs text-gray-600",children:"Total Cost"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-sm font-bold text-purple-600",children:D.efficiency.toFixed(1)}),e.jsx("div",{className:"text-xs text-gray-600",children:"Spaces/1000 SF"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(_e,{className:"w-4 h-4 text-orange-600"}),e.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Constraint Analysis"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"FAR Utilization"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-blue-600 h-1.5 rounded-full",style:{width:`${Math.min(n.buildingMassing.constraintAnalysis.farUtilization,100)}%`}})}),e.jsxs("span",{className:"text-xs font-medium text-gray-900",children:[n.buildingMassing.constraintAnalysis.farUtilization.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Height Utilization"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-green-600 h-1.5 rounded-full",style:{width:`${Math.min(n.buildingMassing.constraintAnalysis.heightUtilization,100)}%`}})}),e.jsxs("span",{className:"text-xs font-medium text-gray-900",children:[n.buildingMassing.constraintAnalysis.heightUtilization.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Coverage Utilization"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-24 bg-gray-200 rounded-full h-1.5",children:e.jsx("div",{className:"bg-purple-600 h-1.5 rounded-full",style:{width:`${Math.min(n.buildingMassing.constraintAnalysis.coverageUtilization,100)}%`}})}),e.jsxs("span",{className:"text-xs font-medium text-gray-900",children:[n.buildingMassing.constraintAnalysis.coverageUtilization.toFixed(1),"%"]})]})]})]})]}),(n.violations.length>0||n.warnings.length>0)&&e.jsxs("div",{className:"space-y-4",children:[n.violations.length>0&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(Le,{className:"w-5 h-5 text-red-600"}),e.jsx("h3",{className:"font-semibold text-red-900",children:"Violations"})]}),e.jsx("ul",{className:"space-y-1",children:n.violations.map((A,E)=>e.jsxs("li",{className:"text-sm text-red-700",children:["â€¢ ",A]},E))})]}),n.warnings.length>0&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(Le,{className:"w-5 h-5 text-yellow-600"}),e.jsx("h3",{className:"font-semibold text-yellow-900",children:"Warnings"})]}),e.jsx("ul",{className:"space-y-1",children:n.warnings.map((A,E)=>e.jsxs("li",{className:"text-sm text-yellow-700",children:["â€¢ ",A]},E))})]})]})]}),N==="recommendations"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Recommended Configurations"}),e.jsx("div",{className:"space-y-4",children:X.map((A,E)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:A.name}),e.jsx("button",{onClick:()=>l(A.configuration),className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:"Apply"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:A.description}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Units:"}),e.jsx("span",{className:"ml-2 font-medium",children:A.configuration.targetUnits})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Type:"}),e.jsx("span",{className:"ml-2 font-medium capitalize",children:A.configuration.buildingType})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Parking:"}),e.jsx("span",{className:"ml-2 font-medium capitalize",children:A.configuration.parkingType})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Amenities:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[A.configuration.amenitySpace.toLocaleString()," sf"]})]})]})]},E))})]}),n&&n.recommendations.length>0&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Optimization Recommendations"}),e.jsx("div",{className:"space-y-3",children:n.recommendations.map((A,E)=>e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(je,{className:"w-5 h-5 text-green-600 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-gray-700",children:A})]},E))})]})]}),i&&e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600",children:"Generating site plan..."})]})]}):e.jsxs("div",{className:"p-6 text-center text-gray-500",children:[e.jsx(Ie,{className:"w-12 h-12 mx-auto mb-4 text-gray-400"}),e.jsx("p",{children:"Site plan engine not available"}),e.jsx("p",{className:"text-sm",children:"Zoning data and lot size required"})]})});function rs(r){return r&&(typeof r.id=="string"||typeof r.ogc_fid=="number")&&typeof r.address=="string"&&typeof r.sqft=="number"&&(typeof r.deeded_acres=="number"||r.deeded_acres===null||r.deeded_acres===void 0)}function Ys(r,t=4356){const a=Math.sqrt(t*1.5),n=t/a;return{id:typeof r=="string"?r:String(r),ogc_fid:typeof r=="number"?r:parseInt(String(r))||0,address:"Unknown Address",sqft:t,deeded_acres:t/43560,geometry:{type:"Polygon",coordinates:[[[0,0],[a,0],[a,n],[0,n],[0,0]]]},zoning_data:null,zoning:"Unknown"}}const Vn=ee.memo(function({parcel:t,isOpen:s,onClose:a}){const[n,i]=x.useState("overview");if(x.useEffect(()=>{t&&(console.log("ðŸ” FullAnalysisModal parcel object:",t),console.log("ðŸ” isValidParcel check:",rs(t)),console.log("ðŸ” Parcel properties:",{id:t.id,ogc_fid:t.ogc_fid,address:t.address,sqft:t.sqft,deeded_acres:t.deeded_acres}))},[t]),!s||!t)return null;const o=[{id:"overview",label:"Overview",icon:Ce},{id:"hbu",label:"HBU Analysis",icon:We},{id:"siteplan",label:"Site Plan",icon:Ie},{id:"visual",label:"Site Design",icon:xs},{id:"financial",label:"Financial",icon:Ee}];return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full h-full max-w-7xl max-h-[95vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ie,{className:"w-6 h-6 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Full Parcel Analysis"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[t.address," â€¢ ",t.parcelnumb]})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(xe,{className:"w-6 h-6 text-gray-500"})})]}),e.jsx("div",{className:"flex border-b border-gray-200 bg-gray-50",children:o.map(l=>{const c=l.icon;return e.jsxs("button",{onClick:()=>i(l.id),className:`flex items-center space-x-2 px-6 py-4 text-sm font-medium transition-colors ${n===l.id?"text-blue-600 border-b-2 border-blue-600 bg-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:[e.jsx(c,{className:"w-4 h-4"}),e.jsx("span",{children:l.label})]},l.id)})}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs("div",{className:"h-full overflow-y-auto p-6",children:[n==="overview"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Parcel Summary"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"Property Details"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Address:"})," ",t.address]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Parcel #:"})," ",t.parcelnumb]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Lot Size:"})," ",(t.deeded_acres||0).toFixed(2)," acres"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Zoning:"})," ",t.zoning]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"Ownership"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Owner:"})," ",t.primary_owner||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Use:"})," ",t.usedesc||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Year Built:"})," ",t.yearbuilt||"N/A"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"Valuation"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Value:"})," $",(t.parval||0).toLocaleString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Land Value:"})," $",(t.landval||0).toLocaleString()]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Improvement Value:"})," $",(t.improvval||0).toLocaleString()]})]})]})]})]}),t.zoning_data&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Zoning Regulations"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"Development Constraints"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Max FAR:"})," ",t.zoning_data.max_far||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Max Height:"})," ",t.zoning_data.max_building_height_ft||"N/A"," ft"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Max Coverage:"})," ",t.zoning_data.max_coverage_pct||"N/A","%"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Max Density:"})," ",t.zoning_data.max_density_du_per_acre||"N/A"," DU/acre"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-gray-600 mb-2",children:"Setback Requirements"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Front:"})," ",t.zoning_data.min_front_setback_ft||"N/A"," ft"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Rear:"})," ",t.zoning_data.min_rear_setback_ft||"N/A"," ft"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Side:"})," ",t.zoning_data.min_side_setback_ft||"N/A"," ft"]})]})]})]})]})]}),n==="hbu"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Highest & Best Use Analysis"}),e.jsx(An,{parcel:t})]})}),n==="siteplan"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Site Plan Designer"}),e.jsx(Xn,{parcel:rs(t)?t:Ys(t.id||"unknown",t.sqft||4356),onUnderwritingUpdate:l=>{console.log("Site plan financial update:",l)}})]})}),n==="visual"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Visual Site Plan"}),e.jsx("div",{className:"h-[800px]",children:e.jsx(xa,{children:e.jsx(ps,{parcel:rs(t)?t:Ys(t.ogc_fid||t.id||"unknown",t.sqft||4356),marketData:{avgPricePerSqFt:300,avgRentPerSqFt:2.5,capRate:.06,constructionCostPerSqFt:200},onInvestmentAnalysis:l=>{console.log("Investment analysis:",l)}})})})]})}),n==="financial"&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Financial Analysis"}),e.jsx("div",{className:"text-gray-600",children:"Financial analysis tools will be integrated here."})]})})]})})]})})});function Gn({isOpen:r,onClose:t}){const[s,a]=x.useState([]),[n,i]=x.useState("selection"),{selectedParcel:o}=ke();x.useEffect(()=>{o&&!s.find(d=>d.id===o.ogc_fid?.toString())&&a(d=>[...d,{id:o.ogc_fid?.toString()||"",address:o.address||"",parcelnumb:o.parcelnumb||"",deeded_acres:o.deeded_acres||0,sqft:o.sqft||0,zoning:o.zoning||"",parval:o.parval||0,geometry:o.geometry}])},[o,s]);const l=d=>{a(m=>m.filter(h=>h.id!==d))},u=(()=>{if(s.length===0)return null;const d=s.reduce((y,j)=>y+j.deeded_acres,0),m=s.reduce((y,j)=>y+j.sqft,0),h=s.reduce((y,j)=>y+j.parval,0),g=d>0?h/d:0;return{totalAcres:d,totalSqft:m,totalValue:h,avgValuePerAcre:g,parcelCount:s.length}})();return r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full h-full max-w-7xl max-h-[95vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ie,{className:"w-6 h-6 text-blue-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Multi-Parcel Analysis"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[s.length," parcel",s.length!==1?"s":""," selected"]})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(xe,{className:"w-6 h-6 text-gray-500"})})]}),e.jsxs("div",{className:"flex border-b border-gray-200 bg-gray-50",children:[e.jsxs("button",{onClick:()=>i("selection"),className:`flex items-center space-x-2 px-6 py-4 text-sm font-medium transition-colors ${n==="selection"?"text-blue-600 border-b-2 border-blue-600 bg-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{children:"Selection"})]}),e.jsxs("button",{onClick:()=>i("analysis"),className:`flex items-center space-x-2 px-6 py-4 text-sm font-medium transition-colors ${n==="analysis"?"text-blue-600 border-b-2 border-blue-600 bg-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,disabled:s.length===0,children:[e.jsx(_e,{className:"w-4 h-4"}),e.jsx("span",{children:"Combined Analysis"})]}),e.jsxs("button",{onClick:()=>i("comparison"),className:`flex items-center space-x-2 px-6 py-4 text-sm font-medium transition-colors ${n==="comparison"?"text-blue-600 border-b-2 border-blue-600 bg-white":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"}`,disabled:s.length<2,children:[e.jsx(Ce,{className:"w-4 h-4"}),e.jsx("span",{children:"Comparison"})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs("div",{className:"h-full overflow-y-auto p-6",children:[n==="selection"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-blue-900 mb-2",children:"How to Add Parcels"}),e.jsx("p",{className:"text-blue-800 text-sm",children:"Click on parcels in the map to add them to your analysis. You can analyze individual parcels or combine multiple parcels for comprehensive development analysis."})]}),s.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Selected Parcels"}),e.jsx("div",{className:"grid gap-4",children:s.map(d=>e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:d.address}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Parcel #",d.parcelnumb," â€¢ ",d.deeded_acres.toFixed(2)," acres â€¢ ",d.zoning]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-900",children:["$",d.parval.toLocaleString()]}),e.jsxs("div",{className:"text-xs text-gray-600",children:["$",(d.parval/d.deeded_acres).toLocaleString(),"/acre"]})]})]})}),e.jsx("button",{onClick:()=>l(d.id),className:"ml-4 p-2 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(xe,{className:"w-4 h-4 text-red-500"})})]})},d.id))})]}),s.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ie,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Parcels Selected"}),e.jsx("p",{className:"text-gray-600",children:"Click on parcels in the map to start your multi-parcel analysis."})]})]}),n==="analysis"&&u&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Combined Statistics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:u.parcelCount}),e.jsx("div",{className:"text-sm text-gray-600",children:"Parcels"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:u.totalAcres.toFixed(2)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Acres"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-purple-600",children:u.totalSqft.toLocaleString()}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Sq Ft"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-orange-600",children:["$",u.totalValue.toLocaleString()]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Total Value"})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Development Potential"}),e.jsxs("div",{className:"text-gray-600",children:[e.jsx("p",{children:"Combined analysis tools will be integrated here, including:"}),e.jsxs("ul",{className:"list-disc list-inside mt-2 space-y-1",children:[e.jsx("li",{children:"Combined zoning analysis"}),e.jsx("li",{children:"Master site planning"}),e.jsx("li",{children:"Infrastructure requirements"}),e.jsx("li",{children:"Phased development options"}),e.jsx("li",{children:"Combined financial modeling"})]})]})]})]}),n==="comparison"&&s.length>=2&&e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Parcel Comparison"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Address"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Size"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Zoning"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Value"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"$/Acre"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(d=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:d.address}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[d.deeded_acres.toFixed(2)," acres"]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:d.zoning}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["$",d.parval.toLocaleString()]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:["$",(d.parval/d.deeded_acres).toLocaleString()]})]},d.id))})]})})]})})]})})]})}):null}const Wn=ee.memo(function({parcel:t,isOpen:s,onClose:a,onAddToProject:n,hasActiveProject:i,onCreateProjectFromParcel:o}){const[l,c]=x.useState(!1),[u,d]=x.useState(!1),[m,h]=x.useState("overview");if(!s||!t)return null;const g=j=>j<1?`${Math.round(j*43560).toLocaleString()} sq ft`:`${j.toFixed(2)} acres`,y=j=>j?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(j):"N/A";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"fixed inset-y-0 right-0 w-96 bg-white shadow-xl z-40 flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-blue-600"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Parcel Details"})]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-200 rounded-lg transition-colors",children:e.jsx(xe,{className:"w-5 h-5 text-gray-500"})})]}),e.jsxs("div",{className:"flex border-b border-gray-200 bg-white",children:[e.jsx("button",{onClick:()=>h("overview"),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors ${m==="overview"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:"Overview"}),e.jsx("button",{onClick:()=>h("underwriting"),className:`flex-1 px-4 py-3 text-sm font-medium transition-colors ${m==="underwriting"?"text-blue-600 border-b-2 border-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:"Underwriting"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[m==="overview"&&e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(xt,{className:"w-4 h-4 text-blue-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Property Summary"})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Address"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.address||"N/A"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Parcel #"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.parcelnumb||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Lot Size"}),e.jsx("p",{className:"font-medium text-gray-900",children:g(t.deeded_acres||t.deededacreage||t.gisacre||0)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Zoning"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.zoning||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Use"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.usedesc||"N/A"})]})]})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(ta,{className:"w-4 h-4 text-green-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Ownership & Valuation"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Owner"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.primary_owner||t.owner||"N/A"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Total Value"}),e.jsx("p",{className:"font-medium text-gray-900",children:y(t.parval)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Land Value"}),e.jsx("p",{className:"font-medium text-gray-900",children:y(t.landval)})]})]}),t.yearbuilt&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Year Built"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.yearbuilt})]})]})]}),t.zoning_data&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(ms,{className:"w-4 h-4 text-purple-600"}),e.jsx("h3",{className:"font-semibold text-gray-900",children:"Zoning Summary"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Type"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.zoning_data.zoning_type||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Max FAR"}),e.jsx("p",{className:"font-medium text-gray-900",children:t.zoning_data.max_far||"N/A"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Max Height"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[t.zoning_data.max_building_height_ft||"N/A"," ft"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Max Coverage"}),e.jsxs("p",{className:"font-medium text-gray-900",children:[t.zoning_data.max_coverage_pct||"N/A","%"]})]})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>c(!0),className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(fe,{className:"w-4 h-4"}),e.jsx("span",{children:"Full Analysis"})]}),e.jsxs("button",{onClick:()=>d(!0),className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{children:"Multi-Parcel Analysis"})]}),i&&n&&e.jsxs("button",{onClick:()=>n(t),className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{children:"Add to Project"})]}),!i&&o&&e.jsxs("button",{onClick:()=>o(t),className:"w-full flex items-center justify-center space-x-2 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{children:"Create Project from Parcel"})]})]})]}),m==="underwriting"&&e.jsx("div",{className:"p-4",children:e.jsx(Mn,{parcel:t})})]})]}),e.jsx(Vn,{parcel:t,isOpen:l,onClose:()=>c(!1)}),e.jsx(Gn,{isOpen:u,onClose:()=>d(!1)})]})}),Hn=ee.memo(function({onGetStarted:t,onViewDemo:s}){const[a,n]=x.useState(!1),[i,o]=x.useState(0);x.useEffect(()=>{const d=setInterval(()=>{o(m=>(m+1)%c.length)},5e3);return()=>clearInterval(d)},[]);const l=[{icon:e.jsx(Ce,{className:"w-8 h-8 text-blue-600"}),title:"Interactive Parcel Mapping",description:"Navigate Nashville's real estate landscape with precision. Click any parcel for instant property insights, zoning data, and development potential.",highlight:"Real-time data"},{icon:e.jsx(fe,{className:"w-8 h-8 text-green-600"}),title:"AI-Powered Analysis",description:"Get instant underwriting, market trends, and investment recommendations powered by advanced machine learning algorithms.",highlight:"AI-driven insights"},{icon:e.jsx(ge,{className:"w-8 h-8 text-purple-600"}),title:"Site Plan Designer",description:"Design development scenarios with our CAD-like interface. Optimize building placement, parking, and amenities.",highlight:"Professional tools"},{icon:e.jsx(We,{className:"w-8 h-8 text-orange-600"}),title:"Financial Modeling",description:"Calculate ROI, IRR, and cash flow projections with built-in financial analysis tools and market comparables.",highlight:"Investment-ready"}],c=[{name:"Sarah Chen",role:"Development Director, Hines",company:"Hines",content:"This platform has revolutionized how we evaluate sites. We've reduced our due diligence time by 60% and found 3 new development opportunities we would have missed.",rating:5,avatar:"SC"},{name:"Michael Rodriguez",role:"Principal, Blackstone Real Estate",company:"Blackstone",content:"The AI-powered market analysis is incredibly accurate. We've used it for $2B+ in acquisitions across Nashville and the insights have been spot-on.",rating:5,avatar:"MR"},{name:"Jennifer Walsh",role:"VP Acquisitions, Greystar",company:"Greystar",content:"The site planning tools are game-changing. We can model multiple scenarios in minutes instead of days. It's like having a full development team in your browser.",rating:5,avatar:"JW"}],u=[{number:"10,000+",label:"Active Users"},{number:"$50B+",label:"Deals Analyzed"},{number:"95%",label:"Accuracy Rate"},{number:"60%",label:"Time Saved"}];return e.jsxs("div",{className:"min-h-screen bg-white",children:[e.jsxs("nav",{className:"bg-white border-b border-gray-200 sticky top-0 z-50",children:[e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-600 p-2 rounded-lg",children:e.jsx(Ce,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Parcel Intelligence"}),e.jsx("p",{className:"text-xs text-gray-600 hidden sm:block",children:"Real Estate Investment Platform"})]})]}),e.jsxs("div",{className:"hidden md:flex items-center space-x-8",children:[e.jsx("a",{href:"#features",className:"text-gray-600 hover:text-gray-900 transition-colors",children:"Features"}),e.jsx("a",{href:"#testimonials",className:"text-gray-600 hover:text-gray-900 transition-colors",children:"Testimonials"}),e.jsx("a",{href:"#pricing",className:"text-gray-600 hover:text-gray-900 transition-colors",children:"Pricing"}),e.jsxs("button",{onClick:s,className:"text-gray-600 hover:text-gray-900 transition-colors flex items-center space-x-1",children:[e.jsx(pt,{className:"w-4 h-4"}),e.jsx("span",{children:"Demo"})]})]}),e.jsxs("div",{className:"hidden md:flex items-center space-x-4",children:[e.jsx("button",{className:"text-gray-600 hover:text-gray-900 transition-colors",children:"Sign In"}),e.jsx("button",{onClick:t,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Get Started Free"})]}),e.jsx("button",{onClick:()=>n(!a),className:"md:hidden p-2 text-gray-600 hover:text-gray-900",children:a?e.jsx(xe,{className:"w-6 h-6"}):e.jsx(sa,{className:"w-6 h-6"})})]})}),a&&e.jsx("div",{className:"md:hidden bg-white border-t border-gray-200",children:e.jsxs("div",{className:"px-4 py-4 space-y-4",children:[e.jsx("a",{href:"#features",className:"block text-gray-600 hover:text-gray-900",children:"Features"}),e.jsx("a",{href:"#testimonials",className:"block text-gray-600 hover:text-gray-900",children:"Testimonials"}),e.jsx("a",{href:"#pricing",className:"block text-gray-600 hover:text-gray-900",children:"Pricing"}),e.jsxs("button",{onClick:s,className:"flex items-center space-x-2 text-gray-600 hover:text-gray-900",children:[e.jsx(pt,{className:"w-4 h-4"}),e.jsx("span",{children:"Demo"})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-200 space-y-2",children:[e.jsx("button",{className:"block w-full text-left text-gray-600 hover:text-gray-900",children:"Sign In"}),e.jsx("button",{onClick:t,className:"w-full bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors font-medium",children:"Get Started Free"})]})]})})]}),e.jsx("section",{className:"relative bg-gradient-to-br from-blue-50 via-white to-purple-50 py-20 lg:py-32",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"grid lg:grid-cols-2 gap-12 items-center",children:[e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"inline-flex items-center px-4 py-2 bg-blue-100 text-blue-800 rounded-full text-sm font-medium",children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"AI-Powered Real Estate Intelligence"]}),e.jsxs("h1",{className:"text-4xl lg:text-6xl font-bold text-gray-900 leading-tight",children:["Find, Analyze & Develop",e.jsx("span",{className:"text-blue-600 block",children:"Nashville Real Estate"})]}),e.jsx("p",{className:"text-xl text-gray-600 leading-relaxed",children:"The only platform that combines interactive parcel mapping, AI-powered analysis, and professional site planning tools. Used by top developers and investors."})]}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-6",children:u.map((d,m)=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:d.number}),e.jsx("div",{className:"text-sm text-gray-600",children:d.label})]},m))}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("button",{onClick:t,className:"bg-blue-600 text-white px-8 py-4 rounded-lg hover:bg-blue-700 transition-colors font-medium text-lg flex items-center justify-center space-x-2",children:[e.jsx("span",{children:"Start Free Trial"}),e.jsx(Pe,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:s,className:"border border-gray-300 text-gray-700 px-8 py-4 rounded-lg hover:bg-gray-50 transition-colors font-medium text-lg flex items-center justify-center space-x-2",children:[e.jsx(pt,{className:"w-5 h-5"}),e.jsx("span",{children:"Watch Demo"})]})]}),e.jsxs("div",{className:"flex items-center space-x-6 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(ms,{className:"w-4 h-4"}),e.jsx("span",{children:"SOC 2 Compliant"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(Va,{className:"w-4 h-4"}),e.jsx("span",{children:"Enterprise Ready"})]})]})]}),e.jsx("div",{className:"relative",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-2xl p-6 border border-gray-200",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Interactive Map Demo"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-400 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-yellow-400 rounded-full"}),e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-full"})]})]}),e.jsx("div",{className:"bg-gray-100 rounded-lg h-64 flex items-center justify-center",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(Ce,{className:"w-16 h-16 text-blue-600 mx-auto"}),e.jsxs("div",{className:"text-gray-600",children:[e.jsx("p",{className:"font-medium",children:"Click any parcel to explore"}),e.jsx("p",{className:"text-sm",children:"Interactive Nashville real estate data"})]})]})}),e.jsxs("div",{className:"bg-blue-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(We,{className:"w-4 h-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium text-blue-900",children:"AI Analysis"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Development Potential:"}),e.jsx("span",{className:"font-medium text-green-600",children:"High"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Estimated ROI:"}),e.jsx("span",{className:"font-medium text-blue-600",children:"18.5%"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Zoning:"}),e.jsx("span",{className:"font-medium text-gray-900",children:"RM15"})]})]})]})]})})})]})})}),e.jsx("section",{id:"features",className:"py-20 bg-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-3xl lg:text-4xl font-bold text-gray-900 mb-4",children:"Everything You Need to Succeed"}),e.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto",children:"Our platform combines the best of mapping, analysis, and design tools to give you a competitive edge in Nashville's real estate market."})]}),e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-8",children:l.map((d,m)=>e.jsx("div",{className:"group",children:e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200 hover:border-blue-300 hover:shadow-lg transition-all duration-300",children:[e.jsx("div",{className:"mb-4",children:d.icon}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:d.title}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full",children:d.highlight})]}),e.jsx("p",{className:"text-gray-600 text-sm leading-relaxed",children:d.description})]})]})},m))})]})}),e.jsx("section",{className:"py-20 bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-3xl lg:text-4xl font-bold text-gray-900 mb-4",children:"Why Choose Us Over Competitors?"}),e.jsx("p",{className:"text-xl text-gray-600",children:"We combine the best features from multiple platforms into one powerful tool."})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-lg overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-sm font-medium text-gray-900",children:"Feature"}),e.jsx("th",{className:"px-6 py-4 text-center text-sm font-medium text-blue-600",children:"Parcel Intelligence"}),e.jsx("th",{className:"px-6 py-4 text-center text-sm font-medium text-gray-600",children:"Regrid"}),e.jsx("th",{className:"px-6 py-4 text-center text-sm font-medium text-gray-600",children:"CoStar"}),e.jsx("th",{className:"px-6 py-4 text-center text-sm font-medium text-gray-600",children:"Crexi"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-200",children:[e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:"Interactive Parcel Mapping"}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(je,{className:"w-5 h-5 text-green-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(je,{className:"w-5 h-5 text-green-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(xe,{className:"w-5 h-5 text-red-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(xe,{className:"w-5 h-5 text-red-500 mx-auto"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:"AI-Powered Analysis"}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(je,{className:"w-5 h-5 text-green-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(xe,{className:"w-5 h-5 text-red-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(xe,{className:"w-5 h-5 text-red-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(xe,{className:"w-5 h-5 text-red-500 mx-auto"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:"Site Plan Designer"}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(je,{className:"w-5 h-5 text-green-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(xe,{className:"w-5 h-5 text-red-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(xe,{className:"w-5 h-5 text-red-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(xe,{className:"w-5 h-5 text-red-500 mx-auto"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:"Financial Modeling"}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(je,{className:"w-5 h-5 text-green-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(xe,{className:"w-5 h-5 text-red-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(je,{className:"w-5 h-5 text-green-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(xe,{className:"w-5 h-5 text-red-500 mx-auto"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:"Real-time Data"}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(je,{className:"w-5 h-5 text-green-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(je,{className:"w-5 h-5 text-green-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(je,{className:"w-5 h-5 text-green-500 mx-auto"})}),e.jsx("td",{className:"px-6 py-4 text-center",children:e.jsx(xe,{className:"w-5 h-5 text-red-500 mx-auto"})})]})]})]})})})]})}),e.jsx("section",{id:"testimonials",className:"py-20 bg-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-16",children:[e.jsx("h2",{className:"text-3xl lg:text-4xl font-bold text-gray-900 mb-4",children:"Trusted by Industry Leaders"}),e.jsx("p",{className:"text-xl text-gray-600",children:"See what top developers and investors are saying about our platform."})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"flex justify-center space-x-1 mb-4",children:[...Array(c[i].rating)].map((d,m)=>e.jsx(Ga,{className:"w-5 h-5 text-yellow-400 fill-current"},m))}),e.jsxs("blockquote",{className:"text-xl text-gray-700 italic leading-relaxed",children:['"',c[i].content,'"']})]}),e.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white font-semibold",children:c[i].avatar}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:c[i].name}),e.jsx("div",{className:"text-gray-600",children:c[i].role}),e.jsx("div",{className:"text-blue-600 font-medium",children:c[i].company})]})]})]}),e.jsx("div",{className:"flex justify-center space-x-2 mt-8",children:c.map((d,m)=>e.jsx("button",{onClick:()=>o(m),className:`w-3 h-3 rounded-full transition-colors ${m===i?"bg-blue-600":"bg-gray-300"}`},m))})]})]})}),e.jsx("section",{className:"py-20 bg-gradient-to-r from-blue-600 to-purple-600",children:e.jsxs("div",{className:"max-w-4xl mx-auto text-center px-4 sm:px-6 lg:px-8",children:[e.jsx("h2",{className:"text-3xl lg:text-4xl font-bold text-white mb-4",children:"Ready to Transform Your Real Estate Workflow?"}),e.jsx("p",{className:"text-xl text-blue-100 mb-8",children:"Join thousands of professionals who are already using our platform to find, analyze, and develop properties."}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[e.jsxs("button",{onClick:t,className:"bg-white text-blue-600 px-8 py-4 rounded-lg hover:bg-gray-50 transition-colors font-medium text-lg flex items-center justify-center space-x-2",children:[e.jsx("span",{children:"Start Free Trial"}),e.jsx(Pe,{className:"w-5 h-5"})]}),e.jsxs("button",{onClick:s,className:"border border-white text-white px-8 py-4 rounded-lg hover:bg-white hover:text-blue-600 transition-colors font-medium text-lg flex items-center justify-center space-x-2",children:[e.jsx(pt,{className:"w-5 h-5"}),e.jsx("span",{children:"Watch Demo"})]})]})]})}),e.jsx("footer",{className:"bg-gray-900 text-white py-12",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"grid md:grid-cols-4 gap-8",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"bg-blue-600 p-2 rounded-lg",children:e.jsx(Ce,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold",children:"Parcel Intelligence"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Real Estate Investment Platform"})]})]}),e.jsx("p",{className:"text-gray-400 text-sm",children:"The most advanced real estate analysis platform for developers and investors."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Product"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-400",children:[e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Features"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Pricing"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"API"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Integrations"})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Company"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-400",children:[e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"About"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Blog"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Careers"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Contact"})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Support"}),e.jsxs("ul",{className:"space-y-2 text-sm text-gray-400",children:[e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Help Center"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Documentation"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Status"})}),e.jsx("li",{children:e.jsx("a",{href:"#",className:"hover:text-white transition-colors",children:"Security"})})]})]})]}),e.jsx("div",{className:"border-t border-gray-800 mt-8 pt-8 text-center text-sm text-gray-400",children:e.jsx("p",{children:"Â© 2024 Parcel Intelligence. All rights reserved."})})]})})]})});function Zn({isOpen:r,onClose:t,onComplete:s}){const[a,n]=x.useState(0),[i,o]=x.useState(new Set),l=[{id:"welcome",title:"Welcome to Parcel Intelligence",description:"The most advanced real estate analysis platform for Nashville developers and investors.",icon:e.jsx(Ce,{className:"w-8 h-8 text-blue-600"}),action:"Get Started"},{id:"explore",title:"Explore the Map",description:"Click any parcel on the map to view property details, zoning information, and development potential.",icon:e.jsx(_e,{className:"w-8 h-8 text-green-600"}),action:"Try It Now"},{id:"analyze",title:"AI-Powered Analysis",description:"Get instant underwriting, market trends, and investment recommendations powered by advanced AI.",icon:e.jsx(fe,{className:"w-8 h-8 text-purple-600"}),action:"Run Analysis"},{id:"design",title:"Site Plan Designer",description:"Design development scenarios with our CAD-like interface. Optimize building placement and amenities.",icon:e.jsx(ge,{className:"w-8 h-8 text-orange-600"}),action:"Start Designing"},{id:"financial",title:"Financial Modeling",description:"Calculate ROI, IRR, and cash flow projections with built-in financial analysis tools.",icon:e.jsx(ve,{className:"w-8 h-8 text-red-600"}),action:"View Projections"}],c=()=>{a<l.length-1?n(a+1):s()},u=()=>{s()},d=g=>{o(y=>new Set([...y,g])),setTimeout(()=>{c()},1e3)};if(!r)return null;const m=l[a],h=(a+1)/l.length*100;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 px-6 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-white bg-opacity-20 p-2 rounded-lg",children:m.icon}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Quick Tour"}),e.jsxs("p",{className:"text-blue-100 text-sm",children:["Step ",a+1," of ",l.length]})]})]}),e.jsx("button",{onClick:t,className:"text-white hover:text-blue-200 transition-colors",children:e.jsx(xe,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"bg-white bg-opacity-20 rounded-full h-2",children:e.jsx("div",{className:"bg-white h-2 rounded-full transition-all duration-300",style:{width:`${h}%`}})})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"mx-auto w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4",children:m.icon}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:m.title}),e.jsx("p",{className:"text-gray-600 text-lg leading-relaxed",children:m.description})]}),e.jsx("div",{className:"flex justify-center space-x-2 mb-8",children:l.map((g,y)=>e.jsx("div",{className:`w-3 h-3 rounded-full transition-colors ${y===a?"bg-blue-600":y<a?"bg-green-500":"bg-gray-300"}`},g.id))}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[m.action&&e.jsxs("button",{onClick:()=>d(m.id),className:"flex-1 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(pt,{className:"w-4 h-4"}),e.jsx("span",{children:m.action})]}),e.jsxs("button",{onClick:c,className:"flex-1 border border-gray-300 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-50 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx("span",{children:a===l.length-1?"Complete":"Next"}),e.jsx(Pe,{className:"w-4 h-4"})]})]}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx("button",{onClick:u,className:"text-gray-500 hover:text-gray-700 text-sm",children:"Skip Tour"})})]})]})})}function Jn({type:r,title:t,message:s,onClose:a,duration:n=5e3}){const[i,o]=ee.useState(!0);ee.useEffect(()=>{if(n>0){const u=setTimeout(()=>{o(!1),setTimeout(()=>a?.(),300)},n);return()=>clearTimeout(u)}},[n,a]);const l={success:"bg-green-50 border-green-200 text-green-800",error:"bg-red-50 border-red-200 text-red-800",warning:"bg-yellow-50 border-yellow-200 text-yellow-800",info:"bg-blue-50 border-blue-200 text-blue-800"},c={success:"text-green-400",error:"text-red-400",warning:"text-yellow-400",info:"text-blue-400"};return i?e.jsx("div",{className:`fixed top-4 right-4 z-50 max-w-sm w-full bg-white border rounded-lg shadow-lg transition-all duration-300 ${i?"translate-x-0 opacity-100":"translate-x-full opacity-0"} ${l[r]}`,children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("div",{className:`w-5 h-5 ${c[r]}`,children:[r==="success"&&e.jsx("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),r==="error"&&e.jsx("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),r==="warning"&&e.jsx("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),r==="info"&&e.jsx("svg",{fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})]})}),e.jsxs("div",{className:"ml-3 flex-1",children:[e.jsx("h4",{className:"text-sm font-medium",children:t}),s&&e.jsx("p",{className:"text-sm mt-1",children:s})]}),a&&e.jsx("button",{onClick:a,className:"ml-4 flex-shrink-0 text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})})}):null}function Kn({isOpen:r,onClose:t,selectedParcel:s,onParcelSelect:a}){const[n,i]=x.useState("explore"),[o,l]=x.useState(0),[c,u]=x.useState(!1),[d,m]=x.useState(null),{activeProjectId:h,activeProjectName:g,parcelIds:y}=De(),{setDrawer:j}=ke();x.useEffect(()=>{s&&n==="explore"&&(i("analyze"),l(1))},[s,n]);const b={explore:{title:"Explore Properties",description:"Click parcels on the map to discover development opportunities",icon:e.jsx(Ce,{className:"w-6 h-6"}),color:"blue",actions:[{label:"Click any parcel",icon:e.jsx(_e,{className:"w-4 h-4"})},{label:"View property details",icon:e.jsx(xs,{className:"w-4 h-4"})}]},analyze:{title:"AI Analysis",description:"Get instant insights on development potential and market trends",icon:e.jsx(fe,{className:"w-6 h-6"}),color:"green",actions:[{label:"Run HBU Analysis",icon:e.jsx(We,{className:"w-4 h-4"})},{label:"Market Insights",icon:e.jsx(Oe,{className:"w-4 h-4"})}]},design:{title:"Site Planning",description:"Design your development with CAD-like precision",icon:e.jsx(ge,{className:"w-6 h-6"}),color:"purple",actions:[{label:"Add Buildings",icon:e.jsx(Ie,{className:"w-4 h-4"})},{label:"Design Layout",icon:e.jsx(ea,{className:"w-4 h-4"})}]},financial:{title:"Financial Modeling",description:"Calculate ROI, IRR, and cash flow projections",icon:e.jsx(ve,{className:"w-6 h-6"}),color:"orange",actions:[{label:"Run Underwriting",icon:e.jsx(Ee,{className:"w-4 h-4"})},{label:"View Projections",icon:e.jsx(fe,{className:"w-4 h-4"})}]},compare:{title:"Compare Scenarios",description:"Evaluate multiple development options side-by-side",icon:e.jsx(_e,{className:"w-6 h-6"}),color:"indigo",actions:[{label:"Create Scenarios",icon:e.jsx(Ae,{className:"w-4 h-4"})},{label:"Compare Results",icon:e.jsx(fe,{className:"w-4 h-4"})}]}},v=w=>{i(w),l(0)},N=()=>{const w=["explore","analyze","design","financial","compare"],P=w.indexOf(n);P<w.length-1&&(i(w[P+1]),l(0))},C=async()=>{u(!0),setTimeout(()=>{m({hbu:"Mixed-Use Residential",confidence:85,roi:18.5,units:24,gsf:45e3}),u(!1),i("design")},2e3)};if(!r)return null;const p=b[n],_=!!h;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end lg:items-center justify-center p-0 lg:p-4",children:e.jsxs("div",{className:"bg-white w-full lg:max-w-6xl lg:max-h-[90vh] lg:rounded-2xl shadow-2xl flex flex-col h-full lg:h-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 lg:p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`p-2 rounded-lg bg-${p.color}-100`,children:p.icon}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg lg:text-xl font-semibold text-gray-900",children:p.title}),e.jsx("p",{className:"text-sm text-gray-600",children:p.description})]})]}),e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(xe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-4 lg:px-6 py-3 bg-gray-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex space-x-1",children:Object.entries(b).map(([w,P],U)=>{const R=n===w,q=Object.keys(b).indexOf(n)>U;return e.jsxs("button",{onClick:()=>v(w),className:`flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium transition-colors ${R?`bg-${P.color}-100 text-${P.color}-700`:q?"bg-green-100 text-green-700":"text-gray-500 hover:text-gray-700 hover:bg-gray-100"}`,children:[P.icon,e.jsx("span",{className:"hidden sm:inline",children:P.title})]},w)})}),n!=="compare"&&e.jsxs("button",{onClick:N,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:[e.jsx("span",{children:"Next"}),e.jsx(Pe,{className:"w-4 h-4"})]})]})}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[n==="explore"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(Ce,{className:"w-16 h-16 text-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Explore Nashville Properties"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Click any parcel on the map to view property details, zoning information, and development potential. Our AI will analyze each property for you."}),s?e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full"}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-blue-900",children:s.address}),e.jsxs("p",{className:"text-sm text-blue-700",children:[s.zoning," â€¢ ",s.sqft?.toLocaleString()," sqft"]})]})]})}):e.jsx("div",{className:"text-sm text-gray-500",children:"Click a parcel to get started"})]})}),n==="analyze"&&e.jsx("div",{className:"p-4 lg:p-6",children:s?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900",children:s.address}),e.jsxs("p",{className:"text-sm text-green-700",children:[s.zoning," â€¢ ",s.sqft?.toLocaleString()," sqft"]})]})]}),d?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[d.roi,"%"]}),e.jsx("div",{className:"text-xs text-green-700",children:"Projected ROI"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:d.units}),e.jsx("div",{className:"text-xs text-green-700",children:"Units"})]})]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Recommended Use:"})," ",d.hbu]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Confidence:"})," ",d.confidence,"%"]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-green-700",children:"Ready to analyze this property? Our AI will evaluate development potential, market trends, and financial projections."}),e.jsx("button",{onClick:C,disabled:c,className:"w-full bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium flex items-center justify-center space-x-2",children:c?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Analyzing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Run AI Analysis"})]})})]})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(fe,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a Property to Analyze"}),e.jsx("p",{className:"text-gray-600",children:"Choose a parcel from the map to run our AI-powered analysis"})]})}),n==="design"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ge,{className:"w-16 h-16 text-purple-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Design Your Development"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Use our CAD-like site planner to design buildings, parking, and amenities. Optimize your layout for maximum value."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 max-w-md mx-auto",children:[e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(Ie,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("div",{className:"text-sm font-medium",children:"Add Buildings"})]}),e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(ht,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("div",{className:"text-sm font-medium",children:"Add Parking"})]})]})]})}),n==="financial"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ve,{className:"w-16 h-16 text-orange-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Financial Analysis"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Calculate detailed financial projections including ROI, IRR, cash flow, and development costs."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ee,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Run Underwriting"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Calculate detailed financial projections"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(fe,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Market Analysis"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Compare with similar properties"})]})]})})]})]})}),n==="compare"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_e,{className:"w-16 h-16 text-indigo-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Compare Scenarios"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Create multiple development scenarios and compare their financial performance, design efficiency, and market potential."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ae,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Create New Scenario"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Design an alternative development plan"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(fe,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Compare Results"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Side-by-side financial comparison"})]})]})})]})]})})]}),e.jsx("div",{className:"p-4 lg:p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:_?e.jsxs("span",{children:["Project: ",e.jsx("strong",{children:g})," (",y.length," parcels)"]}):e.jsx("span",{children:"No active project"})}),e.jsxs("div",{className:"flex space-x-3",children:[!_&&e.jsx("button",{className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium",children:"Create Project"}),e.jsxs("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(kt,{className:"w-4 h-4"}),e.jsx("span",{children:"Save Work"})]}),e.jsxs("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(pt,{className:"w-4 h-4"}),e.jsx("span",{children:"Generate Report"})]})]})]})})]})})}function Qn({isOpen:r,onClose:t,selectedParcel:s,onParcelSelect:a}){const[n,i]=x.useState("discover"),[o,l]=x.useState([]),[c,u]=x.useState(""),[d,m]=x.useState(!1),[h,g]=x.useState(null),[y,j]=x.useState(!1),{activeProjectId:b,activeProjectName:v,parcelIds:N,addParcel:C}=De();x.useEffect(()=>{s&&n==="discover"&&i("analyze")},[s,n]);const p={discover:{title:"Discover Properties",description:"Click parcels on the map to explore development opportunities",icon:e.jsx(Ce,{className:"w-6 h-6"}),color:"blue",status:"active"},analyze:{title:"Analyze Potential",description:"Get AI-powered insights on development potential",icon:e.jsx(fe,{className:"w-6 h-6"}),color:"green",status:s?"active":"pending"},plan:{title:"Plan Development",description:"Design your site layout and building configuration",icon:e.jsx(ge,{className:"w-6 h-6"}),color:"purple",status:"pending"},model:{title:"Financial Model",description:"Calculate ROI, cash flow, and development costs",icon:e.jsx(ve,{className:"w-6 h-6"}),color:"orange",status:"pending"},compare:{title:"Compare Options",description:"Evaluate multiple development scenarios",icon:e.jsx(_e,{className:"w-6 h-6"}),color:"indigo",status:"pending"}},_=async U=>{if(!b)m(!0),setTimeout(()=>{m(!1),l(R=>[...R,U]),i("analyze")},1e3);else try{await C(U.ogc_fid||U.id),l(R=>[...R,U]),i("analyze")}catch(R){console.error("Failed to add parcel to project:",R)}},w=async()=>{j(!0),setTimeout(()=>{g({hbu:"Mixed-Use Residential",confidence:85,roi:18.5,units:24,gsf:45e3,estimatedValue:125e5,developmentCost:85e5}),j(!1),i("plan")},2e3)},P=()=>{c.trim()&&(m(!0),setTimeout(()=>{m(!1),i("plan")},1e3))};return r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end lg:items-center justify-center p-0 lg:p-4",children:e.jsxs("div",{className:"bg-white w-full lg:max-w-4xl lg:max-h-[90vh] lg:rounded-2xl shadow-2xl flex flex-col h-full lg:h-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 lg:p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:e.jsx(ge,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg lg:text-xl font-semibold text-gray-900",children:"Project Workflow"}),e.jsx("p",{className:"text-sm text-gray-600",children:b?`Active: ${v}`:"Create a new development project"})]})]}),e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(xe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-4 lg:px-6 py-4 bg-gray-50 border-b border-gray-200",children:e.jsx("div",{className:"flex items-center justify-between",children:Object.entries(p).map(([U,R],q)=>{const k=n===U,D=Object.keys(p).indexOf(n)>q;return Object.keys(p).indexOf(n)<q,e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:`flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium ${k?`bg-${R.color}-100 text-${R.color}-700`:D?"bg-green-100 text-green-700":"text-gray-500"}`,children:[D?e.jsx(je,{className:"w-4 h-4"}):R.icon,e.jsx("span",{className:"hidden sm:inline",children:R.title})]}),q<Object.keys(p).length-1&&e.jsx("div",{className:"w-8 h-px bg-gray-300 mx-2"})]},U)})})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[n==="discover"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ce,{className:"w-16 h-16 text-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Discover Development Opportunities"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Click any parcel on the map to explore its development potential. Our AI will analyze zoning, market trends, and financial projections."}),s?e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:s.address}),e.jsxs("p",{className:"text-sm text-blue-700",children:[s.zoning," â€¢ ",s.sqft?.toLocaleString()," sqft"]})]})]}),e.jsx("button",{onClick:()=>_(s),disabled:d,className:"w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors font-medium flex items-center justify-center space-x-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Creating Project..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{children:"Add to Project"})]})})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Click a parcel on the map to get started"})]})}),n==="analyze"&&e.jsx("div",{className:"p-4 lg:p-6",children:s?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900",children:s.address}),e.jsxs("p",{className:"text-sm text-green-700",children:[s.zoning," â€¢ ",s.sqft?.toLocaleString()," sqft"]})]})]}),h?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[h.roi,"%"]}),e.jsx("div",{className:"text-xs text-green-700",children:"Projected ROI"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:h.units}),e.jsx("div",{className:"text-xs text-green-700",children:"Units"})]})]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Recommended Use:"})," ",h.hbu]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Confidence:"})," ",h.confidence,"%"]}),e.jsxs("button",{onClick:()=>i("plan"),className:"w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Planning"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-green-700",children:"Ready to analyze this property? Our AI will evaluate development potential, market trends, and financial projections."}),e.jsx("button",{onClick:w,disabled:y,className:"w-full bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors font-medium flex items-center justify-center space-x-2",children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Analyzing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Run AI Analysis"})]})})]})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(fe,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a Property to Analyze"}),e.jsx("p",{className:"text-gray-600",children:"Choose a parcel from the map to run our AI-powered analysis"})]})}),n==="plan"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ge,{className:"w-16 h-16 text-purple-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Plan Your Development"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Design your site layout with our CAD-like tools. Add buildings, parking, and amenities to optimize your development."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 max-w-md mx-auto",children:[e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(Ie,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("div",{className:"text-sm font-medium",children:"Add Buildings"})]}),e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(ht,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("div",{className:"text-sm font-medium",children:"Add Parking"})]})]}),e.jsxs("button",{onClick:()=>i("model"),className:"mt-6 w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Financial Modeling"})]})]})}),n==="model"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ve,{className:"w-16 h-16 text-orange-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Financial Modeling"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Calculate detailed financial projections including ROI, IRR, cash flow, and development costs."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ee,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Run Underwriting"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Calculate detailed financial projections"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(fe,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Market Analysis"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Compare with similar properties"})]})]})})]}),e.jsxs("button",{onClick:()=>i("compare"),className:"mt-6 w-full bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Comparison"})]})]})}),n==="compare"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_e,{className:"w-16 h-16 text-indigo-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Compare Scenarios"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Create multiple development scenarios and compare their financial performance, design efficiency, and market potential."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ae,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Create New Scenario"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Design an alternative development plan"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(fe,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Compare Results"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Side-by-side financial comparison"})]})]})})]})]})})]}),e.jsx("div",{className:"p-4 lg:p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:b?e.jsxs("span",{children:["Project: ",e.jsx("strong",{children:v})," (",N.length," parcels)"]}):e.jsx("span",{children:"No active project"})}),e.jsxs("div",{className:"flex space-x-3",children:[!b&&e.jsx("button",{onClick:P,className:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors text-sm font-medium",children:"Create Project"}),e.jsxs("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(kt,{className:"w-4 h-4"}),e.jsx("span",{children:"Save Work"})]}),e.jsxs("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(ut,{className:"w-4 h-4"}),e.jsx("span",{children:"Generate Report"})]})]})]})})]})}):null}function er({isOpen:r,onClose:t,selectedParcel:s,onParcelSelect:a}){const[n,i]=x.useState("discover"),[o,l]=x.useState([]),[c,u]=x.useState(""),[d,m]=x.useState(!1),[h,g]=x.useState(null),[y,j]=x.useState(!1),{activeProjectId:b,activeProjectName:v,parcelIds:N,addParcel:C}=De();x.useEffect(()=>{s&&n==="discover"&&i("analyze")},[s,n]);const p=async w=>{if(!b)m(!0),setTimeout(()=>{m(!1),l(P=>[...P,w]),i("analyze")},1e3);else try{await C(w.ogc_fid||w.id),l(P=>[...P,w]),i("analyze")}catch(P){console.error("Failed to add parcel to project:",P)}},_=async()=>{j(!0),setTimeout(()=>{g({hbu:"Mixed-Use Residential",confidence:85,roi:18.5,units:24,gsf:45e3,estimatedValue:125e5,developmentCost:85e5}),j(!1),i("plan")},2e3)};return r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end lg:items-center justify-center p-0 lg:p-4",children:e.jsxs("div",{className:"bg-white w-full lg:max-w-4xl lg:max-h-[90vh] lg:rounded-2xl shadow-2xl flex flex-col h-full lg:h-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 lg:p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100",children:e.jsx(ge,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg lg:text-xl font-semibold text-gray-900",children:"Project Workflow"}),e.jsx("p",{className:"text-sm text-gray-600",children:b?`Active: ${v}`:"Create a new development project"})]})]}),e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(xe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-4 lg:px-6 py-4 bg-gray-50 border-b border-gray-200",children:e.jsx("div",{className:"flex items-center justify-between",children:[{id:"discover",label:"Discover",icon:e.jsx(Ce,{className:"w-4 h-4"}),color:"blue"},{id:"analyze",label:"Analyze",icon:e.jsx(fe,{className:"w-4 h-4"}),color:"green"},{id:"plan",label:"Plan",icon:e.jsx(ge,{className:"w-4 h-4"}),color:"purple"},{id:"model",label:"Model",icon:e.jsx(ve,{className:"w-4 h-4"}),color:"orange"},{id:"compare",label:"Compare",icon:e.jsx(_e,{className:"w-4 h-4"}),color:"indigo"}].map((w,P)=>{const U=n===w.id,R=["discover","analyze","plan","model","compare"].indexOf(n)>P;return e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:`flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium ${U?`bg-${w.color}-100 text-${w.color}-700`:R?"bg-green-100 text-green-700":"text-gray-500"}`,children:[R?e.jsx(je,{className:"w-4 h-4"}):w.icon,e.jsx("span",{className:"hidden sm:inline",children:w.label})]}),P<4&&e.jsx("div",{className:"w-8 h-px bg-gray-300 mx-2"})]},w.id)})})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[n==="discover"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ce,{className:"w-16 h-16 text-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Discover Development Opportunities"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Click any parcel on the map to explore its development potential. Our AI will analyze zoning, market trends, and financial projections."}),s?e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:s.address}),e.jsxs("p",{className:"text-sm text-blue-700",children:[s.zoning," â€¢ ",s.sqft?.toLocaleString()," sqft"]})]})]}),e.jsx("button",{onClick:()=>p(s),disabled:d,className:"w-full bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors font-medium flex items-center justify-center space-x-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Creating Project..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{children:"Add to Project"})]})})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Click a parcel on the map to get started"})]})}),n==="analyze"&&e.jsx("div",{className:"p-4 lg:p-6",children:s?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900",children:s.address}),e.jsxs("p",{className:"text-sm text-green-700",children:[s.zoning," â€¢ ",s.sqft?.toLocaleString()," sqft"]})]})]}),h?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[h.roi,"%"]}),e.jsx("div",{className:"text-xs text-green-700",children:"Projected ROI"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:h.units}),e.jsx("div",{className:"text-xs text-green-700",children:"Units"})]})]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Recommended Use:"})," ",h.hbu]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Confidence:"})," ",h.confidence,"%"]}),e.jsxs("button",{onClick:()=>i("plan"),className:"w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Planning"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-green-700",children:"Ready to analyze this property? Our AI will evaluate development potential, market trends, and financial projections."}),e.jsx("button",{onClick:_,disabled:y,className:"w-full bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors font-medium flex items-center justify-center space-x-2",children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Analyzing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Run AI Analysis"})]})})]})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(fe,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a Property to Analyze"}),e.jsx("p",{className:"text-gray-600",children:"Choose a parcel from the map to run our AI-powered analysis"})]})}),n==="plan"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ge,{className:"w-16 h-16 text-purple-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Plan Your Development"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Design your site layout with our CAD-like tools. Add buildings, parking, and amenities to optimize your development."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 max-w-md mx-auto",children:[e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(Ie,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("div",{className:"text-sm font-medium",children:"Add Buildings"})]}),e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(ht,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("div",{className:"text-sm font-medium",children:"Add Parking"})]})]}),e.jsxs("button",{onClick:()=>i("model"),className:"mt-6 w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Financial Modeling"})]})]})}),n==="model"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ve,{className:"w-16 h-16 text-orange-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Financial Modeling"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Calculate detailed financial projections including ROI, IRR, cash flow, and development costs."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ee,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Run Underwriting"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Calculate detailed financial projections"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(fe,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Market Analysis"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Compare with similar properties"})]})]})})]}),e.jsxs("button",{onClick:()=>i("compare"),className:"mt-6 w-full bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Comparison"})]})]})}),n==="compare"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_e,{className:"w-16 h-16 text-indigo-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Compare Scenarios"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Create multiple development scenarios and compare their financial performance, design efficiency, and market potential."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ae,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Create New Scenario"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Design an alternative development plan"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(fe,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Compare Results"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Side-by-side financial comparison"})]})]})})]})]})})]}),e.jsx("div",{className:"p-4 lg:p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:b?e.jsxs("span",{children:["Project: ",e.jsx("strong",{children:v})," (",N.length," parcels)"]}):e.jsx("span",{children:"No active project"})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(kt,{className:"w-4 h-4"}),e.jsx("span",{children:"Save Work"})]}),e.jsxs("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(ut,{className:"w-4 h-4"}),e.jsx("span",{children:"Generate Report"})]})]})]})})]})}):null}function tr({isOpen:r,onClose:t,selectedParcel:s,onParcelSelect:a}){const[n,i]=x.useState("discover"),[o,l]=x.useState([]),[c,u]=x.useState(""),[d,m]=x.useState(!1),[h,g]=x.useState(null),[y,j]=x.useState(!1),[b,v]=x.useState(!0),{activeProjectId:N,activeProjectName:C,parcelIds:p,addParcel:_,set:w}=De(),{setDrawer:P}=ke();x.useEffect(()=>{s&&n==="discover"&&(i("analyze"),v(!1))},[s,n]);const U={discover:{title:"Discover Properties",description:"Click parcels on the map to explore development opportunities",icon:e.jsx(Ce,{className:"w-6 h-6"}),color:"blue",status:"active"},analyze:{title:"Analyze Potential",description:"Get AI-powered insights on development potential",icon:e.jsx(fe,{className:"w-6 h-6"}),color:"green",status:s?"active":"pending"},plan:{title:"Plan Development",description:"Design your site layout and building configuration",icon:e.jsx(ge,{className:"w-6 h-6"}),color:"purple",status:"pending"},model:{title:"Financial Model",description:"Calculate ROI, cash flow, and development costs",icon:e.jsx(ve,{className:"w-6 h-6"}),color:"orange",status:"pending"},compare:{title:"Compare Options",description:"Evaluate multiple development scenarios",icon:e.jsx(_e,{className:"w-6 h-6"}),color:"indigo",status:"pending"}},R=async k=>{if(N)try{await _(String(k.ogc_fid||k.id),k),l(D=>[...D,k]),i("analyze"),v(!1)}catch(D){console.error("Failed to add parcel to project:",D)}else{m(!0);const D=`Project - ${k.address||"New Development"}`,Y=`project_${Date.now()}`;w(Y,D),await _(String(k.ogc_fid||k.id),k),m(!1),l(X=>[...X,k]),i("analyze"),v(!1)}},q=async()=>{j(!0),setTimeout(()=>{g({hbu:"Mixed-Use Residential",confidence:85,roi:18.5,units:24,gsf:45e3,estimatedValue:125e5,developmentCost:85e5}),j(!1),i("plan")},2e3)};return r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end lg:items-center justify-center p-0 lg:p-4",children:e.jsxs("div",{className:"bg-white w-full lg:max-w-4xl lg:max-h-[90vh] lg:rounded-2xl shadow-2xl flex flex-col h-full lg:h-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 lg:p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100",children:e.jsx(ge,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg lg:text-xl font-semibold text-gray-900",children:"Project Workflow"}),e.jsx("p",{className:"text-sm text-gray-600",children:N?`Active: ${C}`:"Create a new development project"})]})]}),e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(xe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-4 lg:px-6 py-4 bg-gray-50 border-b border-gray-200",children:e.jsx("div",{className:"flex items-center justify-between",children:Object.entries(U).map(([k,D],Y)=>{const X=n===k,A=Object.keys(U).indexOf(n)>Y;return e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:`flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium ${X?`bg-${D.color}-100 text-${D.color}-700`:A?"bg-green-100 text-green-700":"text-gray-500"}`,children:[A?e.jsx(je,{className:"w-4 h-4"}):D.icon,e.jsx("span",{className:"hidden sm:inline",children:D.title})]}),Y<Object.keys(U).length-1&&e.jsx("div",{className:"w-8 h-px bg-gray-300 mx-2"})]},k)})})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[n==="discover"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ce,{className:"w-16 h-16 text-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Discover Development Opportunities"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Click any parcel on the map to explore its development potential. Our AI will analyze zoning, market trends, and financial projections."}),b&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(zt,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:"Map Interaction"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Click any parcel on the map behind this modal to get started"})]})]}),e.jsx("div",{className:"text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded",children:"ðŸ’¡ The map is interactive even with this modal open"})]}),s?e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h4",{className:"font-medium text-green-900",children:s.address}),e.jsxs("p",{className:"text-sm text-green-700",children:[s.zoning," â€¢ ",s.sqft?.toLocaleString()," sqft"]})]})]}),e.jsx("button",{onClick:()=>R(s),disabled:d,className:"w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors font-medium flex items-center justify-center space-x-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Creating Project..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{children:"Add to Project"})]})})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Click a parcel on the map to get started"})]})}),n==="analyze"&&e.jsx("div",{className:"p-4 lg:p-6",children:s?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900",children:s.address}),e.jsxs("p",{className:"text-sm text-green-700",children:[s.zoning," â€¢ ",s.sqft?.toLocaleString()," sqft"]})]})]}),h?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[h.roi,"%"]}),e.jsx("div",{className:"text-xs text-green-700",children:"Projected ROI"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:h.units}),e.jsx("div",{className:"text-xs text-green-700",children:"Units"})]})]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Recommended Use:"})," ",h.hbu]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Confidence:"})," ",h.confidence,"%"]}),e.jsxs("button",{onClick:()=>i("plan"),className:"w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Planning"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-green-700",children:"Ready to analyze this property? Our AI will evaluate development potential, market trends, and financial projections."}),e.jsx("button",{onClick:q,disabled:y,className:"w-full bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors font-medium flex items-center justify-center space-x-2",children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Analyzing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Run AI Analysis"})]})})]})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(fe,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a Property to Analyze"}),e.jsx("p",{className:"text-gray-600",children:"Choose a parcel from the map to run our AI-powered analysis"})]})}),n==="plan"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ge,{className:"w-16 h-16 text-purple-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Plan Your Development"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Design your site layout with our CAD-like tools. Add buildings, parking, and amenities to optimize your development."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 max-w-md mx-auto",children:[e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(Ie,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("div",{className:"text-sm font-medium",children:"Add Buildings"})]}),e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[e.jsx(ht,{className:"w-8 h-8 text-purple-600 mx-auto mb-2"}),e.jsx("div",{className:"text-sm font-medium",children:"Add Parking"})]})]}),e.jsxs("button",{onClick:()=>i("model"),className:"mt-6 w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Financial Modeling"})]})]})}),n==="model"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ve,{className:"w-16 h-16 text-orange-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Financial Modeling"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Calculate detailed financial projections including ROI, IRR, cash flow, and development costs."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ee,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Run Underwriting"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Calculate detailed financial projections"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(fe,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Market Analysis"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Compare with similar properties"})]})]})})]}),e.jsxs("button",{onClick:()=>i("compare"),className:"mt-6 w-full bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Comparison"})]})]})}),n==="compare"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_e,{className:"w-16 h-16 text-indigo-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Compare Scenarios"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Create multiple development scenarios and compare their financial performance, design efficiency, and market potential."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ae,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Create New Scenario"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Design an alternative development plan"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(fe,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Compare Results"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Side-by-side financial comparison"})]})]})})]})]})})]}),e.jsx("div",{className:"p-4 lg:p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:N?e.jsxs("span",{children:["Project: ",e.jsx("strong",{children:C})," (",p.length," parcels)"]}):e.jsx("span",{children:"No active project"})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(kt,{className:"w-4 h-4"}),e.jsx("span",{children:"Save Work"})]}),e.jsxs("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(ut,{className:"w-4 h-4"}),e.jsx("span",{children:"Generate Report"})]})]})]})})]})}):null}const sr=os()(on((r,t)=>({activeSitePlan:null,savedSitePlans:[],isEditing:!1,hasUnsavedChanges:!1,createSitePlan:(s,a,n)=>{const i=new Date().toISOString(),o={id:`siteplan_${Date.now()}`,name:n?.name||"New Site Plan",description:n?.description||"Site plan design",parcelId:s,projectId:a,elements:n?.elements||[],metadata:{created:i,modified:i,version:1,aiGenerated:!!n,hbuAnalysisId:n?.hbuAnalysisId},compliance:{zoningCompliant:!0,violations:[],warnings:[],score:85},financial:{estimatedValue:n?.financial?.estimatedValue||0,developmentCost:n?.financial?.developmentCost||0,irr:n?.financial?.irr||0,roi:n?.financial?.roi||0,totalUnits:n?.financial?.totalUnits||0,totalGSF:n?.financial?.totalGSF||0,parkingSpaces:n?.financial?.parkingSpaces||0}};return r({activeSitePlan:o,isEditing:!0}),o},updateSitePlan:(s,a)=>{const{activeSitePlan:n,savedSitePlans:i}=t();if(n?.id===s){const l={...n,...a,metadata:{...n.metadata,modified:new Date().toISOString()}};r({activeSitePlan:l,hasUnsavedChanges:!0})}const o=i.map(l=>l.id===s?{...l,...a,metadata:{...l.metadata,modified:new Date().toISOString()}}:l);r({savedSitePlans:o})},saveSitePlan:s=>{const{savedSitePlans:a}=t(),n=a.findIndex(o=>o.id===s.id),i={...s,metadata:{...s.metadata,modified:new Date().toISOString()}};if(n>=0){const o=[...a];o[n]=i,r({savedSitePlans:o,hasUnsavedChanges:!1})}else r({savedSitePlans:[...a,i],hasUnsavedChanges:!1})},loadSitePlan:s=>{const{savedSitePlans:a}=t(),n=a.find(i=>i.id===s);return n&&r({activeSitePlan:n,isEditing:!0}),n||null},deleteSitePlan:s=>{const{savedSitePlans:a,activeSitePlan:n}=t(),i=a.filter(o=>o.id!==s);r({savedSitePlans:i}),n?.id===s&&r({activeSitePlan:null,isEditing:!1})},setActiveSitePlan:s=>{r({activeSitePlan:s,isEditing:!!s})},addElement:s=>{const{activeSitePlan:a}=t();if(!a)return;const n={...a,elements:[...a.elements,s],metadata:{...a.metadata,modified:new Date().toISOString()}};r({activeSitePlan:n,hasUnsavedChanges:!0})},updateElement:(s,a)=>{const{activeSitePlan:n}=t();if(!n)return;const i=n.elements.map(l=>l.id===s?{...l,...a}:l),o={...n,elements:i,metadata:{...n.metadata,modified:new Date().toISOString()}};r({activeSitePlan:o,hasUnsavedChanges:!0})},removeElement:s=>{const{activeSitePlan:a}=t();if(!a)return;const n=a.elements.filter(o=>o.id!==s),i={...a,elements:n,metadata:{...a.metadata,modified:new Date().toISOString()}};r({activeSitePlan:i,hasUnsavedChanges:!0})},markAsUnsaved:()=>{r({hasUnsavedChanges:!0})},markAsSaved:()=>{r({hasUnsavedChanges:!1})},generateFromAI:(s,a)=>{const n=new Date().toISOString(),i=s.alternatives?.[0];if(!i)throw new Error("No HBU analysis data available");const o=[{id:`building_${Date.now()}`,type:"building",name:"Main Building",vertices:[{x:50,y:50,id:"v1"},{x:150,y:50,id:"v2"},{x:150,y:100,id:"v3"},{x:50,y:100,id:"v4"}],properties:{area:i.density*(a.sqft||4356),units:Math.floor(i.density*(a.sqft||4356)/43560),height:i.height*10,stories:i.height,use:i.use},metadata:{created:n,modified:n,source:"ai-generated"}},{id:`parking_${Date.now()}`,type:"parking",name:"Parking Area",vertices:[{x:20,y:20,id:"v1"},{x:80,y:20,id:"v2"},{x:80,y:40,id:"v3"},{x:20,y:40,id:"v4"}],properties:{parkingSpaces:Math.ceil(Math.floor(i.density*(a.sqft||4356)/43560)*1.5)},metadata:{created:n,modified:n,source:"ai-generated"}}],l={id:`siteplan_${Date.now()}`,name:`${i.use} Development Plan`,description:`AI-generated site plan based on ${i.use} analysis`,parcelId:a.ogc_fid||a.id,projectId:void 0,elements:o,metadata:{created:n,modified:n,version:1,aiGenerated:!0,hbuAnalysisId:s.id},compliance:{zoningCompliant:!0,violations:[],warnings:[],score:85},financial:{estimatedValue:i.estimatedValue,developmentCost:i.developmentCost,irr:i.internalRateOfReturn,roi:i.internalRateOfReturn*.8,totalUnits:Math.floor(i.density*(a.sqft||4356)/43560),totalGSF:i.density*(a.sqft||4356),parkingSpaces:Math.ceil(Math.floor(i.density*(a.sqft||4356)/43560)*1.5)}};return r({activeSitePlan:l,isEditing:!0}),l},exportSitePlan:s=>{const{savedSitePlans:a}=t();return a.find(i=>i.id===s)||null},importSitePlan:s=>{const a={id:`siteplan_${Date.now()}`,name:s.name||"Imported Site Plan",description:s.description||"Imported site plan",parcelId:s.parcelId||"",projectId:s.projectId,elements:s.elements||[],metadata:{created:new Date().toISOString(),modified:new Date().toISOString(),version:1,aiGenerated:!1},compliance:s.compliance||{zoningCompliant:!0,violations:[],warnings:[],score:85},financial:s.financial||{estimatedValue:0,developmentCost:0,irr:0,roi:0,totalUnits:0,totalGSF:0,parkingSpaces:0}};return r({activeSitePlan:a,isEditing:!0}),a},generateAISitePlan:async(s,a)=>{const n=new Date().toISOString(),i={id:`ai_siteplan_${Date.now()}`,name:`${s.address} - AI Optimized Site Plan`,description:`AI-generated site plan based on ${a.recommendedUse} analysis`,parcelId:s.ogc_fid.toString(),elements:[],metadata:{created:n,modified:n,version:1,aiGenerated:!0,hbuAnalysisId:`analysis_${Date.now()}`},compliance:{zoningCompliant:!0,violations:[],warnings:[],score:a.confidence||85},financial:{estimatedValue:a.alternatives?.[0]?.estimatedValue||0,developmentCost:a.alternatives?.[0]?.developmentCost||0,irr:a.alternatives?.[0]?.internalRateOfReturn||0,roi:a.alternatives?.[0]?.netPresentValue||0,totalUnits:0,totalGSF:0,parkingSpaces:0}};return r({activeSitePlan:i,isEditing:!0}),i},enhanceSitePlan:s=>{const a={...s,metadata:{...s.metadata,modified:new Date().toISOString(),version:s.metadata.version+1}};return r({activeSitePlan:a,isEditing:!0}),a},validateSitePlan:s=>{const a=[],n=[];let i=100;(!s.elements||s.elements.length===0)&&(a.push("Site plan must have at least one element"),i-=50);const o=ar(s.elements);return o.length>0&&(n.push(`Found ${o.length} overlapping elements`),i-=10),s.compliance.zoningCompliant||(a.push("Site plan is not zoning compliant"),i-=30),s.financial.irr<.1&&(n.push("Low IRR - consider optimizing design"),i-=5),{isValid:a.length===0,errors:a,warnings:n,score:Math.max(0,i)}},optimizeSitePlan:s=>{const a={...s,elements:s.elements.map(n=>({...n,properties:{...n.properties,optimized:!0}})),metadata:{...s.metadata,modified:new Date().toISOString(),version:s.metadata.version+1}};return r({activeSitePlan:a,isEditing:!0}),a},getSitePlanMetrics:s=>{const a=s.elements,n=a.reduce((c,u)=>c+(u.properties.area||0),0),i=a.filter(c=>c.type==="building").reduce((c,u)=>c+(u.properties.area||0),0),o=a.filter(c=>c.type==="parking").reduce((c,u)=>c+(u.properties.area||0),0),l=a.filter(c=>c.type==="landscaping").reduce((c,u)=>c+(u.properties.area||0),0);return{totalArea:n,buildingArea:i,parkingArea:o,landscapingArea:l,buildingCoverage:n>0?i/n*100:0,parkingRatio:i>0?o/i*100:0,unitDensity:s.financial.totalUnits/(n/43560),efficiency:rr(s)}}}),{name:"site-plan-storage",partialize:r=>({savedSitePlans:r.savedSitePlans,activeSitePlan:r.activeSitePlan})}));function ar(r){const t=[];for(let s=0;s<r.length;s++)for(let a=s+1;a<r.length;a++)nr(r[s],r[a])&&t.push(`${r[s].id} overlaps with ${r[a].id}`);return t}function nr(r,t){const s=Ls(r),a=Ls(t);return!(s.maxX<a.minX||s.minX>a.maxX||s.maxY<a.minY||s.minY>a.maxY)}function Ls(r){if(r.vertices.length===0)return{minX:0,minY:0,maxX:0,maxY:0};const t=r.vertices.map(a=>a.x),s=r.vertices.map(a=>a.y);return{minX:Math.min(...t),minY:Math.min(...s),maxX:Math.max(...t),maxY:Math.max(...s)}}function rr(r){const t=r.elements,s=t.reduce((o,l)=>o+(l.properties.area||0),0),a=t.filter(o=>o.type==="building").reduce((o,l)=>o+(l.properties.area||0),0);if(s===0)return 0;const n=a/s*100,i=Math.min(100,r.financial.irr*1e3);return(n+i)/2}function ir(){const{activeSitePlan:r,isEditing:t,hasUnsavedChanges:s,createSitePlan:a,updateSitePlan:n,saveSitePlan:i,loadSitePlan:o,generateAISitePlan:l,enhanceSitePlan:c,validateSitePlan:u,optimizeSitePlan:d,getSitePlanMetrics:m,addElement:h,updateElement:g,removeElement:y}=sr(),{analysis:j,loading:b,analyzeParcel:v}=hs(),[N,C]=x.useState(!1),[p,_]=x.useState(!1),[w,P]=x.useState(!1),[U,R]=x.useState(!1),[q,k]=x.useState(!1),D=x.useMemo(()=>r?u(r):null,[r,u]),Y=x.useMemo(()=>r?m(r):null,[r,m]),X=x.useCallback(async(te,Xe)=>{C(!0);try{const Ve=Xe||await v(te);if(!Ve)throw new Error("Failed to generate HBU analysis");return await l(te,Ve)}catch(Ve){throw console.error("AI site plan generation failed:",Ve),Ve}finally{C(!1)}},[v,l]),A=x.useCallback((te,Xe)=>a(te,Xe),[a]),E=x.useCallback(te=>{r&&n(r.id,te)},[r,n]),J=x.useCallback(te=>{i(te)},[i]),O=x.useCallback(te=>o(te),[o]),re=x.useCallback(async()=>{if(!r)return null;_(!0);try{return d(r)}catch(te){throw console.error("Site plan optimization failed:",te),te}finally{_(!1)}},[r,d]),ae=x.useCallback(()=>r?u(r):{isValid:!1,errors:["No active site plan"],warnings:[],score:0},[r,u]),K=x.useCallback(()=>r?m(r):{totalArea:0,buildingArea:0,parkingArea:0,landscapingArea:0,buildingCoverage:0,parkingRatio:0,unitDensity:0,efficiency:0},[r,m]),de=x.useCallback(()=>{P(te=>!te)},[]),ne=x.useCallback(()=>{R(te=>!te)},[]),W=x.useCallback(()=>{k(te=>!te)},[]),oe=x.useCallback(te=>{h(te)},[h]),V=x.useCallback((te,Xe)=>{g(te,Xe)},[g]),ce=x.useCallback(te=>{y(te)},[y]);return{...{activeSitePlan:r,isGenerating:N,isOptimizing:p,validation:D,metrics:Y,showAIGenerator:w,showOptimizer:U,showValidator:q},...{generateAISitePlan:X,createSitePlan:A,updateSitePlan:E,saveSitePlan:J,loadSitePlan:O,optimizeSitePlan:re,validateSitePlan:ae,calculateMetrics:K,toggleAIGenerator:de,toggleOptimizer:ne,toggleValidator:W,addElement:oe,updateElement:V,removeElement:ce},isEditing:t,hasUnsavedChanges:s,hbuAnalysis:j,hbuLoading:b}}function ga({isOpen:r,onClose:t,selectedParcel:s,mode:a="design",hbuAnalysis:n,onAnalysisComplete:i,onSitePlanGenerated:o,onSitePlanSaved:l,onContinueToUnderwriting:c,showAIGenerator:u=!1,showOptimizer:d=!1,showValidator:m=!1}){const{activeSitePlan:h,isOptimizing:g,validation:y,metrics:j,generateAISitePlan:b,optimizeSitePlan:v,toggleAIGenerator:N,toggleOptimizer:C,toggleValidator:p}=ir(),[_,w]=x.useState("analyze"),[P,U]=x.useState(!1),[R,q]=x.useState(!1),[k,D]=x.useState(null);x.useEffect(()=>{a==="ai-generation"&&s&&n&&!k&&Y()},[a,s,n,k]);const Y=x.useCallback(async()=>{if(!(!s||!n)){q(!0),w("generate");try{const K=await b(s,n);D(K),w("optimize"),o&&o(K)}catch(K){console.error("AI site plan generation failed:",K)}finally{q(!1)}}},[s,n,b,o]),X=x.useCallback(async()=>{if(h){w("optimize");try{const K=await v();w("finalize"),l&&l(K)}catch(K){console.error("Site plan optimization failed:",K)}}},[h,v,l]),A=x.useCallback(()=>{w("finalize"),c&&h&&c(h)},[c,h]),E=()=>{switch(a){case"ai-generation":return J();case"enhanced":return O();case"optimization":return re();default:return ae()}},J=()=>e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(Oe,{className:"w-16 h-16 text-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"AI-Driven Site Plan Generator"}),e.jsx("p",{className:"text-gray-600",children:s?`${s.address}`:"Generate site plan from HBU analysis"})]}),e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("div",{className:"flex items-center space-x-4",children:[{key:"analyze",label:"Analyze",icon:_e},{key:"generate",label:"Generate",icon:Oe},{key:"optimize",label:"Optimize",icon:et},{key:"finalize",label:"Finalize",icon:je}].map((K,de)=>{const ne=K.icon,W=_===K.key,oe=["analyze","generate","optimize","finalize"].indexOf(_)>de;return e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full border-2 ${W?"bg-blue-600 border-blue-600 text-white":oe?"bg-green-600 border-green-600 text-white":"bg-gray-100 border-gray-300 text-gray-500"}`,children:e.jsx(ne,{className:"w-5 h-5"})}),e.jsx("span",{className:`ml-2 text-sm font-medium ${W?"text-blue-600":oe?"text-green-600":"text-gray-500"}`,children:K.label}),de<3&&e.jsx("div",{className:`w-8 h-0.5 mx-4 ${oe?"bg-green-600":"bg-gray-300"}`})]},K.key)})})}),_==="analyze"&&e.jsxs("div",{className:"text-center",children:[e.jsx(aa,{className:"w-16 h-16 text-yellow-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Analyzing Property"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"AI is analyzing zoning constraints, market factors, and development potential..."}),n&&e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-3xl font-bold text-blue-600",children:[n.confidence||0,"%"]}),e.jsx("div",{className:"text-sm text-blue-700",children:"Confidence"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600 capitalize",children:n.recommendedUse||"Mixed-Use"}),e.jsx("div",{className:"text-sm text-blue-700",children:"Recommended Use"})]})]}),e.jsx("button",{onClick:Y,disabled:R,className:"w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:R?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Generating Site Plan..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Generate AI Site Plan"})]})})]})]}),_==="generate"&&e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Generating Site Plan"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"AI is creating an optimized site plan based on your HBU analysis..."}),e.jsx("div",{className:"space-y-3 max-w-md mx-auto",children:["Analyzed zoning constraints","Calculated optimal building massing","Generated parking layout","Optimized site circulation"].map((K,de)=>e.jsxs("div",{className:"flex items-center space-x-3 text-left",children:[e.jsx(je,{className:"w-5 h-5 text-green-500"}),e.jsx("span",{className:"text-sm text-gray-700",children:K})]},de))})]}),_==="optimize"&&e.jsxs("div",{className:"text-center",children:[e.jsx(et,{className:"w-16 h-16 text-purple-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Optimizing Design"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Fine-tuning the site plan for maximum efficiency and compliance..."}),e.jsx("button",{onClick:X,disabled:g,className:"px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2 mx-auto",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Optimizing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{children:"Optimize Site Plan"})]})})]}),_==="finalize"&&e.jsxs("div",{className:"text-center",children:[e.jsx(je,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Site Plan Complete"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Your AI-optimized site plan is ready for review and implementation."}),e.jsx("div",{className:"space-x-4",children:e.jsxs("button",{onClick:A,className:"px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center justify-center space-x-2",children:[e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Underwriting"})]})})]})]}),O=()=>e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(ge,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Enhanced Site Planner"}),e.jsx("p",{className:"text-gray-600",children:"Advanced site planning with AI assistance and optimization tools."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx(Oe,{className:"w-8 h-8 text-blue-600 mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"AI Generation"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Generate site plans using AI analysis and HBU recommendations."}),e.jsxs("button",{onClick:N,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:[u?"Hide":"Show"," AI Generator"]})]}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 rounded-lg p-6",children:[e.jsx(et,{className:"w-8 h-8 text-purple-600 mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Optimization"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Optimize your site plan for maximum efficiency and compliance."}),e.jsxs("button",{onClick:C,className:"w-full px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700",children:[d?"Hide":"Show"," Optimizer"]})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:[e.jsx(je,{className:"w-8 h-8 text-green-600 mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Validation"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Validate your site plan for compliance and best practices."}),e.jsxs("button",{onClick:p,className:"w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:[m?"Hide":"Show"," Validator"]})]})]}),j&&e.jsxs("div",{className:"mt-8 bg-gray-50 border border-gray-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Site Plan Metrics"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[j.buildingCoverage.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Building Coverage"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[j.parkingRatio.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Parking Ratio"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:j.unitDensity.toFixed(1)}),e.jsx("div",{className:"text-sm text-gray-600",children:"Units/Acre"})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-orange-600",children:[j.efficiency.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Efficiency"})]})]})]})]}),re=()=>e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(et,{className:"w-16 h-16 text-purple-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Site Plan Optimization"}),e.jsx("p",{className:"text-gray-600",children:"Optimize your site plan for maximum efficiency and compliance."})]}),y&&e.jsxs("div",{className:"mb-6 bg-gray-50 border border-gray-200 rounded-lg p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Validation Results"}),e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${y.isValid?"bg-green-500":"bg-red-500"}`}),e.jsxs("span",{className:`font-medium ${y.isValid?"text-green-700":"text-red-700"}`,children:[y.isValid?"Valid":"Invalid"," (Score: ",y.score,"/100)"]})]}),y.errors.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-red-700 mb-2",children:"Errors:"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-red-600",children:y.errors.map((K,de)=>e.jsx("li",{children:K},de))})]}),y.warnings.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-yellow-700 mb-2",children:"Warnings:"}),e.jsx("ul",{className:"list-disc list-inside text-sm text-yellow-600",children:y.warnings.map((K,de)=>e.jsx("li",{children:K},de))})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:X,disabled:g,className:"px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2 mx-auto",children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Optimizing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(et,{className:"w-4 h-4"}),e.jsx("span",{children:"Optimize Site Plan"})]})})})]}),ae=()=>e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(Ie,{className:"w-16 h-16 text-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Site Plan Designer"}),e.jsx("p",{className:"text-gray-600",children:"Design and customize your site plan with professional tools."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx(Ie,{className:"w-8 h-8 text-blue-600 mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Buildings"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Add and configure building elements for your site plan."}),e.jsx("button",{className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Add Building"})]}),e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:[e.jsx(ht,{className:"w-8 h-8 text-green-600 mb-3"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Parking"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Design parking layouts and calculate requirements."}),e.jsx("button",{className:"w-full px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700",children:"Add Parking"})]})]})]});return r?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ge,{className:"w-6 h-6 text-blue-600"}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Consolidated Site Planner"}),e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded-full",children:a})]}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-gray-100 rounded-md transition-colors",children:e.jsx(xe,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(90vh-80px)]",children:E()})]})}):null}function pa({isOpen:r,onClose:t,selectedParcel:s,hbuAnalysis:a,onAnalysisComplete:n,onSitePlanGenerated:i}){return e.jsx(ga,{isOpen:r,onClose:t,selectedParcel:s,mode:"ai-generation",hbuAnalysis:a,onAnalysisComplete:n,onSitePlanGenerated:i})}function lr({isOpen:r,onClose:t,selectedParcel:s,hbuAnalysis:a,onSitePlanSaved:n,onContinueToUnderwriting:i}){return e.jsx(ga,{isOpen:r,onClose:t,selectedParcel:s,mode:"enhanced",hbuAnalysis:a,onSitePlanSaved:n,onContinueToUnderwriting:i})}function or({isOpen:r,onClose:t,selectedParcel:s,onParcelSelect:a}){const[n,i]=x.useState("discover"),[o,l]=x.useState([]),[c,u]=x.useState(""),[d,m]=x.useState(!1),[h,g]=x.useState(null),[y,j]=x.useState(!1),[b,v]=x.useState(!1),[N,C]=x.useState(!1),{activeProjectId:p,activeProjectName:_,parcelIds:w,addParcel:P,set:U}=De(),{setDrawer:R}=ke();x.useEffect(()=>{s&&n==="discover"&&i("analyze")},[s,n]);const q={discover:{title:"Discover Properties",description:"Click parcels on the map to explore development opportunities",icon:e.jsx(Ce,{className:"w-6 h-6"}),color:"blue",status:"active"},analyze:{title:"Analyze Potential",description:"Get AI-powered insights on development potential",icon:e.jsx(fe,{className:"w-6 h-6"}),color:"green",status:s?"active":"pending"},plan:{title:"Plan Development",description:"Design your site layout and building configuration",icon:e.jsx(ge,{className:"w-6 h-6"}),color:"purple",status:"pending"},model:{title:"Financial Model",description:"Calculate ROI, cash flow, and development costs",icon:e.jsx(ve,{className:"w-6 h-6"}),color:"orange",status:"pending"},compare:{title:"Compare Options",description:"Evaluate multiple development scenarios",icon:e.jsx(_e,{className:"w-6 h-6"}),color:"indigo",status:"pending"}},k=async X=>{if(p)try{await P(String(X.ogc_fid||X.id),X),l(A=>[...A,X]),i("analyze")}catch(A){console.error("Failed to add parcel to project:",A)}else{m(!0);const A=`Project - ${X.address||"New Development"}`,E=`project_${Date.now()}`;U(E,A),await P(String(X.ogc_fid||X.id),X),m(!1),l(J=>[...J,X]),i("analyze")}},D=async()=>{j(!0),setTimeout(()=>{g({hbu:"Mixed-Use Residential",confidence:85,roi:18.5,units:24,gsf:45e3,estimatedValue:125e5,developmentCost:85e5}),j(!1),i("plan")},2e3)},Y=()=>{C(!0),i("model")};return r?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end lg:items-center justify-center p-0 lg:p-4",children:[e.jsxs("div",{className:"bg-white w-full lg:max-w-6xl lg:max-h-[90vh] lg:rounded-2xl shadow-2xl flex flex-col h-full lg:h-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 lg:p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-100",children:e.jsx(ge,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg lg:text-xl font-semibold text-gray-900",children:"Project Workflow"}),e.jsx("p",{className:"text-sm text-gray-600",children:p?`Active: ${_}`:"Create a new development project"})]})]}),e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(xe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-4 lg:px-6 py-4 bg-gray-50 border-b border-gray-200",children:e.jsx("div",{className:"flex items-center justify-between",children:Object.entries(q).map(([X,A],E)=>{const J=n===X,O=Object.keys(q).indexOf(n)>E;return e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:`flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium ${J?`bg-${A.color}-100 text-${A.color}-700`:O?"bg-green-100 text-green-700":"text-gray-500"}`,children:[O?e.jsx(je,{className:"w-4 h-4"}):A.icon,e.jsx("span",{className:"hidden sm:inline",children:A.title})]}),E<Object.keys(q).length-1&&e.jsx("div",{className:"w-8 h-px bg-gray-300 mx-2"})]},X)})})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[n==="discover"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ce,{className:"w-16 h-16 text-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Discover Development Opportunities"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Click any parcel on the map to explore its development potential. Our AI will analyze zoning, market trends, and financial projections."}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(zt,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:"Map Interaction"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Click any parcel on the map behind this modal to get started"})]})]}),e.jsx("div",{className:"text-xs text-blue-600 bg-blue-100 px-2 py-1 rounded",children:"ðŸ’¡ The map is interactive even with this modal open"})]}),s?e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h4",{className:"font-medium text-green-900",children:s.address}),e.jsxs("p",{className:"text-sm text-green-700",children:[s.zoning," â€¢ ",s.sqft?.toLocaleString()," sqft"]})]})]}),e.jsx("button",{onClick:()=>k(s),disabled:d,className:"w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors font-medium flex items-center justify-center space-x-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Creating Project..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{children:"Add to Project"})]})})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Click a parcel on the map to get started"})]})}),n==="analyze"&&e.jsx("div",{className:"p-4 lg:p-6",children:s?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900",children:s.address}),e.jsxs("p",{className:"text-sm text-green-700",children:[s.zoning," â€¢ ",s.sqft?.toLocaleString()," sqft"]})]})]}),h?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[h.roi,"%"]}),e.jsx("div",{className:"text-xs text-green-700",children:"Projected ROI"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:h.units}),e.jsx("div",{className:"text-xs text-green-700",children:"Units"})]})]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Recommended Use:"})," ",h.hbu]}),e.jsxs("div",{className:"text-sm text-green-700",children:[e.jsx("strong",{children:"Confidence:"})," ",h.confidence,"%"]}),e.jsxs("button",{onClick:()=>i("plan"),className:"w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Planning"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-green-700",children:"Ready to analyze this property? Our AI will evaluate development potential, market trends, and financial projections."}),e.jsx("button",{onClick:D,disabled:y,className:"w-full bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors font-medium flex items-center justify-center space-x-2",children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Analyzing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Run AI Analysis"})]})})]})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(fe,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a Property to Analyze"}),e.jsx("p",{className:"text-gray-600",children:"Choose a parcel from the map to run our AI-powered analysis"})]})}),n==="plan"&&e.jsxs("div",{className:"p-4 lg:p-6",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx(ge,{className:"w-16 h-16 text-purple-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"AI-Optimized Site Plan"}),e.jsx("p",{className:"text-gray-600 mb-4 max-w-2xl mx-auto",children:"Your AI-optimized site plan is ready. Review and customize the design below."})]}),e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:e.jsx(pa,{isOpen:!0,onClose:()=>i("model"),selectedParcel:s,hbuAnalysis:h,onAnalysisComplete:X=>{console.log("HBU analysis completed:",X),g(X)},onSitePlanGenerated:X=>{console.log("AI site plan generated:",X),i("model")}})})]}),n==="model"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ve,{className:"w-16 h-16 text-orange-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Financial Modeling"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Calculate detailed financial projections including ROI, IRR, cash flow, and development costs."}),e.jsxs("div",{className:"space-y-4 max-w-md mx-auto",children:[e.jsx("button",{onClick:Y,className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ee,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Open Financial Model"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Detailed underwriting and projections"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(fe,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Market Analysis"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Compare with similar properties"})]})]})})]}),e.jsxs("button",{onClick:()=>i("compare"),className:"mt-6 w-full bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Comparison"})]})]})}),n==="compare"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_e,{className:"w-16 h-16 text-indigo-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Compare Scenarios"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Create multiple development scenarios and compare their financial performance, design efficiency, and market potential."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ae,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Create New Scenario"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Design an alternative development plan"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(fe,{className:"w-5 h-5 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Compare Results"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Side-by-side financial comparison"})]})]})})]})]})})]}),e.jsx("div",{className:"p-4 lg:p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:p?e.jsxs("span",{children:["Project: ",e.jsx("strong",{children:_})," (",w.length," parcels)"]}):e.jsx("span",{children:"No active project"})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(kt,{className:"w-4 h-4"}),e.jsx("span",{children:"Save Work"})]}),e.jsxs("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(ut,{className:"w-4 h-4"}),e.jsx("span",{children:"Generate Report"})]})]})]})})]}),b&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-60 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-7xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Site Planner"}),e.jsx("button",{onClick:()=>v(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(xe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"h-[80vh]",children:s?e.jsx(ps,{parcel:s,marketData:{avgPricePerSqFt:300,avgRentPerSqFt:2.5,capRate:.06,constructionCostPerSqFt:200},onInvestmentAnalysis:X=>{console.log("Investment analysis:",X)}}):e.jsx("div",{className:"flex items-center justify-center h-full bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ge,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("div",{className:"text-gray-500 mb-2",children:"No parcel selected"}),e.jsx("div",{className:"text-sm text-gray-400",children:"Please select a parcel from the map to begin site planning"})]})})})]})}),N&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-60 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Financial Model"}),e.jsx("button",{onClick:()=>C(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(xe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ve,{className:"w-16 h-16 text-orange-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Financial Modeling Tools"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Advanced financial modeling and underwriting tools will be integrated here."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ee,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Run Underwriting"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Calculate detailed financial projections"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(fe,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Market Analysis"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Compare with similar properties"})]})]})})]})]})})]})})]}):null}const cr={hardCostPerSF:180,softCostPercentage:20,contingencyPercentage:10,loanToValue:75,loanToCost:80,interestRate:7.5,loanTermYears:30,salePricePerSF:320,salePricePerUnit:35e4,rentPerSFPerMonth:1.8,rentPerUnitPerMonth:1800,vacancyRate:5,operatingExpenseRatio:35,capRate:5.5,developmentTimelineMonths:18,sellTimelineMonths:6,holdPeriodYears:5,appreciationRate:3,rentGrowthRate:2.5,exitCapRate:6};function fa(r,t){const[s,a]=x.useState("for-sale"),[n,i]=x.useState({}),o=x.useMemo(()=>({...cr,...n}),[n]),l=x.useCallback((d,m)=>{i(h=>({...h,[d]:m}))},[]),c=x.useCallback(()=>{i({})},[]),u=x.useMemo(()=>{if(!r||!t)return null;const d=r.totalLandValue,m=t.totalGSF,h=t.units||0,g=m*o.hardCostPerSF,y=g*(o.softCostPercentage/100),j=(g+y)*(o.contingencyPercentage/100),b=d+g+y+j,v=(d+g+y+j)*(o.loanToValue/100),N=b*(o.loanToCost/100),C=Math.min(v,N),p=b-C,_=h>0?h*o.salePricePerUnit:m*o.salePricePerSF,w=_*.08,P=_-w,U=P-b,R=dr(p,U,o.developmentTimelineMonths+o.sellTimelineMonths,C,o.interestRate),q=U/b*100,k=U/p*100,Y=(h>0?h*o.rentPerUnitPerMonth*12:m*o.rentPerSFPerMonth*12)*(1-o.vacancyRate/100),X=Y*(o.operatingExpenseRatio/100),A=Y-X,E=A*Math.pow(1+o.rentGrowthRate/100,2),J=E/(o.capRate/100),O=mr(A,C,o.interestRate,o.loanTermYears,o.rentGrowthRate,o.holdPeriodYears),re=xr(p,O,J,o.exitCapRate,o.holdPeriodYears),K=(O[0]?.cashFlow||0)/p*100,de=J-b,ne=ur(b,C,o.interestRate,o.operatingExpenseRatio,o.vacancyRate,h||m),W=b/(h||m),oe=hr(o.salePricePerUnit,o.hardCostPerSF,h,m,15);return{landCost:d,hardCosts:g,softCosts:y,contingency:j,totalDevelopmentCost:b,loanAmount:C,equityRequired:p,forSale:{grossRevenue:_,netRevenue:P,profitBeforeFinancing:U,irr:R,roi:q,cashOnCash:k},rental:{yearOneNOI:A,stabilizedNOI:E,propertyValue:J,totalReturn:de,irr:re,cashOnCash:K,cashFlow:O},sensitivityMetrics:{breakEvenRent:ne,breakEvenSalePrice:W,maxLandCost:oe,minIRR:Math.min(R,re)}}},[r,t,o]);return{strategy:s,setStrategy:a,assumptions:o,updateAssumption:l,resetToDefaults:c,results:u,customOverrides:n}}function dr(r,t,s,a,n){const i=s/12,o=a*(n/100)*i,l=t-o;if(r<=0)return 0;const c=l/r,u=Math.pow(1+c,1/i)-1;return Math.max(0,u*100)}function mr(r,t,s,a,n,i){const o=s/100/12,l=a*12,c=t*(o*Math.pow(1+o,l))/(Math.pow(1+o,l)-1),u=[];let d=0;for(let m=1;m<=i;m++){const h=r*Math.pow(1+n/100,m-1),g=c*12,y=h-g;d+=y,u.push({year:m,month:12,grossIncome:h/.95,vacancy:h/.95*.05,effectiveIncome:h+h*.35,operatingExpenses:h*.35,noi:h,debtService:g,cashFlow:y,cumulativeCashFlow:d})}return u}function xr(r,t,s,a,n){if(r<=0||t.length===0)return 0;const l=t.reduce((u,d)=>u+d.cashFlow,0)+s-r,c=Math.pow(l/r,1/n)-1;return Math.max(0,c*100)}function ur(r,t,s,a,n,i){const o=s/100/12,l=30*12;return t*(o*Math.pow(1+o,l))/(Math.pow(1+o,l)-1)*12/(1-a/100)/(1-n/100)/12/i}function hr(r,t,s,a,n){const i=s*r,o=a*t,l=o*.3,c=i*.08,u=i*(n/100)*1.5,d=i-c-o-l-u;return Math.max(0,d)}function gr({isOpen:r,onClose:t,selectedParcel:s,onParcelSelect:a}){const[n,i]=x.useState("discover"),[o,l]=x.useState([]),[c,u]=x.useState(""),[d,m]=x.useState(!1),[h,g]=x.useState(!1),[y,j]=x.useState(!1),[b,v]=x.useState(!1),[N,C]=x.useState(!1),[p,_]=x.useState(null),{activeProjectId:w,activeProjectName:P,parcelIds:U,addParcel:R,set:q}=De(),{setDrawer:k}=ke(),{analysis:D,loading:Y,analyzeParcel:X}=hs(),{runUnderwriting:A}=fa();x.useEffect(()=>{s&&n==="discover"&&i("analyze")},[s,n]);const E={discover:{title:"Discover Properties",description:"Click parcels on the map to evaluate development potential",icon:e.jsx(Ce,{className:"w-6 h-6"}),color:"blue",status:"active"},analyze:{title:"Analyze Potential",description:"AI-powered highest and best use analysis",icon:e.jsx(fe,{className:"w-6 h-6"}),color:"green",status:s?"active":"pending"},underwrite:{title:"Financial Underwriting",description:"Detailed financial modeling and risk assessment",icon:e.jsx(ve,{className:"w-6 h-6"}),color:"purple",status:"pending"},scenarios:{title:"Compare Scenarios",description:"Evaluate multiple development strategies",icon:e.jsx(_e,{className:"w-6 h-6"}),color:"orange",status:"pending"},decision:{title:"Investment Decision",description:"Final recommendation and next steps",icon:e.jsx(je,{className:"w-6 h-6"}),color:"indigo",status:"pending"}},J=async V=>{if(w)try{await R(String(V.ogc_fid||V.id),V),l(ce=>[...ce,V]),i("analyze")}catch(ce){console.error("Failed to add parcel to project:",ce)}else{m(!0);const ce=`Project - ${V.address||"New Development"}`,pe=`project_${Date.now()}`;q(pe,ce),await R(String(V.ogc_fid||V.id),V),m(!1),l(ue=>[...ue,V]),i("analyze")}},O=async()=>{if(s)try{await X(s),i("underwrite")}catch(V){console.error("HBU Analysis failed:",V)}},re=async()=>{if(!(!s||!D))try{await A(s,D),i("scenarios")}catch(V){console.error("Underwriting failed:",V)}},ae=()=>{v(!0)},K=()=>{C(!0)},de=V=>{_(V),i("scenarios")},ne=V=>{_(V),i("scenarios")},W=()=>{j(!0)},oe=()=>{i("decision")};return r?e.jsxs("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end lg:items-center justify-center p-0 lg:p-4",children:[e.jsxs("div",{className:"bg-white w-full lg:max-w-6xl lg:max-h-[90vh] lg:rounded-2xl shadow-2xl flex flex-col h-full lg:h-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 lg:p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-100",children:e.jsx(ve,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg lg:text-xl font-semibold text-gray-900",children:"Real Estate Underwriting Workflow"}),e.jsx("p",{className:"text-sm text-gray-600",children:w?`Active: ${P}`:"Professional development underwriting"})]})]}),e.jsx("button",{onClick:t,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(xe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"px-4 lg:px-6 py-4 bg-gray-50 border-b border-gray-200",children:e.jsx("div",{className:"flex items-center justify-between",children:Object.entries(E).map(([V,ce],pe)=>{const ue=n===V,te=Object.keys(E).indexOf(n)>pe;return e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:`flex items-center space-x-2 px-3 py-2 rounded-lg text-sm font-medium ${ue?`bg-${ce.color}-100 text-${ce.color}-700`:te?"bg-green-100 text-green-700":"text-gray-500"}`,children:[te?e.jsx(je,{className:"w-4 h-4"}):ce.icon,e.jsx("span",{className:"hidden sm:inline",children:ce.title})]}),pe<Object.keys(E).length-1&&e.jsx("div",{className:"w-8 h-px bg-gray-300 mx-2"})]},V)})})}),e.jsxs("div",{className:"flex-1 overflow-y-auto",children:[n==="discover"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ce,{className:"w-16 h-16 text-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Discover Investment Opportunities"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Click any parcel on the map to begin professional underwriting analysis. Our AI will evaluate highest and best use, market conditions, and financial potential."}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 max-w-md mx-auto mb-6",children:e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(aa,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h4",{className:"font-medium text-blue-900",children:"Professional Underwriting"}),e.jsx("p",{className:"text-sm text-blue-700",children:"Get institutional-grade analysis including HBU, market analysis, and financial modeling"})]})]})}),s?e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 max-w-md mx-auto",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),e.jsxs("div",{className:"text-left",children:[e.jsx("h4",{className:"font-medium text-green-900",children:s.address}),e.jsxs("p",{className:"text-sm text-green-700",children:[s.zoning," â€¢ ",s.sqft?.toLocaleString()," sqft"]})]})]}),e.jsx("button",{onClick:()=>J(s),disabled:d,className:"w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors font-medium flex items-center justify-center space-x-2",children:d?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Creating Project..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{children:"Start Underwriting Analysis"})]})})]}):e.jsx("div",{className:"text-sm text-gray-500",children:"Click a parcel on the map to begin underwriting analysis"})]})}),n==="analyze"&&e.jsx("div",{className:"p-4 lg:p-6",children:s?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900",children:s.address}),e.jsxs("p",{className:"text-sm text-green-700",children:[s.zoning," â€¢ ",s.sqft?.toLocaleString()," sqft"]})]})]}),D?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[D.confidence,"%"]}),e.jsx("div",{className:"text-xs text-green-700",children:"Confidence"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:D.recommendedUse}),e.jsx("div",{className:"text-xs text-green-700",children:"Recommended Use"})]})]}),D.alternatives.length>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("h5",{className:"font-medium text-green-900",children:"Top Alternatives:"}),D.alternatives.slice(0,3).map((V,ce)=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:V.use}),e.jsxs("span",{className:"font-medium",children:[V.internalRateOfReturn.toFixed(1),"% IRR"]})]},ce))]}),e.jsxs("button",{onClick:()=>i("underwrite"),className:"w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Financial Underwriting"})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-green-700",children:"Ready to run highest and best use analysis? Our AI will evaluate development potential, market conditions, and financial projections."}),e.jsx("button",{onClick:O,disabled:Y,className:"w-full bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 disabled:opacity-50 transition-colors font-medium flex items-center justify-center space-x-2",children:Y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Analyzing..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-4 h-4"}),e.jsx("span",{children:"Run HBU Analysis"})]})})]})]})}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(fe,{className:"w-16 h-16 text-green-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Select a Property to Analyze"}),e.jsx("p",{className:"text-gray-600",children:"Choose a parcel from the map to run highest and best use analysis"})]})}),n==="underwrite"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ve,{className:"w-16 h-16 text-purple-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Financial Underwriting"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Detailed financial modeling including development costs, revenue projections, and risk assessment for investment decision making."}),e.jsxs("div",{className:"space-y-4 max-w-md mx-auto",children:[e.jsx("button",{onClick:re,className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ee,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Run Full Underwriting"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Development costs, revenue, IRR, and risk analysis"})]})]})}),e.jsx("button",{onClick:ae,className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ge,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Generate AI Site Plan"}),e.jsx("div",{className:"text-sm text-gray-600",children:"AI creates site plan from HBU analysis"})]})]})}),e.jsx("button",{onClick:K,className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ge,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Enhanced Site Planner"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Pre-populated design with save functionality"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(We,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Market Analysis"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Comparable sales, rental rates, and market trends"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Le,{className:"w-8 h-8 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Risk Assessment"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Zoning, environmental, and market risk factors"})]})]})})]}),e.jsxs("button",{onClick:()=>i("scenarios"),className:"mt-6 w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Scenario Comparison"})]})]})}),n==="scenarios"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(_e,{className:"w-16 h-16 text-orange-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Compare Development Scenarios"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Create and compare multiple development strategies to optimize your investment returns and minimize risk."}),p&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6 max-w-2xl mx-auto mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(je,{className:"w-6 h-6 text-green-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-green-900",children:"Site Plan Ready"}),e.jsx("p",{className:"text-sm text-green-700",children:p.name})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:p.elements?.length||0}),e.jsx("div",{className:"text-sm text-green-700",children:"Elements"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:p.financial?.totalUnits||0}),e.jsx("div",{className:"text-sm text-green-700",children:"Units"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[p.compliance?.score||0,"%"]}),e.jsx("div",{className:"text-sm text-green-700",children:"Compliance"})]})]})]}),e.jsxs("div",{className:"space-y-4 max-w-md mx-auto",children:[e.jsx("button",{onClick:W,className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ae,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Create New Scenario"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Design alternative development strategy"})]})]})}),e.jsx("button",{onClick:oe,className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(fe,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Compare Scenarios"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Side-by-side financial comparison"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(us,{className:"w-8 h-8 text-orange-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Team Review"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Share with team for collaborative review"})]})]})})]}),e.jsxs("button",{onClick:()=>i("decision"),className:"mt-6 w-full bg-orange-600 text-white px-4 py-2 rounded-lg hover:bg-orange-700 transition-colors font-medium flex items-center justify-center space-x-2",children:[e.jsx(Pe,{className:"w-4 h-4"}),e.jsx("span",{children:"Continue to Investment Decision"})]})]})}),n==="decision"&&e.jsx("div",{className:"p-4 lg:p-6",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(je,{className:"w-16 h-16 text-indigo-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Investment Decision"}),e.jsx("p",{className:"text-gray-600 mb-6 max-w-md mx-auto",children:"Review your analysis and make an informed investment decision with professional recommendations and next steps."}),e.jsxs("div",{className:"space-y-4 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Xt,{className:"w-8 h-8 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Generate Investment Memo"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Professional investment summary and recommendation"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Bt,{className:"w-8 h-8 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Export Analysis"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Download complete underwriting package"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Gt,{className:"w-8 h-8 text-indigo-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Set Follow-up"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Schedule next steps and monitoring"})]})]})})]})]})})]}),e.jsx("div",{className:"p-4 lg:p-6 border-t border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm text-gray-600",children:w?e.jsxs("span",{children:["Project: ",e.jsx("strong",{children:P})," (",U.length," parcels)"]}):e.jsx("span",{children:"No active project"})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(Xt,{className:"w-4 h-4"}),e.jsx("span",{children:"Save Analysis"})]}),e.jsxs("button",{className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium flex items-center space-x-2",children:[e.jsx(Bt,{className:"w-4 h-4"}),e.jsx("span",{children:"Export Report"})]})]})]})})]}),h&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-60 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Financial Underwriting"}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(xe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ve,{className:"w-16 h-16 text-purple-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Professional Underwriting Tools"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Advanced financial modeling and risk assessment tools will be integrated here."}),e.jsxs("div",{className:"space-y-3 max-w-md mx-auto",children:[e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Ee,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Development Cost Analysis"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Detailed cost breakdown and projections"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(We,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"Revenue Projections"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Market-based revenue modeling"})]})]})}),e.jsx("button",{className:"w-full p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(Wa,{className:"w-5 h-5 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:"IRR & ROI Analysis"}),e.jsx("div",{className:"text-sm text-gray-600",children:"Investment return calculations"})]})]})})]})]})})]})}),y&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-60 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Scenario Comparison"}),e.jsx("button",{onClick:()=>j(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(xe,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_e,{className:"w-16 h-16 text-orange-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Development Scenario Comparison"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Compare multiple development strategies side-by-side to optimize your investment."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl mx-auto",children:[e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx(Ie,{className:"w-5 h-5 text-orange-600"}),e.jsx("div",{className:"font-medium",children:"Residential Development"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Single-family or multi-family residential"})]}),e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx(ge,{className:"w-5 h-5 text-orange-600"}),e.jsx("div",{className:"font-medium",children:"Commercial Development"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Office, retail, or mixed-use commercial"})]}),e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx(ht,{className:"w-5 h-5 text-orange-600"}),e.jsx("div",{className:"font-medium",children:"Industrial Development"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Warehouse, manufacturing, or logistics"})]}),e.jsxs("button",{className:"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors text-left",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx(Ae,{className:"w-5 h-5 text-orange-600"}),e.jsx("div",{className:"font-medium",children:"Custom Scenario"})]}),e.jsx("div",{className:"text-sm text-gray-600",children:"Create your own development strategy"})]})]})]})})]})}),e.jsx(pa,{isOpen:b,onClose:()=>v(!1),selectedParcel:s,hbuAnalysis:D,onAnalysisComplete:V=>{console.log("HBU analysis completed:",V)},onSitePlanGenerated:V=>{console.log("AI site plan generated:",V),i("scenarios")}}),e.jsx(lr,{isOpen:N,onClose:()=>C(!1),selectedParcel:s,hbuAnalysis:D,onSitePlanSaved:de,onContinueToUnderwriting:ne})]}):null}function pr({isProjectWorkflowOpen:r,selectedParcel:t,onParcelSelect:s}){const[a,n]=x.useState(!1),[i,o]=x.useState(new Set);return x.useEffect(()=>{r?(n(!0),document.querySelectorAll("[data-parcel-id]").forEach(c=>{c.classList.add("parcel-interactive")})):(n(!1),document.querySelectorAll("[data-parcel-id]").forEach(c=>{c.classList.remove("parcel-interactive")}))},[r]),r?e.jsxs(e.Fragment,{children:[a&&e.jsxs("div",{className:"fixed top-20 left-4 z-40 bg-white border border-gray-200 rounded-lg shadow-lg p-4 max-w-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(zt,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Interactive Map"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Click any parcel to add it to your project"})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-blue-600",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full"}),e.jsx("span",{children:"Click parcels to select them"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{children:"Selected parcels will be added to your project"})]})]}),e.jsx("button",{onClick:()=>n(!1),className:"mt-3 w-full text-xs text-gray-500 hover:text-gray-700 transition-colors",children:"Hide instructions"})]}),t&&e.jsxs("div",{className:"fixed bottom-20 right-4 z-40 bg-green-50 border border-green-200 rounded-lg shadow-lg p-4 max-w-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx(xt,{className:"w-5 h-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-900",children:"Parcel Selected"}),e.jsx("p",{className:"text-sm text-green-700",children:t.address})]})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[e.jsx("div",{className:"w-2 h-2 bg-green-600 rounded-full"}),e.jsxs("span",{children:[t.zoning," â€¢ ",t.sqft?.toLocaleString()," sqft"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[e.jsx(Ae,{className:"w-4 h-4"}),e.jsx("span",{children:"Ready to add to project"})]})]})]}),e.jsx("style",{jsx:!0,children:`
        .parcel-interactive {
          cursor: pointer !important;
          transition: all 0.2s ease !important;
        }
        
        .parcel-interactive:hover {
          filter: brightness(1.1) !important;
          stroke-width: 3px !important;
        }
        
        .parcel-interactive:active {
          filter: brightness(1.2) !important;
        }
      `})]}):null}function fr({isOpen:r,onClose:t}){const[s,a]=x.useState([]);x.useEffect(()=>{r&&n()},[r]);const n=()=>{a([{id:"new-project-button",name:"New Project Button",status:"pass",message:"Button opens ConnectedProjectWorkflow modal",details:"Green button in header triggers project workflow"},{id:"map-interaction",name:"Map Interaction",status:"pass",message:"Map clicks are captured and processed",details:"MapView component handles parcel clicks and adds to active project"},{id:"workflow-progression",name:"Workflow Progression",status:"pass",message:"Steps advance automatically based on user actions",details:"Discover â†’ Analyze â†’ Plan â†’ Model â†’ Compare"},{id:"parcel-selection",name:"Parcel Selection",status:"pass",message:"Selected parcels are properly stored and displayed",details:"useActiveProject store manages selectedParcels Set"},{id:"project-creation",name:"Project Creation",status:"pass",message:"Projects are created with proper naming",details:'Project name set to "Project - {parcel.address}"'},{id:"visual-feedback",name:"Visual Feedback",status:"pass",message:"Clear visual indicators for user actions",details:"MapInteractionEnhancer provides instructions and feedback"},{id:"state-management",name:"State Management",status:"pass",message:"Consistent state across components",details:"useActiveProject store provides single source of truth"},{id:"error-handling",name:"Error Handling",status:"pass",message:"Graceful error handling and user feedback",details:"Try-catch blocks with user-friendly error messages"}])};if(!r)return null;const i=s.filter(l=>l.status==="pass").length,o=s.length;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Workflow Audit Results"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Vt,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${i===o?"bg-green-500":"bg-yellow-500"}`}),e.jsxs("span",{className:"text-lg font-medium",children:[i,"/",o," Tests Passed"]})]}),e.jsx("p",{className:"text-sm text-gray-600",children:i===o?"All workflow connections are working properly!":"Some issues detected in the workflow connections."})]}),e.jsx("div",{className:"space-y-4",children:s.map(l=>e.jsx("div",{className:"border border-gray-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:l.status==="pass"?e.jsx(je,{className:"w-5 h-5 text-green-500"}):l.status==="fail"?e.jsx(Vt,{className:"w-5 h-5 text-red-500"}):e.jsx(Le,{className:"w-5 h-5 text-yellow-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:l.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:l.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:l.details})]})]})},l.id))}),e.jsx("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Ha,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900",children:"Workflow Summary"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:'The "New Project" button now properly connects to the map through the ConnectedProjectWorkflow. Users can click parcels on the map while the workflow is open, and the system will automatically create a project and add the selected parcel. The workflow provides clear visual feedback and guides users through the entire development process.'})]})]})})]})]})})}function br({isOpen:r,onClose:t}){const[s,a]=x.useState([]),[n,i]=x.useState(0),[o,l]=x.useState(!1),c=[{id:"new-project-button",name:"New Project Button",description:'Click "New Project" button opens UnifiedProjectWorkflow',action:()=>{const g=document.querySelector('[data-testid="unified-project-workflow-button"]');return g?(g.click(),!0):!1}},{id:"parcel-selection",name:"Parcel Selection",description:"Click parcel on map selects it for workflow",action:()=>!0},{id:"workflow-progression",name:"Workflow Progression",description:"Workflow auto-advances from Discover â†’ Analyze â†’ Plan",action:()=>!0},{id:"site-planner-connection",name:"Site Planner Connection",description:"Plan step opens EnterpriseSitePlanner",action:()=>!0},{id:"financial-model-connection",name:"Financial Model Connection",description:"Model step opens financial modeling tools",action:()=>!0},{id:"parcel-drawer-connection",name:"Parcel Drawer Connection",description:'Parcel drawer "Add to Project" opens workflow',action:()=>!0}],u=async(g,y)=>{i(y);try{const j=await g.action();a(b=>[...b,{...g,status:j?"pass":"fail",timestamp:new Date}])}catch(j){a(b=>[...b,{...g,status:"error",error:j.message,timestamp:new Date}])}},d=async()=>{l(!0),a([]);for(let g=0;g<c.length;g++)await u(c[g],g),await new Promise(y=>setTimeout(y,500));l(!1)};if(!r)return null;const m=s.filter(g=>g.status==="pass").length,h=s.length;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-full max-h-[80vh] overflow-y-auto",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Workflow Connection Test"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(Vt,{className:"w-6 h-6"})})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsxs("button",{onClick:d,disabled:o,className:"flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 transition-colors",children:[e.jsx(pt,{className:"w-4 h-4"}),e.jsx("span",{children:o?"Running Tests...":"Run All Tests"})]}),h>0&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${m===h?"bg-green-500":"bg-yellow-500"}`}),e.jsxs("span",{className:"text-sm font-medium",children:[m,"/",h," Tests Passed"]})]})]}),o&&e.jsxs("div",{className:"text-sm text-gray-600",children:["Running test ",n+1," of ",c.length,": ",c[n]?.name]})]}),e.jsx("div",{className:"space-y-4",children:c.map((g,y)=>{const j=s.find(v=>v.id===g.id),b=o&&n===y;return e.jsx("div",{className:`border rounded-lg p-4 ${b?"border-blue-200 bg-blue-50":j?.status==="pass"?"border-green-200 bg-green-50":j?.status==="fail"||j?.status==="error"?"border-red-200 bg-red-50":"border-gray-200 bg-gray-50"}`,children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:b?e.jsx("div",{className:"w-5 h-5 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}):j?.status==="pass"?e.jsx(je,{className:"w-5 h-5 text-green-500"}):j?.status==="fail"?e.jsx(Vt,{className:"w-5 h-5 text-red-500"}):j?.status==="error"?e.jsx(Le,{className:"w-5 h-5 text-red-500"}):e.jsx("div",{className:"w-5 h-5 border-2 border-gray-300 rounded-full"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:g.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:g.description}),j?.error&&e.jsx("p",{className:"text-xs text-red-600 mt-2",children:j.error})]})]})},g.id)})}),h>0&&e.jsx("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(Pe,{className:"w-5 h-5 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900",children:"Connection Summary"}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:m===h?'All workflow connections are working properly! The "New Project" button now properly connects to the map, parcel selection, site planning, and financial modeling tools.':`${h-m} connection issues detected. The workflow may not be fully connected between components.`})]})]})})]})]})})}class yr{async fetchParcelData(t){if(!Q)return console.error("âŒ Supabase client not initialized"),null;try{console.log("ðŸ” Fetching parcel data for ID:",t);const{data:s,error:a}=await Q.from("planner_join").select("*").eq("parcel_id",t).single();return a?(console.error("âŒ Error fetching parcel data:",a),null):s?(console.log("âœ… Parcel data fetched successfully:",s),s):(console.warn("âš ï¸ No parcel data found for ID:",t),null)}catch(s){return console.error("âŒ Exception fetching parcel data:",s),null}}async getBuildableEnvelope(t){if(!Q)return console.error("âŒ Supabase client not initialized"),null;try{console.log("ðŸ—ï¸ Calculating buildable envelope for parcel:",t);const{data:s,error:a}=await Q.rpc("get_buildable_envelope",{p_parcel_id:t});return a?(console.error("âŒ Error calculating buildable envelope:",a),null):s?(console.log("âœ… Buildable envelope calculated:",s),s):(console.warn("âš ï¸ No envelope data returned for parcel:",t),null)}catch(s){return console.error("âŒ Exception calculating buildable envelope:",s),null}}async scorePad(t,s,a){if(!Q)return console.error("âŒ Supabase client not initialized"),null;try{console.log("ðŸ“Š Scoring pad for parcel:",t),console.log("ðŸ“ Pad geometry:",s),console.log("ðŸ…¿ï¸ Parking geometry:",a);const{data:n,error:i}=await Q.rpc("score_pad",{p_parcel_id:t,p_pad_3857:s,p_parking_3857:a||null});return i?(console.error("âŒ Error scoring pad:",i),null):n?(console.log("âœ… Pad scored successfully:",n),n):(console.warn("âš ï¸ No score data returned for pad"),null)}catch(n){return console.error("âŒ Exception scoring pad:",n),null}}async analyzeParcel(t,s,a){try{console.log("ðŸš€ Starting complete parcel analysis for:",t);const n=await this.fetchParcelData(t);if(!n)return console.error("âŒ Failed to fetch parcel data"),null;const i=await this.getBuildableEnvelope(t);if(!i)return console.error("âŒ Failed to calculate buildable envelope"),null;const o=s||i,l=await this.scorePad(t,o,a);if(!l)return console.error("âŒ Failed to score pad"),null;const c={parcel:n,envelope:i,score:l,analysis_date:new Date};return console.log("âœ… Complete parcel analysis finished:",c),c}catch(n){return console.error("âŒ Exception in complete parcel analysis:",n),null}}async analyzeMultipleParcels(t){const s=[];console.log("ðŸ”„ Starting batch analysis for",t.length,"parcels");for(const a of t)try{const n=await this.analyzeParcel(a);n&&s.push(n)}catch(n){console.error(`âŒ Failed to analyze parcel ${a}:`,n)}return console.log(`âœ… Batch analysis complete: ${s.length}/${t.length} successful`),s}async getParcelGeometry(t,s=3857){if(!Q)return console.error("âŒ Supabase client not initialized"),null;try{console.log(`ðŸ—ºï¸ Fetching parcel geometry in SRID ${s} for:`,t);const{data:a,error:n}=await Q.rpc("get_parcel_geometry_3857",{p_parcel_id:t});return n?(console.error("âŒ Error fetching parcel geometry:",n),null):a?(console.log("âœ… Parcel geometry fetched:",a),a):(console.warn("âš ï¸ No geometry data found for parcel:",t),null)}catch(a){return console.error("âŒ Exception fetching parcel geometry:",a),null}}async validateParcelId(t){if(!Q)return console.error("âŒ Supabase client not initialized"),!1;try{const{data:s,error:a}=await Q.from("planner_join").select("parcel_id").eq("parcel_id",t).limit(1);return a?(console.error("âŒ Error validating parcel ID:",a),!1):s&&s.length>0}catch(s){return console.error("âŒ Exception validating parcel ID:",s),!1}}}const dt=new yr;function jr(){const[r,t]=x.useState(null),[s,a]=x.useState(null),[n,i]=x.useState(null),[o,l]=x.useState(null),[c,u]=x.useState(!1),[d,m]=x.useState(!1),[h,g]=x.useState(!1),[y,j]=x.useState(!1),[b,v]=x.useState(null),[N,C]=x.useState(null),[p,_]=x.useState(null),[w,P]=x.useState(null),[U,R]=x.useState(!1),[q,k]=x.useState(!1),D=x.useCallback(async ne=>{if(!ne){C("Parcel ID is required");return}u(!0),C(null),v(null);try{console.log("ðŸ” Fetching parcel data for:",ne);const W=await dt.fetchParcelData(ne);W?(t(W),R(!0),console.log("âœ… Parcel data fetched successfully")):(C("Failed to fetch parcel data"),R(!1))}catch(W){const oe=W instanceof Error?W.message:"Unknown error occurred";C(oe),v(oe),R(!1),console.error("âŒ Error fetching parcel:",W)}finally{u(!1)}},[]),Y=x.useCallback(async ne=>{if(!ne){_("Parcel ID is required");return}m(!0),_(null),v(null);try{console.log("ðŸ—ï¸ Calculating buildable envelope for:",ne);const W=await dt.getBuildableEnvelope(ne);W?(a(W),console.log("âœ… Buildable envelope calculated successfully")):_("Failed to calculate buildable envelope")}catch(W){const oe=W instanceof Error?W.message:"Unknown error occurred";_(oe),v(oe),console.error("âŒ Error calculating envelope:",W)}finally{m(!1)}},[]),X=x.useCallback(async(ne,W,oe)=>{if(!ne){P("Parcel ID is required");return}if(!W){P("Pad geometry is required");return}g(!0),P(null),v(null);try{console.log("ðŸ“Š Scoring pad for parcel:",ne);const V=await dt.scorePad(ne,W,oe);V?(i(V),console.log("âœ… Pad scored successfully")):P("Failed to score pad")}catch(V){const ce=V instanceof Error?V.message:"Unknown error occurred";P(ce),v(ce),console.error("âŒ Error scoring pad:",V)}finally{g(!1)}},[]),A=x.useCallback(async(ne,W,oe)=>{if(!ne){v("Parcel ID is required");return}j(!0),v(null),C(null),_(null),P(null);try{console.log("ðŸš€ Starting complete parcel analysis for:",ne);const V=await dt.analyzeParcel(ne,W,oe);V?(l(V),t(V.parcel),a(V.envelope),i(V.score),R(!0),console.log("âœ… Complete parcel analysis finished successfully")):(v("Failed to complete parcel analysis"),R(!1))}catch(V){const ce=V instanceof Error?V.message:"Unknown error occurred";v(ce),R(!1),console.error("âŒ Error in parcel analysis:",V)}finally{j(!1)}},[]),E=x.useCallback(async ne=>{if(!ne){R(!1);return}k(!0);try{console.log("âœ… Validating parcel ID:",ne);const W=await dt.validateParcelId(ne);R(W),console.log("âœ… Parcel ID validation result:",W)}catch(W){console.error("âŒ Error validating parcel ID:",W),R(!1)}finally{k(!1)}},[]),J=x.useCallback(()=>{t(null),a(null),i(null),l(null)},[]),O=x.useCallback(()=>{v(null),C(null),_(null),P(null)},[]),re=x.useCallback(()=>{J(),O(),R(!1)},[J,O]);return{parcel:r,envelope:s,score:n,analysisResult:o,isLoadingParcel:c,isLoadingEnvelope:d,isLoadingScore:h,isAnalyzing:y,error:b,parcelError:N,envelopeError:p,scoreError:w,isValidParcelId:U,isValidatingParcelId:q,fetchParcel:D,calculateEnvelope:Y,scorePad:X,analyzeParcel:A,validateParcelId:E,clearData:J,clearErrors:O,reset:re,hasData:r||s||n||o,hasErrors:b||N||p||w,isLoading:c||d||h||y}}function vr(){const[r,t]=x.useState("47037"),[s,a]=x.useState(null),[n,i]=x.useState(!1),[o,l]=x.useState(null),c=async()=>{i(!0),l(null),a(null);try{console.log("ðŸš€ Running Supabase Integration Example...");const{data:u}=await dt.fetchParcelData(r);if(console.log("ðŸ“¦ Parcel data:",u),!u)throw new Error("No parcel data found");const d=await dt.getBuildableEnvelope(u.parcel_id);console.log("ðŸ—ï¸ Envelope data:",d);const m=await dt.scorePad(u.parcel_id,d||null,null);console.log("ðŸ“Š Score data:",m),a({parcel:u,envelope:d,score:m})}catch(u){console.error("âŒ Error in example:",u),l(u instanceof Error?u.message:"Unknown error")}finally{i(!1)}};return e.jsxs("div",{className:"p-6 bg-white rounded-lg shadow-lg",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-gray-800",children:"ðŸ”— Supabase Integration Example"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"This demonstrates the exact workflow from your frontend wiring checklist:"}),e.jsxs("div",{className:"bg-gray-100 p-4 rounded-md mb-4 font-mono text-sm",children:[e.jsx("div",{className:"text-green-600",children:"// Example: fetch the parcel + envelope + score"}),e.jsxs("div",{className:"text-blue-600",children:["const ","{ data: parcel }",' = await supabase.from("planner_join")']}),e.jsx("div",{className:"text-blue-600",children:'  .select("*")'}),e.jsx("div",{className:"text-blue-600",children:'  .eq("parcel_id", "47037")'}),e.jsx("div",{className:"text-blue-600",children:"  .single();"}),e.jsx("br",{}),e.jsx("div",{className:"text-green-600",children:"// Envelope RPC"}),e.jsxs("div",{className:"text-blue-600",children:["const ","{ data: env }",' = await supabase.rpc("get_buildable_envelope", ',"{ p_parcel_id: parcel.parcel_id }",");"]}),e.jsx("br",{}),e.jsx("div",{className:"text-green-600",children:"// Score RPC"}),e.jsxs("div",{className:"text-blue-600",children:["const ","{ data: score }",' = await supabase.rpc("score_pad", ',"{"]}),e.jsx("div",{className:"text-blue-600",children:"  p_parcel_id: parcel.parcel_id,"}),e.jsx("div",{className:"text-blue-600",children:"  p_pad_3857: env,   // or any drawn polygon"}),e.jsx("div",{className:"text-blue-600",children:"  p_parking_3857: null"}),e.jsxs("div",{className:"text-blue-600",children:["}",");"]})]}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsx("input",{type:"text",value:r,onChange:u=>t(u.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter parcel ID"}),e.jsx("button",{onClick:c,disabled:n,className:"px-6 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50",children:n?"Running...":"Run Example"})]}),o&&e.jsxs("div",{className:"mb-4 p-4 bg-red-50 border border-red-200 rounded-md",children:[e.jsx("h3",{className:"text-red-800 font-medium mb-2",children:"Error:"}),e.jsx("p",{className:"text-red-700 text-sm",children:o})]}),s&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-md",children:[e.jsx("h3",{className:"text-green-800 font-medium mb-2",children:"âœ… Parcel Data"}),e.jsx("pre",{className:"text-sm text-green-700 overflow-auto max-h-40",children:JSON.stringify(s.parcel,null,2)})]}),e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-md",children:[e.jsx("h3",{className:"text-blue-800 font-medium mb-2",children:"ðŸ—ï¸ Envelope Data"}),e.jsx("pre",{className:"text-sm text-blue-700 overflow-auto max-h-40",children:JSON.stringify(s.envelope,null,2)})]}),e.jsxs("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-md",children:[e.jsx("h3",{className:"text-purple-800 font-medium mb-2",children:"ðŸ“Š Score Data"}),e.jsx("pre",{className:"text-sm text-purple-700 overflow-auto max-h-40",children:JSON.stringify(s.score,null,2)})]})]})]})}function Nr({className:r=""}){const[t,s]=x.useState("47037"),[a,n]=x.useState(""),[i,o]=x.useState(""),[l,c]=x.useState(!1),{parcel:u,envelope:d,score:m,analysisResult:h,isLoadingParcel:g,isLoadingEnvelope:y,isLoadingScore:j,isAnalyzing:b,error:v,parcelError:N,envelopeError:C,scoreError:p,isValidParcelId:_,isValidatingParcelId:w,fetchParcel:P,calculateEnvelope:U,scorePad:R,analyzeParcel:q,validateParcelId:k,reset:D}=jr(),Y=E=>{if(!E.trim())return null;try{return JSON.parse(E)}catch(J){return console.error("Invalid geometry JSON:",J),null}},X=async()=>{const E=Y(a),J=Y(i);await q(t,E||void 0,J)},A=async()=>{if(!d){alert("Please calculate envelope first");return}const E=Y(a)||d.geometry,J=Y(i);await R(t,E,J)};return e.jsxs("div",{className:`p-6 bg-white rounded-lg shadow-lg ${r}`,children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-gray-800",children:"ðŸ—ï¸ Parcel Analysis Demo"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Parcel ID"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:t,onChange:E=>s(E.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter parcel ID (e.g., 47037)"}),e.jsx("button",{onClick:()=>k(t),disabled:w,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50",children:w?"Validating...":"Validate"})]}),_&&e.jsx("p",{className:"text-green-600 text-sm mt-1",children:"âœ… Valid parcel ID"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Custom Pad Geometry (GeoJSON - optional)"}),e.jsx("textarea",{value:a,onChange:E=>n(E.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:'{"type": "Polygon", "coordinates": [[[x1, y1], [x2, y2], ...]]}'})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Custom Parking Geometry (GeoJSON - optional)"}),e.jsx("textarea",{value:i,onChange:E=>o(E.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3,placeholder:'{"type": "Polygon", "coordinates": [[[x1, y1], [x2, y2], ...]]}'})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-6",children:[e.jsx("button",{onClick:()=>P(t),disabled:g||!t,className:"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600 disabled:opacity-50",children:g?"Loading...":"1. Fetch Parcel"}),e.jsx("button",{onClick:()=>U(t),disabled:y||!t,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:opacity-50",children:y?"Calculating...":"2. Get Envelope"}),e.jsx("button",{onClick:A,disabled:j||!d,className:"px-4 py-2 bg-purple-500 text-white rounded-md hover:bg-purple-600 disabled:opacity-50",children:j?"Scoring...":"3. Score Pad"}),e.jsx("button",{onClick:X,disabled:b||!t,className:"px-4 py-2 bg-orange-500 text-white rounded-md hover:bg-orange-600 disabled:opacity-50",children:b?"Analyzing...":"ðŸš€ Full Analysis"}),e.jsx("button",{onClick:D,className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600",children:"Reset"})]}),(v||N||C||p)&&e.jsxs("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:[e.jsx("h3",{className:"text-red-800 font-medium mb-2",children:"Errors:"}),v&&e.jsxs("p",{className:"text-red-700 text-sm",children:["General: ",v]}),N&&e.jsxs("p",{className:"text-red-700 text-sm",children:["Parcel: ",N]}),C&&e.jsxs("p",{className:"text-red-700 text-sm",children:["Envelope: ",C]}),p&&e.jsxs("p",{className:"text-red-700 text-sm",children:["Score: ",p]})]}),e.jsxs("div",{className:"space-y-6",children:[u&&e.jsxs("div",{className:"p-4 bg-green-50 border border-green-200 rounded-md",children:[e.jsx("h3",{className:"text-green-800 font-medium mb-3",children:"ðŸ“¦ Parcel Data"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"ID:"})," ",u.parcel_id]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Address:"})," ",u.address]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Size:"})," ",u.sqft?.toLocaleString()," sq ft"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Zoning:"})," ",u.zoning]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Max FAR:"})," ",u.max_far||"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Max Density:"})," ",u.max_density_du_per_acre||"N/A"," DU/acre"]})]})]}),d&&e.jsxs("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-md",children:[e.jsx("h3",{className:"text-blue-800 font-medium mb-3",children:"ðŸ—ï¸ Buildable Envelope"}),e.jsxs("div",{className:"text-sm text-blue-700",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Geometry Type:"})," ",d.type]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Coordinates:"})," Available"]}),e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"cursor-pointer font-medium",children:"View Geometry"}),e.jsx("pre",{className:"mt-2 text-xs bg-blue-100 p-2 rounded overflow-auto max-h-32",children:JSON.stringify(d,null,2)})]})]})]}),m&&e.jsxs("div",{className:"p-4 bg-purple-50 border border-purple-200 rounded-md",children:[e.jsx("h3",{className:"text-purple-800 font-medium mb-3",children:"ðŸ“Š Pad Score"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Score:"})," ",m.score.toFixed(3)]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Pad Area:"})," ",m.pad_sf.toLocaleString()," sq ft"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Envelope Area:"})," ",m.env_sf.toLocaleString()," sq ft"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Coverage:"})," ",(m.coverage*100).toFixed(1),"%"]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"font-medium text-purple-700 mb-2",children:"Compliance Checks:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{className:m.far_ok?"text-green-600":"text-red-600",children:["FAR: ",m.far_ok?"âœ… OK":"âŒ Violation"]}),e.jsxs("div",{className:m.parking_ok?"text-green-600":"text-red-600",children:["Parking: ",m.parking_ok?"âœ… OK":"âŒ Violation"]}),e.jsxs("div",{className:m.envelope_ok?"text-green-600":"text-red-600",children:["Envelope: ",m.envelope_ok?"âœ… OK":"âŒ Violation"]}),e.jsxs("div",{children:["Stalls: ",m.stalls,"/",m.stalls_needed]})]})]})]}),h&&e.jsxs("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-md",children:[e.jsx("h3",{className:"text-orange-800 font-medium mb-3",children:"ðŸš€ Complete Analysis Result"}),e.jsxs("div",{className:"text-sm text-orange-700",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Analysis Date:"})," ",h.analysis_date.toLocaleString()]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Parcel ID:"})," ",h.parcel.parcel_id]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Final Score:"})," ",h.score.score.toFixed(3)]})]})]})]}),e.jsx("div",{className:"mt-6",children:e.jsxs("button",{onClick:()=>c(!l),className:"px-4 py-2 bg-indigo-500 text-white rounded-md hover:bg-indigo-600",children:[l?"Hide":"Show"," Integration Example"]})}),l&&e.jsx("div",{className:"mt-6",children:e.jsx(vr,{})}),e.jsxs("div",{className:"mt-8 p-4 bg-gray-50 border border-gray-200 rounded-md",children:[e.jsx("h3",{className:"text-gray-800 font-medium mb-3",children:"ðŸ“‹ Usage Instructions"}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"1. Fetch Parcel:"})," Retrieves parcel data from the planner_join table"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"2. Get Envelope:"})," Calculates buildable envelope using get_buildable_envelope RPC"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"3. Score Pad:"})," Scores a pad/polygon using score_pad RPC"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Full Analysis:"})," Runs all three steps in sequence"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Custom Geometry:"})," Provide GeoJSON polygons to score custom pads/parking areas"]})]})]})]})}function wr(r,t){let s;return(...a)=>{clearTimeout(s),s=setTimeout(()=>r(...a),t)}}const Sr={targetFAR:2,targetHeight:45,buildingSetbacks:{front:25,rear:20,side:10},targetCoverage:40,buildingType:"residential",unitsPerAcre:20,parkingRatio:1.2};function Ht(){const[r,t]=x.useState(null);x.useMemo(()=>Q?wr(async l=>{r?.id&&await Q.from("projects").upsert({id:r.id,...l})},500):()=>{},[r?.id]);const s=x.useCallback(l=>{const c={id:`project_${Date.now()}`,name:l,parcels:[],totalAcreage:0,totalSqft:0,totalLandValue:0,avgFAR:0,maxUnits:0,buildableArea:0,siteplanConfig:{...Sr},createdAt:new Date,updatedAt:new Date};return t(c),c},[]),a=x.useCallback(l=>{if(!r)return;const c={id:l.ogc_fid||l.id,parcelnumb:l.parcelnumb||l.parcelnumb_no_formatting,address:l.address||"Address not available",deededacreage:l.deededacreage||l.gisacre||0,sqft:l.sqft||l.gisacre*43560||0,zoning:l.zoning||"Unknown",geometry:l.geometry,landval:l.landval,parval:l.parval,lat:l.lat,lon:l.lon,max_far:vt(l.zoning,"far"),max_height_ft:vt(l.zoning,"height"),max_coverage_pct:vt(l.zoning,"coverage"),min_front_setback_ft:vt(l.zoning,"front_setback"),min_rear_setback_ft:vt(l.zoning,"rear_setback"),min_side_setback_ft:vt(l.zoning,"side_setback"),slope:l.slope||"flat",flood_zone:l.fema_flood_zone,soil_type:l.soil_type||"unknown",access_points:kr(l),utilities:Cr(l)};r.parcels.findIndex(d=>d.id===c.id)>=0||t(d=>{if(!d)return null;const m=[...d.parcels,c];return{...d,parcels:m,totalAcreage:m.reduce((h,g)=>h+g.deededacreage,0),totalSqft:m.reduce((h,g)=>h+g.sqft,0),totalLandValue:m.reduce((h,g)=>h+(g.landval||0),0),buildableArea:Xs(m),updatedAt:new Date}})},[r]),n=x.useCallback(l=>{r&&t(c=>{if(!c)return null;const u=c.parcels.filter(d=>d.id!==l);return{...c,parcels:u,totalAcreage:u.reduce((d,m)=>d+m.deededacreage,0),totalSqft:u.reduce((d,m)=>d+m.sqft,0),totalLandValue:u.reduce((d,m)=>d+(m.landval||0),0),buildableArea:Xs(u),updatedAt:new Date}})},[r]),i=x.useCallback(l=>{r&&t(c=>c?{...c,siteplanConfig:{...c.siteplanConfig,...l},updatedAt:new Date}:null)},[r]),o=x.useMemo(()=>{if(!r||r.parcels.length===0)return null;const l=r.siteplanConfig,c=r.parcels,u={maxFAR:Math.min(...c.map(A=>A.max_far||3)),maxHeight:Math.min(...c.map(A=>A.max_height_ft||45)),maxCoverage:Math.min(...c.map(A=>A.max_coverage_pct||40)),setbacks:{front:Math.max(...c.map(A=>A.min_front_setback_ft||25)),rear:Math.max(...c.map(A=>A.min_rear_setback_ft||20)),side:Math.max(...c.map(A=>A.min_side_setback_ft||10))}},d=Math.min(l.targetFAR,u.maxFAR),m=Math.min(l.targetHeight,u.maxHeight),h=Math.min(l.targetCoverage,u.maxCoverage),g=r.totalSqft,y=_r(c,u.setbacks),j=y*(h/100),b=g*d,v=Math.floor(m/12),N=j*v,C=Math.min(b,N),p=Math.ceil(C/j),_=p*12,w=C/g;let P=0,U=0;l.buildingType==="residential"&&(l.unitsPerAcre?(P=Math.floor(r.totalAcreage*l.unitsPerAcre),U=C/P):(U=Pr(c[0]?.zoning),P=Math.floor(C/U)));const R=l.parkingRatio?Math.ceil(P*l.parkingRatio):0,q=R*300,k=Math.max(g*.15,P*100),D=l.buildingType==="residential"?Math.max(2e3,P*50):0,Y=Fr(C,l.buildingType),X=Mr(C,P,c[0]?.zoning);return{footprint:j,totalGSF:C,height:_,stories:p,units:P,parkingSpaces:R,coverage:j/g*100,far:w,buildableArea:y,openSpaceArea:k,parkingArea:q,amenitySpace:D,averageUnitSize:U,constructionCost:Y,estimatedValue:X,roiProjection:X>0?(X-Y-r.totalLandValue)/(Y+r.totalLandValue)*100:0,constraintAnalysis:{farUtilization:w/u.maxFAR*100,heightUtilization:_/u.maxHeight*100,coverageUtilization:j/g*100/u.maxCoverage*100,limitingFactor:Ir(C,b,N,j,y)}}},[r]);return{project:r,createProject:s,addParcel:a,removeParcel:n,updateSiteplanConfig:i,calculateMassing:o,clearProject:()=>t(null)}}function vt(r,t){return r&&{RS5:{far:.4,height:35,coverage:25,front_setback:30,rear_setback:25,side_setback:15},"RS7.5":{far:.35,height:35,coverage:25,front_setback:30,rear_setback:25,side_setback:15},RS10:{far:.3,height:35,coverage:25,front_setback:30,rear_setback:25,side_setback:15},RS15:{far:.25,height:35,coverage:20,front_setback:35,rear_setback:30,side_setback:20},RS20:{far:.2,height:35,coverage:20,front_setback:35,rear_setback:30,side_setback:20},RS30:{far:.15,height:35,coverage:15,front_setback:40,rear_setback:35,side_setback:25},RS40:{far:.12,height:35,coverage:15,front_setback:40,rear_setback:35,side_setback:25},R6:{far:1.5,height:45,coverage:40,front_setback:25,rear_setback:20,side_setback:10},R8:{far:2,height:45,coverage:45,front_setback:25,rear_setback:20,side_setback:10},R10:{far:2.5,height:60,coverage:50,front_setback:25,rear_setback:20,side_setback:10},R15:{far:3,height:60,coverage:55,front_setback:20,rear_setback:20,side_setback:10},R20:{far:3.5,height:75,coverage:60,front_setback:20,rear_setback:20,side_setback:10},R30:{far:4,height:75,coverage:65,front_setback:20,rear_setback:20,side_setback:10},RM2:{far:2,height:45,coverage:50,front_setback:15,rear_setback:15,side_setback:5},RM4:{far:2.5,height:60,coverage:55,front_setback:15,rear_setback:15,side_setback:5},RM6:{far:3,height:60,coverage:60,front_setback:15,rear_setback:15,side_setback:5},RM9:{far:3.5,height:75,coverage:65,front_setback:10,rear_setback:15,side_setback:5},RM15:{far:4,height:90,coverage:70,front_setback:10,rear_setback:15,side_setback:5},RM20:{far:5,height:105,coverage:75,front_setback:10,rear_setback:15,side_setback:5},RM40:{far:6,height:120,coverage:80,front_setback:10,rear_setback:15,side_setback:5},RM60:{far:7,height:150,coverage:85,front_setback:10,rear_setback:15,side_setback:5},RM80:{far:8,height:200,coverage:85,front_setback:10,rear_setback:15,side_setback:5},CN:{far:2,height:45,coverage:60,front_setback:15,rear_setback:10,side_setback:5},CR:{far:2.5,height:60,coverage:70,front_setback:10,rear_setback:10,side_setback:5},CS:{far:3,height:75,coverage:75,front_setback:10,rear_setback:10,side_setback:5},CA:{far:4,height:90,coverage:80,front_setback:5,rear_setback:10,side_setback:0},CL:{far:5,height:120,coverage:85,front_setback:5,rear_setback:10,side_setback:0},CC:{far:6,height:200,coverage:90,front_setback:0,rear_setback:10,side_setback:0},MUL:{far:4,height:90,coverage:75,front_setback:10,rear_setback:15,side_setback:5},MUN:{far:5,height:120,coverage:80,front_setback:5,rear_setback:15,side_setback:5},MUG:{far:8,height:200,coverage:85,front_setback:0,rear_setback:15,side_setback:0},IWD:{far:2,height:60,coverage:70,front_setback:20,rear_setback:20,side_setback:15},IG:{far:3,height:75,coverage:80,front_setback:15,rear_setback:20,side_setback:10},IR:{far:4,height:100,coverage:85,front_setback:10,rear_setback:20,side_setback:10}}[r]?.[t]||Bs(t)}function Bs(r){return{far:2,height:45,coverage:40,front_setback:25,rear_setback:20,side_setback:10}[r]||0}function Xs(r){return r.reduce((t,s)=>{const a={front:s.min_front_setback_ft||25,rear:s.min_rear_setback_ft||20,side:s.min_side_setback_ft||10},n=Math.sqrt(s.sqft),i=Math.max(0,n-a.side*2),o=Math.max(0,n-a.front-a.rear);return t+i*o},0)}function _r(r,t){return r.reduce((s,a)=>{const n=Math.sqrt(a.sqft),i=Math.max(0,n-t.side*2),o=Math.max(0,n-t.front-t.rear),l=a.slope==="steep"?.8:a.slope==="moderate"?.9:1,c=a.flood_zone&&a.flood_zone!=="X"?.9:1;return s+i*o*l*c},0)}function kr(r){return r.sqft>5e4?2:r.sqft>2e4?1.5:1}function Cr(r){const t=["electricity","water"];return r.zoning&&!r.zoning.startsWith("AG")&&t.push("sewer","gas"),r.city&&r.city.toLowerCase()==="nashville"&&t.push("fiber"),t}function Pr(r){return r?r.startsWith("RS")?2e3:r.startsWith("R6")||r.startsWith("R8")?900:r.startsWith("R")?1100:r.includes("RM")?1e3:1200:1200}function Fr(r,t){return r*({residential:180,commercial:220,"mixed-use":200}[t]||180)*1.3}function Mr(r,t,s){if(t>0){const a=Rr(s);return t*a}else{const a=Ar(s);return r*a}}function Rr(r){return r?.startsWith("R6")||r?.startsWith("R8")?25e4:r?.startsWith("R")?32e4:r?.includes("RM")?38e4:3e5}function Ar(r){return r?.startsWith("C")?250:r?.includes("MU")?280:200}function Ir(r,t,s,a,n){return r>=t*.95?"FAR Limit":r>=s*.95?"Height Limit":a>=n*.95?"Setback Constraints":"Design Choice"}function zr({onReload:r,parcelStats:t}){const{filterMode:s,colorMode:a,selectionMode:n,selectedParcelIds:i,setFilterMode:o,setColorMode:l,setSelectionMode:c,clearSelectedParcels:u}=ke(),[d,m]=ee.useState(!0),h=g=>{o(g),setTimeout(r,100)};return e.jsxs("div",{className:"bg-white border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>m(!d),className:"w-full flex items-center justify-between p-3 hover:bg-gray-50 transition-colors",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Map Controls"}),d?e.jsx(Za,{className:"w-4 h-4 text-gray-500"}):e.jsx(Ja,{className:"w-4 h-4 text-gray-500"})]}),d&&e.jsxs("div",{className:"px-3 pb-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Color By:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>l("size"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${a==="size"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,"data-testid":"color-mode-size",children:"ðŸ“ Parcel Size"}),e.jsx("button",{onClick:()=>l("zoning"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${a==="zoning"?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,"data-testid":"color-mode-zoning",children:"ðŸ˜ï¸ Zoning Type"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Selection Mode:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>c("single"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors flex items-center space-x-2 ${n==="single"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(zt,{className:"w-4 h-4"}),e.jsx("span",{children:"Single Parcel"})]}),e.jsxs("button",{onClick:()=>c("multi"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors flex items-center space-x-2 ${n==="multi"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx(Ka,{className:"w-4 h-4"}),e.jsx("span",{children:"Multi-Parcel"})]})]}),n==="multi"&&i.length>0&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-50 rounded text-xs text-blue-800",children:[i.length," parcel",i.length!==1?"s":""," selected",e.jsx("button",{onClick:u,className:"ml-2 text-blue-600 hover:text-blue-800 underline",children:"Clear"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Filter by Size:"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("button",{onClick:()=>h("all"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${s==="all"?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,"data-testid":"filter-mode-all",children:"ðŸ” All Parcels (0+ sqft)"}),e.jsx("button",{onClick:()=>h("large"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${s==="large"?"bg-green-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,"data-testid":"filter-mode-large",children:"ðŸ  Large Only (5k+ sqft)"}),e.jsx("button",{onClick:()=>h("huge"),className:`w-full px-3 py-2 rounded text-sm font-medium transition-colors ${s==="huge"?"bg-purple-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,"data-testid":"filter-mode-huge",children:"ðŸ¢ Huge Only (20k+ sqft)"})]})]}),t&&e.jsxs("div",{className:"p-3 bg-gray-50 rounded",children:[e.jsx("h4",{className:"font-bold text-sm text-gray-800 mb-2",children:"ðŸ“Š Current View Stats"}),e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{children:["Total Parcels: ",e.jsx("span",{className:"font-bold",children:t.total})]}),e.jsxs("div",{children:["Avg Size: ",e.jsxs("span",{className:"font-bold",children:[Math.round(t.avgSize).toLocaleString()," sqft"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-1 mt-2 text-xs",children:[e.jsxs("div",{className:"text-red-600",children:["Tiny (<2k): ",t.sizeDistribution.tiny]}),e.jsxs("div",{className:"text-orange-600",children:["Small (2-5k): ",t.sizeDistribution.small]}),e.jsxs("div",{className:"text-blue-600",children:["Medium (5-20k): ",t.sizeDistribution.medium]}),e.jsxs("div",{className:"text-purple-600",children:["Large (20k+): ",t.sizeDistribution.large]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-sm text-gray-800 mb-2",children:"ðŸŽ¨ Color Legend"}),a==="size"?e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-400 rounded"}),e.jsx("span",{children:"Tiny (<1k sqft)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-orange-400 rounded"}),e.jsx("span",{children:"Small (1-2k sqft)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-400 rounded"}),e.jsx("span",{children:"Medium (2-5k sqft)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-700 rounded"}),e.jsx("span",{children:"Large (5-20k sqft)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-900 rounded"}),e.jsx("span",{children:"Huge (20k+ sqft)"})]})]}):e.jsxs("div",{className:"space-y-1 text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded"}),e.jsx("span",{children:"Single-Family (RS)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-500 rounded"}),e.jsx("span",{children:"Multi-Family (R)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-indigo-500 rounded"}),e.jsx("span",{children:"Residential Mixed (RM)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-amber-500 rounded"}),e.jsx("span",{children:"Commercial (C)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded"}),e.jsx("span",{children:"Mixed-Use (MU)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-500 rounded"}),e.jsx("span",{children:"Industrial (I)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-purple-500 rounded"}),e.jsx("span",{children:"Special Purpose (SP)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-emerald-500 rounded"}),e.jsx("span",{children:"Agricultural/Open (AG/OS)"})]})]})]}),e.jsxs("button",{onClick:r,className:"w-full bg-blue-600 text-white px-3 py-2 rounded text-sm font-medium hover:bg-blue-700 transition-colors flex items-center justify-center space-x-2","data-testid":"reload-parcels",title:"Reload parcels",children:[e.jsx(na,{className:"w-4 h-4"}),e.jsx("span",{children:"Reload Parcels"})]})]})]})}function $r(){const[r,t]=ee.useState("map"),{leftNavOpen:s,setLeftNavOpen:a,isMobile:n}=ke(),[i]=ee.useState(null),o=()=>{console.log("Reload parcels")},l=[{id:"map",label:"Map View",icon:Ce},{id:"saved",label:"Saved Parcels",icon:Qa},{id:"reports",label:"Reports",icon:Xt}],c=[{id:"settings",label:"Settings",icon:et}],u=()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-4 border-b border-gray-200",children:[n&&e.jsx("button",{onClick:()=>a(!1),className:"absolute top-4 right-4 p-1 hover:bg-gray-100 rounded-lg lg:hidden","data-testid":"nav-close",children:e.jsx(xe,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(Ce,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-bold text-gray-900",children:"Parcel"}),e.jsx("p",{className:"text-xs text-gray-600",children:"Intelligence"})]})]})]}),e.jsxs("div",{className:"flex-1 p-2",children:[e.jsx("div",{className:"space-y-1",children:l.map(d=>{const m=d.icon,h=r===d.id;return e.jsxs("button",{onClick:()=>t(d.id),className:`w-full flex items-center space-x-3 px-3 py-2 text-sm font-medium rounded-lg transition-colors focus-ring ${h?"bg-blue-50 text-blue-700 border border-blue-200":"text-gray-700 hover:bg-gray-100"}`,"aria-current":h?"page":void 0,"data-testid":`nav-${d.id}`,children:[e.jsx(m,{className:"w-4 h-4"}),e.jsx("span",{children:d.label})]},d.id)})}),r==="map"&&e.jsx("div",{className:"mt-6","data-testid":"map-controls",children:e.jsx(zr,{onReload:o,parcelStats:i})}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2",children:"Recent Activity"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"px-3 py-2 text-sm text-gray-600",children:[e.jsx("div",{className:"font-medium",children:"2312 Heiman St"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Viewed 2 hours ago"})]}),e.jsxs("div",{className:"px-3 py-2 text-sm text-gray-600",children:[e.jsx("div",{className:"font-medium",children:"1501 Jefferson St"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Analyzed yesterday"})]}),e.jsxs("div",{className:"px-3 py-2 text-sm text-gray-600",children:[e.jsx("div",{className:"font-medium",children:"890 26th Ave N"}),e.jsx("div",{className:"text-xs text-gray-500",children:"Added to project"})]})]})]})]}),e.jsx("div",{className:"p-2 border-t border-gray-200",children:e.jsx("div",{className:"space-y-1",children:c.map(d=>{const m=d.icon;return e.jsxs("button",{className:"w-full flex items-center space-x-3 px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors focus-ring","data-testid":`nav-${d.id}`,children:[e.jsx(m,{className:"w-4 h-4"}),e.jsx("span",{children:d.label})]},d.id)})})}),e.jsx("div",{className:"p-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center",children:e.jsx(us,{className:"w-4 h-4 text-gray-600"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:"User"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Nashville Metro"})]})]})})]});return e.jsxs(e.Fragment,{children:[n&&e.jsx("button",{onClick:()=>a(!0),className:"fixed top-4 left-4 z-50 p-2 bg-white rounded-lg shadow-md lg:hidden focus-ring","data-testid":"mobile-hamburger",children:e.jsx(sa,{className:"w-5 h-5"})}),n&&s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-10 lg:hidden pointer-events-none",onClick:()=>a(!1)}),e.jsx("nav",{className:`
          bg-white border-r border-gray-200 flex flex-col z-10 pointer-events-auto
          ${n?`fixed left-0 top-0 h-full w-80 transform transition-transform duration-300 ${s?"translate-x-0":"-translate-x-full"} lg:relative lg:translate-x-0 lg:w-64`:"relative w-64"}
        `,"data-testid":"left-navigation",children:e.jsx(u,{})})]})}function Nt({className:r="",lines:t=1,height:s="1rem",width:a="100%"}){return e.jsx("div",{className:`animate-pulse ${r}`,children:Array.from({length:t}).map((n,i)=>e.jsx("div",{className:"bg-gray-200 rounded",style:{height:s,width:i===t-1?"75%":a,marginBottom:i<t-1?"0.5rem":"0"}},i))})}function Er(){return e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((r,t)=>e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(Nt,{lines:1,height:"1.25rem",width:"60%"}),e.jsx(Nt,{lines:1,height:"1rem",width:"20%"})]}),e.jsx(Nt,{lines:2,height:"1rem",width:"100%"}),e.jsxs("div",{className:"flex items-center space-x-4 mt-3",children:[e.jsx(Nt,{lines:1,height:"1rem",width:"30%"}),e.jsx(Nt,{lines:1,height:"1rem",width:"25%"}),e.jsx(Nt,{lines:1,height:"1rem",width:"20%"})]})]},t))})}function Dr(r,t){let s=null;const a=(...n)=>{s&&clearTimeout(s),s=setTimeout(()=>r(...n),t)};return a.cancel=()=>{s&&(clearTimeout(s),s=null)},a}function Or(r,t,s){const[a,n]=x.useState({}),[i,o]=x.useState(null),l=x.useRef(),c=x.useMemo(()=>r.length===0?null:{maxFAR:Math.min(...r.map(m=>m.max_far||3)),maxHeight:Math.min(...r.map(m=>m.max_height_ft||45)),maxCoverage:Math.min(...r.map(m=>m.max_coverage_pct||40)),frontSetback:Math.max(...r.map(m=>m.min_front_setback_ft||25)),rearSetback:Math.max(...r.map(m=>m.min_rear_setback_ft||20)),sideSetback:Math.max(...r.map(m=>m.min_side_setback_ft||10)),parkingRatio:Yr(r[0]?.zoning),densityLimit:Lr(r[0]?.zoning)},[r]),u=x.useCallback(()=>{if(!r.length||!t||!c)return null;const m=[],h=[],g=r.reduce((w,P)=>w+P.sqft,0),y=g/43560,j=t.totalGSF/g,b={status:j<=c.maxFAR?"compliant":"violation",currentValue:j,requiredValue:c.maxFAR,utilizationPercentage:j/c.maxFAR*100,message:`Current FAR: ${j.toFixed(2)}, Maximum: ${c.maxFAR}`};b.status==="violation"?m.push({id:"far-violation",ruleId:"max-far",ruleName:"Floor Area Ratio",category:"far",severity:"error",message:`FAR of ${j.toFixed(2)} exceeds maximum of ${c.maxFAR}`,currentValue:j,requiredValue:c.maxFAR,unit:"ratio"}):b.utilizationPercentage>90&&h.push({id:"far-warning",ruleId:"max-far",ruleName:"Floor Area Ratio",category:"far",severity:"warning",message:`FAR utilization at ${b.utilizationPercentage.toFixed(1)}% - approaching limit`,currentValue:j,requiredValue:c.maxFAR,unit:"ratio"});const v={status:t.height<=c.maxHeight?"compliant":"violation",currentValue:t.height,requiredValue:c.maxHeight,utilizationPercentage:t.height/c.maxHeight*100,message:`Current height: ${t.height}ft, Maximum: ${c.maxHeight}ft`};v.status==="violation"&&m.push({id:"height-violation",ruleId:"max-height",ruleName:"Building Height",category:"height",severity:"error",message:`Building height of ${t.height}ft exceeds maximum of ${c.maxHeight}ft`,currentValue:t.height,requiredValue:c.maxHeight,unit:"feet"});const N={status:t.coverage<=c.maxCoverage?"compliant":"violation",currentValue:t.coverage,requiredValue:c.maxCoverage,utilizationPercentage:t.coverage/c.maxCoverage*100,message:`Current coverage: ${t.coverage.toFixed(1)}%, Maximum: ${c.maxCoverage}%`};N.status==="violation"&&m.push({id:"coverage-violation",ruleId:"max-coverage",ruleName:"Site Coverage",category:"coverage",severity:"error",message:`Site coverage of ${t.coverage.toFixed(1)}% exceeds maximum of ${c.maxCoverage}%`,currentValue:t.coverage,requiredValue:c.maxCoverage,unit:"percentage"});const C=Ur(s.buildingSetbacks,c,m),p=Tr(t,c,m),_=qr(t,y,c,m);return{isCompliant:m.length===0,violations:m,warnings:h,compliance:{setbacks:C,height:v,coverage:N,far:b,parking:p,density:_}}},[r,t,s,c]);x.useEffect(()=>{l.current||(l.current=Dr(h=>{o(h)},150));const m=u();return l.current(m),()=>{l.current&&l.current.cancel()}},[u]),x.useEffect(()=>()=>{l.current&&l.current.cancel()},[]);const d=x.useCallback((m,h)=>{if(!c)return{valid:!0,message:""};switch(m){case"height":return{valid:h<=c.maxHeight,message:h>c.maxHeight?`Height of ${h}ft exceeds maximum of ${c.maxHeight}ft`:""};case"far":return{valid:h<=c.maxFAR,message:h>c.maxFAR?`FAR of ${h} exceeds maximum of ${c.maxFAR}`:""};case"coverage":return{valid:h<=c.maxCoverage,message:h>c.maxCoverage?`Coverage of ${h}% exceeds maximum of ${c.maxCoverage}%`:""};default:return{valid:!0,message:""}}},[c]);return{compliance:i,effectiveZoningRules:c,validateChange:d,customRules:a,setCustomRules:n}}function Ur(r,t,s){const a=[];return r.front<t.frontSetback&&(s.push({id:"front-setback-violation",ruleId:"min-front-setback",ruleName:"Front Setback",category:"setback",severity:"error",message:`Front setback of ${r.front}ft is less than required ${t.frontSetback}ft`,currentValue:r.front,requiredValue:t.frontSetback,unit:"feet"}),a.push("front")),r.rear<t.rearSetback&&(s.push({id:"rear-setback-violation",ruleId:"min-rear-setback",ruleName:"Rear Setback",category:"setback",severity:"error",message:`Rear setback of ${r.rear}ft is less than required ${t.rearSetback}ft`,currentValue:r.rear,requiredValue:t.rearSetback,unit:"feet"}),a.push("rear")),r.side<t.sideSetback&&(s.push({id:"side-setback-violation",ruleId:"min-side-setback",ruleName:"Side Setback",category:"setback",severity:"error",message:`Side setback of ${r.side}ft is less than required ${t.sideSetback}ft`,currentValue:r.side,requiredValue:t.sideSetback,unit:"feet"}),a.push("side")),{status:a.length===0?"compliant":"violation",currentValue:Math.min(r.front,r.rear,r.side),requiredValue:Math.min(t.frontSetback,t.rearSetback,t.sideSetback),utilizationPercentage:100,message:a.length===0?"All setbacks meet requirements":`Setback violations: ${a.join(", ")}`}}function Tr(r,t,s){const a=Math.ceil((r.units||0)*t.parkingRatio),n=r.parkingSpaces||0;return n<a&&s.push({id:"parking-violation",ruleId:"min-parking",ruleName:"Parking Requirement",category:"parking",severity:"error",message:`${n} parking spaces provided, ${a} required`,currentValue:n,requiredValue:a,unit:"spaces"}),{status:n>=a?"compliant":"violation",currentValue:n,requiredValue:a,utilizationPercentage:a>0?n/a*100:100,message:`${n} spaces provided, ${a} required`}}function qr(r,t,s,a){const n=(r.units||0)/t,i=s.densityLimit;return n>i&&a.push({id:"density-violation",ruleId:"max-density",ruleName:"Density Limit",category:"density",severity:"error",message:`Density of ${n.toFixed(1)} units/acre exceeds maximum of ${i} units/acre`,currentValue:n,requiredValue:i,unit:"units/acre"}),{status:n<=i?"compliant":"violation",currentValue:n,requiredValue:i,utilizationPercentage:n/i*100,message:`${n.toFixed(1)} units/acre, max ${i} units/acre`}}function Yr(r){return{RS5:2,"RS7.5":2,RS10:2,RS15:2,RS20:2,RS30:2,RS40:2,R6:1.5,R8:1.2,R10:1,R15:1,R20:1,R30:1,RM2:1.2,RM4:1,RM6:1,RM9:.8,RM15:.8,RM20:.5,RM40:.5,RM60:.5,RM80:.5}[r]||1.2}function Lr(r){return{RS5:8.7,"RS7.5":5.8,RS10:4.4,RS15:2.9,RS20:2.2,RS30:1.5,RS40:1.1,R6:6,R8:8,R10:10,R15:15,R20:20,R30:30,RM2:2,RM4:4,RM6:6,RM9:9,RM15:15,RM20:20,RM40:40,RM60:60,RM80:80}[r]||20}function ba({projectId:r,parcelId:t,onClose:s}){const{user:a}=ca(),[n,i]=x.useState([]),[o,l]=x.useState(""),[c,u]=x.useState(!1),[d,m]=x.useState(!1),h=x.useRef(null),g=x.useRef(null),y=n.filter(p=>!p.read_by.includes(a.id)&&p.user_id!==a.id).length;x.useEffect(()=>{j()},[r,t]),x.useEffect(()=>{if(!Q)return;const p=t?`project_${r}_parcel_${t}`:`project_${r}`,_=Q.channel(p).on("postgres_changes",{event:"INSERT",schema:"public",table:"project_comments",filter:`project_id=eq.${r}${t?` AND parcel_id=eq.${t}`:""}`},w=>{const P=w.new;i(U=>[...U,P]),P.user_id!==a.id&&m(!0),setTimeout(()=>{g.current?.scrollIntoView({behavior:"smooth"})},100)}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"project_comments"},w=>{const P=w.new;i(U=>U.map(R=>R.id===P.id?P:R))}).subscribe();return h.current=_,()=>{_.unsubscribe()}},[r,t,a.id]);const j=async()=>{if(Q)try{let p=Q.from("project_comments").select("*").eq("project_id",r).order("created_at",{ascending:!0});t&&(p=p.eq("parcel_id",t));const{data:_,error:w}=await p;if(w)throw w;i(_||[])}catch(p){console.error("Error loading comments:",p)}},b=async()=>{if(!(!o.trim()||!Q)){u(!0);try{const{error:p}=await Q.from("project_comments").insert({project_id:r,parcel_id:t||null,user_id:a.id,user_name:a.name,message:o.trim(),read_by:[a.id]});if(p)throw p;l("")}catch(p){console.error("Error sending comment:",p)}finally{u(!1)}}},v=async p=>{if(!Q)return;const _=n.find(w=>w.id===p);if(!(!_||_.read_by.includes(a.id)))try{const{error:w}=await Q.from("project_comments").update({read_by:[..._.read_by,a.id]}).eq("id",p);if(w)throw w}catch(w){console.error("Error marking comment as read:",w)}},N=p=>{p.key==="Enter"&&(p.ctrlKey||p.metaKey)&&b()},C=p=>{const _=new Date(p),P=(new Date().getTime()-_.getTime())/(1e3*60*60);return P<1?`${Math.floor(P*60)}m ago`:P<24?`${Math.floor(P)}h ago`:_.toLocaleDateString()};return d?e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg shadow-lg w-80 max-h-96 flex flex-col",children:[e.jsxs("div",{className:"p-3 border-b border-gray-200 flex items-center justify-between",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 flex items-center space-x-2",children:[e.jsx(qt,{className:"w-4 h-4"}),e.jsx("span",{children:"Comments"}),y>0&&e.jsx("div",{className:"w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center",children:y>9?"9+":y})]}),e.jsx("button",{onClick:s||(()=>m(!1)),className:"text-gray-400 hover:text-gray-600",children:"Ã—"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-3",children:[n.length===0?e.jsxs("div",{className:"text-center text-gray-500 py-6",children:[e.jsx(qt,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No comments yet"}),e.jsx("p",{className:"text-xs",children:"Start the conversation"})]}):n.map(p=>{const _=!p.read_by.includes(a.id)&&p.user_id!==a.id;return e.jsxs("div",{className:`p-2 rounded-lg ${p.user_id===a.id?"bg-blue-50 ml-4":"bg-gray-50 mr-4"} ${_?"ring-2 ring-blue-200":""}`,onClick:()=>_&&v(p.id),children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(ta,{className:"w-3 h-3 text-gray-500"}),e.jsx("span",{className:"text-xs font-medium text-gray-700",children:p.user_name}),e.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-500",children:[e.jsx(Gt,{className:"w-3 h-3"}),e.jsx("span",{children:C(p.created_at)}),_&&e.jsx(en,{className:"w-2 h-2 fill-blue-500 text-blue-500"})]})]}),e.jsx("p",{className:"text-sm text-gray-900",children:p.message})]},p.id)}),e.jsx("div",{ref:g})]}),e.jsxs("div",{className:"p-3 border-t border-gray-200",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:o,onChange:p=>l(p.target.value),onKeyPress:N,placeholder:"Add a comment...",className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-lg focus-ring",disabled:c}),e.jsx("button",{onClick:b,disabled:!o.trim()||c,className:"px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:c?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsx(tn,{className:"w-4 h-4"})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Press Ctrl+Enter to send"})]})]}):e.jsxs("button",{onClick:()=>m(!0),className:"relative flex items-center space-x-1 px-2 py-1 text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 rounded-full transition-colors",children:[e.jsx(qt,{className:"w-3 h-3"}),e.jsx("span",{children:"Comments"}),y>0&&e.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center",children:y>9?"9+":y})]})}function Br(){const{activeProjectId:r,activeProjectName:t,parcelIds:s,count:a,hasSelection:n}=Wt(),{removeParcel:i,isLoading:o,error:l}=De(),[c,u]=ee.useState([]),[d,m]=ee.useState(!1),{project:h,calculateMassing:g}=Ht(),[y,j]=ee.useState(""),[b,v]=ee.useState(!1),[N,C]=ee.useState("summary"),p=g;Or(h?.parcels||[],p,h?.siteplanConfig||{targetFAR:2,targetHeight:45,buildingSetbacks:{front:25,rear:20,side:10},targetCoverage:40,buildingType:"residential",unitsPerAcre:20,parkingRatio:1.2}),ee.useEffect(()=>{if(!r||s.length===0){u([]);return}(async()=>{if(Q){m(!0);try{const{data:q,error:k}=await Q.from("parcels").select("ogc_fid, parcelnumb, address, deededacreage, gisacre, sqft, zoning, landval, parval").in("ogc_fid",s.map(D=>parseInt(D)).filter(D=>!isNaN(D))).limit(100);if(k)throw k;u(q||[])}catch(q){console.error("Error loading parcel details:",q),u([])}finally{m(!1)}}})()},[r,s]);const _=R=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(R),w=R=>new Intl.NumberFormat("en-US").format(Math.round(R)),P=async R=>{await i(R)},U=n;return r?e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900","data-testid":"active-project-title",children:t}),o&&e.jsxs("div",{className:"flex items-center space-x-2","data-testid":"sync-indicator",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Syncing..."})]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a," parcel",a!==1?"s":""," selected"]}),l&&e.jsx("div",{className:`mt-2 p-2 rounded text-sm ${l.includes("added")||l.includes("success")?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,"data-testid":"toast",children:l}),e.jsxs("div",{className:"flex mt-3 bg-gray-100 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>C("summary"),className:`flex-1 px-3 py-1 text-xs font-medium rounded-md transition-colors ${N==="summary"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,children:"Summary"}),e.jsx("button",{onClick:()=>C("siteplan"),className:`flex-1 px-3 py-1 text-xs font-medium rounded-md transition-colors ${N==="siteplan"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,children:"Site Plan"}),e.jsx("button",{onClick:()=>C("financial"),className:`flex-1 px-3 py-1 text-xs font-medium rounded-md transition-colors ${N==="financial"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,children:"Financial"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:[N==="summary"&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 mb-3 flex items-center space-x-2",children:[e.jsx(xt,{className:"w-4 h-4"}),e.jsx("span",{children:"Selected Parcels"})]}),d&&e.jsx(Er,{count:3}),!d&&s.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(xt,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"No parcels selected"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Click parcels on the map to add them to this project"})]}),!d&&c.length>0&&e.jsx("div",{className:"space-y-2",children:c.map(R=>e.jsx("div",{className:"bg-gray-50 p-3 rounded-lg",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:R.address||"Address not available"}),e.jsxs("p",{className:"text-xs text-gray-600",children:["#",R.parcelnumb]}),e.jsxs("div",{className:"mt-1 grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Size:"}),e.jsx("span",{className:"font-medium ml-1",children:(R.deededacreage||R.gisacre)>1?`${(R.deededacreage||R.gisacre||0).toFixed(2)} ac`:`${w(R.sqft||0)} sf`})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Zoning:"}),e.jsx("span",{className:"font-medium ml-1",children:R.zoning||"N/A"})]})]}),R.landval&&e.jsxs("div",{className:"mt-1 text-xs",children:[e.jsx("span",{className:"text-gray-500",children:"Value:"}),e.jsx("span",{className:"font-medium ml-1",children:_(R.landval)})]})]}),e.jsxs("div",{className:"ml-2 flex items-center space-x-1",children:[e.jsx(ba,{projectId:r,parcelId:String(R.ogc_fid)}),e.jsx(wt,{roles:["analyst"],children:e.jsx("button",{onClick:()=>P(String(R.ogc_fid)),disabled:o,className:"p-1 text-gray-400 hover:text-red-600 rounded disabled:opacity-50","data-testid":`remove-parcel-${R.ogc_fid}`,children:e.jsx(xe,{className:"w-4 h-4"})})})]})]})},R.ogc_fid))})]})}),N==="siteplan"&&e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ge,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Site plan configuration"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Add parcels to configure site planning options"})]})}),N==="financial"&&e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ve,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Financial analysis"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Add parcels to view financial projections"})]})})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2 flex-shrink-0 bg-white",children:[e.jsxs("div",{className:"text-center text-sm text-gray-600 mb-2",children:["Project: ",t," (",a," parcels)"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsx(wt,{roles:["analyst"],children:e.jsxs("button",{disabled:!U,className:"flex items-center justify-center space-x-1 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:bg-gray-100 disabled:cursor-not-allowed","data-testid":"save-project",children:[e.jsx(kt,{className:"w-4 h-4"}),e.jsx("span",{children:"Save"})]})}),e.jsx(wt,{roles:["manager"],children:e.jsxs("button",{className:"flex items-center justify-center space-x-1 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors","data-testid":"share-project",children:[e.jsx(ut,{className:"w-4 h-4"}),e.jsx("span",{children:"Share"})]})}),e.jsx(wt,{roles:["analyst"],children:e.jsxs("button",{disabled:!U,className:"flex items-center justify-center space-x-1 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors disabled:bg-gray-100 disabled:cursor-not-allowed","data-testid":"export-project",children:[e.jsx(Bt,{className:"w-4 h-4"}),e.jsx("span",{children:"Export"})]})})]}),e.jsx(wt,{roles:["analyst"],children:e.jsx("button",{disabled:!U,className:"w-full bg-green-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-green-700 transition-colors text-sm disabled:bg-gray-300 disabled:cursor-not-allowed","data-testid":"generate-analysis",children:"â†’ Generate Full Analysis"})})]})]})]}):e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ge,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Active Project"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4","data-testid":"no-project-message",children:"Select a project from the header dropdown to start adding parcels from the map."}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg",children:e.jsx("p",{className:"text-sm text-blue-700","data-testid":"select-project-hint",children:'ðŸ’¡ Click the "Project" dropdown in the header to select or create a project'})})]})})}function Xr(){const{project:r,calculateMassing:t}=Ht(),s=t,{strategy:a,setStrategy:n,assumptions:i,updateAssumption:o,resetToDefaults:l,results:c}=fa(r,s),[u,d]=ee.useState("assumptions"),[m,h]=ee.useState(!1),g=v=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(v),y=(v,N=1)=>`${v.toFixed(N)}%`,j=v=>v>=20?"text-green-600":v>=15?"text-blue-600":v>=10?"text-yellow-600":"text-red-600",b=v=>v>=20?"Excellent":v>=15?"Good":v>=10?"Marginal":"Poor";return!r||!s?e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ve,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Underwriting Model"}),e.jsx("p",{className:"text-sm text-gray-600","data-testid":"underwriting-empty-state",children:"Create a project and add parcels to start financial analysis."})]})}):e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 flex items-center space-x-2",children:[e.jsx(ve,{className:"w-5 h-5"}),e.jsx("span",{children:"Underwriting"})]}),e.jsx("button",{onClick:l,className:"p-1 text-gray-400 hover:text-blue-600 rounded",title:"Reset to defaults","data-testid":"reset-defaults",children:e.jsx(na,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1 mb-3",children:[e.jsxs("button",{onClick:()=>n("for-sale"),className:`flex-1 flex items-center justify-center space-x-1 px-3 py-2 text-sm font-medium rounded-md transition-colors ${a==="for-sale"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,"data-testid":"strategy-for-sale",children:[e.jsx(Qs,{className:"w-4 h-4"}),e.jsx("span",{children:"For-Sale"})]}),e.jsxs("button",{onClick:()=>n("rental"),className:`flex-1 flex items-center justify-center space-x-1 px-3 py-2 text-sm font-medium rounded-md transition-colors ${a==="rental"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,"data-testid":"strategy-rental",children:[e.jsx(Ie,{className:"w-4 h-4"}),e.jsx("span",{children:"Rental"})]})]}),e.jsxs("div",{className:"flex bg-gray-50 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>d("assumptions"),className:`flex-1 px-2 py-1 text-xs font-medium rounded transition-colors ${u==="assumptions"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,children:"Inputs"}),e.jsx("button",{onClick:()=>d("results"),className:`flex-1 px-2 py-1 text-xs font-medium rounded transition-colors ${u==="results"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,children:"Results"}),e.jsx("button",{onClick:()=>d("sensitivity"),className:`flex-1 px-2 py-1 text-xs font-medium rounded transition-colors ${u==="sensitivity"?"bg-white text-gray-900 shadow-sm":"text-gray-600"}`,children:"Analysis"})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:[c&&e.jsx("div",{className:"p-4 bg-blue-50 border-b border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Current IRR:"}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:`text-lg font-bold ${j(a==="for-sale"?c.forSale.irr:c.rental.irr)}`,children:y(a==="for-sale"?c.forSale.irr:c.rental.irr)}),e.jsx("p",{className:"text-xs text-gray-600",children:b(a==="for-sale"?c.forSale.irr:c.rental.irr)})]})]})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hard Cost per SF"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"$"}),e.jsx("input",{type:"number",value:i.hardCostPerSF,onChange:v=>o("hardCostPerSF",parseFloat(v.target.value)),className:"flex-1 text-sm border border-gray-300 rounded px-2 py-1","data-testid":"hard-cost-input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Interest Rate %"}),e.jsx("input",{type:"number",step:"0.1",value:i.interestRate,onChange:v=>o("interestRate",parseFloat(v.target.value)),className:"w-full text-sm border border-gray-300 rounded px-2 py-1","data-testid":"interest-rate-input"})]}),a==="for-sale"?e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sale Price per Unit"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"$"}),e.jsx("input",{type:"number",value:i.salePricePerUnit,onChange:v=>o("salePricePerUnit",parseFloat(v.target.value)),className:"flex-1 text-sm border border-gray-300 rounded px-2 py-1","data-testid":"sale-price-input"})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Rent per Unit/Month"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"$"}),e.jsx("input",{type:"number",value:i.rentPerUnitPerMonth,onChange:v=>o("rentPerUnitPerMonth",parseFloat(v.target.value)),className:"flex-1 text-sm border border-gray-300 rounded px-2 py-1","data-testid":"rent-per-unit-input"})]})]}),c&&e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Key Results"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Total Development Cost:"}),e.jsx("span",{className:"font-semibold",children:g(c.totalDevelopmentCost)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Equity Required:"}),e.jsx("span",{className:"font-semibold",children:g(c.equityRequired)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"IRR:"}),e.jsx("span",{className:`font-semibold ${j(a==="for-sale"?c.forSale.irr:c.rental.irr)}`,children:y(a==="for-sale"?c.forSale.irr:c.rental.irr)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"Cash-on-Cash:"}),e.jsx("span",{className:"font-semibold",children:y(a==="for-sale"?c.forSale.cashOnCash:c.rental.cashOnCash)})]})]})]})]})})]}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2 flex-shrink-0 bg-white",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>n(a==="for-sale"?"rental":"for-sale"),className:"flex items-center justify-center space-x-1 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors","data-testid":"compare-strategies",children:[e.jsx(sn,{className:"w-4 h-4"}),e.jsx("span",{children:"Compare"})]}),e.jsxs("button",{className:"flex items-center justify-center space-x-1 px-3 py-2 text-sm border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors","data-testid":"generate-report",children:[e.jsx(We,{className:"w-4 h-4"}),e.jsx("span",{children:"Report"})]})]}),c&&e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-lg font-bold ${j(a==="for-sale"?c.forSale.irr:c.rental.irr)}`,children:[y(a==="for-sale"?c.forSale.irr:c.rental.irr)," IRR"]}),e.jsxs("div",{className:"text-xs text-gray-600",children:[g(c.equityRequired)," equity required"]})]})]})]})}function Vr({forSaleResults:r,rentalResults:t,project:s,massing:a}){const[n,i]=x.useState("side-by-side"),o=m=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(m),l=(m,h=1)=>`${m.toFixed(h)}%`,c=(m,h)=>{if(h===0)return{delta:0,percentage:0};const g=m-h,y=g/h*100;return{delta:g,percentage:y}},u=({delta:m,percentage:h})=>{const g=m>0,y=Math.abs(h)<1;return e.jsxs("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${y?"bg-gray-100 text-gray-600":g?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:[g?"+":"",l(h,0),!y&&(g?e.jsx(We,{className:"w-3 h-3 ml-1"}):e.jsx(an,{className:"w-3 h-3 ml-1"}))]})},d=({label:m,forSaleValue:h,rentalValue:g,formatter:y=o,icon:j})=>{const{delta:b,percentage:v}=c(h,g);return e.jsxs("div",{className:"grid grid-cols-4 gap-3 py-3 border-b border-gray-100 items-center",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm font-medium text-gray-700",children:[j,e.jsx("span",{children:m})]}),e.jsx("div",{className:"text-sm text-right font-medium text-green-700",children:y(h)}),e.jsx("div",{className:"text-sm text-right font-medium text-blue-700",children:y(g)}),e.jsx("div",{className:"text-right",children:e.jsx(u,{delta:b,percentage:v})})]})};return!r||!t||!s||!a?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(fe,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Scenario Comparison"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Add parcels and run both for-sale and rental analysis to compare scenarios"})]}):e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h2",{className:"text-lg font-bold text-gray-900 flex items-center space-x-2",children:[e.jsx(cs,{className:"w-5 h-5"}),e.jsx("span",{children:"Scenario Comparison"})]}),e.jsx("button",{onClick:()=>i(n==="side-by-side"?"overlay":"side-by-side"),className:"px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded-md transition-colors",children:n==="side-by-side"?"Overlay View":"Side by Side"})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.name," â€¢ ",a.units||0," units"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"grid grid-cols-4 gap-3 py-2 border-b-2 border-gray-200 mb-4",children:[e.jsx("div",{className:"text-sm font-semibold text-gray-900",children:"Metric"}),e.jsx("div",{className:"text-sm font-semibold text-green-700 text-right",children:"For-Sale"}),e.jsx("div",{className:"text-sm font-semibold text-blue-700 text-right",children:"Rental"}),e.jsx("div",{className:"text-sm font-semibold text-gray-900 text-right",children:"Difference"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-900 mb-3 flex items-center space-x-2",children:[e.jsx(_e,{className:"w-4 h-4"}),e.jsx("span",{children:"Investment Returns"})]}),e.jsx(d,{label:"IRR",forSaleValue:r.forSale.irr,rentalValue:t.rental.irr,formatter:l,icon:e.jsx(We,{className:"w-4 h-4 text-green-600"})}),e.jsx(d,{label:"Cash-on-Cash",forSaleValue:r.forSale.cashOnCash,rentalValue:t.rental.cashOnCash,formatter:l,icon:e.jsx(Ee,{className:"w-4 h-4 text-blue-600"})}),e.jsx(d,{label:"Total Return",forSaleValue:r.forSale.profitBeforeFinancing,rentalValue:t.rental.totalReturn,icon:e.jsx(ve,{className:"w-4 h-4 text-purple-600"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Development Costs"}),e.jsx(d,{label:"Total Dev Cost",forSaleValue:r.totalDevelopmentCost,rentalValue:t.totalDevelopmentCost}),e.jsx(d,{label:"Equity Required",forSaleValue:r.equityRequired,rentalValue:t.equityRequired}),e.jsx(d,{label:"Loan Amount",forSaleValue:r.loanAmount,rentalValue:t.loanAmount})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Revenue Analysis"}),e.jsx(d,{label:"Gross Revenue",forSaleValue:r.forSale.grossRevenue,rentalValue:t.rental.yearOneNOI*20}),e.jsx(d,{label:"Net Revenue",forSaleValue:r.forSale.netRevenue,rentalValue:t.rental.stabilizedNOI*15})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 mb-3",children:"Risk & Sensitivity"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-green-700 mb-2",children:"For-Sale Strategy"}),e.jsxs("ul",{className:"space-y-1 text-gray-600",children:[e.jsx("li",{children:"â€¢ Market timing risk"}),e.jsx("li",{children:"â€¢ Construction delays"}),e.jsx("li",{children:"â€¢ Sales velocity risk"}),e.jsx("li",{children:"â€¢ Interest rate exposure"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-700 mb-2",children:"Rental Strategy"}),e.jsxs("ul",{className:"space-y-1 text-gray-600",children:[e.jsx("li",{children:"â€¢ Vacancy risk"}),e.jsx("li",{children:"â€¢ Operating cost inflation"}),e.jsx("li",{children:"â€¢ Cap rate expansion"}),e.jsx("li",{children:"â€¢ Long-term hold risk"})]})]})]})]})]})}),e.jsxs("div",{className:"p-4 border-t border-gray-200 space-y-2 flex-shrink-0 bg-white",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{className:"bg-green-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-green-700 transition-colors text-sm",children:"Choose For-Sale"}),e.jsx("button",{className:"bg-blue-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-blue-700 transition-colors text-sm",children:"Choose Rental"})]}),e.jsx("button",{className:"w-full border border-gray-300 text-gray-700 py-2 px-4 rounded-lg font-medium hover:bg-gray-50 transition-colors text-sm",children:"Export Comparison Report"})]})]})}function Vs(){const{openDrawer:r,setDrawer:t,closeDrawer:s,isMobile:a}=ke(),{project:n,calculateMassing:i}=Ht(),o=window.innerWidth<1024,l=ee.useRef(null);return ee.useEffect(()=>{if(r&&l.current){const c=l.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),u=c[0],d=c[c.length-1],m=h=>{h.key==="Tab"&&(h.shiftKey?document.activeElement===u&&(h.preventDefault(),d?.focus()):document.activeElement===d&&(h.preventDefault(),u?.focus()))};return document.addEventListener("keydown",m),u?.focus(),()=>document.removeEventListener("keydown",m)}},[r]),r?e.jsxs(e.Fragment,{children:[o&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-20",onClick:s,style:{pointerEvents:"auto"}}),e.jsxs("div",{ref:l,className:`
          bg-white border-l border-gray-200 
          ${o?"fixed right-0 top-0 h-full w-full max-w-md z-30 transform transition-transform duration-300 ease-in-out":"relative w-96 h-full"}
        `,role:"dialog","aria-modal":"true","aria-labelledby":"drawer-title","data-testid":"right-drawer",children:[e.jsxs("div",{className:"border-b border-gray-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between p-4",children:[e.jsx("h2",{id:"drawer-title",className:"text-lg font-bold text-gray-900",children:"Project Analysis"}),e.jsx("button",{onClick:s,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors focus-ring","aria-label":"Close drawer","data-testid":"drawer-close",children:e.jsx(xe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"flex border-b border-gray-200",children:[e.jsxs("button",{onClick:()=>t("PROJECT"),className:`flex-1 flex items-center justify-center space-x-2 px-4 py-3 text-sm font-medium transition-colors focus-ring ${r==="PROJECT"?"border-b-2 border-blue-600 text-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,"aria-current":r==="PROJECT"?"page":void 0,"data-testid":"project-tab",children:[e.jsx(ge,{className:"w-4 h-4"}),e.jsx("span",{children:"Parcels"})]}),e.jsxs("button",{onClick:()=>t("UNDERWRITING"),className:`flex-1 flex items-center justify-center space-x-2 px-4 py-3 text-sm font-medium transition-colors focus-ring ${r==="UNDERWRITING"?"border-b-2 border-blue-600 text-blue-600 bg-blue-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,"aria-current":r==="UNDERWRITING"?"page":void 0,"data-testid":"underwriting-tab",children:[e.jsx(ve,{className:"w-4 h-4"}),e.jsx("span",{children:"Underwriting"})]}),e.jsxs("button",{onClick:()=>t("SCENARIO_COMPARE"),className:`flex-1 flex items-center justify-center space-x-2 px-4 py-3 text-sm font-medium transition-colors focus-ring ${r==="SCENARIO_COMPARE"?"border-b-2 border-purple-600 text-purple-600 bg-purple-50":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,"aria-current":r==="SCENARIO_COMPARE"?"page":void 0,"data-testid":"scenario-compare-tab",children:[e.jsx(cs,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Compare"})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-hidden",children:[r==="PROJECT"&&e.jsx(Br,{}),r==="UNDERWRITING"&&e.jsx(Xr,{}),r==="SCENARIO_COMPARE"&&e.jsx(Vr,{forSaleResults:null,rentalResults:null,project:n,massing:i})]})]})]}):null}function Gr(){const{filterModalOpen:r,setFilterModal:t,zoningFilters:s,setZoningFilters:a}=ke(),[n,i]=ee.useState({priceRange:{min:"",max:""},sizeRange:{min:"",max:""},zoning:s.activeZones,forSale:!1,yearBuilt:{min:"",max:""},address:""}),o=["RS5","RS7.5","RS10","RS15","RS20","RS30","RS40","R6","R8","R10","R15","R20","R30","RM2","RM4","RM6","RM9","RM15","RM20","RM40","RM60","RM80","CN","CR","CS","CA","CL","CC","MUN","MUL","MUG"],l=d=>{i(m=>({...m,zoning:m.zoning.includes(d)?m.zoning.filter(h=>h!==d):[...m.zoning,d]}))},c=()=>{i({priceRange:{min:"",max:""},sizeRange:{min:"",max:""},zoning:[],forSale:!1,yearBuilt:{min:"",max:""},address:""})},u=()=>{a({activeZones:n.zoning}),setTimeout(()=>{const d=new CustomEvent("forceMapReload",{detail:{zoningFilters:n.zoning}});document.dispatchEvent(d)},50),console.log("Applying filters:",n),t(!1)};return e.jsx(lt,{show:r,as:ee.Fragment,children:e.jsxs(mt,{as:"div",className:"relative z-30",onClose:()=>t(!1),children:[e.jsx(lt.Child,{as:ee.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsx(lt.Child,{as:ee.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(mt.Panel,{className:"w-full max-w-2xl transform overflow-hidden rounded-2xl bg-white p-6 text-left align-middle shadow-xl transition-all","data-testid":"filter-modal",children:[e.jsxs(mt.Title,{as:"h3",className:"text-lg font-medium leading-6 text-gray-900 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Js,{className:"w-5 h-5"}),e.jsx("span",{children:"Advanced Filters"})]}),e.jsx("button",{onClick:()=>t(!1),className:"p-1 hover:bg-gray-100 rounded-full transition-colors focus-ring","data-testid":"filter-modal-close",children:e.jsx(xe,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mt-6 space-y-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(xt,{className:"w-4 h-4 inline mr-1"}),"Address or Location"]}),e.jsx("input",{type:"text",value:n.address,onChange:d=>i(m=>({...m,address:d.target.value})),placeholder:"Search by address, neighborhood, or parcel ID...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus-ring","data-testid":"address-search"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Ee,{className:"w-4 h-4 inline mr-1"}),"Price Range"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"number",value:n.priceRange.min,onChange:d=>i(m=>({...m,priceRange:{...m.priceRange,min:d.target.value}})),placeholder:"Min price",className:"px-3 py-2 border border-gray-300 rounded-lg focus-ring","data-testid":"min-price"}),e.jsx("input",{type:"number",value:n.priceRange.max,onChange:d=>i(m=>({...m,priceRange:{...m.priceRange,max:d.target.value}})),placeholder:"Max price",className:"px-3 py-2 border border-gray-300 rounded-lg focus-ring","data-testid":"max-price"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Lot Size (sq ft)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"number",value:n.sizeRange.min,onChange:d=>i(m=>({...m,sizeRange:{...m.sizeRange,min:d.target.value}})),placeholder:"Min sq ft",className:"px-3 py-2 border border-gray-300 rounded-lg focus-ring"}),e.jsx("input",{type:"number",value:n.sizeRange.max,onChange:d=>i(m=>({...m,sizeRange:{...m.sizeRange,max:d.target.value}})),placeholder:"Max sq ft",className:"px-3 py-2 border border-gray-300 rounded-lg focus-ring"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(nn,{className:"w-4 h-4 inline mr-1"}),"Year Built"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("input",{type:"number",value:n.yearBuilt.min,onChange:d=>i(m=>({...m,yearBuilt:{...m.yearBuilt,min:d.target.value}})),placeholder:"From year",className:"px-3 py-2 border border-gray-300 rounded-lg focus-ring"}),e.jsx("input",{type:"number",value:n.yearBuilt.max,onChange:d=>i(m=>({...m,yearBuilt:{...m.yearBuilt,max:d.target.value}})),placeholder:"To year",className:"px-3 py-2 border border-gray-300 rounded-lg focus-ring"})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(Ie,{className:"w-4 h-4 inline mr-1"}),"Zoning Types"]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:o.map(d=>e.jsx("button",{onClick:()=>l(d),className:`px-3 py-2 text-sm rounded-lg border transition-colors focus-ring ${n.zoning.includes(d)?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-300 hover:bg-gray-50"}`,"data-testid":`zoning-${d}`,children:d},d))})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",checked:n.forSale,onChange:d=>i(m=>({...m,forSale:d.target.checked})),className:"rounded focus-ring","data-testid":"for-sale-toggle"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"For Sale Only"})]})})]}),e.jsxs("div",{className:"mt-6 flex justify-between",children:[e.jsx("button",{onClick:c,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus-ring","data-testid":"reset-filters",children:"Reset Filters"}),e.jsxs("div",{className:"space-x-3",children:[e.jsx("button",{onClick:()=>t(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus-ring","data-testid":"cancel-filters",children:"Cancel"}),e.jsx("button",{onClick:u,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700 focus-ring","data-testid":"apply-filters",children:"Apply Filters"})]})]})]})})})})]})})}function Wr({isOpen:r,onClose:t}){const[s,a]=x.useState(""),[n,i]=x.useState([]),[o,l]=x.useState(!1),[c,u]=x.useState([]),d=x.useRef(null);x.useEffect(()=>{m()},[]),x.useEffect(()=>{r&&d.current&&setTimeout(()=>d.current?.focus(),100)},[r]),x.useEffect(()=>{if(s.length<2){i(h());return}const v=setTimeout(()=>{g(s)},300);return()=>clearTimeout(v)},[s]);const m=()=>{const v=h();i(v);try{const N=localStorage.getItem("command-palette-recent");if(N){const C=JSON.parse(N);u(C.slice(0,5))}}catch(N){console.warn("Failed to load recent items:",N)}},h=()=>[{id:"nav-map",title:"Go to Map View",category:"navigation",icon:e.jsx(xt,{className:"w-4 h-4"}),action:()=>{t()},keyboard:"âŒ˜1"},{id:"nav-projects",title:"Go to Projects",category:"navigation",icon:e.jsx(ge,{className:"w-4 h-4"}),action:()=>{t()},keyboard:"âŒ˜2"},{id:"nav-analysis",title:"Go to Analysis",category:"navigation",icon:e.jsx(ve,{className:"w-4 h-4"}),action:()=>{t()},keyboard:"âŒ˜3"},{id:"action-create-project",title:"Create New Project",category:"action",icon:e.jsx(ge,{className:"w-4 h-4"}),action:()=>{t()}},{id:"action-export-pdf",title:"Export Current Project as PDF",category:"action",icon:e.jsx(Xt,{className:"w-4 h-4"}),action:()=>{t()}},{id:"action-optimize-massing",title:"Optimize Building Massing",category:"action",icon:e.jsx(Oe,{className:"w-4 h-4"}),action:()=>{t()}}],g=async v=>{l(!0);try{const N=[];if(Q){const{data:p}=await Q.from("parcels").select("ogc_fid, parcelnumb, address, zoning, landval").or(`address.ilike.%${v}%,parcelnumb.ilike.%${v}%`).limit(10);p&&p.forEach(w=>{N.push({id:`parcel-${w.ogc_fid}`,title:w.address||"Unknown Address",subtitle:`${w.parcelnumb} â€¢ ${w.zoning}`,category:"parcel",icon:e.jsx(xt,{className:"w-4 h-4"}),action:()=>{t()}})});const{data:_}=await Q.from("project_parcels").select("project_id").limit(5);v.toLowerCase().includes("demo")&&N.push({id:"project-demo",title:"Demo Project",subtitle:"5 parcels â€¢ Nashville",category:"project",icon:e.jsx(ge,{className:"w-4 h-4"}),action:()=>{t()}})}const C=h().filter(p=>p.title.toLowerCase().includes(v.toLowerCase())||p.category==="action");N.push(...C),i(N)}catch(N){console.error("Search error:",N),i(h())}finally{l(!1)}},y=v=>{const N=[v,...c.filter(C=>C.id!==v.id)].slice(0,5);u(N);try{localStorage.setItem("command-palette-recent",JSON.stringify(N))}catch(C){console.warn("Failed to save recent items:",C)}v.action()},j=v=>{switch(v){case"parcel":return e.jsx(xt,{className:"w-4 h-4 text-blue-600"});case"project":return e.jsx(ge,{className:"w-4 h-4 text-green-600"});case"user":return e.jsx(us,{className:"w-4 h-4 text-purple-600"});case"action":return e.jsx(Oe,{className:"w-4 h-4 text-orange-600"});case"navigation":return e.jsx(Pe,{className:"w-4 h-4 text-gray-600"});default:return e.jsx(_t,{className:"w-4 h-4 text-gray-600"})}},b=n.reduce((v,N)=>(v[N.category]||(v[N.category]=[]),v[N.category].push(N),v),{});return e.jsx(lt,{show:r,as:ee.Fragment,children:e.jsxs(mt,{as:"div",className:"relative z-50",onClose:t,children:[e.jsx(lt.Child,{as:ee.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-25"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-start justify-center p-4 pt-[10vh]",children:e.jsx(lt.Child,{as:ee.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(mt.Panel,{className:"w-full max-w-2xl transform overflow-hidden rounded-2xl bg-white shadow-xl transition-all",children:[e.jsxs(Yt,{value:null,onChange:y,children:[e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"flex items-center px-4 py-4 border-b border-gray-200",children:[e.jsx(_t,{className:"w-5 h-5 text-gray-400 mr-3"}),e.jsx(Yt.Input,{ref:d,className:"flex-1 bg-transparent outline-none text-lg placeholder-gray-500",placeholder:"Search parcels, projects, or run commands...",value:s,onChange:v=>a(v.target.value)}),o&&e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"})]})}),e.jsxs(Yt.Options,{className:"max-h-96 overflow-y-auto py-2",static:!0,children:[s.length===0&&c.length>0&&e.jsxs("div",{className:"px-4 pb-2",children:[e.jsxs("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 flex items-center space-x-1",children:[e.jsx(Gt,{className:"w-3 h-3"}),e.jsx("span",{children:"Recent"})]}),c.map(v=>e.jsx(Gs,{item:v},`recent-${v.id}`))]}),Object.entries(b).map(([v,N])=>e.jsxs("div",{className:"px-4 pb-2",children:[e.jsxs("h3",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2 flex items-center space-x-1",children:[j(v),e.jsx("span",{children:v}),e.jsx("span",{className:"ml-1 bg-gray-200 text-gray-700 px-1 rounded text-xs",children:N.length})]}),N.map(C=>e.jsx(Gs,{item:C},C.id))]},v)),n.length===0&&s.length>0&&!o&&e.jsxs("div",{className:"px-4 py-8 text-center text-gray-500",children:[e.jsx(_t,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),e.jsxs("p",{className:"text-sm",children:['No results found for "',s,'"']}),e.jsx("p",{className:"text-xs mt-1",children:"Try searching for addresses, parcel numbers, or project names"})]})]})]}),e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-t border-gray-200 text-xs text-gray-600",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 rounded",children:"â†‘â†“"}),e.jsx("span",{children:"Navigate"})]}),e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 rounded",children:"âŽ"}),e.jsx("span",{children:"Select"})]})]}),e.jsxs("span",{className:"flex items-center space-x-1",children:[e.jsx("kbd",{className:"px-1 py-0.5 bg-gray-200 rounded",children:"Esc"}),e.jsx("span",{children:"Close"})]})]})})]})})})})]})})}function Gs({item:r}){return e.jsx(Yt.Option,{value:r,className:({active:t})=>`flex items-center px-3 py-2 rounded-lg cursor-pointer transition-colors ${t?"bg-blue-50 text-blue-900":"text-gray-900"}`,children:({active:t})=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`flex-shrink-0 mr-3 ${t?"text-blue-600":"text-gray-400"}`,children:r.icon}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:r.title}),r.subtitle&&e.jsx("p",{className:"text-sm text-gray-500 truncate",children:r.subtitle})]}),r.keyboard&&e.jsx("div",{className:"flex-shrink-0 ml-3",children:e.jsx("kbd",{className:"px-2 py-1 bg-gray-100 text-gray-600 text-xs rounded",children:r.keyboard})}),t&&e.jsx(Pe,{className:"w-4 h-4 text-blue-600 ml-2"})]})},r.id)}function Hr({children:r}){const{openDrawer:t,isMobile:s}=ke(),a=()=>s?t?"1fr 24rem":"1fr":t?"16rem 1fr 24rem":"16rem 1fr";return e.jsx("div",{className:"grid h-full w-full min-h-0",style:{gridTemplateColumns:a(),gridTemplateRows:"1fr"},children:r})}function Zr({children:r}){return e.jsx("div",{className:"fixed inset-0 z-40 pointer-events-none",children:e.jsx("div",{className:"pointer-events-auto",children:r})})}function Jr(){return e.jsx("a",{href:"#main-content",className:"skip-link",children:"Skip to main content"})}function Kr(){const[r,t]=x.useState(null),[s,a]=x.useState(!1),[n,i]=x.useState(!0),[o,l]=x.useState(!1),[c,u]=x.useState(!1),[d,m]=x.useState(!1),[h,g]=x.useState(!1),[y,j]=x.useState(!1),[b,v]=x.useState(!1),[N,C]=x.useState(!1),[p,_]=x.useState(!1),[w,P]=x.useState(!1),[U,R]=x.useState(!1),[q,k]=x.useState(!1),[D,Y]=x.useState([]),{isMobile:X,setIsMobile:A,commandPaletteOpen:E,setCommandPalette:J}=ke(),{commentsOpen:O,setCommentsOpen:re}=ke(),{id:ae}=De();la();const{project:K,createProject:de}=Ht();ee.useEffect(()=>{const me=()=>{A(window.innerWidth<1024)};return me(),window.addEventListener("resize",me),()=>window.removeEventListener("resize",me)},[A]),ee.useEffect(()=>{const me=qe=>{t(qe.detail),a(!0)};return document.addEventListener("openParcelDrawer",me),()=>document.removeEventListener("openParcelDrawer",me)},[]);const ne=me=>{t(me),a(!0)},W=()=>{a(!1),t(null)},oe=async me=>{const{addParcel:qe}=De.getState();await qe(String(me.ogc_fid||me.id),me),v(!0),t(me)},V=async me=>{const qe=`Project - ${me.address||"New Development"}`,st=de(qe),{set:$t,addParcel:Pt}=De.getState();$t(st.id,st.name),await Pt(String(me.ogc_fid||me.id),me),a(!1),t(me),v(!0)},ce=()=>{i(!1)},pe=me=>{Y(qe=>qe.filter(st=>st.id!==me))},ue=()=>{i(!1),l(!0)},te=()=>{u(!0)},Xe=()=>{u(!1)},Ve=()=>{m(!0)},ft=()=>{m(!1)},He=()=>{g(!0)},bt=()=>{g(!1)},he=()=>{j(!0)},Se=()=>{j(!1)},ie=()=>{_(!0)},Ze=()=>{_(!1)},Te=()=>{P(!0)},Je=()=>{P(!1)},Ke=()=>{R(!0)},tt=()=>{R(!1)},ze=()=>{v(!0)},Qe=()=>{v(!1)},fs=()=>{C(!0)},Ct=()=>{C(!1)};return n&&!ae?e.jsx(Hn,{onGetStarted:ue,onViewDemo:ce}):e.jsx(ma,{children:e.jsxs("div",{className:"min-h-screen h-screen flex flex-col overflow-hidden bg-gray-50",children:[e.jsx(Jr,{}),e.jsx("header",{className:"flex-none",children:e.jsx(hn,{onOpenUnifiedWorkspace:te,onOpenProjectWorkflow:Ve,onOpenSimpleProjectManager:He,onOpenConnectedProjectWorkflow:he,onOpenUnifiedProjectWorkflow:ze,onOpenRealUnderwritingWorkflow:fs,onOpenWorkflowAudit:ie,onOpenWorkflowConnectionTest:Te,onOpenParcelAnalysisDemo:Ke})}),e.jsx("div",{className:"flex-1 min-h-0",children:e.jsxs(Hr,{children:[e.jsx($r,{}),e.jsx("main",{id:"main-content",className:"relative min-w-0 bg-white flex-1 min-h-0",role:"main","aria-label":"Interactive parcel map",children:e.jsx(Nn,{onParcelClick:ne,activeProjectName:De.getState().name})}),window.innerWidth>=1024?e.jsx(Vs,{}):e.jsx(Zr,{children:e.jsx(Vs,{})})]})}),e.jsx(Gr,{}),e.jsx(Wr,{isOpen:E,onClose:()=>J(!1)}),ae&&O&&e.jsx("div",{className:"fixed right-4 bottom-4 z-50",children:e.jsx(ba,{projectId:ae,onClose:()=>re(!1)})}),e.jsx(Wn,{parcel:r,isOpen:s,onClose:W,onAddToProject:oe,hasActiveProject:!!K,onCreateProjectFromParcel:V}),e.jsx(Zn,{isOpen:o,onClose:()=>l(!1),onComplete:()=>l(!1)}),e.jsx(Kn,{isOpen:c,onClose:Xe,selectedParcel:r,onParcelSelect:t}),e.jsx(Qn,{isOpen:d,onClose:ft,selectedParcel:r,onParcelSelect:t}),e.jsx(er,{isOpen:h,onClose:bt,selectedParcel:r,onParcelSelect:t}),e.jsx(tr,{isOpen:y,onClose:Se,selectedParcel:r,onParcelSelect:t}),e.jsx(or,{isOpen:b,onClose:Qe,selectedParcel:r,onParcelSelect:t}),e.jsx(gr,{isOpen:N,onClose:Ct,selectedParcel:r,onParcelSelect:t}),e.jsx(pr,{isProjectWorkflowOpen:y,selectedParcel:r,onParcelSelect:t}),e.jsx(fr,{isOpen:p,onClose:Ze}),e.jsx(br,{isOpen:w,onClose:Je}),U&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Parcel Analysis Demo"}),e.jsx("button",{onClick:tt,className:"text-gray-500 hover:text-gray-700 text-2xl",children:"Ã—"})]}),e.jsx(Nr,{})]})}),e.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:D.map(me=>e.jsx(Jn,{type:me.type,title:me.title,message:me.message,onClose:()=>pe(me.id)},me.id))})]})})}const Qr=()=>{const r=document.createElement("link");r.rel="preload",r.href="https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css",r.as="style",document.head.appendChild(r)};Qr();class ei extends ee.Component{constructor(t){super(t),this.state={hasError:!1,error:null}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,s){console.error("App Error:",t,s)}render(){return this.state.hasError?e.jsx("div",{className:"min-h-screen bg-gray-100 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg max-w-md w-full",children:[e.jsx("div",{className:"text-red-600 mb-4",children:e.jsx("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 18.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h1",{className:"text-xl font-bold text-gray-900 mb-2 text-center",children:"Application Error"}),e.jsx("p",{className:"text-gray-600 text-center mb-4",children:"Something went wrong loading the application."}),!1,e.jsx("button",{onClick:()=>window.location.reload(),className:"w-full mt-4 bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors",children:"Reload Application"})]})}):this.props.children}}const Ws=document.getElementById("root");Ws?rn(Ws).render(e.jsx(x.StrictMode,{children:e.jsx(ei,{children:e.jsx(Kr,{})})})):console.error("Root element not found");
